### 分块 1
5.3传输控制协议TCP概述由千TCP协议比较复杂，因此本(cid:7188)先对TCP协议进行一(cid:7184)的介绍，然后再逐步深入讨论TCP的可靠传输、流量控制和拥塞控制等问题。
5.3.1TCP扫--扫视频讲解最主要的特点TCP是TCP/IP体系中非常复杂的一个协议。下面介绍TCP最主要的特点。
()TCP是面向连接的运输层协议。这就是说，应用程序在使用TCP协议之前，必须先
建立TCP连接。在传送数据完毕后，必须释放已经建立的TCP连接。也就是说，应用进程
之间的通信好像在：通话前要先拨号建立连接，通话结束后要挂机释放连接。
“打电话”(2)每一条TCP连接只(cid:7126)有两个端点(endpoint)，每一条TCP连接只(cid:7126)是点对点的（一对一）。这个问题后面还要进一步讨论。
(3)TCP提供可靠交付的服务。通过TCP连接传送的数据，无差错、不丢失、不重复，并且按序到达。
(4)TCP提供全双工通信。TCP允许通信双方的应用进程在任何时候都(cid:7126)发送数据。
TCP连接的两端都设有发送级存和接收缓存，用来临时存放双向通信的数据。在发送时，

### 分块 2
TCP连接的两端都设有发送级存和接收缓存，用来临时存放双向通信的数据。在发送时，
应用程序在把数据传送给TCP的缓存后，就可以做(cid:7151)己的事，而TCP在合适的时候把数据
发送出去。在接收时，TCP把收到的数据放入缓存，上层的应用进程在合适的时候读取缓
存中的数据。
“面向字(cid:7188)流(5)面向字(cid:7195)流。TCP中的“流”(stream)指的是流入到进程或从进程流出的字(cid:7195)序列。
”的含义是：虽然应用程序和TCP的交互是一次一个数据块（大小不等），但
TCP把应用程序交下来的数据仅仅看成是一连串的无结构的字(cid:7195)流。TCP并不知道所传送的
字(cid:7188)流的含义。TCP不保证接收方应用程序所收到的数据块和发送方应用程序所发出的数据
块具有对应大小的关系（例如，发送方应用程序交给发送方的TCP共10个数据块，但接收
方的TCP可(cid:7126)只用了4个数据块就把收到的字(cid:7188)流交付上层的应用程序）。但接收方应用程

### 分块 3
序收到的字(cid:7188)流必须和发送方应用程序发出的字(cid:7188)流完全一样。当然，接收方的应用程序必
须有(cid:7126)力识别收到的字(cid:7188)流，把它还原成有意义的应用层数据。图5-7是上述概念的示意图。
送方发匾应用进程字节流回表示TCP报文段的首部曰表示序号为x的数据字节＿0－流节字＿l_2一3一TCP连接像条管道，把字节流可靠地按序送到目的进程一图5-7TCP面向字节流的概念传•219•1为了突出示意图的要点，我们只画出了一个方向的数据流。但请注意，在实际的网络中，一个TCP报文段包含上千个字(cid:7188)是很常见的，而图中的各部分都只画出了几个字(cid:7188)，“面向字(cid:7188)流”的概念。另一点很重要的是：图5-7中的TCP
这仅仅是为了更方便地说明
连接是一条虚连接（也就是逻辑连接），而不是一条真正的物理连接。TCP报文段先要传送
到IP层，加上IP首部后，再传送到数据链路层；再加上数据链路层的首部和尾部后，才离
开主机发送到物理链路。

### 分块 4
开主机发送到物理链路。
从图5-7可看出，TCP和UDP在发送报文时所采用的方式完全不同。TCP并不关心应
用进程一次把多长的报文发送到TCP的缓存中，而是根据对方给出的窗口值和当前网络拥
塞的程度（后面还将深入讨论），来决定一个报文段应包含多少个字(cid:7188)(UDP发送的报文长
度是应用进程给出的）。如果应用进程传送到TCP缓存的数据块太长，TCP就可以把它划分
为短一些的数据块再传送。如果应用进程一次只发来一个字(cid:7188)，TCP也可以等待积累足够
多的字(cid:7188)后再构成报文段发送出去。关千TCP报文段的长度问题，在后面还要进行讨论。
5.3.2TCP的连接TCP把连接作为最基本的抽象。TCP的许多特性都与TCP是面向连接的这个基本特性有关。因此我们对TCP连接需要有更清楚的了解。
前面已经讲过，每一条TCP连接有两个端点。那么，TCP连接的端点是什么呢？不是

### 分块 5
前面已经讲过，每一条TCP连接有两个端点。那么，TCP连接的端点是什么呢？不是
主机，不是主机的IP地址，不是应用进程，也不是运输层的协议端口。TCP连接的端点叫作套接字(socket)或插口。根据RFC793的定义：端口号拼接到(concatenatedwith)IP地址即构成了套接字。因此，套接字的表示方法是在点分十进制的IP地址后面写上端口号，中间
用冒号或逗号隔开。例如，若IP地址是192.3.4.5而端口号是80,那么得到的套接字就是(192.3.4.5:80)。总之，我们有套接字socket=(IP地址：端口号）(5-1)每一条TCP连接唯一地被通信两端的两个端点（即套接字对socketpair)所确定。即：TCP连接：：＝｛socket1,socket2}={(IP1:port1),(IP2:port2)}(5-2)这里IP1和IP2分别是两个端点主机的IP地址，而port1和port2分别是两个端点主机中的端口号。因此，TCP连接就是两个套接字socket1和socket2之间的连接。套接字socket是

### 分块 6
个很抽象的概念，在下一章的6.8(cid:7188)还要对套接字进行更多的介绍。
总之，TCP连接就是由协议软件所提供的一种抽象。虽然有时为了方便，我们也可以
说，在一个应用进程和另一个应用进程之间建立了一条TCP连接，但一定要记住：TCP连
接的端点是个很抽象的套接字，即(IP地址：端口号）。也还应记住：同一个IP地址可以
有多个不同的TCP连接，而同一个端口号也可以出现在多个不同的TCP连接中。
本来socket的意思就是插座（或插口）。选用socket这个名词是相当准确的。其实一条
TCP连接就像一条电缆线，其两端都各带有一个插头。把每一端的插头插入位千主机的应
用层和运输层之间的插座(socket)后，两个主机之间的进程就可以通过这条电缆线进行可靠
通信了。但插座这个名词很容易让人想起来是个硬件，而socket是个软件名词，这样＂套
接字就成为socket的标准译名了。

### 分块 7
接字就成为socket的标准译名了。
”请注意，socket这个名词有时容易使人把一些概念弄混淆，因为随着互(cid:7110)网的不断发展•220•以及网络技术的进步，同一个名词socket却可表示多种不同的意思。例如：(1)允许应用程序访问连网协议的应用编程接口API(ApplicationProgrammingInterface),即运输层和应用层之间的一种接口，称为socketAPI,并简称为socket。
(2)在socketAPI中使用的一个函数名也叫作socket。
(3)调用socket函数的端点称为socket,如“创建一个数据报socket”。
(4)调用socket函数时，其返回值称为socket描述符，可简称为socket。
(5)在操作系统内核中连网协议的Berkeley实现，称为socket实现。
上面的这些socket的意思都和本章所引用的RFC793定义的socket（指端口号拼接到IP地址）不同。请读者加以注意。
5.4可靠传输的工作原理我们知道，TCP发送的报文段是交给IP层传送的。但IP层只能提供尽最大努力服务，

### 分块 8
也就是说，TCP下面的网络所提供的是不可靠的传输。因此，TCP必须采用适当的措施才
能使得两个运输层之间的通信变得可靠。
理想的传输条件有以下两个特点：
(1)传输信道不产生差错。
(2)不管发送方以多快的速度发送数据，接收方总是来得及处理收到的数据。
在这样的理想传输条件下，不需要采取任何措施就能够实现可靠传输。
然而实际的网络都不具备以上两个理想条件。但我们可以使用一些可靠传输协议，当
出现差错时让发送方重传出现差错的数据，同时在接收方来不及处理收到的数据时，及时告
诉发送方适当降低发送数据的速率。这样一来，本来不可靠的传输信道就能够实现可靠传输
了。下面从最简单的停止等待协议气井起。
5.4.1停止等待协议全双工通信的双方既是发送方也是接收方。下面为了讨论问题的方便，我们仅考虑A
发送数据而B接收数据并发送确认。因此A叫作发送方，而B叫作接收方。因为这里是讨
论可靠传输的原理，因此把传送的数据单元都称为分组，而并不考虑数据是在哪一个层次上
传送的气“停止等待”就是每发送完一个分组就停止发送，等待对方的确认。在收到确认
后再发送下一个分组。

### 分块 9
后再发送下一个分组。
1.无差错情况停止等待协议可用图5-8来说明。图5-8(a)是最简单的无差错情况。A发送分组Ml，发
完就暂停发送，等待B的确认。B收到了M1就向A发送确认。A在收到了对M1的确认后，O注：在计算机网络发展初期，通信链路不太可靠，因此在链路层传送数据时都要采用可靠的通信协议。其中最简单的协议就是这种
层使用的可靠传输协议要复杂得多（见后面5.6节）。
停止等待协议“”。在运输层并不使用这种协议，这里只是为了引出可靠传输的问题才从最简单的概念讲起。在运输＠注：运输层传送的协议数据单元叫作报文段，网络层传送的协议数据单元叫作IP数据报。但在般讨论问题时，都可把它们简称为分组。
一•221•

