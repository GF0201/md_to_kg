### 分块 1
一一两大类：类就是前面所说的最基本的比特差错，而另类传输差错则更复杂些，这就是收到的帧并没有出现比特差错，但却出现了帧丢失、帧重复或帧失序。例如，发送方连续传送一三个帧：［＃1]-[#2]-[#3]。假定接收端收到的每个帧都没有比特差错，但却出现下面的几种情况：帧丢失：收到[#l]-[#3]（丢失[#2]）。
帧重复：收到[#1]-[#2]-[#2]-[#3]（收到两个[#2])。
一帧失序：收到[#1]-[#3]-[#2]（后发送的帧反而先到达了接收端，这与一般数据链路层的传输概念不样）。
”＂“＂以上三种情况都属千出现传输差错，但都不是这些帧里有比特差错。帧丢失很容易理解。但出现帧重复和帧失序的情况则较为复杂，对这些问题我们现在不展开讨论。在学完第5章的5.4节后，我们就会知道在什么情况下接收端可能会出现帧重复或帧失序。
“”“”总之，我们应当明确，无比特差错与无传输差错并不是同样的概念。在数据链路层使用CRC检验，能够实现无比特差错的传输，但这还不是可靠传输。
我们知道，过去OSI的观点是：必须让数据链路层向上提供可靠传输。因此在CRC检

### 分块 2
我们知道，过去OSI的观点是：必须让数据链路层向上提供可靠传输。因此在CRC检
错的基础上，增加了帧编号、确认和重传机制。收到正确的帧就要向发送端发送确认。发送一端在定的期限内若没有收到对方的确认，就认为出现了差错，因而就进行重传，直到收到对方的确认为止。这种方法在历史上曾经起到很好的作用。但现在的通信线路的质量已经大大提高了，由通信链路质量不好引起差错的概率已经大大降低。因此，现在互联网就采取了区别对待的方法：对于通信质量良好的有线传输链路，数据链路层协议不使用确认和重传机制，即不要求数据链路层向上提供可靠传输的服务。如果在数据链路层传输数据时出现了差错并且需要进行改正，那么改正差错的任务就由上层协议（例如，运输层的TCP协议）来完成。
对千通信质量较差的无线传输链路，数据链路层协议使用确认和重传机制，数据链路层向上提供可靠传输的服务（见第9章）。
实践证明，这样做可以提高通信效率。
可靠传输协议将在第5章中讨论。本章介绍的数据链路层协议都不是可靠传输的协议。
3.2点对点协议PPP在通信线路质量较差的年代，在数据链路层使用可靠传输协议曾经是种好办法。因

### 分块 3
3.2点对点协议PPP在通信线路质量较差的年代，在数据链路层使用可靠传输协议曾经是种好办法。因
此，能实现可靠传输的高级数据链路控制HDLC(High-levelDataLinkControl)就成为当时比较流行的数据链路层协议。但现在HDLC已很少使用了。对千点对点的链路，简单得多的点对点协议PPP(Point-to-PointProtocol)则是目前使用得最广泛的数据链路层协议。
3.2.1PPP协议的特点一我们知道，互联网用户通常都要连接到某个ISP才能接入到互联网。PPP协议就是用户计算机和ISP进行通信时所使用的数据链路层协议（如图3-9所示）。
•78•用户已从互联网管理机构
申请到
批IP地址一ISP至互联网-PPP协议伸图3-9用户到ISP的链路使用协议PPPPPP协议是IETF在1992年制定的。经过1993年和1994年的修订，现在的PPP协议在1994年就已成为互联网的正式标准[RFC1661,STD51]。
1.PPP协议应满足的需求IETF认为，在设计PPP协议时必须考虑以下多方面的需求[RFC1547]:

### 分块 4
(1)简单IETF在设计互联网体系结构时把其中最复杂的部分放在TCP协议中，而
网际协议IP则相对比较简单，它提供的是不可靠的数据报服务。在这种情况下，数据链路层没有必要提供比IP协议更多的功能。因此，对数据链路层的帧，不需要纠错，不需要序“”号，也不需要流星控制。IETF把简单作为首要的需求。
简单的设计还可使协议在实现时不容易出错，从而使不同厂商在协议的不同实现上的一互操作性提高了。我们知道，协议标准化的个主要目的就是提高协议的互操作性。
一总之，这种数据链路层的协议非常简单：接收方每收到CRC检验正确，就收下这个帧；反之，就丢弃这个帧，其他什么也不做。
个帧，就进行CRC检验。如
一(2)封装成帧PPP协议必须规定特殊的字符作为帧定界符（即标志个帧的开始和结束的字符），以便使接收端从收到的比特流中能准确地找出帧的开始和结束位置。
一
(3)透明性PPP协议必须保证数据传输的透明性。这就是说，如果数据中碰巧出现了和帧定界符样的比特组合时，就要采取有效的措施来解决这个问题（见3.2.2节）。

### 分块 5
一(4)多种网络层协议PPP协议必须能够在同条物理链路上同时支持多种网络层协议（如IP和IPX等）的运行。当点对点链路所连接的是局域网或路由器时，PPP协议必须同时支持在链路所连接的局域网或路由器上运行的各种网络层协议。
一一一除了要支持多种网络层的协议外，PPP还必须能够在多种类型的(5)多种类型链路
链路上运行。例如，串行的（次只发送个比特）或并行的（次并行地发送多个比特），同步的或异步的，低速的或高速的，电的或光的，交换的（动态的）或非交换的（静态的）点对点链路。
这里特别要提到的是在1999年公布的在以太网上运行的PPP,即PPPoverEthernet,简
个典型例子。PPPoE是称为PPPoE[RFC2516]，这是PPP协议能够适应多种类型链路的一为宽带上网的主机使用的链路层协议。这个协议把PPP帧再封装在以太网帧中（当然还要一增加些能够识别各用户的功能）。宽带上网时由千数据传输速率较高，因此可以让多个连一一个用户利用ADSL进
条到ISP的宽带链路。现在，即使只有
接在以太网上的用户共享

### 分块 6
条到ISP的宽带链路。现在，即使只有
接在以太网上的用户共享
行宽带上网（并不和其他人共享到ISP的宽带链路），也是使用PPPoE协议，见后面的3.5.4节的讨论。
•79•订(6)差错检测(eordetection)PPP协议必须能够对接收端收到的帧进行检测，并立即丢弃有差错的帧。若在数据链路层不进行差错检测，那么已出现差错的无用帧就还要在网络中继续向前转发，因而会臼臼浪费许多的网络资源。
一(7)检测连接状态PPP协议必须具有种机制能够及时（不超过几分钟）自动检测一出链路是否处千正常工作状态。当出现故障的链路隔了段时间后又重新恢复正常工作时，就特别需要有这种及时检测功能。
一(8)最大传送单元PPP协议必须对每种类型的点对点链路设置最大传送单元MTU的标准默认值气这样做是为了促进各种实现之间的互操作性。如果高层协议发送的
分组过长并超过MTU的数值，PPP就要丢弃这样的帧，并返回差错。需要强调的是，MTU是数据链路层的帧可以载荷的数据部分的最大长度，而不是帧的总长度。

### 分块 7
一(9)网络层地址协商PPP协议必须提供种机制使通信的两个网络层（例如，两个IP层）的实体能够通过协商知道或能够配置彼此的网络层地址。协商的算法应尽可能简单，并且能够在所有的情况下得出协商结果。这对拨号连接的链路特别重要，因为如果仅仅在链路层建立了连接而不知道对方网络层地址，则还不能够保证网络层可以传送分组。
一(10)数据压缩协商PPP协议必须提供种方法来协商使用数据压缩算法。但PPP协议并不要求将数据压缩算法进行标准化。
在TCP/IP协议族中，可靠传输由运输层的TCP协议负责，因此数据链路层的PPP协议不需要进行纠错，不需要设置序号，也不需要进行流量控制。PPP协议不支持多点线路一（即个主站轮流和链路上的多个从站进行通信），而只支持点对点的链路通信。此外，PPP协议只支持全双工链路。
2.PPP协议的组成一PPP协议有三个组成部分：
(1)个将IP数据报封装到串行链路的方法。PPP既支持异步链路（无奇偶检验的8比
特数据），也支持面向比特的同步链路。IP数据报在PPP帧中就是其信息部分。这个信息部
分的长度受最大传送单元MTU的限制。

### 分块 8
分的长度受最大传送单元MTU的限制。
一(2)个用来建立、配置和测试数据链路连接的链路控制协议LCP(LinkControl一Protocol)。通信的双方可协商一@
些选项。在RFC1661中定义了11种类型的LCP分组。
一(3)套网络控制协议NCP(NetworkControlProtocol),其中的每个协议支持不同的网络层协议，如IP、OSI的网络层、DECnet和AppleTalk等。
协议的帧格式3.2.2PPP1.各字段的意义PPP的帧格式如图3-10所示。PPP帧的首部和尾部分别为四个字段和两个字段。
一“首部的第个字段和尾部的第二个字段都是标志字段F(Flag)，规定为Ox7E（符号Ox"表示它后面的字符是用十六进制表示的。十六进制的7E的二进制表示是01111110)。标志注：MTU的默认值是1500字节。在RFC1661中，MTU叫作最大接仅单元MRU(MaximumReceiveUnit)。
CD
＠注：TCP的早期版本也叫什NCP,但它和这里所讨论的NCP没有关系。
•80•一一

### 分块 9
CD
＠注：TCP的早期版本也叫什NCP,但它和这里所讨论的NCP没有关系。
•80•一一
字段表示个帧的开始或结束。因此标志字段就是PPP帧的定界符。连续两帧之间只需要一用个标志字段。如果出现连续两个标志字段，就表示这是个空帧，应当丢弃。
首部中的地址字段A规定为OxFF（即11111111)，控制字段C规定为Ox03（即
00000011)。最初曾考虑以后再对这两个字段的值进行其他定义，但至今也没有给出。可见
这两个字段实际上并没有携带PPP帧的信息。，，可变长度IP数据报字节1I122不超过1500字节
PPP帧图3-10PPP帧的格式PPP首部的第四个字段是2字节的协议字段。当协议字段为Ox0021时，PPP帧的信息
字段就是IP数据报。若为OxC021,则信息字段是PPP链路控制协议LCP的数据，而
Ox8021表示这是网络层的控制数据。
信息字段的长度是可变的，不超过1500字节。
尾部中的第一个字段(2字节）是使用CRC的帧检验序列FCS。

### 分块 10
尾部中的第一个字段(2字节）是使用CRC的帧检验序列FCS。
2.字节填充一一当信息字段中出现和标志字段一样的比特(Ox7E)组合时，就必须采取些措施使这种形式上和标志字段样的比特组合不出现在信息字段中。
当PPP使用异步传输时，它把转义符定义为Ox7D（即01111101)，并使用字节填充，RFC1662规定了如下所述的填充方法：一(1)把信息字段中出现的每一个Ox7E字节转变成为2字节序列(Ox7D,Ox5E)。
一(2)若信息字段中出现个Ox7D的字节（即出现了和转义字符样的比特组合），则把Ox7D转变成为2字节序列(Ox7D,Ox5D)。
一(3)若信息字段中出现ASCII码的控制字符（即数值小于Ox20的字符），则在该字符前
“
面要加入个Ox7D字节，同时将该字符的编码加以改变。例如，出现Ox03（在控制字符中“是传输结束ETX)就要把它转变为2字节序列(Ox7D,Ox23)。
巾千在发送端进行了字节填充，因此在链路上传送的信息字节数就超过了原来的信息字节数。但接收端在收到数据后再进行与发送端字节填充相反的变换，就可以正确地恢复出原来的信息。

### 分块 11
3.零比特填充一PPP协议用在SONET/SDH链路时，使用同步传输（连串的比特连续传送）而不是异步传输（逐个字符地传送）。在这种情况下，PPP协议采用零比特填充方法来实现透明传输。
零比特填充的具体做法是：在发送端，先扫描整个信息字段（通常用硬件实现，但也一可用软件实现，只是会慢些）。只要发现有5个连续1,则立即填入个0。因此经过这种零一比特填充后的数据，就可以保证在信息字段中不会出现6个连续l。接收端在收到个帧时，•81•先找到标志字段F以确定一个帧的边界，接着再用硬件对其中的比特流进行扫描。每当
发现5个连续1时，就把这5个连续l后的一个0删除，以还原成原来的信息比特流（如
图3-11所示）。这样就保证了透明传输：在所传送的数据比特流中可以传送任意组合的比特流，而不会引起对帧边界的错误判断。
信息字段中出现了和
标志字段F完全
样
的8比特组合一发送端在5个连续1之后
填入0比特再发送出去在接收端把5个连续l
之后的0比特删除00F1
o01111o
1
1
Au0o01010发送端填入比特o1
o0111111
o001010接收端删入的0上
特七0
几
V
填

### 分块 12
o0111111
o001010接收端删入的0上
特七0
几
V
填
除3.2.3PPP协议的工作状态图3-11零比特的填充与删除上一节我们通过PPP帧的格式讨论了PPP帧是怎样组成的。但PPP链
路一开始是怎样被初始化的？当用户拨号接入ISP后，就建立了一条从用户
个人电脑到ISP的物理连接。这时，用户个人电脑向ISP发送一系列的链路
控制协议LCP分组（封装成多个PPP帧），以便建立LCP连接。这些分组及其响应选择了
将要使用的一些PPP参数。接着还要进行网络层配置，网络控制协议NCP给新接入的用户
个人电脑分配一个临时的IP地址。这样，用户个人电脑就成为互联网上的一个有IP地址的
主机了。
视频讲解当用户通信完毕时，NCP释放网络层连接，收回原来分配出去的IP地址。接着，LCP释放数据链路层连接。最后释放的是物理层的连接。
上述过程可用如图3-12所示的状态图来描述。
PPP链路的起始和终止状态永远是图3-12中的“链路静止”用户个人电脑和ISP的路由器之间并不存在物理层的连接。
(LinkDead)状态，这时在LCP链路
终止链路故障或

### 分块 13
(LinkDead)状态，这时在LCP链路
终止链路故障或
关闭请求鉴别失败设备之间无链路I物理链路ILCP链路功或无须鉴别1置协商已鉴别的LCP链路l已鉴别的LCP链路
和NCP链路•82•图3-12PPP协议的状态图当用户个人电脑通过调制解调器呼叫路由器时（通常是在屏幕上用鼠标点击一个连接按钮），路由器就能够检测到调制解调器发出的载波信号。在双方建立了物理层连接后，
PPP就进入“链路建立”(LinkEstablish)状态，其目的是建立链路层的LCP连接。
这时LCP开始协商一些配置选项，即发送LCP的配置请求帧(Configure-Request)。这是
个PPP帧，其协议字段置为LCP对应的代码，而信息字段包含特定的配置请求。链路的另
一端可以发送以下几种响应中的一种：(1)配置确认帧(Configure-Ack)：所有选项都接受。
(2)配置否认帧(Configure-Nak)：所有选项都理解但不能接受。
(3)配置拒绝帧(Configure-Reject)：选项有的无法识别或不能接受，需要协商。

### 分块 14
(3)配置拒绝帧(Configure-Reject)：选项有的无法识别或不能接受，需要协商。
LCP配置选项包括链路上的最大帧长、所使用的鉴别协议(AuthenticationProtocol)的规
约（如果有的话），以及不使用PPP帧中的地址和控制字段（因为这两个字段的值是固定的，
没有任何信息量，可以在PPP帧的首部中省略这两个字节）。
协商结束后双方就建立了LCP链路，接着就进入＂鉴别”(Authenticate)状态。在这一
状态，只允许传送LCP协议的分组、鉴别协议的分组以及监测链路质量的分组。若使用口
令鉴别协议PAP(PasswordAuthenticationProtocol)，则需要发起通信的一方发送身份标识符
和口令。系统可允许用户重试若干次。如果需要有更好的安全性，则可使用更加复杂的口令握手鉴别协议CHAP(Challenge-HandshakeAuthenticationProtocol)。若鉴别身份失败，则转
到“链路终止”(LinkTerminate)状态。若鉴别成功，则进入“网络层协议”(Network-Layer
Protocol)状态。

### 分块 15
Protocol)状态。
在“网络层协议”状态，PPP链路两端的网络控制协议NCP根据网络层的不同协议互相交换网络层特定的网络控制分组。这个步骤是很重要的，因为现在的路由器都能够同时支持多种网络层协议。总之，PPP协议两端的网络层可以运行不同的网络层协议，但仍然可使
用同一个PPP协议进行通信。
如果在PPP链路上运行的是IP协议，则对PPP链路的每一端配置IP协议模块（如分
配IP地址）时就要使用NCP中支持IP的协议IP控制协议IPCP(IPControlProtocol)。
IPCP分组也封装成PPP帧（其中的协议字段为Ox8021)在PPP链路上传送。在低速链路上运行时，双方还可以协商使用压缩的TCP和IP首部，以减少在链路上发送的比特数。
当网络层配置完毕后，链路就进入可进行数据通信的＂链路打开”(LinkOpen)状态。链
路的两个PPP端点可以彼此向对方发送分组。两个PPP端点还可发送回送请求LCP分组(Echo-Request)和回送回答LCP分组(Echo-Reply)，以检查链路的状态。

### 分块 16
数据传输结束后，可以由链路的一端发出终止请求LCP分组(Terminate-Request)请求终
止链路连接，在收到对方发来的终止确认LCP分组(Terminate-Ack)后，转到“链路终止”
状态。如果链路出现故障，也会从“链路打开“状态转到“链路终止”状态。当调制解调器
的载波停止后，则回到＂链路静止”状态。
图3-12右方的灰色方框给出了对PPP协议的几个状态的说明。从设备之间无链路开始，到先建立物理链路，再建立链路控制协议LCP链路。经过鉴别后再建立网络控制协议NCP链路，然后才能交换数据。由此可见，PPP协议已不是纯粹的数据链路层的协议，它还包含了物理层和网络层的内容。
•83•

