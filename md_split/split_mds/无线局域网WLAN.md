### 分块 1
第9章无线网络和移动网络近几十年来，无线蜂窝电话通信技术得到了飞速发展。现在移动电话数已经超过了发
展历史达一百多年的固定电话数。据ITU的统计，在2015年，全世界移动电话的普及率
已达到96.8%[W-ITU]，大大超过了当时固定电话14.5％的普及率。据工信部2020年上半年
的统计，我国的移动电话用户已超过15.9亿户，也大大超过了固定电话的用户数1.88亿户
（固定电话的总数仍在逐年下降）。
对移动通信的这种需要也必然反映到计算机网络中。人们也希望能够在移动中使用计算机网络。如果说，互联网在过去曾是PC互联网，那么现在就应当是移动互联网了。
由于无线网络和移动网络的数据链路层与传统的有线互联网的数据链路层相差很大，因此有必要单列一章来讨论这个问题。
本章先讨论无线局域网WLAN,其重点是无线局域网MAC层协议载波监听多点接入／
碰撞避免CSMA/CA的原理；接着对无线个人区域网WPAN和无线城域网WMAN进行简
单的介绍；最后简要介绍一下蜂窝移动通信网。本来，这种蜂窝移动通信网属于通信领域的
内容，与计算机网络并无关联。但是随着技术的发展，情况发生了根本的变化：蜂窝移动通

### 分块 2
内容，与计算机网络并无关联。但是随着技术的发展，情况发生了根本的变化：蜂窝移动通
信网已演进到全部使用IP技术。按照计算机网络对主机的定义，现在的智能手机已经变成
了计算机网络上的主机。因此在本书中也应对无线蜂窝通信网进行适当的介绍。
本章最重要的内容是：
(1)无线局域网的组成，特别是分配系统DS(DistributionSystem)和接入点AP(AccessPoint)的作用。
(2)无线局域网使用的CSMA/CA协议（弄清与载波监听多点接入／碰撞检测CSMA/CD的区别）和无线局域网MAC帧使用的几种地址。
(3)蜂窝移动通信网的基本概念以及与互联网互连的方法。
9.1无线局域网WLAN在局域网刚刚问世后的一段时间，无线局域网的发展比较缓慢，原因是价格贵、数据
传输速率低、安全性较差，以及使用登记手续复杂（使用无线电频率必须得到有关部门的批
准）。但自20世纪80年代末以来，由千人们工作和生活节奏的加快以及移动通信技术的飞
速发展，无线局域网也就逐步进入市场。无线局域网提供了移动接入的功能，这就给许多需

### 分块 3
速发展，无线局域网也就逐步进入市场。无线局域网提供了移动接入的功能，这就给许多需
要发送数据但又不能坐在办公室的工作人员提供了方便。当一个工厂跨越的面积很大时，若
要将各个部门都用电缆连接成网，其费用可能很高；但若使用无线局域网，不仅节省了投资，
另外，当大量持有便携式计算机的用户在一个地方同时要求上网
而且建网的速度也会较快。
时（如在图书馆或股票交易大厅里），若用电缆连网，恐怕连铺设电缆的位置都很难找到。
而用无线局域网则比较容易。由千手机普及率日益增高，通过无线局域网接入到互联网已成
为当今上网最常用的方式。无线局域网常简写为WLAN(WirelessLocalAreaNetwork)。
请读者注意，便携站(portablestation)和移动站(mobilestation)表示的意思并不一样。便•405•携站当然是便于移动的，但便携站在工作时其位置是固定不变的。
而移动站不仅能够移动，而且还可以在移动的过程中进行通信（正在进行的应用程序感觉不到计算机位置的变化，也
不因计算机位置的移动而中断运行）。移动站一般使用电池供电。

### 分块 4
不因计算机位置的移动而中断运行）。移动站一般使用电池供电。
9.1.1无线局域网的组成无线局域网可分为两大类。第一类是有基础设施的，第二类是无基础设施的。本章主要介绍第一类无线局域网。
1.IEEE802.11对于第一类有基础设施的无线局域网，1997年IEEE制定出无线局域网协议802.11系列
标准。2003年5月，我国颁布了WLAN的国家标准，该标准采用1S0/IEC8802-11系列国际
标准，并针对WLAN的安全问题，把国家对密码算法和无线电频率的要求纳入了进来。它
是基千国际标准的符合我国安全规范的WLAN标准，是属于国家强制执行的标准。该国标
在2004年6月已经正式执行，不符合此标准的WLAN产品将不允许出现在国内市场上。
802.11是个相当复杂的标准。但简单地说，802.11就是无线以太网的标准，它使用星形拓扑。无线局域网的中心叫作接入点AP(
AccessPoint)，它是无线局域网的基础设施，也是

### 分块 5
AccessPoint)，它是无线局域网的基础设施，也是
一个链路层的设备。接入点AP也叫作无线接入点WAP(WirelessAccessPoint)。所有在无线局域网中的站点，对网内或网外的通信，都必须通过接入点AP。现在的无线局域网的接入
点AP往往具有100Mbit/s或1Gbit/s的端口，用来连接到有线以太网。家庭使用的无线局
域网接入点AP,为了方便居民上网，就把IP层的路由器的功能也嵌入进来。因此家用的接
入点AP往往又称为无线路由器（直接用网线连接到家中墙上的RJ-45插孔即可）。但企业
或机构使用的接入点AP还是和路由器分开的。
802.11无线局域网的MAC层使用CSMA/CA协议（在后面的9.1.3节讨论）。现在
802.11系列标准的无线局域网常称为Wi-Fi。曾经广为流传的“Wi-Fi是Wireless-Fidelity的
缩写“其实是错误的（本书的前几个版本也曾这样写过）。这点在Wi-Fi的官网可以查到[W­
WiFi]。Wi-Fi是非营利性国际组织Wi-Fi联盟(Wi-FiAlliance)的一个标记。Wi-Fi联盟对通过

### 分块 6
其互操作性测试的产品就发给这样的注册商标。和，表明是经过Wi-Fi联盟认证的。从2000年起到2020年，全球有Wi-Fi注册商标认证的产品已超过150亿个。Wi-Fi的写法并
无统一规定，如WiFi,Wifi,Wi-fi等都能在文献中见到。
802.11标准规定无线局域网的最小构件是基本服务集BSS(BasicServiceSet)。一个基本
服务集BSS包括一个接入点和若干个移动站（这里所说的移动站，也可包括不经常搬动的台
式电脑。这种电脑的主板上都装有Wi-Fi适配器）。各站在本BSS以内之间的通信，或者与外
部站点的通信，都必须通过本BSS的接入点。当网络管理员安装AP时，
必须为该AP分配
一个不超过32字节的服务集标识符SSID(ServiceSetIDentifier)(j)和一个通信信道。SSID就
是指使用该AP的无线局域网的名字。SSID使用字符串而不使用二进制数字的理由就是字CD注：例如，对千使用WindowsJO的计算机，点击“”““”开始

### 分块 7
＂-"Windows系统一控制面板一网络和Internet"”“”“一网络和共享中心，下面有三个选项，点击连接到网络，就可以看见在每个无线局域网的覆盖范围内的网络名SSID。
这些网络名可以由设备AP的生产厂家预先给出，也可以由局域网的管理员更改为另外的名字。
•406•符串便千记忆。一个基本服务集BSS所覆盖的地理范围叫作一个基本服务区BSA(BasicServiceArea)。基本服务区BSA和(cid:4876)线移动通信的蜂窝小区相似。(cid:4876)线局域网的基本服务区BSA的范围直径一般不超过100米。我们知道，在网络通信中，链路层设备的唯一标志是其MAC地址。接入点AP在出厂时就已有了
正式名称是基本服务集标识符BSSID。在(cid:4877)线局域网中传送的各种帧的首部中个唯的48位二进制数字的MAC地址，其，都必须有一一节点的MAC地址（即BSSID,但不是SSID)。请不要把BSSID和SSID弄混。用户通常都知道所连接的(cid:4877)线局域网的名SSID,但可以不知道其MAC地址BSSID。

### 分块 8
现在简单介绍一下(cid:4877)线局域网所用的信道(channel)的概念。(cid:4875)线局域网通常使用的频段是2.4GHz和5GHz频段。每
如，在2.4GHz频段中有大约85MHz的带宽可用。802.llb标准定义了11个部分重叠的信个频段又再划分为若干个信道，供各(cid:4877)线局域网使用。例一道集。相邻信道的中心频率相差5MHz,而每个信道的带宽约为22MHz。因此，仅当两个信道由四个或更多信道隔开时它们彼此才(cid:4877)重叠。其中，信道1,6和11的集合是唯一的三个非重叠信道的集合。现在已经广泛使用的(cid:4877)线路由器就是典型的接入点设备，并且在出厂时就预先设置了SSID和使用的信道（用户也可以自行更改）。例如，当发现附近的接入点使用的频道对自己有干扰时，就可以重(cid:4843)设置本服务集接入点的工作信道。
一个基本服务集可以是孤立的单个服务集，也可通过接入点AP连接到

### 分块 9
一个基本服务集可以是孤立的单个服务集，也可通过接入点AP连接到
一一DS(DistributionSystem)，然后再连接到另个基本服务集，这样就构成了个扩展服务集一个分配系统ESS(ExtendedServiceSet)。ESS也有个标识符，是不超过32字符的字符串名字而不是地址，
叫作扩展服务集标识符ESSID（如图9-1所示）。分配系统的作用就是使扩展的服务集ESS对上层的表现就像一个基本服务集BSS一样。分配系统可以使用以太网（这是最常用的）、点对点链路或其他(cid:4877)线网络。扩展服务集ESS还可为(cid:4876)线用户提供到802.x局域网（也就是
非802.11(cid:4877)线局域网）的接入。这种接入是通过叫作门户(portal)的设备来实现的。门户是
一
802.11定义的(cid:4843)名词，其实它的作用就相当于个扩展服务集内几个不同的基个网桥。在一本服务集也可能有相交的部分。图9-1中的移动站A如果要和另
个基本服务集中的移动

### 分块 10
个基本服务集中的移动
站B通信，就必须经过两个接入点AP1和AP2,即A-AP]-AP2-B。我们应当注意到，在一图9-1的例子中，从AP1到AP2的通信是使用有线传输的。
DS＇，＇＇
,，分配系统，夕－－－－－－－－－一一一一一一一了三勹___l_＿＿＿＿＿＿＿＿＿__＿_＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿+－－－－－－－－－
至其他802.x
局域网
扩展服务集
1
，＇，，＇夕，夕，口＿一＿一＿＿
·······门户
－
－－－
－－
ESS
－
---
，容．．·••
名：ESSIDj
．
..
..
·.....
:
，屯，飞
··
＇，，
..
．
;
，
．
＇，
．
｀`l··
··?
,
｀、、、、、基本服务集BSSi飞;-))
，
，
、、
臣－－－夕T-Z-－～～
、、、、、:
.:··...
拟袋；心“心，＇｝｝
i
�I\....I!,,/,'
＇邕．．．．．．
`、、、、巨三贮心s2—\\嫣＇岱磁夥签淤窃淤嫉怨｀甚．生、、｀基`｀`袅恣滋党揉

### 分块 11
`、、、、巨三贮心s2—\\嫣＇岱磁夥签淤窃淤嫉怨｀甚．生、、｀基`｀`袅恣滋党揉
`—三-图9-1IEEE802.11的基本服务集BSS和扩展服务集ESS我们还应注意到，图9-1所示的两个基本服务集的覆盖范围有重合的地(cid:4851)。为了避免在这种重合的地(cid:4851)出现不同信道的相互干扰，这两个接入点所选择的工作信道，必须相隔5个或更多的信道。
图9-1画出了移动站A漫游的情况。但移动站A漫游到图中的位置A1时，就能够同时•407•收到两个接入点的信号。这时，移动站A可以选择和信号较强的一个接入点联系。当移动站漫游到位置A2时，就只能和接入点AP2联系了。移动站只要能够和其中一个接入点联系一一直可保持与另上，就
电磁波的辐射范围确定的。在图9-1中用一个移动站B的通信。基本服务集的服务范围是由移动站所发射的个虚线椭圆来表示基本服务区的范围。由千实际地形条件可能是多种多样的，一个服务区的覆盖范围可能是很不规则的几何形状。

### 分块 12
802.11标准并没有定义如何实现漫游，但定义了一些基本的工具。例如，一个移动站若一要加入个基本服务集BSS,就必须先与某个接入点AP建立关联(association)。建立关联就表示这个移动站加入了选定的AP所属的子网，并和这个接入点AP创建了一个虚拟线路。
只有已关联的AP才向这个移动站发送数据帧，而这个移动站也只有通过关联的AP才能向其他站点发送数据帧。这和手机开机后必须和附近的某个基站建立关联的概念是相似的。
移动站与接入点AP建立关联的(cid:4851)法有两种。一种是被动扫描（如图9-2(a)所示），其过程如下：0接入点AP周期性发出（例如每秒10次）信标帧(beaconframe)，其中包含有若干系统参数（如服务集标识符SSID以及支持的速率等）。图9-2(a)表示移动站A收到了两个接入点发出的信标帧。
＠移动站A扫描11个信道，选择愿意加入接入点AP2所在的基本服务集BSS2,千是向AP2发出关联请求帧(AssociationRequestframe)。

### 分块 13
＠接入点AP2同意移动站A发来的关联请求，向移动站A发送关联响应帧(AssociationResponseframe)。
这样，移动站A和接入点AP2的关联就建立了。
1BSS、、、、、、,，＇----BSS厂；`、`---------­(a)、-、----------、、``、`APr,
~'
,
'
｀l
＇
,
,
'，
＇
，,＇,＇'，,i(b)图9-2被动扫描(a)与主动扫描(b)一另种建立关联的(cid:4851)法是主动扫描（如图9-2(b)所示），其步骤如下：0移动站A主动发出广播的探测请求帧(ProbeRequestframe)，让所有能够收到此帧的接入点都能够知道有移动站要求建立关联（见图9-2(b)中的多个虚线箭头）。
＠现在两个接入点都回答探测响应帧(ProbeResponseframe)。
＠移动站A向AP2发出关联请求帧。
0接入点AP2向移动站A发送关联响应帧，与移动站A建立了关联。
一个基本服务集BSS能够为更多的移动站提供服务，往往在为了使一个BSS内安装有多个接入点AP。有时

### 分块 14
一个基本服务集BSS能够为更多的移动站提供服务，往往在为了使一个BSS内安装有多个接入点AP。有时
一一AP中选择个建立关联。通常可以选择信号最强的个AP。但有时也可能该AP提供的信一个移动站也可以收到本服务集以外的AP信号。移动站只能在多个道都已被其他移动站占用了。在这种情况下，也只能与信号强度稍差些的AP建立关联。
此后，这个移动站就和选定的AP互相使用802.11关联协议进行对话。移动站点还要•408•向该AP鉴别自身。现在的接入点AP在出厂时就已经嵌入了DHCP模块。因此在关联建立
后，移动站点通过关联的AP向该子网发送DHCP发现报文就可以获取IP地址。这时，互
联网中的其他部分就把这个移动站当作该AP子网中的一台主机。
若移动站使用重建关联(reassociation)服务，就可把这种关联转移到另一个接入点。当使用分离(dissociation)服务时，就可终止这种关联。
一个移动站可以同时进行主动扫描和被动扫描，这样可以更加迅速地和AP建立关联。
802.11标准没有规定移动站应选择哪一种扫描方式。但很多移动站愿意使用被动扫描，这样
可以节省移动站的电源功率消耗。

### 分块 15
可以节省移动站的电源功率消耗。
现在许多地方，如办公室、机场、快餐店、旅馆、购物中心等都能够向公众提供有偿或无偿接入Wi-Fi的服务。这样的地点就叫作热点(hotspot)
起来的区域叫作热区(hotzone)。热点也就是公众无线入网点。
。由许多热点和接入点AP连接由于无线局域网已非常普及，因此现在无论是智能手机、智能电视机或计算机，其主
板上都已经有了内置的无线局域网适配器，能够实现802.11的物理层和MAC层的功能。只要在无线局域网信号覆盖的地方，用户就能够通过接入点AP连接到互联网。
无线局域网用户在和附近的接入点AP建立关联时，一般还要键入用户口令。键入正确后，才能和在该网络中的AP建立关联。在无线局域网发展初期，这种接入加密方案称为
WEP(WiredEquivalentPrivacy,意思是“有线等效的保密”
，它曾经是1999年通过的
IEEE802.11b标准中的一部分。然而WEP的加密方案有安全漏洞，因此现在的无线局域网
普遍采用了保密性更好的加密方案WPA(WiFiProtectedAccess,意思是“无线局域网受保

### 分块 16
护的接入”)或其第二个版本WPA2。现在WPA2是802.1ln中强制执行的加密方案，微软
的Windows10支持WPA2。这表明只有在电脑屏幕上弹出的口令窗口键入正确的口令后，
才能与其AP建立关联。
2.移动自组网络另一类无线局域网是无固定基础设施的无线局域网，它又叫作自组网络(adhoc
network)心。这种自组网络没有上述基本服务集中的接入点AP,而是由一些处于平等状态的
移动站相互通信组成的临时网络（如图9-3所示）。图中还画出了当移动站A和E通信时，
经过A-B,B-C,C-D和最后D-E这样一连串的存储转发过程。因此，在从源节点A到
目的节点E的路径中，移动站B,C和D都是转发节点，这些节点都具有路由器的功能。由于自组网络没有预先建好的网络固定基础设施（基站），因此自组网络的服务范围通常是
受限的，而且自组网络一般也不和外界的其他网络相连接（当然也不能接入到互联网）。
移动自组网络也就是移动分组无线网络。
自组网络通常是这样构成的：一些可移动的设备发现在它们附近还有其他的可移动设
备，并且要求和其他移动设备进行通信。随着便携式电脑和智能手机的普及，自组网络的组句

### 分块 17
备，并且要求和其他移动设备进行通信。随着便携式电脑和智能手机的普及，自组网络的组句
ET
,
4
、.-..l.
-
-
.，-)1O注：拉丁语adhoc本来的意思是＂仅为此目的(forthispurposeonly)",并且通常还有“临时的含义。译成中文就是
“特定的＂。直译adhocnetwork就是“特定网络＂。但由千这种网络的组成并不需要使用固定的基础设施，因此可意译为“自组
网络＂，表明不需要固定基站而仅依靠移动站自身就能组成网络。
＂•409•)
网方式已受到人们的广泛关注。由千在自组网络中的每一个移动站，都要参与到网络中其他
移动站的路由的发现和维护，同时由移动站构成的网络拓扑有可能随时间变化得很快，因此
在固定网络中行之有效的一些路由选择协议对移动自组网络已不适用。这样，在自组网络中
另一个重要问题是多播。在移动自组网络中往往需要将
路由选择协议就引起了特别的关注。
某个重要信息同时向多个移动站传送。这种多播比固定节点网络的多播要复杂得多，需要有
实时性好而效率又高的多播协议。在移动自组网络中，安全问题也是一个更为突出的问题。
转发节点、转发节点(飞飞转发节点B`位

### 分块 18
转发节点、转发节点(飞飞转发节点B`位
源节点:------二二------------------------飞目的节占；（邕图9-3由处千平等状态的一些便携机构成的自组网络移动自组网络在军用和民用领域都有很好的应用前景。在军事领域中，由千战场上往往没有预先建好的固定接入点，其移动站就可以利用临时建立的移动自组网络进行通信。这种组网方式也能够应用到作战的地面车辆群和坦克群，以及海上的舰艇群、空中的机群。由
于每一个移动设备都具有路由器转发分组的功能，因此分布式的移动自组网络的生存性非常
好。在民用领域，持有笔记本电脑的人可以利用这种移动自组网络方便地交换信息，而不受便携式电脑附近没有电话线插头的限制。当出现自然灾害时，在抢险救灾时利用移动自组网络进行及时通信往往也是很有效的，因为这时事先已建好的网络基础设施（基站）可能都已经被破坏了。
近年来，移动自组网络中的一个子集一无线传感器网络WSN(WirelessSensorNetwork)引起了人们广泛的关注。无线传感器网络是由大量传感器节点通过无线通信技术构

### 分块 19
成的自组网络。无线传感器网络的应用就是进行各种数据的采集、处理和传输，一般并不需
要很高的带宽，但是在大部分时间必须保持低功耗，以节省电池的消耗。由于无线传感节点的存储容量受限，因此对协议栈的大小有严格的限制。此外，无线传感器网络还对网络安全
性、节点自动配置、网络动态重组等方面有一定的要求。
据统计，全球98％的处理器并不在传统的计算机中，而是处在各种家电设备、运输工具以及工厂的机器中。如果在这些设备上能够嵌入合适的传感器和无线通信功能，就可能把数量极大的节点连接成分布式的传感器无线网络，因而能够实现连网计算和处理。
图9-4是典型的传感器节点的组成，它的主要构件包括CPU、存储器、传感器硬件、无线收发器和电池。
无线传感器网络中的节点基本上是固定不变的，这点和移动自组网络有很大的区别。
无线传感器网络主要的应用领域就是组成各种物联网IoT(InternetofThings)
的一些举例：。下面是物联网(1)环境监测与保护（如洪水预报、动物栖息的监控）；(2)战争中对敌情的侦查和对兵力、装备、物资等的监控；•410•三三门4:

### 分块 20
三厂1霍图9-4传感器节点的主要构件(3)医疗中对病房的监测和对患者的护理；
(4)在危险的工业环境（如矿井、核电站等）中的安全监测；(5)城市交通管理、建筑内的温度／照明／安全控制等。
关于(cid:4873)线传感器网络更详细的内容可参阅[COMM02]。
顺便指出，移动自组网络和移动IP并不相同。移动IP技术使漫游的主机可以用多种(cid:4852)
个子
式连接到互联网。漫游的主机可以直接连接到或通过(cid:4876)线链路连接到固定网络上的另
网。支持这种形式的主机移动性需要地址管理和增加协议的互操作性，但移动IP的核心网
直在使用的各种路由选择协议。但移动自组网络是把移
络功能仍然是基于在固定互联网中一一动性扩展到(cid:4874)线领域中的自治系统，它具有自己特定的路由选择协议，并且可以不和互联网相连。即使在和互联网相连时，移动自组网络也是以末梢网络(stubnetwork)(cid:4854)式工作的。所“谓末梢网络”就是通信景可以进入末梢网络，也可以从末梢网络发出，但不允许外部的通信量穿越末梢网络。

### 分块 21
最后需要弄清在(cid:4825)献中经常要遇到的、与接入有关的几个名词。
固定接入(fixedaccess)在作为网络用户期间，用户设置的地理位置保持不变。
移动接入(mobilityaccess)用户设备能够以车辆速度（一般取为120km/h)移动时进行网络通信。当发生切换（即用户移动到不同蜂窝小区）时，通信仍然是连续的。
便携接入(portableaccess)在受限的网络覆盖面积中，用户设备能够在以步行速度移动时进行网络通信，提供有限的切换能力。
游牧接入(nomadicaccess)用户设备的地理位置至少在进行网络通信时保持不变。如
果用户设备移动了位置（改变了蜂窝小区），那么再次进行通信时可能还要寻找最佳的基站。
一也有的(cid:4831)献把便携接入和游牧接入当作样的，定义为可以在通信时以步行速度移动。
这点在阅读(cid:4825)献时应加以注意。
9.1.2802.11局域网的物理层802.11标准中物理层相当复杂。限于篇幅，这里对(cid:4873)线局域网的物理层不能展开讨论。

### 分块 22
根据物理层的不同（如工作频段、(cid:4801)据率、调制(cid:4855)法等），对应的标准也不同。最早流行的
(cid:4873)线局域网是802.llb,802.lla和802.11g。2009年以后又公布了(cid:4844)的标准802.1ln,802.1lac以及802.llax（见表9-1)。为了使(cid:4873)线局域网的适配器能够适应多种标准，很多适配器都做
成双模的(802.lla/g)或多模的（例如，802.1la/b/g/n/ac)。顺便说
开
始就有的。在802.11以后的(cid:4842)标准就在原来的802.11后面增加个英(cid:4825)字母。但26个英(cid:4825)并非别名下，一一一“”字母很快就用完了。这时就采用附加两个英(cid:4825)字母的办法。在2018年人们普遍感到(cid:4878)线局
域网的名字太难记忆时，W]－伈联盟就决定使用Wi-Fi4/5/6作为802.1ln/ac/ax的别名。随后
也顺便把Wi-Fi1/2/3作为最早流行的三种(cid:4879)线局域网的别名。

### 分块 23
•411•表9-1几种常用的802.11(cid:4880)线局域网＇标准别名频段最高数据率物理层优缺点80211bWi-Fil24GHz11Mbit/s扩频最高数据率较低，价格最低，信号传播距离最远，且不易(1999年）受阻碍802IlaWi-Fi25GHz54Mbit/sOFDM最高数据年较高，支持更多用户同时上网，价格最高，信(1999年）号传播距骁较短，且易受阻碍802IlgWi-Fi324GHz54Mbit/sOFDM最高数据率较高，支持更多用户同时上网，信号传播距离(2003年）最远，且不易受阻碍，价格比802.1lb贵802IInWi-Fi424I5GHz600Mbit/sMIMO使用多个发射和接收天线达到更高的数据传输率，(2009年）OFDM当使用双倍带宽(40MHz)时速率可达600Mbit/s802IlacWi-Fi55GHz7Gbit/sMIMO完令边循80211i安全怀准的所有内谷，使得兀线迕桉能(2014年）OFDM够什及个目汀同达：刊企业级川尸的需水802IlaxW中62415GHz96Gbit/sMIMO侧重解决密货环境下（如火车站、机场）提高吞吐量

### 分块 24
2IlaxW中62415GHz96Gbit/sMIMO侧重解决密货环境下（如火车站、机场）提高吞吐量密度(2019年）OFDM（即单位面积的吞吐豐）表9-1中802.1lax又称为高效率(cid:4881)线标准HEW(High-EfficiencyWireless)，向下兼容802.11a/b/g/n/ac。其侧重要解决的问题是要在密集环境下（如火车站、飞机场等热点和人员都很密集的场所）保持手机的畅通。表9-1给出的关千802.11ac和802.llax的最高数据率来自[KHOR19]，但现在已有不少802.1lax的产品的最高数据率达到了更高的数值。目前正在研究的还有被称为极高吞吐量EHT(ExtremelyHighThroughput)的802.llbe(Wi-Fi7)，其最高数据率有望达到30Gbit/s,它的另一个特点是要降低延迟和抖动（迟延要降低到5ms以下），这对实时游戏具有重要意义。802.llbe的标准可能在2024年完成。

### 分块 25
2016年的802.llah,工作频段在900MHz,最高数据率为18Mbit/s,这种(cid:4873)线局域网的功耗低、传输距离长（最长可达1km)，很适合于物联网设备之间的通信。
(cid:4873)线局域网最初还使用过跳频扩频FHSS(FrequencyHoppingSpreadSpectrum)和红外技术IR(InfraRed)，但现在已经很少使用了。
以上几种标准都使用共同的媒体接入控制协议，都可以用千有固定基础设(cid:4870)的或(cid:4873)固定基础设(cid:4871)的(cid:4873)线局域网。除IEEE的802.11委员会外，欧洲电信标准协会ETSI(European
sInstitute)的RESlO工作组也为欧洲制定(cid:4873)线局域网的标准，他TelecommunicationsStandard们把这种局域网取名为HiperLAN。ETSI和IEEE的标准是可以互操作的。
下面我们讨论802.11标准的MAC层。

### 分块 26
下面我们讨论802.11标准的MAC层。
9.1.3802.11局域网的MAC层协议1.CSMA/CA协议虽然CSMA/CD协议已成功地应用于使用有线连接的局域网，但(cid:4873)线局域网能不能也使用CSMA/CD协议呢？下面我们从(cid:4873)线信道本身的特点出发来详细讨论这个问题。
＂碰撞检测“一要求个站点在发送本站数据的同时，还必须不间(cid:4837)地检测信道。一旦O庄：在物理层使用的OFDM是OrthogonalFrequencyDivisionMultiplexing（正交频分复用）的缩写。MIMO是MultiplelnputMultipleOutput（多入多出）的缩写，即空间分集，使用多空间通道，即利用物理上完全分离的最多4个发射天线和4个接收大线，对不同数据进行不同的调制／解调，因而提高了数据的传输速率。

### 分块 27
•412•检测到碰撞，就立即停止发送。但由千(cid:4876)线信道的传输条件特殊，其信号强度的动态范围非常大，因此在802.11适配器上接收到的信号强度往往会远远小于发送信号的强度（信号强度可能相差百万倍）。因此(cid:4876)线局域网的适配器(cid:4874)法实现碰撞检测。
我们知道，(cid:4882)线电波能够向所有的(cid:4851)向传播，且其传播距离有限。当电磁波在传播过程中遇到障碍物时，其传播距离就会受到限制。如图9-5所示的例子就是(cid:4874)线局域网的隐蔽站问题。我们假定每个移动站的(cid:4876)线电信号传播范围都是以发送站为圆心的一个圆形面积。
A的作用范围C的作用范围A的作用范围＼，产＇＇，---、
、＼＼＿－＿－＇，、
、
、，
，－－－－～－－、
、IE二｀｀心';`｀
CA\B,:(a)＼飞｀妃』:｀\~:，I\
！飞一八贮

### 分块 28
、IE二｀｀心';`｀
CA\B,:(a)＼飞｀妃』:｀\~:，I\
！飞一八贮
B''，｀｀,A｀、、、、＇，＇＇，(b)图9-5A和C同时向B发送数据，发生碰撞图9-5(a)表示站点A和C都想和B通信（这里仅仅是讲解隐蔽站问题的原理，在通信的过程中省略了接入点AP。可以把B看成是接入点AP)。但A和C相距较远，彼此都检测不到对(cid:4854)发送的信号。当A和C检测到信道空闲时，就都向B发送数据，结果发生了碰撞，并且(cid:4882)法检测出这种碰撞。这就是隐蔽站问题(hiddenstationproblem)。所谓隐蔽站，就是它发送的信号检测不到，但却能产生碰撞。这里C是A的隐蔽站，A也是C的隐蔽站。
当移动站之间有障碍物时也有可能出现上述问题。例如，图9-5(b)的三个站点A,B和C彼此距离都差不多。从距离上看，彼此都应当能够检测到对(cid:4851)发送的信号。但A和C之间有高楼或高山，因此A和C都互相成为对(cid:4851)的隐蔽站。若A和C同时向B发送数据就会发生碰撞，使B(cid:4876)法正常接收。此时也(cid:4876)法检测出碰撞。

### 分块 29
综上所述，在制定(cid:4879)线局域网的协议时，必须考虑以下特点：(1)(cid:4883)线局域网的适配器(cid:4876)法实现碰撞检测；(2)检测到信道空闲，其实信道可能并不空闲；(3)即使我们能够在硬件上实现(cid:4876)线局域网的碰撞检测功能，也(cid:4876)法检测出隐蔽站问题带来的碰撞。
我们知道，CSMA/CD有两个要点。
一是发送前先检测信道，信道忙就不发送。二是边发送边检测信道，一发现碰撞就立即停止发送，并执行退避算法进行重传。因此偶尔发生的
碰撞并不会使局域网的运行效率降低很多。(cid:4876)线局域网显然可以使用CSMA,但(cid:4876)法使用
碰撞检测（由上述(cid:4879)线局域网特点(1)和(3)决定的），
定把(cid:4821)个帧发旦开始发送数据，就一一送完毕；一旦发生碰撞，(cid:4821)个信道资源的浪费就比较严重。
(D

### 分块 30
(D
为此，802.11局域网使用CSMA/CA协议。CA表示CollisionAvoidance,是碰撞避免的意思，或者说，协议的设计是要尽量减少碰撞发生的概率。这点和使用有线连接的以太网有很大的区别。以太网当然不希望发生碰撞，但并不怕发生碰撞，因为碰撞的影响并不大。
CD注：有的资料称这种协议为具有碰撞避免的多点接入MACA(MultipleAccesswithCollisionAvoidance)。
•413•802.11局域网在使用CSMA/CA的同时，还使用停止等待协议。这是因为(cid:4876)线信道的通
帧后，要等到收到对(cid:4851)信质量远不如有线信道的，因此(cid:4884)线站点每通过(cid:4873)线局域网发送完一的确认帧后才能继续发送下一帧。这就是链路层确认。链路层确认也是解决碰撞后重传的手段。
我们在进一步讨论CSMA/CA协议之前，先要介绍802.11的MAC层。

### 分块 31
我们在进一步讨论CSMA/CA协议之前，先要介绍802.11的MAC层。
802.11标准设计了独特的MAC层（如图9-6所示）。它通过协调功能(CoordinationFunction)来确定在基本服务集BSS中的移动站，在什么时间能发送数据或接收数据。802.11的MAC层在物理层的上面，它包括两个子层。
』九争用服务（选用）争用服务（必须实现）MAC层点协调功能PCF
(PointCoordinationFunction)雪分布协调功能DCF
(DistributedCoordinationFunction)
(CSMA/CA)物理层图9-6802.11的MAC层(l)分布协调功能DCF(DistributedCoordinationFunction)。DCF不采用任何中心控制，而是在每一个节点使用CSMA机制的分布式接入算法，让各个站通过争用信道来获取发送权。囚此DCF向上提供争用服务。802.11标准规定，所有的实现都必须有DCF功能。为此，定义了两个非常重要的时间间隔，即短帧间间隔SIFS(ShortInter-FrameSpacing)和分布协调

### 分块 32
功能帧间间隔DIFS(DCFIFS)。关于这两个时间间隔后面还要讲到。802.11标准还定义了其他几种时间间隔，这里从略。
(2)点协调功能PCF(PointCoordinationFunction)。PCF是选项，是用接入点AP集中控制(cid:4821)个BSS内的活动，因此自组网络就没有PCF子层。PCF使用集中控制的接入算法，用类似千探询的(cid:4856)法把发送数据权轮流交给各个站，从而避免了碰撞的产生。对千时间敏感的业务，如分组话音，就应使用提供(cid:4885)争用服务的点协调功能PCF。
我们目前大量使用的(cid:4886)线局域网都是使用上述的分布协调功能DCF。
CSMA/CA协议比较复杂。IEEE的802.11-2007标准(cid:4826)档共有1232页之多。这里介绍CSMA/CA协议的要点如下：(1)站点若想发送数据必须先监听信道。若信道在时间间隔DIFS内均为空闲，则发送(cid:4822)个数据帧。否则，进行(2)。

### 分块 33
(2)站点选择一随机数，设置退避计时器。计时器的运行规则是：若信道忙，则冻结退避计时器，继续等待，直至信道变为空闲（这叫作推迟接入）；若信道空闲，并在时间间隔
DIFS内均为空闲，则开始争用信道，进行倒计时。当退避计时器的时间减到零时（显然这
只能发生在信道空闲时），站点就发送(cid:4802)据帧，把(cid:4821)帧发完。
一(3)站点若收到接收(cid:4851)发来的确认帧，且还有后续帧要发送，就转到(2)。若在设定时间内未收到确认，则准备重传，并转到(2)，但会在更大的范围内选择一随机数。
下面详细解释上述协议中的内容。

### 分块 34
下面详细解释上述协议中的内容。
•414•2.时间间隔DIFS的重要性在图9-7中，站点A要向站点B发送数据。A监听信道。若信道在时间间隔DIFS内一直都是空闲的（理由下面就要讲到），A就可以在to时间发送数据帧DATA。B收到后立即发回确认ACK。B开始发送确认的时刻，实际上必然略滞后千B收完DATA的时间，滞后的时间是SIFS。这是因为B收到数据帧后，必须进行CRC检验。若检验(cid:4887)差错，再从接收状态转为发送状态，这些动作不可能在瞬间完成。SIFS值在802.11标准中均有规定。因此，
从A发送数据帧DATA开始，到收到确认ACK为止的这段时间(DATA+SIFS+ACK)，必
须不允许任何其他站发送数据，这样才不会发生碰撞。为此，802.11标准规定了每个站必须同时使用以下的两个(cid:4851)法。
A
 Bt'。
D怍SDIFSDATASIFS
t
t'尸一三三
H
三
，
:丿AV
:·
；．CW一信道忙f2;+-•—I:其他站在此期间不得发送图9-7A向B发送数据，B发回确认一

### 分块 35
:·
；．CW一信道忙f2;+-•—I:其他站在此期间不得发送图9-7A向B发送数据，B发回确认一
第个(cid:4851)法是用软件实现的虚拟载波监听(VirtualCarrierSense)的机制。这就是让源
站A把要占用信道的时间（即DATA+SIFS+ACK)，以微秒为单位，写入其数据帧DATA的首部（在后面的9.1.4节还要介绍首部的各字段）。所有处在站点A的广播范围内的各站，
信息，并创建自己的网络分配向量NAY(NetworkAllocationVector)。NAV都能够收到这一指出了信道忙的持续时间，意思是：““
A和B以外的站点都不能在这段时间发送数据。
第二个(cid:4852)法是在物理层用硬件实现载波监听。每个站检查收到的信号强度是否超过一定的门限数值，用此判(cid:4837)是否有其他移动站在信道上发送数据。任何站要发送数据之前，必须监听信道。只要监听到信道忙，就不能发送数据。

### 分块 36
从图9-7可以看出，t1至t2这段时间SIFS,信道是空闲的。为了保证在这小段空闲时间不让其他站点发送数据，802.11标准定义了比SIFS更长的时间间隔DIFS(DCFIFS)，并且规定，凡在空闲时间想发送数据的站点，必须等待时间DIFS后才能发送。这就保证了确认
帧ACK得以优先发送。这个重要措(cid:4870)使得在这段时间(DATA+SIFS+ACK)，(cid:4823)个信道好像是A和B专用的，因为其他站点暂时都不能发送数据。
3.争用信道的过程现假定在站点A和B通信的过程中，站点C和D也要发送数据（如图9-8所示）。但C和D检测到信道忙，因此必须推迟接入(deferaccess)，以免发生碰撞。很明显，如果有两个或更多的站，在等待信道进入空闲状态后，大家都经过规定的时间间隔DIFS再同时发送数据，那么必然产生碰撞。因此，协议CSMA/CA规定，所有推迟接入的站，都必须在争用期执行统一的退避算法开始公平地争用信道。
•415•信道忙ADATA:：：ACK]尸信道AcDt＿信道忙三气们�cw一
t
门
|
－推迟接入--－－....：退避冻结

### 分块 37
t
门
|
－推迟接入--－－....：退避冻结
矿／：退避占用信道DATA+SIFS+ACK信道忙二三］空；
＿＿＿＿＿＿
闲：沪壁占用信道尸l＿＿＿＿＿＿＿＿＿＿
－1
|-－－－－－－－推迟接入－－－－－－－三｀＿－－－－推迟接入－－－－－一一一一1_图9-8在争用期根据退避算法公平竞争图9-8中的争用期也叫作争用窗口CW(ContentionWindow)。争用窗口由许多时隙(timeslot)组成。例如，争用窗口cw=15表示窗口大小是15个时隙。时隙长度是这样确定的：
在下一
个时隙开始时，每个站点都能检测出在前个时隙开始时信道是否忙（这样就可采取一适当对策）。时隙的长短在不同802.11标准中可以有不同数值。例如，802.1lg规定一个时隙时间为9µs,SIFS=10µs,而DIFS应比SIFS的长度多两个时隙，因此DIFS=28µs。

### 分块 38
退避算法规定，站点在进入争用期时，应在0~cw个时隙中随机生成一个退避时隙数，并设置退避计时器(backofftimer)。当几个站同时争用信道时，计时器最先降为零的站，就首先接入媒体，发送数据帧。这时信道转为忙，而其他正在退避的站则冻结其计时器，保留计时器的数值不变，推迟到在下次争用信道时接着倒计时。这样的规定对所有的站是公平的。
例如，图9-8中的站点C的退避时隙数为3,而站点D的退避时隙数为9。当经过3个退避时隙后，站点C获得了发送权，立即发送数据帧，信道转为忙状态。站点D随即冻结其剩余的6个时隙，推迟到下一个争用信道时间的到来。如果此后没有其他站要发送数据，那么经过剩余的6个退避时隙，站点D就可以发送数据了。
““请注意“
推迟接入和退避(backoft)"的区别。推迟接入发生在信道处千忙的状态，为的是等待争用期的到来，以便执行退避算法来争用信道。这时退避计时器处千冻结状态。
而退避是争用期各站点执行的算法，退避计时器进行倒计时。这时信道是空闲的，并且总是出现在时间间隔DIFS的后面（如图9-8所示）。

### 分块 39
802.11标准并未规定争用窗口CW的初始值，但建议CW最小值可取为15,最大值为1023。
为了减少碰撞的机会，协议CSMA/CA规定，如果未收到确认帧（可能是发生碰撞，
一或数据帧传输出差错），则必须重传。但每重传
例如，假定选择初始争用窗口cw=2次，争用窗口的数值就近似加倍增大。
-1=15'那么首次争用信道时，随机退避时隙4数应在0~15之间生成。在进行重传时，第l次重传的争用窗口cw=24+i-1。
第1次重传时，随机退避的时隙数应在0~31之间生成。
第2次重传时，随机退避的时隙数应在0~63之间生成。
第3次重传时，随机退避的时隙数应在0~127之间生成。
第4次重传时，随机退避的时隙数应在0~511之间生成。
第5次以及5次以上重传时，随机退避的时隙数应在0~1023之间生成，争用窗口CW•416•不再增大了。
采用上面这些措(cid:4870)，发生几个站同时发送数据的概率可以大大减小。
归纳以上的讨论可以得出如下结论：当站点想发送数据，并检测信道连续空闲时间超过DIFS时，即可立即发送数据，而不必经过争用期。

### 分块 40
在以下几种情况下，发送数据必须经过争用期的公平竞争：(1)要发送数据时检测到信道忙。
(2)已发出的数据帧未收到确认，重传数据帧。
(3)接着发送后续的数据帧。
上述的(3)是为了防止一个站长期垄(cid:4837)发送权。若一站点要连续发送若干数据帧，则不管有(cid:4875)其他站争用信道，都必须进入争用期（如图9-9所示）。
DIFS
送i要发
At勹五诃五］尸皿『数据不争用
信道争用
信道主cw—皇cw
正面五厂勹『开飞而五口t
t｀图9-9只有A站连续发送数据即使有了上述措(cid:4870)，碰撞仍有可能发生。例如，B站正好在图9-9中A占用信道时要发送数据。B检测到信道忙，于是推迟到争用信道时与A一起争用信道。但正巧A和B又生成了同样大小的随机退避时隙数。结果就发生了碰撞，A和B都必须再重传。这就浪费了宝贵的信道资源。因此，要进一步减少碰撞的机会，还需要再采用一些措(cid:4870)。这就是下面要介绍的信道预约。
4.对信道进行预约为了更好地解决隐蔽站带来的碰撞问题，802.11允许要发送数据的站对信道进行预约。

### 分块 41
我们假定在图9-10中的A站要和B站通信。显然，A站与B站的通信都必须通过接入点AP的转发。在前面图9-7和图9-8中讲解原理时，我们都把接入点AP省略了。下面我们要画出A站和AP之间交换的信息，但为简单起见，图中省略了AP和B站之间交换的信息。
我们再假定，A站或B站向接入点AP发送数据时，远处的C站接收不到这些信号，而C站向AP发送的信号也传播不到远处的A站或B站。
在A站向AP发送数据帧DATA之前，先发送一个很短的控制帧，叫作请求发送RTS(RequestToSend)，目的是告诉所有能够收到RTS帧的站：“我将要占用信道一段时间：”
[SIFS+CTS+SIFS+DATA+SIFS+ACK]。这段时间写在控制帧RTS的首部中。A站发送的RTS帧，B站能够收到，但远处的C站收不到。
接入点AP若正确收到RTS帧，经过最短的时间间隔SIFS后，就向A站发送一允许发送CTS(ClearToSend)的控制帧，目的不仅是告诉A站：“你可以发送数据了个叫作
＂，而且也是告诉所有能够收到CTS帧的站：“A站和我通信，要占用信道一段时间：［SIFS+”

### 分块 42
＂，而且也是告诉所有能够收到CTS帧的站：“A站和我通信，要占用信道一段时间：［SIFS+”
DATA+SIFS+ACK]。这段时间是写在控制帧CTS的首部中。AP发送的CTS帧，A站和B站以及C站都能够收到。
在随后A站发送的DATA帧的首部中，也写入了时间[DATA+SIFS+ACK]。如果有的站没有收到RTS和CTS帧，那么收到DATA帧后，也能设置其NAV。
以上措(cid:4870)就使得A站和接入点AP（以及A站和B站）的通信过程中，发生碰撞的概•417•率大大降低，特别是减少了隐蔽站的干扰问题。
`-AP心/-－－－-－－－－－－－-－－-－-－－一书立（隐蔽站）
l荨
�：：了五勹二1古：三：：：气：芒三昙？H|司A气心三t开始争用DA:TT::：A
P
A收到Rft
勹l图9-10发送RTS帧和CTS帧对信道进行预约显然，增加使用RTS帧和CTS帧会使(cid:4824)个网络的通信效率有所下降，要多浪费信道的
时间[RTS+SIFS+CTS+SIFS]。但由于这两种控制帧都很短，其长度分别为20字节和14

### 分块 43
时间[RTS+SIFS+CTS+SIFS]。但由于这两种控制帧都很短，其长度分别为20字节和14
字节，与数据帧（最长可达2346字节）相比开销不算大。相反，若不使用这种控制帧，则一旦发生碰撞而导致数据帧重发，浪费的时间就更多了。
从图9-10可以看出，即使我们使用RTS和CTS对信道进行了预约，但碰撞也有可能发生。例如，有的站可能在时间t1或t2就发送了数据（这些站可能是没有收到RTS帧或CTS
帧或NAY)，结果必定与RTS帧或CTS帧发生碰撞。A站若收不到CTS帧，就不能发送数
据帧，而必须重传RTS帧。A站只有正确收到CTS帧后才能发送数据帧。但我们可以看出，
在使用信道预约的情况下，即使发生了碰撞，信道资源的浪费是很小的。
信道预约不是强制性规定。各站可以自己决定使用或不使用信道预约。看来，只有当数据帧的长度超过某一数值时，使用RTS帧和CTS帧才比较有利。
因为(cid:4885)线信道的误码率比有线信道的高得多，所以，(cid:4888)线局域网的MAC帧长一般应当短些，以便在出错重传时减小开销。这样，有时就必须将太长的帧进行分片。

### 分块 44
一最后，我们要提下关千(cid:4885)线局域网的(cid:4803)据发送速率问题。在第2章的2.3.2节的图2-13
，已经指出(cid:4889)线信道中的误码率与信噪比（信道状况）以及所选择的调制技术（包括数据
率）有关。802.11标准并没有对(cid:4890)线局域网(cid:4803)据率的自适应算法有具体的标准或规定。但生
产(cid:4891)线局域网适配器的厂商，一般都使自己的产品能够自适应地改变(cid:4801)据率，以便更好地适
应信道特性的变化。例如，可以采用这样的算法：如果
连发送两个数据帧但都没有收到确
一
认，就认为信道的质量较差，这时就把数据率调慢
挡。反之，如果此后又能够连续收到
10个数据帧的确认，那么就可以认为信道质量改善了，因而可以把数据率调快
协议TCP中的拥塞控制的处理思路是相似的。
挡。这与一一9.1.4802.11局域网的MAC帧－
为了更好地了解802.11局域网的步了解802.11局域网的MAC
帧的结构。802.11帧共有三种类型，即控制帧＼数据帧和管理帧。通过图9-11所示的

### 分块 45
帧的结构。802.11帧共有三种类型，即控制帧＼数据帧和管理帧。通过图9-11所示的
802.ll局域网的(cid:4804)据帧和三种控制帧的主要字段，可以进
步了解802.11局域网的MAC帧
的特点。
［作原理，我们应当进一一•418•中
从图9-ll(a)可以看出，802.11数据帧由以下三大部分组成：26MAC首部
6626字节2帧控制1持续期I地址I
42I地址2I地址3I序号控制I地址4I帧主体IFCSMAC
尾部
40-2312类型子类型来自更多
去往
AP(j)AP分片11功率更多重试管理数据|WEPI顺序(a)数据帧格式（帧控制字段中的子类型为0000)！I／卢网＿1，沪尸归卢竺归卫1，cs4662字节
12帧～尸(b)RTS帧格式（帧控制字段中的子类型为IO11)字节2l
2
I帧控同』』扛续回』曰欠地址64
FCSj(c)CTS和ACK帧格式（帧控制字段中的了类型分别为1100和llOl)阳9-11
(1)MAC首部，共30字节。帧的复杂性都在帧的MAC首部。

### 分块 46
(1)MAC首部，共30字节。帧的复杂性都在帧的MAC首部。
(2)帧主体，也就是帧的数据部分，不超过2312字节。这个数值比以太网的最大长度802.11局域网的帧格式长很多。不过802.11帧的长度通常都小千1500字节。
(3)帧检验序列FCS是MAC尾部，共4字节。
1．关于802.11数据帧的地址802.11数据帧最特殊的地(cid:4851)就是有四个地址字段。这几个地址与帧控制字段中的去往
来自AP"（从接入点发往移动站）这两个子字段的数值有“AP"（移动站发送到接入点）和”关。
地址l永远是接收地址（即直接接收数据帧的节点地址）。
地址2永远是发送地址（即实际发送数据帧的节点地址）。
地址3和地址4取决于数据帧中的来自AP"和”“去往AP"这两个字段的数值。
这里要再强调一下，上述地址都是MAC地址，即硬件地址（在数据链路层不可能使用IP地址），而AP的MAC地址就是在9.1.1节介绍的BSSID。表9-2给出了802.11帧的地址字段最常用的两种情况（在有基础设(cid:4871)的网络中
移动网络中使用的地址4)。
一般只使用前三种地址，很少使用仅在自组去住AP。

### 分块 47
移动网络中使用的地址4)。
一般只使用前三种地址，很少使用仅在自组去住AP。
I来自AP
；I表9-2802.11帧的地址字段最常用的两种情况:：三丿;i：址I：三勹勹1:1:：地址4CD注：802.11标准上使用的名词是分配系统DS,但在解释中，指出这里的DS也包含桵入点AP。因此找们在这里使用接，入点AP代替DS。
•419•--现假定在一个基本服务集中的站点A向站点B发送数据帧。在站点A发往接入点AP的数据帧的帧控制字段中，“去往AP=1"而“来自AP=O”。
A-AP的数据帧首部：地址1:接收地址（不是目的地址）是AP的地址BSSID。
地址2:发送地址，即源地址，也就是站点A的地址MAC氏地址3:目的地址（不是接收地址）是站点B的地址MAC贮接入点AP收到数据帧后，转发给站点B,但在数据帧的帧控制字段中，“去往AP=O"””
来自AP=l。
而AP-B的数据帧首部：
地址l：接收地址就是目的地址MACB。
地址2:发送地址（不是源地址）是接入点AP的地址BSSID。

### 分块 48
地址2:发送地址（不是源地址）是接入点AP的地址BSSID。
地址3:源地址（不是发送地址）是站点A的地址MAC氏下面讨论另一种稍复杂些的情况，即站点A向站点B发送数据帧（如图9-12所示）。
现在A和B分别处在不同的两个子网凡和N2，因此在网络层看，是地址为I凡的站点A,把IP数据报从子网凡经过路由器R转发到子网N2。在网络层看不见链路层的接入点AP1和AP2。IP(cid:4802)据报必须装入链路层的帧才能在链路层发送。但链路层不认识IP地址，只认识MAC地址，即硬件地址。站点A使用协议ARP获得了默认路由器R的接口1的地址MACR-1为802.3帧，发送到路由器R的接口1。站点A发送的802.11帧的帧控制字段中。这样，站点A先把802.ll数据帧发到接入点AP1,然后AP1把802.11帧转换
，“去往AP=I"而“来自AP=O”。
A-AP1的802.11数据帧首部：地址I:接收地址（不是目的地址）是AP1的地址BSSID1。
地址2:发送地址，即源地址，也就是站点A的地址MAC氏地址3:目的地址（不是接收地址）是本子网中路由器R接口1的地址MAC知。
,？

### 分块 49
,？
ZIP,B心802
她址MACR—｀＇｀三AP1
l
-R
卫－'•-－－－－－－-－－－－－－1`地址BSSIDI地址BSSID，802.11帧l(-IPA、、
,，毛1)-－－-；_＿＿＿＿＿＿＿4-－，也
-i、、、、、、、',
地址MACA,：炙｀：2SS2:-/：'BSSl＼邕IN图9-12链路上的802.11帧和802.3帧当接入点AP1收到802.11数据帧后，就转换成802.3帧(802.3帧只有两个地址），其目的地址是MACR-1•而源地址是MACA（而不是接入点AP1的地址BSSID1)。
路由器R收到802.3帧后，剥去首部和尾部，上交给网络层。网络层根据IP数据报首部中的目的地址I腥查找转发表，知道应从接口2转发给地址为IPB的设备。再使用协议ARP，获得此设备的硬件地址是MACB，这个地址就是802.3帧的目的地址，路由器R接口2的地址MACR-2是这个802.3帧的源地址。
接入点AP2收到802.3帧，将其转换为802.11帧，其帧控制字段中，“去往AP=O"而””
来自AP=1。
•420•中
AP2一B的802.11帧首部：

### 分块 50
来自AP=1。
•420•中
AP2一B的802.11帧首部：
地址1:接收地址（即目的地址）是站点B的地址MAC贮
地址2:发送地址是AP2的地址BSSID沪地址3:源地址（不是发送地址）是路由器R接口2的地址MACR-2。
2.序号控制字段、持续期字段和帧控制字段下面再介绍802.11数据帧中其他的
(1)序号控制字段占16位，其中序号子字段占12位（从0开始，每发送个(cid:4843)帧就加
1,到4095后再回到0)，分片子字段占4位（不分片则保持为0。如分片，则帧的序号子字
段保持不变，而分片子字段从0开始，每个分片加1,最多到15)。重传的帧的序号和分片些字段。
一一子字段的值都不变。序号控制的作用是使接收(cid:4852)能够区分开是(cid:4843)传送的帧还是因出现差错而重传的帧。这和运输层讨论的序号的概念是相似的。
(2)持续期字段占16位。在9.1.3小节第4部分“对信道进行预约”中已经讲过CSMA/CA协议允许发送数据的站点预约信道一段时间（见前面的图9-10的例子），并把这个时间写入到持续期字段中

### 分块 51
。这个字段有多种用途（这里不对这些用途进行详细的说明），
15
只有最高位为0时才表示持续期。这样，持续期不能超过2—1=32767,单位是微秒。
(3)帧控制字段共分为11个子字段。下面介绍其中较为重要的几个。
协议版本字段现在是0。
类型字段和子类型字段用来区分帧的功能。上面已经讲过，802.11帧共有三种类型：控制帧、数据帧和管理帧，而每
ACK等几种不同的子类型。控制帧的几种常用的帧格式如图9-ll(b)和(c)所示。
种帧又分为若干种子类型。例如，控制帧有RTS,CTS和一一一更多分片字段置为1时表明这个帧属于。我们知道，(cid:4873)线信道
--4
的通信质量是较差的。因此(cid:4873)线局域网的数据帧不宜太长。当帧长为n而误比特率p=10个帧的多个分片之”
。若n=12144bit（相当千1518字节长的以太网帧），
时，正确收到这个帧的概率P=(l-p)
则算出这时P=0.2969,即正确收到这样的帧的概率还不到30%。因此，为了提高传输效率，
次使用

### 分块 52
则算出这时P=0.2969,即正确收到这样的帧的概率还不到30%。因此，为了提高传输效率，
次使用
一个较长的帧划分为许多较短的分片。这时可以在在信道质量较差时，需要把RTS和CTS帧预约信道后连续发送这些分片。当然这仍然要使用停止等待协议，即发送一一个分片，等收到确认后再发送下一个分片，不过后面的分片都不需要用RTS和CTS帧重(cid:4843)预约信道（如图9-13所示）。
s}FS-—
酰三言丁1长的帧划分为许多分片言气三言］
工卢产NAY(RTS)NAY(CTS)NAY（分片0)
NAY(ACKO)NAV（分片1)
NAY(ACKI)源站目的站

### 分块 53
NAY(ACKO)NAV（分片1)
NAY(ACKI)源站目的站
其他站图9-13分片的发送功率管理字段只有1位，用来指示移动站的功率管理模式。我们知道，移动站的功率是其非常宝贵的资源。移动站在活跃状态时（即发送或接收信息）需要消耗功率，而在关机•421•状态虽然不消耗功率，但却可能漏掉重要信息的接收。因此我们需要有第三种状态，这就是待机状态，或省电状态。这时移动站不进行任何实质性操作，屏幕也处千(cid:4837)电状态，但并未(cid:4838)开与AP的关联，因此这种状态非常省电。若一个移动站在发送给接入点AP的MAC帧中的功率管理字段置为O,就表示这个移动站是处千活跃状态。但若把功率管理字段置为1,则表示在成功发送完这一帧后，即进入待机状态。由于接入点AP总是处在活跃状态，因此AP发送的MAC帧的功率管理字段总是置为0。

### 分块 54
接入点AP保存有处在待机状态的移动站的名单。所有要发送给待机状态的移动站的帧，AP都暂时不发送，而是保存在自己的缓存中。由千AP要周期性地向周围的移动站发送信标帧（通常是每隔100ms发送一次），因此每个要转为待机状态的移动站都必须设置一个计时器，为的是在AP即将发送信标帧时，把处在待机状态的移动站唤醒，以便接收AP发来的信标帧。唤醒时间很短，仅0.25ms。AP发送的信标帧中有帧被缓存在AP中的节点列表。
若移动站从收到的信标帧中发现有发给自己的帧，就向AP发送请求把缓存的帧发过来。反之，若发现没有发给自己的帧，就再返回到待机状态。这样，若移动站既不发送也不接收数
据帧，就可以有99％的时间处在待机状态，因而大大地减少了电池功率的消耗。
WEP字段占1位。若WEP=I,就表明对MAC帧的帧主体字段采用了加密算法。我
们已经在9.1.l节指出，WEP加密算法有安全漏洞。因此，IEEE802.11i就努力解决(cid:4877)线

### 分块 55
局域网的安全问题。2002年Wi-Fi联盟制定了符合802.11i功能的加密(cid:4857)式WPA。2004年制定的WPA2增加了支持AES加密算法，并完全符合IEEE802.11i-2004的安全功能。现在的Wi-F]产品几乎都支持WPA2。但在MAC帧首部的帧控制字段中，WEP字段的名称仍继续使用（已发现有的(cid:4828)献把WEP字段改为被保护帧(ProtectedFrame)字段，但字段的作用不变）。WPA2的加密算法相当复杂[KUR017]，限于篇幅，这里从略。
9.2无线个人区域网WPAN(cid:4892)线个人区域网WPAN(WirelessPersonalAreaNetwork)就是在个人工作的地(cid:4857)把属千个人使用的电子设备（如便携式电脑、平板电脑、便携式打印机以及蜂窝电话等）用(cid:4877)线技
一术连接起来自组网络，不需要使用接入点AP,(cid:4821)个网络的范围约为10m。WPAN可以是个人使用，也可以是若干人共同使用（例如，
用的个外科手术小组的几位医生把几米范围内使

### 分块 56
用的个外科手术小组的几位医生把几米范围内使
个(cid:4875)线个人区域网）。这些电子设备可以很(cid:4857)便地进行通信，就像些电子设备组成一一一样。请注意，(cid:4893)线个人区域网WPAN和个人区域网PAN(PersonalArea一用普通电缆连接
Network)并不完全等同，因为PAN不一定都是使用(cid:4894)线连接的。
一WPAN和(cid:4877)线局域网WLAN并不样。WPAN是以个人为中心来使用的(cid:4877)线个人区域网，它实际上就是一个低功率、小范围、低速率和低价格的电缆替代技术。
WPAN的IEEE标准起初都由IEEE的802.15工作组制定，这个标准也包括MAC层和物理层这两层的标准[W-IEEE802.15]。后来也有其他组织参加了标准的制定。WPAN都工作在2.4GHz的ISM颜段。顺便指出，欧洲的ETSI标准则把(cid:4875)线个人区域网取名为
HiperPAN。
1.蓝牙系统最早使用的WPAN是1994年爱立信公司推出的蓝牙(Bluetooth)系统。IEEE的802.15•422•

