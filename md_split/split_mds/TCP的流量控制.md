### 分块 1
5.7TCP的流量控制5.7.1利用滑动窗口实现流量控制一(cid:7185)说来，我们总是希望数据传输得更快一些。但如果发送方把数据l!J立视频讲解发送得过快，接收方就可(cid:7126)来不及接收，这就会造成数据的丢失。所谓流量控制(flowcontrol)就是让发送方的发送速率不要太快，要让接收方来得及接收。
利用滑动窗口机制可以很方便地在TCP连接上实现对发送方的流量控制。
下面通过图5-21的例子说明如何利用滑动窗口机制进行流量控制。
seq=I,DATAB:A发达了序号］至100,还能发送300字节seq=101,DATA二牙京仁A发达了序号201否300，但丢失了！

### 分块 2
:A发送了序号101至200,还能发送200字节ACK=I,ack=20I,rwnd=300:允许A发送序号201至500共300字节seq=301,DATAseq=401,DATAseq=201,DATAACK=I,ack=501,rwnd=100seq=501,DATAACK=I,ack=60I,rwnd=0A发送了）字号301至400,还能再发送100字节新数据A发送了序号401至500,不能再发送新数据了A超时重传旧的数据，但不能发送新的数据允许A发送序号501至600共100字节A发送了序号501至600,不能再发送了不允许A再发送（到厅号600为止的数据都收到了）图5-21利用可变窗口进行流量控制举例设A向B发送数据。在连接建立时，B告诉了A:“我的接收窗口rwnd=400。”（这里
rwnd表示receiverwindow。)因此，发送方的发送窗口不(cid:7129)超过接收方给出的接收窗口＠的
数值。请注意，TCP的窗口单位是字(cid:7195)，不是报文段。TCP连接建立时的窗口协商过程在

### 分块 3
图中没有显示出来。再设每一个报文段为100字(cid:7188)长，而数据报文段序号的初始值设为1
（见图中第一个箭头上面的序号s
eq=I。图中右边的注释可帮助理解整个过程）。请注意，图中箭头上面大写ACK表示首部中的确认位ACK,小写ack表示确认字段的值。
我们应注意到，接收方的主机B进行了三次流量控制。第一次把窗口减小到rwnd=300,第二次又减到rwnd=100,最后减到rwnd=O,即不允许发送方再发送数据了。这种使发送
方暂停发送的状态将持续到主机B重新发出一个新的窗口值为止。我们还应注意到，B向
A发送的三个报文段都设置了ACK=l,只有在ACK=1时确认号字段才有意义。
现在我们考虑一种情况。在图5-21中，B向A发送了零窗口的报文段后不久，B的接
收缓存又有了一些存储空间。于是B向A发送了rwnd=400的报文段。然而这个报文段在
传送过程中丢失了。A一直等待收到B发送的非零窗口的通知，而B也一直等待A发送的
数据。如果没有其他措施，这种互相等待的死锁局面将一直延续下去。

### 分块 4
数据。如果没有其他措施，这种互相等待的死锁局面将一直延续下去。
为了解决这个问题，TCP为每一个连接设有一个持续计时器(perstimer)。只要istenceCD注：从rwnd的原文看，中文译名应当是接收方窗口。然而在不产4误解的情况下，也可简称为接收窗口。
•236•TCP连接的一方收到对方的零窗口通知，就启动持续计时器。若持续计时器设置的时间到
期，就发送一个零窗口探测报文段（仅携带l字(cid:7194)的数据）气而对方就在确认这个探测报
文段时给出了现在的窗口值。如果窗口仍然是零，那么收到这个报文段的一方就重新设置持
续计时器。如果窗口不是零，那么死锁的僵局就可以打破了。
扫·j·15.7.2TCP的传输效率
、护扣＄
前面已经讲过，应用进程把数据传送到TCP的发送缓存后，剩下的发�J.1.....飞§}
匝祧嗟担
送任务就由TCP来控制了。可以用不同的机制来控制TCP报文段的发送时笝合氪倍也
机。例如，第一种机制是TCP维持一个变量，它等于最大报文段长度MSS。
只要缓存中存放的数据达到MSS字(cid:7194)时，就组装成一个TCP报文段发送出去。第二种机制

### 分块 5
是由发送方的应用进程指明要求发送报文段，即TCP支持的推送(push)操作。第三种机制是
发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不(cid:7138)超过
MSS)发送出去。
f见步扩训解但是，如何控制TCP发送报文段的时机仍然是一个较为复杂的问题[RFC1
例如，一个交互式用户使用一条TELNET连接（运输层为TCP协议）。假设用户只发l
个字符，加上20字(cid:7188)的首部后，得到21字(cid:7194)长的TCP报文段。再加上20字节的IP首部，
形成41字(cid:7188)长的IP数据报。在接收方TCP立即发出确认，构成的数据报是40字(cid:7194)长（假
定没有数据发送）。若用户要求远地主机回送这一字符，则又要发回41字节长的IP数据报
和40字(cid:7188)长的确认IP数据报。这样，用户仅发1个字符时，线路上就需传送总长度为162
字(cid:7188)共4个报文段。当线路带宽并不富裕时，这种传送方法的效率的确不高。因此应适当推122]。
迟发回确认报文，并尽量使用捎带确认的方法。

### 分块 6
迟发回确认报文，并尽量使用捎带确认的方法。
在TCP的实现中广泛使用Nagle算法。算法如下：若发送应用进程把要发送的数据逐
个字(cid:7191)地送到TCP的发送缓存，则发送方就把第一个数据字(cid:7194)先发送出去，把后面到达的
数据字(cid:7188)都缓存起来。当发送方收到对第一个数据字符的确认后，再把发送缓存中的所有数
据组装成一个报文段发送出去，同时继续对随后到达的数据进行缓存。只有在收到对前一个
报文段的确认后才继续发送下一个报文段。当数据到达较快而网络速率较慢时，用这样的方
法可明显地减少所用的网络带宽。Nagle算法还规定，当到达的数据已达到发送窗口大小的
一半或已达到报文段的最大长度时，就立即发送一个报文段。这样做，就可以有效地提高网
络的吞吐量。
另一个问题叫作糊涂窗口综合征(sillywindowsyndrome)，有时也会使TCP的性(cid:7139)变坏。
设想一种情况：TCP接收方的缓存已满，而交互式的应用进程一次只从接收缓存中读取l

### 分块 7
设想一种情况：TCP接收方的缓存已满，而交互式的应用进程一次只从接收缓存中读取l
个字(cid:7194)（这样就使接收缓存空间仅(cid:7148)出1个字(cid:7188)），然后向发送方发送确认，并把窗口设置
为1个字节（但发送的数据报是40字(cid:7188)长）。接着，发送方又发来l个字(cid:7188)的数据（请注意，
发送方发送的IP数据报是41字(cid:7194)长）。接收方发回确认，仍然将窗口设置为1个字节。这样进行下去，使网络的效率很低。
要解决这个问题，可以让接收方等待一段时间，使得或者接收缓存已有足够空间容纳
一个最长的报文段，或者等到接收缓存已有一半空闲的空间。只要出现这两种情况之一，接CD注：TCP规定，即使设置为零窗口，也必须接收以下几种报文段：零窗口探刷报又段、确认报义段和携沿紧急数拟的报文段。
•237•收方就发出确认报文，并向发送方通知当前的窗口大小。此外，发送方也不要发送太小的报
文段，而是把数据积累成足够大的报文段，或达到接收方缓存的空间的一半大小。

### 分块 8
文段，而是把数据积累成足够大的报文段，或达到接收方缓存的空间的一半大小。
上述两种方法可配合使用。使得在发送方不发送很小的报文段的同时，接收方也不要在缓存刚刚有了一点小的空间就急忙把这个很小的窗口大小信息通知给发送方。
5.8TCP的拥塞控制一5.8.1拥塞控制的般原理在计算机网络中的链路容量（即带宽）、交换(cid:7188)点中的缓存和处理机等，扫一扫寄恩畸启视频讲解都是网络的资源。在某段时间，若对网络中某一资源的需求超过了该资源所(cid:7126)
提供的可用部分，网络的性(cid:7126)就要变坏。这种情况就叫作拥塞(congestion)。可以把出现网络拥
塞的条件写成如下的关系式：区对负源的需求＞可用资掠(5-7)若网络中有许多资源同时呈现供应不足，网络的性(cid:7126)就要明显变坏，整个网络的吞吐量将随输入负荷的增大而下降。
有人可(cid:7126)会说：“只要任意增加一些资源，例如，把(cid:7188)点缓存的存储空间扩大，或把链路更换为更高速率的链路，或把(cid:7188)点处理机的运算速度提高，就可以解决网络拥塞的问题。”

### 分块 9
其实不然。这是因为网络拥塞是一个非常复杂的问题。简单地采用上述做法，在许多情况下，
不但不(cid:7126)解决拥塞问题，而且还可(cid:7126)使网络的性(cid:7126)更坏。
网络拥塞往往是由很多因素引起的。例如，当某个(cid:7188)点缓存的容量太小时，到达该(cid:7192)点的分组因无存储空间暂存而不得不被丢弃。现在设想将该(cid:7188)点缓存的容量扩展到非常大，千是凡到达该节点的分组均可在(cid:7188)点的缓存队列中排队，不受任何限制。由千输出链路的容量和处理机的处理速度并未提高，因此在这队列中的绝大多数分组的排队等待时间将会大大增加，结果上层软件只好把它们进行重传（因为早就超时了）。由此可见，简单地扩大缓存的存储空间同样会造成网络资源的严重浪费，因而解决不了网络拥塞的问题。
又如，处理机处理的速率太低可(cid:7126)引起网络的拥塞。简单地将处理机的速率提高，可
(cid:7126)会使上述情况缓解一些，但往往又会将瓶颈转移到其他地方。问题的实质往往是整个系统
的各个部分不匹配。只有所有的部分都平衡了，问题才会得到解决。

### 分块 10
的各个部分不匹配。只有所有的部分都平衡了，问题才会得到解决。
拥塞常常趋千恶化。如果一个路由器没有足够的缓存空间，它就会丢弃一些新到的分
组。但当分组被丢弃时，发送这一分组的源点就会重传这一分组，甚(cid:7169)可(cid:7126)还要重传多次。
这样会引起更多的分组流入网络和被网络中的路由器丢弃。可见拥塞引起的重传并不会缓解
网络的拥塞，反而会加剧网络的拥塞。
拥塞控制与流量控制的关系密切，它们之间也存在着一些差别。所谓拥塞控制就是防
止过多的数据注入到网络中，这样可以使网络中的路由器或链路不(cid:7173)千过载。拥塞控制所要
做的都有一个前提，就是网络(cid:7129)够承受现有的网络负荷。拥塞控制是一个全局性的过程，涉

### 分块 11
做的都有一个前提，就是网络(cid:7129)够承受现有的网络负荷。拥塞控制是一个全局性的过程，涉
及所有的主机、所有的路由器，以及与降低网络传输性(cid:7126)有关的所有因素。但TCP连接的端点只要迟迟不(cid:7126)收到对方的确认信息，就猜想在当前网络中的某处很可(cid:7126)发生了拥塞，但这时却无法知道拥塞到底发生在网络的何处，也无法知道发生拥塞的具体原因。（是访问某个服务器的通信量过大？还是在某个地区出现(cid:7160)然灾害？）相反，流量控制往往是指点对点通信量的控制，是个端到端的问题（接收端控制发送•238•

