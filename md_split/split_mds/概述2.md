### 分块 1
第8章互联网上的音频／视频服务本章首先对互联网提供音频／视频服务进行概述。然后介绍流式音频／视频中的媒体服务器和实时流式协议RTSP,并以IP电话为例介绍交互式音频／视频所使用的一些协议，如实时运输协议RTP、实时传送控制协议RTCP、H.323以及会话发起协议SIP。接着讨论改进
““尽最大努力交付服务的些措施，包括怎样使互联网能够提高服务质量，并介绍综合服一务IntServ、资源预留协议RSVP和区分服务DiffSe1-v的要点。
本章最重要的内容是；
(1)多媒体信息的特点（如时延和时延抖动，播放时延等）。
(2)流媒休的概念。
(3)IP电话使用的几种协议。
“
(4)改进尽最大努力交付服务的几种方法。
“8.1概述计算机网络最初是为传送数据设计的。互联网IP层提供的“尽最大努力交付“服务以及每一个分组独立交付的策略，对传送数据信息十分合适。互联网使用的TCP协议可以很好地解决IP层不能提供可靠交付这一问题。

### 分块 2
然而技术的进步使许多用户开始利用互联网传送音频／视频信息。在许多情况下，这种音频／视频常称为多媒体信息气本来电路交换的公用电话网传送话音和多媒体信息早已是成熟的技术。例如视频会议（又称为电视会议）原先是使用电路交换的公用电话网。使用电路交换的好处是：一旦连接建立了（也就是只要拨通了电话），各种信号在电话线路上的传输质量就有保证。但使用公用电话网的缺点是价格太高。因此要想办法改用互联网。
多媒体信息（包括声音和图像信息）与不包括声音和图像的数据信息有很大的区别，其中最主要的两个特点如下。
一第，多媒体信息的信息量往往很大。
一含有音频或视频的多媒体信息的信息量
对于电话的声音信息，如采用标准的PCM编码(8kHz速率采样），而每个采样脉冲
用8位编码，则得出的声音信号的数据率就是64kbit/s。对于高质量的立体声音乐CD信息，
虽然它也使用PCM编码，但其采样速率为44.1kHz,而每
个采样脉冲用16位编码，因此
这种双声道立体声音乐信号的数据率超过了1.4Mbit/s。
下面是简单的说明。

### 分块 3
这种双声道立体声音乐信号的数据率超过了1.4Mbit/s。
下面是简单的说明。
般都很大，一一印注：多媒体信息和传统数据信息不同，它是指内容上相叮关联的文本、图形、图像、声音、动画和活动图像等所形成的复合数据信息。而多媒体业务则应有使成件、交且忤和同步性的特占。集成性是指对多媒体信息进行存储、传输、处理、显示的能力，玄互件是指人与多媒体1iv.务系统之间的相叮拧制能力，同步性是指在多媒体＼Iv.务终端上显示的图像、声音和文字是以同步方式上1个的。在本祁中，我们经沿把音频／视频信息和多媒体信息作为同义词来使用，虽然它们并不严格地等同。
•370•再看
一码，则一下数码照片。假定分辨率为1280X960（中等质量）。若每个像素用24位进行编张未经压缩的照片的字节数约合3.52MB（这里1B=8bit,1M=220)。
活动图像的信息量就更大，如不压缩的彩色电视信号的数据率超过250Mbit/s。
因此在网上传送多媒体信息都无例外地采用各种信息压缩技术。例如在话音压缩方面的标准有：移动通信的GSMC13kbit/s),IP电话使用的G.729

### 分块 4
(8kbit/s)和G.723.1(6.4kbit/s
和5.3kbit/s)；在立体声音乐的压缩技术有MP3(128kbit/s或112kbit/s)。在视频信号方面
有：VCD质量的MPEG1(1.5Mbit/s)和DVD质量的MPEG.2(3~6Mbit/s)。由于多媒体信息压缩技术本身不是计算机网络技术范畴，本书将不讨论有关数据压缩方面的内容。
第二，在传输多媒体数据时，对时延和时延抖动均有较高的要求。
首先要说明的是，“传输多媒体数据“隐含地表示了＂边传输边播放＂的意思。因为如果是把多媒体音频／视频节目先下载到计算机的硬盘中，等下载完毕后再去播放，那么在互联网上传输多媒体数据就没有什么更多的特点值得我们专门来讨论（仅仅是数据量非常大而己）。设想我们想欣赏网上的某个视频或音频节目。如果必须先花好几个小时（准确的时间事先还不知道）来下载它，等下载完毕后才能开始播放，那么这显然是很不方便的。因此，今后讨论在互联网上传输多媒体数据时，都是指含有边传输边播放的特点。
“”我们知道，模拟的多媒体信号只有经过数字化后才能在互联网上传送。就是对模拟信

### 分块 5
“”我们知道，模拟的多媒体信号只有经过数字化后才能在互联网上传送。就是对模拟信
一号要经过采样和模数转换变为数字信号，然后将定数量的比特组装成分组进行传送。这些分组在发送时的时间间隔都是恒定的，通常称这样的分组为等时的(isochronous)。这种等时分组进入互联网的速率也是恒定的。但传统的互联网本身是非等时的。这是因为在使用IP
个分组是独立地传送，因而这些分组在到达接收端时就变成为非等时
协议的互联网中，每一的。如果我们在接收端对这些以非恒定速率到达的分组边接收边还原，那么就
大的失真。图8-1说明了互联网是非等时的这特点。
一一定会产生很模拟信号//＼／尸IIIh|IIIIIIIl||||了「门门丿采样后的信号发送的分组
（等时的）恒定速率三叮联网/二
\_-心/到达的分组
（非等时的）OJ]门非恒定速率困8-1互联网是非等时的要解决这一问题，可以在接收端设置适当大小的缓存1，当缓存中的分组数达到一定的数量后再以恒定速率按顺序将这些分组读出进行还原播放。图8-2说明了缓存的作用。
到达的分组
（非等时的）�I二缓存（队列）IIIIIIIIII匕二二二：有可能发生
分组丢失
＼

### 分块 6
到达的分组
（非等时的）�I二缓存（队列）IIIIIIIIII匕二二二：有可能发生
分组丢失
＼
门＼经过缓存
变成等时的I『|［|f非恒定速率,T,恒定速率图8-2缓存把非等时的分组变换为等时的从图8-2可看出，缓存实际上就是一个先进先出的队列。图中标明的T叫作播放时延，这就是从最初的分组开始到达缓存算起，经过时间T后就按固定时间间隔把缓存中的分组句注：请不要和运输层TCP的缓存弄混。这里所说的缓存是在应用层的缓存。
•371•按先后顺序依次读出。我们看到，缓存使所有到达的分组都经受了迟延。由于分组以非恒定速率到达，因此早到达的分组在缓存中停留的时间较长，而晚到达的分组在缓存中停留的时间就较短。从缓存中取出分组是按照固定的时钟节拍进行的，因此，到达的非等时的分组，
经过缓存后再以恒定速率读出，就变成了等时的分组（但请注意，时延太大的分组就丢弃了），这就在很大程度上消除了时延的抖动。但我们付出的代价是增加了时延。以上所述的概念可以用图8-3来说明。
暴愚愚＿＿＿分
发组
出一＿暴
－456O推迟播放l23到达组分
·数6_15432234分
到组
达一5'
,
l
＇
l
l

### 分块 7
－456O推迟播放l23到达组分
·数6_15432234分
到组
达一5'
,
l
＇
l
l
,6口21l且1456＠再推迟播放时间•t图8-3利用缓存得到等时的分组序列图8-3画出了发送端一
连发送6个等时的分组。如果网络没有时延，那么到达的分组数随时间的变化就如图中最左边的阶梯状的曲线所示。这就是说，只要发送方一发出一在接收方到达的分组数就立即加1。但实际的网络使每一个分组经受的时延不同，因此这个分组，
一串分组在到达接收端时就变成了非等时的，这就使得分组到达的阶梯状曲线向右移动，并且变成不均匀的。图8-3标注出了分组l的时延。图中给出了两个不同的开始播放时刻。黑色小圆点表示在播放时刻对应的分组已经在缓存中，而空心小圆圈表示在播放时刻对应的分组尚未到达。我们可以看出，即使推迟了播放时间（如图中的O)，也还有可能有某个迟到分组赶不上播放（如图中的空心小圆圈）。如果再推迟播放时间（如图中的＠），则所有的6个分组都不会错过播放，但这样做的时延会较大。
然而我们还有一些问题没有讨论。

### 分块 8
然而我们还有一些问题没有讨论。
首先，播放时延T应当选为多大？把T选择得越大，就可以消除更大的时延抖动，但所有分组经受的平均时延也增大了，而这对某些实时应用（如视频会议）是很不利的。当然这对单向传输的视频节目问题并不太大（如从网上下载一段视频节目，只要耐心多等待一段时间用来将分组放入缓存即可）。如果T选择得太小，那么消除时延抖动的效果就较差。因此播放时延T的选择必须折中考虑。在传送时延敏感(delaysensitive)的实时数据时，不仅传输时延不能太大，而且时延抖动也必须受到限制。
•372•其次，在互联网上传输实时数据的分组时有可能会出现差错或甚至丢失。如果利用TCP协议对这些出错或丢失的分组进行重传，那么时延就会大大增加。因此实时数据的传输在运输层就应采用用户数据报协议UDP而不使用TCP协议。这就是说，对千传送实时数据，我们宁可丢失少量分组（当然不能丢失太多），也不要太晚到达的分组。在连续的音频或视频数据流中，很少量分组的丢失对播放效果的影响并不大（因为这是山人来进行主观评价的），因而是可以容忍的。丢失容忍(losstolerant)也是实时数据的另一个重要特点。

### 分块 9
由千分组的到达可能不按序，但将分组还原和播放时又应当是按序的。因此在发送多媒体分组时还应当给每
一一个分组加上序号。这表明还应当有相应的协议支持才行。
还有种情况，就是要使接收端能够将节目中本来就存在的正常的短时间停顿（如话音中的静默期或音乐中出现的几拍停顿）和因某些分组产生的较大迟延造成的“停顿开来。这就需要在每一个分组增加一个时间戳(timestamp)，让接收端知道所收到的每”一区分个分组是在什么时间产生的。
有了序号和时间戳，再采用适当的算法，接收端就知道应在什么时间开始播放缓存中收到的分组。这样既可减少分组的丢失率，也可使播放的延迟在人们可容忍的范围之内。
根据以上的讨论可以看出，若想在互联网上传送质量很好的音频／视频数据，就需要设法改造现有的互联网使它能够适应音频／视频数据的传送。

### 分块 10
对这个问题，网络界一直有较大的争论，众说纷纭。有人认为，只要大量使用光缆，网络的时延和时延抖动就可以足够小。再加上使用具有大容量高速缓存的高速路由器，在互联网上传送实时数据就不会有问题。也有人认为，必须将互联网改造为能够对端到端的带宽实现预留(reservation)，从而根本改变互联网的协议栈从无连接的网络转变为面向连接的网络。还有人认为，部分改动杠联网的协议栈所付出的代价较小，而这也能够使多媒体信息在互联网上的传输质量得到改进。
尽管上述的争论仍在继续，但互联网的一些新的协议也在不断出现。下面我们有选择地讨论与传送音频／视频信息有关的若干问题。

### 分块 11
目前互联网提供的音频／视频服务大体上可分为三种类型：(1)流式(streaming)存储音频／视频这种类型是先把已压缩的录制好的音频／视频文件（如音乐、电影等）存储在服务器上。用户通过互联网下载这样的文件。请注意，用户并不是把文件全部下载完毕后再播放，因为这往往需要很长时间，而用户一般也不大愿意等待太长的时间。流式存储音频／视频文件的特点是能够边下载边播放，即在文件下载后不久（例一如，般在缓存中存放最多几十秒）就开始连续播放。请注意，普通光盘中的DVD电影文件不是流式视频文件。如果我们打算下载一部光盘中的普通的DVD电影，那么你只能花费很长的时间把整个电影文件全部下载完毕后才能播放。请注意，flow的译名也是
“流量”
)，但意思和streaming完全不同。
”“流（或(2)流式实况音频／视频这种类型和无线电台或电视台的实况广播相似，不同之处是

### 分块 12
”“流（或(2)流式实况音频／视频这种类型和无线电台或电视台的实况广播相似，不同之处是
一一一音频／视频节目的广播是通过互联网来传送的。流式实况音频／视频是对多（而不是对）的通信。它的特点是：音频／视频节目不是事先录制好和存储在服务器中的，而是在发送方边录制边发送（不是录制完毕后再发送）。在接收时也要求能够连续播放。接收方收到节目的时间和节目中事件的发生时间可以认为是同时的（相差仅仅是电磁波的传播时间和很短的信号处理时间）。流式实况音频／视频按理说应当采用多播技术才能提高网络资源的利用率，•373•但目前实际上还是使用多个独立的单播。
(3)交互式音频／视频这种类型是用户使用兀联网和其他人进行实时交互式通信。现在的互联网电话或互联网电视会议就属千这种类型。
““请注意，对千流式音频／视频的下载，实际上并没有把＂“下载的内容存储在硬盘上。
“因此当边下载边播放”结束后，在用户的硬盘上没有留下有关播放内容的任何痕迹。播放流式音频／视频的用户，仅仅能够在屏幕上观看播放的内容。用户既不能修改节目内容，也不能把播放的内容存储下来，因此也无法进行转发。这对保护版权非常有利。

### 分块 13
不过技术总是在不断进步的，现在已经有了能够存储在网上播放的流式音频／视频文件的软件。
我们现在常见的词汇流媒体(streamingmedia)就是上面所说的流式音频／视频。流媒体最主要的特点就是不是全部都收录下来再开始播放。在国外的一些文献中，常见到streaming一词，网上有人译为“串流“”或流播“，但目前还没有找到对streaming更好的译名。
限于篇幅，下面简单介绍上面的第一种和第三种音频／视频类型的服务。
8.2流式存储音频／视频“流式存储音频／视频”中的“存储“二字，表明这里所讨论的流式音频／视频文件不是实时产生的，而是已经录制好的，通常存储在光盘或硬盘中。不过有时为了简便，往往省略““存储二字。在讨论从网上下载这种文件之前，我们先回忆一下使用传统的浏览器是怎样从服务器下载已经录制好的音频／视颜文件的。图8-4说明了下载的三个步骤。
客户机
一1�

### 分块 14
客户机
一1�
I，，服务器GET音频／视频文件RESPONSE图8-4传统的下载文件方法0用户从客户机(clientmachine)的浏览器上用HTTP协议向服务器请求下载某个音频／视频文件，GET表示请求下载的HTTP报文。请注意，HTTP使用TCP连接。
＠服务器如有此文件就发送给浏览器，RESPONSE表示服务器的HTTP响应报文。在响应报文中装有用户所要的音频／视频文件。整个下载过程可能会花费很长的时间。
＠当浏览器完全收下这个文件后（所需的时间取决千音频／视频文件的大小），就可以传送给自己机器上的媒体播放器进行解压缩，然后播放。
为什么不能直接在浏览器中播放音频／视频文件呢？这是因为播放器并没有集成在万维网浏览器中。因此，必须使用
个单独的应用程序来播放这种音频／视频节目。这个应用程
序通常称为媒体播放器(mediaplayer)。现在流行的媒体播放器有RealNetworks的RealPlayer、
微软的WindowsMediaPlayer和苹果公司的QuickTime。媒体播放器具有的主要功能是：管一•374•

