### 分块 1
6.6动态主机配置协议DHCP视频讲解为了把协议软件做成通用的和便于移植的，协议软件的编写者不会把所
一
有的细节都固定在源代码中。相反，他们把协议软件参数化。这就使得在很
一一一一多台计算机上有可能使用同个经过编译的二进制代码。
台计算机和另
一台计算机的许多区别，都可以通过些不同的参数来体现。在协议软件运行之前，必须给每个参数赋值。
在协议软件中给这些参数赋值的动作叫作协议配置。
个协议软件在使用之前必须是已正确配置的。具体的配置信息有哪些则取决千协议栈。例如，连接到互联网的计算机的协
议软件需要配置的项目包括：(1)IP地址；
(2)子网掩码；
(3)默认路由器的IP地址；
(4)域名服务器的IP地址。
一
为了省去给计算机配置IP地址的麻烦，我们能否在计算机的生产过程中，事先给每一一一一一台计算机配置好
一个唯的IP地址呢（如同每
一个以太网适配器拥有个唯的MAC地址）？这显然是不行的。这是因为IP地址不仅包括了主机号，而且还包括了网络号。一个
IP地址指出了
个网络上。当计算机还在生产时，无法知道它在出厂
台计算机连接在哪

### 分块 2
IP地址指出了
个网络上。当计算机还在生产时，无法知道它在出厂
台计算机连接在哪
个网络上。因此，需要连接到互联网的计算机，必须对IP地址等项目进一后将被连接到哪
行协议配置。
一一
Protocol)，它提供了用人工进行协议配置很不方便，而且容易出错。因此，应当采用自动协议配置的方法。
互联网现在广泛使用的是动态主机配置协议DHCP(DynamicHostConfiguration
种机制，称为即插即用连网(plug-and-playnetworking)。这种机制允许
—
台计算机加入新的网络和获取IP地址而不用手工参与。DHCP最新的RFC文档还是互联
一网草案标准[RFC21312132]。
DHCP对运行客户软件和服务器软件的计算机都适用。当运行客户软件的计算机移至
个新的网络时，就可使用DHCP获取其配置信息而不需要手工干预。DHCP给运行服务器
软件而位置固定的计算机指派个永久地址，而当这计算机重新启动时其地址不改变。
一DHCP使用客户服务器方式。需要IP地址的主机在启动时就向DHCP服务器广播发送

### 分块 3
一DHCP使用客户服务器方式。需要IP地址的主机在启动时就向DHCP服务器广播发送
发现报文(DHCPDISCOVER)（将目的IP地址置为全1,即255.255.255.255)，这时该主机就
成为DHCP客户。发送广播报文是因为现在还不知道DHCP服务器在什么地方，因此要发
现(DISCOVER)DHCP服务器的IP地址。这台主机目前还没有自己的IP地址，因此它将IP
数据报的源IP地址设为全0。这样，在本地网络上的所有主机都能够收到这个广播报文，
但只有DHCP服务器才对此广播报文进行回答。DHCP服务器先在其数据库中查找该计算
机的配置信息。若找到，则返回找到的信息。若找不到，则从服务器的IP地址池(address
”
pool)中取
个地址分配给该计算机。DHCP服务器的回答报文叫作提供报文(DHCPOFFER),
表示提供一一一“了IP地址等配置信息。
一一但是我们并不愿意在每
务器的数量太多。因此现在是使每
是（通常
台路由器，如图6-18所示），它配置了DHCP服务器的IP地址信息。当DHCP中继代个网络至少有个DHCP服务器，因为这样会使DHCP服

### 分块 4
个DHCP中继代理(relayagent)个网络上都设置一理收到主机A以广播形式发送的发现报文后，就以单播方式向DHCP服务器转发此报文，•304•并等待其回答。收到DHCP服务器回答的提供报文后，DHCP中继代理再把此提供报文发
回给主机A。需要注意的是，图6-18只是个示意图。实际上，DHCP报文只是UDP用户数据报的数据，它还要加上UDP首部、IP数据报首部，以及以太网的MAC帧的首部和尾部后，才能在链路上传送。
主机A广播
IDHCPDISCOVER尸DHCP服务器%1单播
IDHCPDISCOVER尸DHCP中继代理图中继代理以单播方式转发发现报文6-18DHCPDHCP服务器分配给DHCP客户的IP地址是临时的，因此DHCP客户只能在一段有限的时间内使用这个分配到的IP地址。DHCP协议称这段时间为租用期(leaseperiod)，但并没有具体规定租用期应取为多长或至少为多长，这个数值应由DHCP服务器自己决定。例如，一个校园网的DHCP服务器可将租用期设定为1小时。DHCP服务器在给DHCP发送的提

### 分块 5
供报文的选项中给出租用期的数值。按照RFC2132的规定，租用期用4字节的二进制数字表示，单位是秒。因此可供选择的租用期范围从1秒到136年。DHCP客户也可在自已发送的报文中（例如，发现报文）提出对租用期的要求。
DHCP的详细工作过程如图6-19所示。DHCP客户使用的UDP端口是68,而DHCP服务器使用的UDP端口是67。这两个UDP端口都是熟知端口。
＠,I三oUDPUDPUDPUDPUDPUDPDHCPDISCOVERDHCPOFFERDHCPREQUESTDHCPACKDHCPREOUESTDHCPACKDHCPNACKDHCPRELEASE协议的工作过程下面按照图6-19中的注释编号(0至O)进行简单的解释。
图6-19DHCP0DHCP服务器被动打开UDP端口67,等待客户端发来的报文。
8DHCP客户从UDP端口68发送DHCP发现报文。
视频讲解＠凡收到DHCP发现报文的DHCP服务器都发出DHCP提供报文，因此DHCP客户•305•可能收到多个DHCP提供报文。

### 分块 6
0DHCP客户从几个DHCP服务器中选择其中的一个，并向所选择的DHCP服务器发送DHCP请求报文。
©被选择的DHCP服务器发送确认报文DHCPACK。从这时起，DHCP客户就可以使用这个IP地址了。这种状态叫作已绑定状态，因为在DHCP客户端的IP地址和MAC地址已经完成绑定，并且可以开始使用得到的临时IP地址了。
DHCP客户现在要根据服务器提供的租用期T设置两个计时器T1和T2,它们的超时时间分别是0.5T和0.875T。当超时时间到了就要请求更新租用期。
0租用期过了一新租用期。
半（T1时间到），DHCP客户发送请求报文DHCPREQUEST要求更8DHCP服务器若同意，则发回确认报文DHCPACK。DHCP客户得到了新的租用期，重新设置计时器。
0DHCP服务器若不同意，则发回否认报文DHCPNACK。这时DHCP客户必须立即停止使用原来的IP地址，而必须重新申请IP地址（回到步骤＠）。

### 分块 7
若DHCP服务器不响应步骤0的请求报文DHCPREQUEST,则在租用期过了87.5％时（兀时间到），DHCP客户必须重新发送请求报文DHCPREQUEST（重复步骤0)，然后又继续后面的步骤。
0DHCP客户可以随时提前终止服务器所提供的租用期，这时只需向DHCP服务器发送释放报文DHCPRELEASE即可。
DHCP很适合千经常移动位置的计算机。当计算机使用Windows操作系统时，点击“控制面板”““的
“网络
”协议后点击其属性按钮，若选择图标就可以找到某个连接中的“自动获得IP地址”“”网络
“和下面的菜单，找到TCP/IP
”自动获得DNS服务器地址选项，就表示是使用DHCP协议。
6.7简单网络管理协议SNMP6.7.1网络管理的基本概念虽然网络管理还没有精确定义，但它的内容可归纳为：网络管理包括对硬件、软件和人力的使用、综合与协调，以便对网络资源进行监视、测试、配置｀分析、评价和控制，这样就能以合理的价格满足网络的
性能、服务质量等。网络管理常简称为网管。
—些需求，如实时运行我们可以看到，网络管理并不是指对网络进行行政上的管理。

### 分块 8
—些需求，如实时运行我们可以看到，网络管理并不是指对网络进行行政上的管理。
网络是个非常复杂的分布式系统。这是因为网络上有很多不同厂家生产的、运行着一多种协议的节点（主要是路由器），而这些节点还在相互通信和交换信息。网络的状态总是
一一不断地变化着。可见，我们必须使用种机制来读取这些节点上的状态信息，有时还要把些新的状态信息写入到这些节点上。
下面简单介绍网络管理模型中的主要构件（如图6-20所示）。
管理站又称为管理器，是整个网络管理系统的核心，它通常是个有着良好图形界面的高性能的工作站，并由网络管理员直接操作和控制。所有向被管设备发送的命令都是从管理站发出的。管理站的所在部门也常称为网络运行中心NOC(NetworkOperationsCenter)。管•306•

