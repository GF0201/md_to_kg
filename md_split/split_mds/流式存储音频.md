### 分块 1
但目前实际上还是使用多个独立的单播。
(3)交互式音频／视频这种类型是用户使用兀联网和其他人进行实时交互式通信。现在的互联网电话或互联网电视会议就属千这种类型。
““请注意，对千流式音频／视频的下载，实际上并没有把＂“下载的内容存储在硬盘上。
“因此当边下载边播放”结束后，在用户的硬盘上没有留下有关播放内容的任何痕迹。播放流式音频／视频的用户，仅仅能够在屏幕上观看播放的内容。用户既不能修改节目内容，也不能把播放的内容存储下来，因此也无法进行转发。这对保护版权非常有利。
不过技术总是在不断进步的，现在已经有了能够存储在网上播放的流式音频／视频文件的软件。
我们现在常见的词汇流媒体(streamingmedia)就是上面所说的流式音频／视频。流媒体最主要的特点就是不是全部都收录下来再开始播放。在国外的一些文献中，常见到streaming一词，网上有人译为“串流“”或流播“，但目前还没有找到对streaming更好的译名。
限于篇幅，下面简单介绍上面的第一种和第三种音频／视频类型的服务。

### 分块 2
限于篇幅，下面简单介绍上面的第一种和第三种音频／视频类型的服务。
8.2流式存储音频／视频“流式存储音频／视频”中的“存储“二字，表明这里所讨论的流式音频／视频文件不是实时产生的，而是已经录制好的，通常存储在光盘或硬盘中。不过有时为了简便，往往省略““存储二字。在讨论从网上下载这种文件之前，我们先回忆一下使用传统的浏览器是怎样从服务器下载已经录制好的音频／视颜文件的。图8-4说明了下载的三个步骤。
客户机
一1�
I，，服务器GET音频／视频文件RESPONSE图8-4传统的下载文件方法0用户从客户机(clientmachine)的浏览器上用HTTP协议向服务器请求下载某个音频／视频文件，GET表示请求下载的HTTP报文。请注意，HTTP使用TCP连接。
＠服务器如有此文件就发送给浏览器，RESPONSE表示服务器的HTTP响应报文。在响应报文中装有用户所要的音频／视频文件。整个下载过程可能会花费很长的时间。
＠当浏览器完全收下这个文件后（所需的时间取决千音频／视频文件的大小），就可以传送给自己机器上的媒体播放器进行解压缩，然后播放。

### 分块 3
为什么不能直接在浏览器中播放音频／视频文件呢？这是因为播放器并没有集成在万维网浏览器中。因此，必须使用
个单独的应用程序来播放这种音频／视频节目。这个应用程
序通常称为媒体播放器(mediaplayer)。现在流行的媒体播放器有RealNetworks的RealPlayer、
微软的WindowsMediaPlayer和苹果公司的QuickTime。媒体播放器具有的主要功能是：管一•374•理用户界面、解压缩、消除时延抖动和处理传输带来的差错。
“请注意，图8-4所示传统的下载文件的方法并没有涉及流式”
（即边下载边播放）的概念。传统的下载方法最大缺点就是历时太长，这往往使下载者不愿继续等待。为此，已经找出了几种改进的措施。
8.2.1具有元文件的万维网服务器一第种改进的措施就是在万维网服务器中，除了真正的音频／视频文件外，还增加了一个元文件(metafile)。所谓元文件（请注意，不是源文件）就是一种非常小的文件，它描述或指明其他文件的一些重要信息。这里的元文件保存了有关这个音频／视频文件的信息。图8-5说明了使用元文件下载音频／视频文件的几个步骤。
客户机

### 分块 4
客户机
I服务器「导；lGET元文件RESPONSE2音频／视砌RESPONSE图8-5使用具有元文件的万维网服务器0浏览器用户点击所要看的音频／视频文件的超链，使用HTTP的GET报文接入到万维网服务器。实际上，这个超链并没有直接指向所请求的音频／视频文件，而是指向文件。这个元文件有实际的音频／视频文件的统一资源定位符URL。
一个元＠万维网服务器把该元文件装入HTTP响应报文的主体，发回给浏览器。在响应报文中还有指明该音频／视频文件类型的首部。
＠客户机浏览器收到万维网服务器的响应，分析其内容类型首部行，调用相关的媒体播放器（客户机中可能装有多个媒体播放器），把提取出的元文件传送给媒体播放器。
0媒体播放器使用元文件中的URL直接和万维网服务器建立TCP连接，并向万维网服务器发送HTTP请求报文，要求下载浏览器想要的音频／视频文件。
0万维网服务器发送HTTP响应报文，把该音频／视频文件发送给媒体播放器。媒体播放器在存储了若干秒的音频／视频文件后（这是为了消除抖动），就以音频／视频流的形式边下载、边解压缩、边播放。

### 分块 5
8.2.2媒体服务器为了更好地提供播放流式音频／视频文件的服务，现在最为流行的做法就是使用两个分
个媒体服务器开的服务器。如图8-6所示，现在使用个普通的万维网服务器，和另一一(mediaserver)。媒体服务器和万维网服务器可以运行在一个端系统内，也可以运行在两个不同的端系统中。媒体服务器与普通的万维网服务器的最大区别就是，媒体服务器是专门为播放流式音频／视频文件而设计的，因此能够更加有效地为用户提供播放流式多媒体文件的服务。因此媒体服务器也常被称为流式服务器(streamingserver)。下面我们介绍其工作原理。
•375•客户机l
：一I;�，服务器GET：元文件RESPONSE0
GET音频／视频文件
..媒体RESPONSE图8-6使用媒体服务器在用户端的媒体播放器与媒体服务器的关系是客户与服务器的关系。与图8-5不同的是，现在媒体播放器不是向万维网服务器而是向媒体服务器请求音频／视频文件。媒体服务器和媒体播放器之间采用另外的协议进行交互。

### 分块 6
采用媒体服务器后，下载音频／视频文件的前三个步骤仍然和上一节所述的一样，区别就是后面两个步骤，即：0~＠前三个步骤与图8-5中的相同。
0媒体播放器使用元文件中的URL接入到媒体服务器，请求下载浏览器所请求的音频／视频文件。下载文件可以使用上一小节讲过的HTTP/TCP,也可以借助于使用UDP的任何协议，例如使用实时运输协议RTP（见8.3.3节）。
©媒体服务器给出响应，把该音频／视频文件发送给媒体播放器。媒体播放器在迟延了若干秒后（例如，2~5秒），以流的形式边下载、边解压缩、边播放。
上面提到，传送音频／视频文件可以使用TCP,也可以使用UDP。起初人们选用UDP来传送。不采用TCP的主要原因是担心当网络出现分组丢失时，TCP的重传机制会使重传的分组不能按时到达接收端，使得媒体播放器的播放不流畅。但后来的实践经验发现，采用
UDP会有以下几个缺点。
(I)发送端按正常播放的速率发送流媒体数据帧，但由于网络的情况多变，在接收端的播放器很难做到始终按规定的速率播放。例如，一个视频节目需要以1Mbit/s的速率播放。

### 分块 7
如果从媒体服务器到媒体播放器之间的网络容量突然降低到IMbit/s以下，那么这时就会出现播放器的暂停，影响正常的观看。
(2)很多单位的防火墙往往阻拦外部UDP分组的进入，因而使用UDP传送多媒体文件时会被防火墙阻拦掉。
(3)使用UDP传送流式多媒体文件时，如果在用户端希望能够控制媒体的播放，如进
行暂停、快进等操作，那么还需要使用另外的协议RTP（见8.3.3节）和RTSP（见8.2.3节）。这样就增加了成本和复杂性。
于是，现在对流式存储音频／视频的播放，如YouTube和NetflixG),都采用TCP来传送。
图8-7说明了使用TCP传送流式视频的几个主要步骤[KUROl7]。
句注：YouTube(（由管）是全球砓人的视频网站，能支持数百万用户同时观看流畅的视频节目，也支持网民上传自己制作的共亨视频节目。Netflix（奈飞，或网飞）是世界上最大的在线影片租赁提供商，可提供超过85000部DVD电影的租赁服务，以及4000多部影片或者电视剧的在线观看服务。
•376•视频义件待
发
送
的TCP
发送缓存TCP
接收缓存丿:应用程序缓存
1
1
b1等时地从缓存中把

### 分块 8
发
送
的TCP
发送缓存TCP
接收缓存丿:应用程序缓存
1
1
b1等时地从缓存中把
帧读出，解压缩，圈显示在屏幕上互联网上传送图8-7使用TCP传送流式视频的主要步骤客户机步骤0：用户使用HTTP获取存储在万维网服务器中的视频文件，然后把视频数据传送到TCP发送缓存中。若发送缓存已填满，就暂时停止传送。
步骤＠：从TCP发送缓存通过互联网向客户机中的TCP接收缓存传送视频数据，直到接收缓存被填满。
步骤＠：从TCP接收缓存把视频数据再传送到应用程序缓存（即媒体播放器的缓存）。
这叫作预先存储。当预先存储在缓存中的视频数据存储到一定数量时，就开始播放。这个过一程般不超过1分钟。
步骤0：在播放时，媒体播放器等时地（即周期性地）把视频数据按帧读出，经解压缩后，把视频节目显示在用户的屏幕上。
请注意。这里只有步骤0的读出速率是严格按照源视频文件的规定速率来播放的。而前面的三个步骤中的数据传送速率则可以是任意的。如果用户暂停播放，那么图中的三个缓存将很快被填满，这时TCP发送缓存就暂停读取所要传送的视频文件，否则就会引起视频数

### 分块 9
据的丢失。以后，当用户继续播放时，媒体播放器每读出nbit,TCP发送缓存就可以从存
储的视频文件再读取nbit。如果客户机中的两个缓存经常处于填满状态，就能够较好地应付网络中偶然出现的拥塞。
如果步骤＠的传送速率小千步骤0的读出速率，那么客户机中的两个缓存中的存量就会逐渐减少。当媒体播放器缓存的数据被取空后，播放就不得不暂停，直到后续的视频数据重新注入进来后才能再继续播放。实践证明，只要在步骤＠的TCP平均传送速率达到视频节
目规定的播放速率的两倍，媒体播放器般就能流畅地播放网上的视频节目。
一这里要指出，如果是观看实况转播，那么最好应当首先考虑使用UDP来传送。如果使用TCP传送则当出现网络严重拥塞而产生播放的暂停时，就会使人难千接受。使用UDP
传送时，即使因网络拥塞丢失了些分组，对观看的感觉也会比突然出现暂停要好些。

### 分块 10
传送时，即使因网络拥塞丢失了些分组，对观看的感觉也会比突然出现暂停要好些。
一顺便指出，我们在家中的宽带上网并不能保证媒体播放器一定能够流畅地回放任何视频节目。这是因为网络营运商只能保证，从用户家中到网络运营商的某个路由器之间的这段网络的数据速率。但从网络运营商到互联网上下载视频的某个媒体服务器的这段网络状况则是未知的，很可能在某些时段会出现一些网络拥塞。此外，还要考虑所选的视频节目的清晰度所要求的传输带宽。我们都知道，DVD质量的视频和高清电视或4K超高清视频节目所要求的网速就相差很远。
流式媒体播放器问世后就很受欢迎。网民们不需要再随身携带刻录有视频节目的光盘，只要有能够上网的智能手机或轻巧的平板电脑，就能够随时上网观看各种视频音频节目。曾经在城市中很热闹的光盘销售商店，由千受到流式媒体的冲击，现已变得相当萧条。

### 分块 11
•377•8.2.3实时流式协议RTSP实时流式协议RTSP(Real-TimeStreamingProtocol)是IETF的MMUSIC工作组(MultipartyMUitimediaSessionControlWG,多方多媒体会话控制工作组）开发的协议，现在是RTSP2.0
[RFC7826,建议标准］。RTSP是为了给流式过程增加更多的功能而设计的协议。RTSP本身一并不传送数据，而仅仅是使媒体播放器能够控制多媒体流的传送（有点像文件传送协议FTP
有个控制信道），因此RTSP又称为带外协议(out
一-of-bandprotocol)。
RTSP协议以客户－服务器方式工作，它是个应用层的多媒体播放控制协议，用来使用户在播放从互联网下载的实时数据时能够进行控制（像在影碟机上那样的控制），如：暂停／继续、快退、快进等。因此，RTSP又称为互联网录像机遥控协议“”
。
RTSP的语法和操作与HTTP协议的相似（所有的请求和响应报文都是ASCII文本）。

### 分块 12
。
RTSP的语法和操作与HTTP协议的相似（所有的请求和响应报文都是ASCII文本）。
但与HTTP不同的地方是RTSP是有状态的协议(HTTP是无状态的）。RTSP记录客户机所处千的状态（初始化状态、播放状态或暂停状态）。RFC7826还规定，RTSP控制分组既可
在TCP上传送，也可在UDP上传送。RTSP没有定义音频／视频的压缩方案，也没有规定音
频／视频在网络中传送时应如何封装在分组中。RTSP不规定音频／视频流在媒体播放器中应如何缓存。
在使用RTSP的播放器中比较著名的是苹果公司的QuickTime和RealNetworks公司的RealPlayer。
图8-8表示使用RTSP的媒体服务器的工作过程。
客户机
1
I
一服务器GET:元文件RESPONSESETUPRESPONSEPLAYRESPONSE音频／视频流TEARDOWNRESPONSE媒体
服务器0浏览器使用HTTP的GET报文向万维网服务器请求音频／视频文件。
图8-8使用RTSP的媒体服务器的工作过程＠万维网服务器从浏览器发送携带有元文件的响应。
＠浏览器把收到的元文件传送给媒体播放器。

### 分块 13
＠浏览器把收到的元文件传送给媒体播放器。
0媒体播放器的RTSP客户发送SETUP报文与媒体服务器的RTSP服务器建立连接。
©媒体服务器的RTSP服务器发送响应RESPONSE报文。
0媒体播放器的RTSP客户发送PLAY报文开始下载音频／视频文件（即开始播放）。
＠媒体服务器的RTSP服务器发送响应RESPONSE报文。
•378•此后，音频／视频文件被下载，所用的协议是运行在UDP上的。可以是后面要介绍的RTP,也可以是其他专用的协议。在音频／视频流播放的过程中，媒体播放器可以随时暂停（利用PAUSE报文）和继续播放（利用PLAY报文），也可以快进或快退。
©用户在不想继续观看时，可以由RTSP客户发送TEARDOWN报文断开连接。
0媒体服务器的RTSP服务器发送响应RESPONSE报文。
请注意，以上编号的步骤0至0都使用实时流协议RTSP。在图8-8中步骤＠后面没有
则使用另外的传送音频／视频数据的协议，如RTP。
“”编号的
音频／视频流
8.3交互式音频／视频限千篇幅，在本节中我们只介绍交互式音频，即IP电话。
IP电话是在互联网上传送多

### 分块 14
IP电话是在互联网上传送多
个例子。通过IP电话的讨论，可以有助千了解在互联网上传送多媒体信息应一媒体信息的
当解决好哪些问题。
8.3.1IP电话概述1.狭义的和广义的IP电话IP电话有多个英文同义词。常见的有VoIP(VoiceoverIP),InternetTelephony和VON“”“(VoiceOntheNet)。但IP电话的含义却有不同的解释。
狭义的IP电话就是指在IP网络上打电话。所谓”交换网
不过在互联网中至少要有一个IP网络。
的简称。这里的网络可以是互联网，也可以是包含有传统的电路交换网的互联网，IP网络就是使用IP协议的分组广义的IP电话则不仅仅是电话通信，而且还可以是在IP网络上进行交互式多媒体实时
通信（包括话音、视像等），甚至还包括即时传信IM(InstantMessaging)。即时传信是在上网时就能从屏幕上得知有哪些朋友也正在上网。若有，则彼此可在网上即时交换信息（文字的或声音的），也包括使用
Skype、QQ和MSNMessenger[CHEN07]，很受网民的欢迎。

### 分块 15
Skype、QQ和MSNMessenger[CHEN07]，很受网民的欢迎。
的多媒体服务平台，是话音、视像、数据综合的基础结构。在某些条件下（例如使用宽带的点对多点的多播技术。目前流行的即时传信应用程序有微信、IP电话可看成是个正在演进一一一局域网），IP电话的话音质量甚至还优千普通电话。
下面讨论狭义的IP电话[COLLOl]，而广义的IP电话在原理上是样的。
其实IP电话并非新概念。早在20世纪70年代初期ARPANET刚开始运行不久，美国一即着手研究如何在计算机网络上传送电话信息，即所谓的分组话音通信。但在很长
里，分组话音通信发展得并不快。主要的原因是：段时间(1)缺少廉价的高质量、低速率的话音信号编解码软件和相应的芯片。
(2)计算机网络的传输速率和路山器处理速率均不够快，因而导致传输时延过大。
(3)没有保证实时通信服务质量QoS(QualityofService)的网络协议。
(4)计算机网络的规模较小，而通信网只有在具有定规模后才能产生经济效益。
一2.IP电话网关然而到了20世纪90年代中期，上述的几个问题才相继得到了较好的解决。千是美国的•379•

