### 关键词提取 - 分块 1
A收到数据后，用自己的私钥SK
加密数据已被中间人C截获并解密了份，但A和B却都不知道。
一解密，以为和B进行了保密通信。其实，B发送给A的A一由此可见，公钥的分配以及认证公钥的真实性也是个非常重要的问题。关于这点我们在后面(7.4.2节）还要讨论。
7.4密钥分配一由于密码算法是公开的，网络的安全性就完全基于密钥的安全保护上。因此在密码学
密钥管理。密钥管理包括：密钥的产生、分配、注入、验证和个重要的分支中出现了
使用。本节只讨论密钥的分配。
密钥分配（或密钥分发）是密钥管理中最大的问题。密钥必须通过最安全的通路进行
分配。例如，可以派非常可靠的信使携带密钥分配给互相通信的各用户。这种方法称为网外
分配方式。但随着用户的增多和网络流侬的增大，密钥更换频繁（密钥必须定期更换才能做
到可靠），派信使的办法已不再适用，而应采用网内分配方式，即对密钥自动分配。
7.4.1对称密钥的分配一一对称密钥分配存在以下两个问题。
一
，如果n个人中的每第两人共享个需要和其他n-l个人通信，就需要n(n-l)个密钥。但每

**关键词**: 计算机网络 中间人攻击 公钥分配 公钥认证 密码算法 密钥管理 密钥分配 网外分配方式 对称密钥分配


### 关键词提取 - 分块 2
一
，如果n个人中的每第两人共享个需要和其他n-l个人通信，就需要n(n-l)个密钥。但每
个密钥，因此密钥数是n(n-1)/2。这常称为矿问题。如果n是个很大的数，所需要的密钥数量就非常大。
第二，通信的双方怎样才能安全地得到共享的密钥呢？正是因为网络不安全，所以才需要使用加密技术。但密钥又需要怎样传送呢？
一
大家都信任的机构，其任务就是给需要进行秘密通信的用户临时分配目前常用的密钥分配方式是设立密钥分配中心KDC(KeyDistributionCenter)oKDC是
个会话密钥（仅使用
次）。在图7-13中假定用户A和B都是KDC的登记用户。A和B在KDC登记时就已经
＂
和KB。为简单起
。密钥分配分为三个步骤（如图7-13中带箭在KDC的服务器上安装了各自和KDC进行通信的主密钥(masterkey)K
见，下面在叙述时把
简称为
头直线上的O,＠和＠所示）。
主密钥密钥A““＂一A密钥分配中心
KDCB＠时间图7-13KDC对会话密钥的分配0用户A向密钥分配中心KDC发送时用明文，说明想和用户B通信。在明文中给出•348•A和B在KDC登记的身份。

**关键词**: 密钥 密钥分配中心 KDC 会话密钥 主密钥


### 关键词提取 - 分块 3
“一一”AB@KDC用随机数产生A
的会话密钥K供A和B的这次会话使用，然后向AB一
A发送回答报文。这个回答报文用A的密钥K
AB
B
个票据(ticket)
K和请A转给B的加密。这个报文中包含这次会话使用的密钥
,该票据包括A和B在KDC登记的身份，以及这次次密
CD会话将要使用的密钥KB。票据用B的密钥K加密，A无法知道此票据的内容，因为A没有B的密钥KB
，当然A也不需要知道此票据的内容。
AB
©当B收到A转来的票据并使用自己的密钥K
。
也知道KDC为这次和A通信所分配的会话密钥KAB解密后，就知道A要和他通信，同时此后，A和B就可使用会话密钥K进行这次通信了。
请注意，在网络上传送密钥时，都是经过加密的。解密用的密钥都不在网上传送。
KDC还可在报文中加入时间戳，以防止报文的截取者利用以前已记录下的报文进行重ABA扣一放攻击。会话密钥K是次性的，因此机密性较高。而KDC分配给用户的密钥K和K都应定期更换，以减少攻击者破译密钥的机会。

**关键词**: 计算机网络 会话密钥 KDC 票据 加密 解密 重放攻击


### 关键词提取 - 分块 4
®目前最出名的对称密钥分配协议是KerberosV5[RFC4120,4121,建议标准］，是美国麻省理工学院(MIT)开发的。Kerberos既是鉴别协议，同时也是KDC,它已经变得很普及。
Kerberos使用比DES更加安全的高级加密标准AES进行加密。下面用图7-14介绍Kerberos一V4的大致工作过程（其原理和V5大体样，但稍简单些）。
KerberosTGSBA。A。
。
图7-14Kerberos的工作原理Kerberos使用两个服务器：鉴别服务器AS(AuthenticationServer)、票据授予服务器TGSCD注：目前在网络安全领域中ticket词还没有标准译名，也有人译为票执照“票证或签条。
Kerberos＠注：是希腊神话中具有三个头的狗，它为Hades（哈得斯，主宰阴间的冥王）看门。
一＂”“””＂”•349•(Ticket在图7--GrantingServer)。Kerberos只用千客户与服务器之间的鉴别，而不用于人对人的鉴别。

**关键词**: Kerberos V5 AS TGS AES 鉴别协议 KDC 票证


### 关键词提取 - 分块 5
14中，A是请求服务的客户，而B是被请求的服务器。A通过Kerberos向B请求服务。Kerberos需要通过以下六个步骤鉴别的确是A（而不是其他人冒充A)向B请求服务
后，才向A和B分配会话使用的密钥。下面简单解释各步骤。
OA用明文（包括登记的身份）向鉴别服务器AS表明自己的身份。AS就是KDC,它掌握各实体登记的身份和相应的口令。AS对A的身份进行验证。只有验证结果正确，才允许A和票据授予服务器TGS进行联系。
＠鉴别服务器AS向A发送用A的对称密钥KA加密的报文，这个报文包含A和TGS通信的会话密钥Ks以及AS要发送给TGS的票据（这个票据是用TGS的对称密钥KTG加密的）。A并不保存密钥KA,但当这个报文到达A时，A就键入其口令。若口令正确，则该口令和适当的算法一起就能生成密钥KA。这个口令随即被销毁。密钥KA用来对AS发送过来的报文进行解密。这样就提取出会话密钥Ks（这是A和TGS通信要使用的）以及要转发给TGS的票据（这是用密钥KTG加密的）。
@A向TGS发送三项内容：•转发鉴别服务器AS发来的票据。

**关键词**: 计算机网络 鉴别服务器 AS 票据授予服务器 TGS Kerberos 会话密钥 对称密钥 口令 KDC


### 关键词提取 - 分块 6
@A向TGS发送三项内容：•转发鉴别服务器AS发来的票据。
•服务器B的名字。这表明A请求B的服务。请注意，现在A向TGS证明自己的身份并非通过键入口令（因为入侵者能够从网上截获明文口令），而是通过转发AS发出的票据（只有A才能提取出）。票据是加密的，入侵者伪造不了。
•用从加密的时间戳T。它用来防止入侵者的重放攻击。
0TGS发送两个票据，每个都包含A和B通信的会话密钥KAB。给A的票据用Ks
加密；给B的票据用B的密钥KB加密。请注意，现在入侵者不能提取KAB，因为不知道Ks一和KB。入侵者也不能重放步骤＠，因为入侵者不能把时间戳更换为一个新的（因为不知道Ks)。如果入侵者在时间戳到期之前，非常迅速地发送步骤＠的报文，那么对TGS发送过来的两个票据仍然不能解密。
0A向B转发TGS发来的票据，同时发送用KAB加密的时间戳T。
OB把时间戳T加1来证实收到了票据。B向A发送的报文用密钥KAB加密。
以后，A和B就使用TGS给出的会话密钥KAB进行通信。
顺便指出，Kerberos要求所有使用Kerberos的主机必须在时钟上进行

**关键词**: 计算机网络 鉴别服务器AS 票据 TGS 时间戳T KAB 入侵者 重放攻击 密钥Ks 密钥KB 报文 加密 解密 会话密钥KAB 主机 时钟


### 关键词提取 - 分块 7
顺便指出，Kerberos要求所有使用Kerberos的主机必须在时钟上进行
““所谓松散的同步是要求所有主机的时钟误差不能太大，例如，不能超过5分钟的数量级。
““松散的同步。
这个要求是为了防止重放攻击。TGS发出的票据都设置较短的有效期。超过有效期的票据就作废了。因此入侵者即使截获了某个票据，也不能长期保留用来进行以后的重放攻击。
7.4.2公钥的分配在公钥密码体制中，公钥的分配方法并不简单。本节就讨论这个问题。
我们不妨先假定大家都各自保存有自己的私钥，而把各自的公钥发布在网上。假定A和B都是公司。有个捣乱者给A发送邮件，声称自己是B,要购买A生产的设备，货到付款，并给出了B的收货地址。邮件中还附上“B的公钥＂
（其实是捣乱者的公钥）。最后用捣乱者的私钥对邮件进行了签名。A收到邮件后，就用邮件中给出的捣乱者的公钥(A以为自己使用了B的公钥），对邮件中的签名进行了鉴别，就误认为B真的是要购买设备。当A•350•“＂把生产的设备运到B的地址后，B才知道被愚弄了！捣乱者甚至还可伪造
（其实是捣乱者的公钥）。

**关键词**: 计算机网络 Kerberos 时钟 松散的同步 重放攻击 公钥密码体制 公钥 私钥 捣乱者 邮件 签名 设备 收货地址


### 关键词提取 - 分块 8
（其实是捣乱者的公钥）。
站，上面有B的公钥一那么，有没有可靠的方法来获得B的公钥，并且能确信公钥是真的？
一个冒充B的网有种非常可靠的方法，就是公司A派人亲自去公司B,直接向公司B索要其公钥。
这样拿到的B的公钥当然是可信任的。但这种很不方便的办法显然不能普遍推广使用。
一现在流行的办法，这就是找个可信任的第三方机构（第三方机构既不是需要B的公一一钥的公司A,也不是拥有公钥的公司B)，给拥有公钥的实体发
书(digitalcertificate)，有时也可简称为证书。数字证书就是对公钥与其对应的实体（人或机
器）进行绑定(binding)
个证明。因此它常称为公钥证书。这种签发证书的机构就叫作认证
中心CA(CertificationAuthority)，它由政府或知名公司出资建立（这样就可以得到大家的信

**关键词**: 计算机网络 公钥 第三方机构 数字证书 认证中心CA


### 关键词提取 - 分块 9
任）。每个证书中写有公钥及其拥有者的标识信息（人名、地址、电子邮件地址或IP地址个具有数字签名的数字证等）。更重要的是，证书中有CA使用自己私钥的数字签名，这就是认证中心CA把B的未签名的证书进行散列函数运算，再用CA的私钥对散列值进行D运算（也就是对散列值进一行签名）。这样就得到了CA的数字签名。把CA的数字签名和未签名的B的证书放在起，就最后构成了已签名的B的数字证书（如图7-15所示）。图中的数字证书只给出了最重要的
几个项目。这样的证书无法伪造。任何用户都可从可信任的地方（如代表政府的报纸）获得认证中心CA的公钥，以验证证书的真伪。这种数字证书是公开的，不需要加密。现在我国
的认证中心已有不少，例如，在金融领域，中国金融认证中心CFCA(ChinaFinancial
一
CertificationAuthority)是由中国人民银行牵头，联合14家全国性商业银行共同建立的金融认
证机构，其权威性是毋庸置疑的。在国际上，威瑞信公司VeriSign是发行数字证书产品的家具有权威性的公司。
未签名的证书拥有者：B－－－－－－－－－－－－－B的数字证书卢:芦｀言

**关键词**: 公钥 标识信息 数字签名 认证中心CA 私钥 散列函数运算 数字证书 可信任的地方 政府 报纸 金融领域 中国金融认证中心CFCA 中国人民银行 商业银行 威瑞信公司VeriSign


### 关键词提取 - 分块 10
未签名的证书拥有者：B－－－－－－－－－－－－－B的数字证书卢:芦｀言
散列运算｝CA用私钥2竺竺贮－－－－－－－－固定长度散列匠亘叶旦旦|CA的数字签名+-图7-15已签名的B的数字证书的产生过程已签名的B的数字证书t厂勹雷者
厂三亘二BCA的数字签名－－－-一公司A拿到B的数字证书后，可以对B的数字证书的真实性进行核实。A使用数字证
个数值。再对B书上给出的CA的公钥，对数字证书中CA的数字签名进行E运算，得出一一的数字证书（把CA的数字签名除外的部分）进行散列运算，又得出
数值。若
似的方法，对订单的真实性进行核实（使用B的数字证书中给出的B的公钥）。
个数值。比较这两个
致，则数字证书是真的。当A收到包含有B的数字签名的订货单时，也能用类为了使CA发布的数字证书在各行各业中能够通用，数字证书的格式就必须标准化。为
ITU-T制定了X.509协议标准，后来IETF采用了现在的版本，即X.509V3[RFC5280],此，
作为互联网的建议标准(147页）。X.509又称为互联网公钥基础结构PKl
Infrastructure)。

**关键词**: 计算机网络 数字证书 X.509 V3 RFC5280 PKI


### 关键词提取 - 分块 11
Infrastructure)。
一个数字证书必须包括以下这些重要字段：X.509规定了
•X.509的版本
•数字证书名称及序列号(PublicKey•351••本数字证书所使用的签名算法
•数字证书签发者的唯
标识符一一
•数字证书的有效期（有效期开始到结束的日期范围）一一标识符）•主体名（或主题名，公钥和数字证书拥有者的唯
•公钥（数字证书拥有者的公钥和使用算法的标识符，对应的私钥由证书拥有者保存）
个树状的认证系统（如图7-16(a)所示）。
X.509提出把多级认证中心链接起来的，构成
在多级认证系统的末端就是用户(A~E)。在X.509中并没有规定这种链接需要多少级，也
没有给每
级的认证中心都称为根认证中心(Root
CA)，即公认可信的认证中心（或无条件信任的），且其公钥是公开的。在这种树状的认证
个根CA。从根CA向下的所有链接都称为信任链，表示处在这条链
系统中，可以有不止
接上的认证机构都是可信的。
级的认证中心规定统
一的名称。但最高一一根证书....,,_者2KK心“－中间CA的证书？

**关键词**: 数字证书 公钥 私钥 X.509 认证中心 信任链 根认证中心


### 关键词提取 - 分块 12
级的认证中心规定统
一的名称。但最高一一根证书....,,_者2KK心“－中间CA的证书？
中间CA中间CA的公钥根CA签发(a)(b)图7-16树状结构的多级认证系统(a)和证书链(b)一一一一一串链接就是图7-16(a)最右边的用户E。与这
条信任链对应的是证书链（如图7-16(b)所示），通过图中所示的链接，就可以查到本证书的
签发者，也可以知道用谁的公钥来验证本证书中的签名。在这条证书链中，根CA给中间
2
CA签发了中间证书，并使用根CA的私钥进行数字签名。中间CA2可以用根CA的公钥，条信任链的例子：根CA中间CA22对证书中的根CA签名进行验证。因此中间证书是可信的和不可篡改的。同理，中间CA
个用户签发了用户证书，并使用中间C心的私钥进行数字签名。用户可以用中
给下面的
的签名进行验证。因此，这个用户证书也是可信
间C心的公钥，对用户证书中的中间CA
的和不可篡改的。请注意，最顶层的根证书的数字签名是自签名（即自己的私钥给自己签
名）。根证书不需要其他的认证机构对其签名，是我们的信任链的起点。

**关键词**: 计算机网络 认证中心 公钥 私钥 数字签名 证书 信任链 根CA 中间CA 用户CA


### 关键词提取 - 分块 13
名）。根证书不需要其他的认证机构对其签名，是我们的信任链的起点。
2若证书链中的某个认证中心没有严格遵守证书所规定的要求（例如，把证书转让给了一一其他单位，但并未严格验证其身份），那么这个节点以下的证书是否还可信，就应重新验证。
个
用户若发现私钥被盗或遗失，应及时报告上级CA,以便撤销证书。每
公布千众的、用本CA的私钥签名证书撤销名单，并定期更新。
7.5互联网使用的安全协议个CA应当有前面几节所讨论的网络安全原理都可用在互联网中，目前在网络层、运输层和应用层都有相应的网络安全协议。下面分别介绍这些协议的要点。
•352•

**关键词**: 根证书 认证机构 Certification Authority CA 私钥 互联网安全协议 网络安全原理

