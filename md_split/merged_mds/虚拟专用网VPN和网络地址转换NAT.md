### 关键词提取 - 分块 1
中的IP(IP-in-IP)。
(3)基千核心的发现技术。这种方法对千多播组的大小在较大范围内变化时都适合。这
种方法是对每一个多播组G指定一个核心(core)路由器，给出它的IP单播地址。核心路由器
按照前面讲过的方法创建出对应于多播组G的转发树。如果有一个路由器R1向这个核心路
由器发送数据报，那么它在途中经过的每一个路由器都要检查其内容。当数据报到达参加了
多播组G的路由器凡时，民就处理这个数据报。如果民发出的是一个多播数据报，其目的地址是G的组地址，民就向多播组G的成员转发这个多播数据报。如果民发出的数据
报是一个请求加入多播组G的数据报，民就把这个信息加到它的路由中，并用隧道技术向
R1转发每一个多播数据报的一个副本。这样，参加到多播组G的路由器就从核心向外增多
了，扩大了多播转发树的覆盖范围。
目前还没有在整个互联网范围使用的多播路由选择协议。下面是一些建议使用的多播路由选择协议。
距离向量多播路由选择协议DVMRP(DistanceVectorMulticastRoutingProtocol)是在互

**关键词**: IP-in-IP 多播组 核心路由器 转发树 数据报 路由器 DVMRP


### 关键词提取 - 分块 2
联网上使用的第一个多播路由选择协议[RFC1075]。由千在UNIX系统中实现RIP的程序叫
作routed,所以在routed的前面加表示多播的字母m,叫作mrouted,它使用DVMRP在路
由器之间传播路由信息。
基于核心的转发树CBT(CoreBasedTree)[RFC2189,2201]。这个协议使用核心路由器
作为转发树的根节点。一个大的自治系统AS可划分为几个区域，每一个区域选择一个核心
路由器（也叫作中心路由器centerrouter,或汇聚点路由器rendezvousrouter)。
开放最短通路优先的多播扩展MOSPF(MulticastextensionstoOSPF)[RFC1585]。这个
协议是单播路由选择协议OSPF的扩充，使用于一个机构内。MOSPF使用多播链路状态路
由选择创建出基于源点的多播转发树。
协议无关多播－稀疏方式PIM-SM(ProtocolIndependentMulticast-SparseMode)[RFC
7761,STD83]。这是唯一成为互联网标准的一个协议，它使用和CBT同样的方法构成多播

**关键词**: 多播路由选择协议 DVMRP 核心的转发树 CBT 开放最短通路优先的多播扩展MOSPF 协议无关多播－稀疏方式PIM-SM


### 关键词提取 - 分块 3
7761,STD83]。这是唯一成为互联网标准的一个协议，它使用和CBT同样的方法构成多播
转发树。采用“协议无关”这个名词是强调：虽然在建立多播转发树时是使用单播数据报来
和远程路由器联系的，但这并不要求使用特定的单播路由选择协议。这个协议适用千组成员的分布非常分散的情况。
协议无关多播－密集方式PIM-DM(ProtocolIndependentMulticast-DenseMode)[RFC3973]。这个协议适用千组成员的分布非常集中的情况，例如组成员都在一个机构之内。
PIM-DM不使用核心路由器，而是使用洪泛方式转发数据报。
4.8虚拟专用网VPN和网络地址转换NAT4.8.1VPN虚拟专用网由于IP地址的紧缺，一个机构能够申请到的IP地址数往往远小千本机构所拥有的主机数。考虑到互联网并不很安全，一个机构内也并不需要把所有的主机接入到外部的互联网。
实际上，在许多情况下，很多主机主要还是和本机构内的其他主机进行通信（例如，在大型
商场或宾馆中，有很多用于营业和管理的计算机。显然这些计算机并不都需要和互联网相

**关键词**: 协议无关多播 ProtocolIndependentMulticast-DenseMode PIM-DM 虚拟专用网 VPN 网络地址转换 NAT4.8.1


### 关键词提取 - 分块 4
商场或宾馆中，有很多用于营业和管理的计算机。显然这些计算机并不都需要和互联网相
连）。假定在一个机构内部的计算机通信也是采用TCP/IP协议，那么从原则上讲，对于这些•185•仅在机构内部使用的计算机就可以由本机构(cid:7152)行分配其IP地址。这就是说，让这些计算机使用仅在本机构有效的IP地址（这种地址称为本地地址），而不需要向互(cid:7110)网的管理机构申
请全球唯一的IP地址（这种地址称为全球地址）。这样就可以大大(cid:7188)约宝贵的全球IP地址
资源。
但是，如果任意选择一些IP地址作为本机构内部使用的本地地址，那么在某种情况下
可(cid:7126)会引起一些麻烦。例如，有时机构内部的某台主机需要和互(cid:7110)网连接，那么这种仅在内
部使用的本地地址就有可(cid:7126)和互(cid:7110)网中某个IP地址重合，这样就会出现地址的二义性问题。
为了解决这一问题，RFC1918指明了一些专用地址(privateaddres)。这些地址只(cid:7126)用

**关键词**: 计算机网络 互联网 TCP/IP协议 IP地址 全球唯一的IP地址 本地地址 全球IP地址资源 专用地址


### 关键词提取 - 分块 5
千一个机构的内部通信，而不(cid:7126)用千和互(cid:7110)网上的主机通信。换言之，专用地址只(cid:7126)用作本
地地址而不(cid:7126)用作全球地址。在互(cid:7116)网中的所有路由器，对目的地址是专用地址的数据报一
律不进行转发。2013年4月，RFC6890全面地给出了所有特殊用途的IPv4和IPv6地址，
但三个IPv4专用地址块的指派并无变化，即(1)10.0.0.0/8,即从10.0.0.0到10.255.255.255。
(2)172.16.0.0/12,即从172.16.0.0到172.31.255.255。
(3)192.168.0.0/16，即从192.168.0.0到192.168.255.255。
上面的三个地址块分别相当千原来的一个A类网络、16个连续的B类网络和256个连
续的C类网络。A类地址本来早已用完了，而上面的地址10.0.0.0本来是分配给ARPANET的。由千ARPANET已经关闭停止运行了，因此这个地址就用作专用地址。

**关键词**: 计算机网络 路由器 IPv4 IPv6 专用地址 特殊用途地址 RFC6890 A类 B类 C类网络 ARPANET


### 关键词提取 - 分块 6
采用这样的专用IP地址的互连网络称为专用互(cid:7116)网或本地互(cid:7116)网，或更简单些，就叫作专用网。显然，全世界可(cid:7126)有很多的专用互连网络具有相同的IP地址，但这并不会引起麻烦，因为这些专用地址仅在本机构内部使用。专用IP地址也叫作可重用地址(reusableaddres)。
有时一个很大的机构的许多部门分布的范围很广（例如，在世界各地），这些部门经常
要互相交换信息。这可以有两种方法。(1)租用电信公司的通信线路为本机构专用。这种方法虽然简单方便，但线路的租金太高，一(cid:7183)难千承受。(2)利用公用的互(cid:7110)网作为本机构各专用网之间的通信载体，这样的专用网又称为虚拟专用网VPN(VirtualPrivateNetwork)。
这里之所以称为“专用网”是因为这种网络是为本机构的主机用千机构内部的通信，而不是用于和网络外非本机构的主机通信。如果专用网不同网点之间的通信必须经过公用的互(cid:7110)网，但又有保密的要求，那么所有通过互(cid:7116)网传送的数据都必须加密。加密需要采用的

**关键词**: 专用互连网络 本地互连网络 专用网 专用IP地址 可重用地址 虚拟专用网 VPN


### 关键词提取 - 分块 7
＂，但实际上并不是，因为现在并没有真正使
协议将在7.6.1(cid:7188)讨论。
用通信专线，而VPN只是在效果上和真正的专用网一样。一个机构要构建(cid:7164)己的VPN就必
须为它的每一个场所购买专门的硬件和软件，并进行配置，使每一个场所的VPN系统都知
道其他场所的地址。
表示““虚拟好像是”图4-64以两个场所为例说明如何使用IP隧道技术实现虚拟专用网。
假定某个机构在两个相隔较远的场所建立了专用网A和B,其网络地址分别为专用地址10.1.0.0和10.2.0.0。现在这两个场所需要通过公用的互(cid:7110)网构成一个VPN。
显然，每一个场所(cid:7168)少要有一个路由器具有合法的全球IP地址，如图4-64(a)中的路由
器凡和R2。这两个路由器和互(cid:7110)网的接口地址必须是合法的全球IP地址。路由器民和R2在专用网内部网络的接口地址则是专用网的本地地址。
•186•s
s
加密的从X到Y的内部数据报源地址：125.1.2.3

**关键词**: 协议 通信专线 VPN 专用网 硬件和软件 IP隧道技术 路由器 全球IP地址 内部数据报源地址


### 关键词提取 - 分块 8
•186•s
s
加密的从X到Y的内部数据报源地址：125.1.2.3
目的地址：194.4.5.6外部数据报的数据部分数据报首部外部数据报x场所A、10.1.0.010.1.0.1'-』/产(a)使用隧道技术场所A虚拟专用网VPNX、
10.1.0.1'-.._10.l.0.0场所B/＿_/二/三::J1心么
雪
区
r场所B1-。
02厂
l0
二一/10＿＿
Y_3＼)(b)构成虚拟专用网图4-64用隧道技术实现虚拟专用网在每一个场所A或B内部的通信量都不经过互(cid:7110)网。但如果场所A的主机X要和另一
个场所B的主机Y通信，那么就必须经过路由器R,和R2。主机X向主机Y发送的IP数据
报的源地址是10.1.0.1,而目的地址是10.2.0.3。这个数据报先作为本机构的内部数据报从X
发送到与互(cid:7110)网连接的路由器R,。路由器R,收到内部数据报后，发现其目的网络必须通过互(cid:7110)网才(cid:7126)到达，就把整个的内部数据报进行加密（这样就保证了内部数据报的安全），然

**关键词**: 计算机网络 路由器R1 路由器R2 IP数据报 内部数据报 虚拟专用网(VPN) 隧道技术


### 关键词提取 - 分块 9
后重新加上数据报的首部，封装成为在互(cid:7110)网上发送的外部数据报，其源地址是路由器R,
的全球地址125.1.2.3,而目的地址是路由器民的全球地址194.4.5.6。路由器民收到数据报后将其数据部分取出进行解密，恢复出原来的内部数据报（目的地址是10.2.0.3)，交付主机Y。可见，虽然X向Y发送的数据报通过了公用的互(cid:7120)网，但在效果上就好像是在本部门
的专用网上传送一样。如果主机Y要向X发送数据报，那么所进行的步骤也是类似的。
请注意，数据报从R,传送到民可(cid:7126)要经过互(cid:7110)网中的很多个网络和路由器。但从逻辑
上看，在民到民之间好像是一条直通的点对点链路，图4-64(a)中的＂隧道”就是这个意思。
如图4-64(b)月示的、由场所A和B的内部网络所构成的虚拟专用网VPN又称为内(cid:7116)网(intranet或intrnnetVPN,即内(cid:7110)网VPN)，表示场所A和B都属于同一个机构。

**关键词**: 计算机网络 路由器 全球地址 数据报 解密 内部数据报 专用网 公网 点对点链路 虚拟专用网 VLAN 内网VPN


### 关键词提取 - 分块 10
有时一个机构的VPN需要有某些外部机构（通常就是合作伙伴）参加进来。这样的VPN就称为外(cid:7116)网(extranet或extranetVPN,即外(cid:7110)网VPN)。
请注意，内(cid:7110)网和外(cid:7110)网都采用了互(cid:7110)网技术，即都是基于TCP/IP协议的。
还有一种类型的VPN,就是远程接入VPN(remoteaccessVPN)。我们知道，有的公司
可(cid:7126)并没有分布在不同场所的部门，但却有很多流动员工在外地工作。公司需要和他们保持
(cid:7110)系，有时还可(cid:7126)一起开电话会议或视频会议。远程接入VPN可以满足这种需求。在外地
工作的员工通过拨号接入互(cid:7110)网，而驻留在员工个人电(cid:7143)中的VPN软件可以在员工的个人电(cid:7143)和公司的主机之间建立VPN隧道，因而外地员工与公司通信的内容也是保密的，员工•187•们感到好像就是使用公司内部的本地网络。
关于VPN隧道的保密问题，在后面的7.5.1节还有进一步的论述。

**关键词**: 外网(extranet)VPN 内网 外网 互联网技术 TCP/IP协议 远程接入VPN 电话会议 视频会议 VPN隧道 保密问题


### 关键词提取 - 分块 11
关于VPN隧道的保密问题，在后面的7.5.1节还有进一步的论述。
4.8.2网络地址转换下面讨论另一种情况，就是在专用网内部的一些主机本来已经分配到
了本地IP地址（即仅在本专用网内使用的专用地址），但现在又想和互联网上的主机通信（并不需要加密），那么应当采取什么措施呢？
视频讲解最简单的办法就是设法再申请一些全球IP地址。但这在很多情况下是不容易做到的。
目前使用得最多的方法是采用网络地址转换。
网络地址转换NAT(NetworkAddressTranslation)方法是在1994年提出的。这种方法需
要在专用网连接到互联网的路由器上安装NAT软件。装有NAT软件的路由器叫作NAT路
由器，它至少有一个有效的外部全球IP地址。这样，所有使用本地地址的主机在和外界通
信时，都要在NAT路由器上将其本地地址转换成全球IP地址，才能和互联网连接。
图4-65给出了NAT路由器的工作原理。在图中，专用网192.168.0.0内所有主机的IP地址都是本地IP地址192.168.x.x。NAT路由器至少要有一个全球IP地址，才能和互联网相

**关键词**: 计算机网络 VPN隧道 保密问题 网络地址转换 NAT NetworkAddressTranslation 专用网 互联网 路由器 本地IP地址 全球IP地址


### 关键词提取 - 分块 12
连。在本例中，NAT路由器的全球IP地址是172.38.1.5（当然，NAT路由器可以有多个全
球IP地址）。
专用网192.168.0.0/16图4-65NAT路由器的工作原理NAT路由器收到从专用网内部的主机A发往互联网上主机B的IP数据报0:源地址S
=192.168.0.3，而目的地址D=213.18.2.4。NAT路由器通过内部的NAT转换表，把专用网
的IP地址192.168.0.3,转换为全球IP地址172.38.1.5后，改写到数据报的首部中作为新的
源地址，然后把新的数据报＠转发出去。主机B收到IP数据报＠后，发回应答＠，B发送
的IP数据报的源地址就是自己的地址：S=213.18.2.4,目的地址就是刚才收到的数据报的源地址，因此现在D=172.38.1.5。请注意，B并不知道A的专用地址192.168.0.3。实际上，
即使知道了，也不能使用，因为互联网上的路由器不能转发目的地址是任何专用地址的IP
数据报。当NAT路由器收到B发来的IP数据报＠时，还要进行一次IP地址的转换。通过

**关键词**: 计算机网络 NAT路由器 全球IP地址 专用网 IP数据报 内部NAT转换表 转发 主机 回应答 目的地址 路由器


### 关键词提取 - 分块 13
数据报。当NAT路由器收到B发来的IP数据报＠时，还要进行一次IP地址的转换。通过
NAT转换表，把收到的IP数据报使用的目的地址D=172.38.1.5转换为专用网内部的目的
地址D=192.168.0.3（即主机A真正的本地IP地址），变成了数据报0,然后发送到A。
由此可见，当NAT路由器具有n个全球IP地址时，专用网内最多可以同时有n台主机
接入到互联网。这样就可以使专用网内较多数量的主机，轮流使用NAT路由器有限数量的•188•全球IP地址。
显然，通过NAT路由器的通信必须由专用网内的主机发起。设想如果有专用网上外面
的主机要发起通信，当IP数据报到达NAT路由器时，NAT路由器就不知道应当把目的IP
地址转换成专用网内的哪一个本地IP地址。这就表明，专用网内部的主机不能直接充当服
务器用。
为了更加有效地利用NAT路由器上的全球IP地址，现在常用的NAT转换表把运输层
的端口号也利用上。这样，就可以使多个拥有本地地址的主机，共用NAT路由器上的一个
全球IP地址，因而可以同时和互联网上的不同主机进行通信[COME06]。

**关键词**: 数据报 IP地址 NAT转换表 NAT路由器 全球IP地址 专用网 互联网 主机 端口号 NAT转换


### 关键词提取 - 分块 14
全球IP地址，因而可以同时和互联网上的不同主机进行通信[COME06]。
由千运输层的端口号将在下一章5.1.3节讨论，因此，建议在学完运输层的有关内容后，再学习下面的内容。但从系统性方面考虑，把下面的这部分内容放在本章中介绍较为合适。
使用端口号的NAT也叫作网络地址与端口号转换NAPT(NetworkAddressandPort
Translation)，而不使用端口号的NAT就叫作传统的NAT(traditionalNAT)。但在许多文献中
并没有这样区分，而是不加区分地都使用NAT这个更加简洁的缩写词。表4-9说明了
NAPT的地址转换机制。

**关键词**: 全球IP地址 运输层 端口号 NAT NAPT 传统NAT


### 关键词提取 - 分块 15
NAPT的地址转换机制。
表4-9NAPT地址转换表举例方向字段原先的IP地址和端口号转换后的IP地址和端口号从专用网发往互联网源IP地址TCP源喘口192.168.0.330000从专用网发往互联网源IP地址TCP源端口I921680430000从互联网发往专用网目的IP地址TCP目的端口17238.15-4000I从互联网发往专用网目的IP地址TCP目的瑞口17238.154000217238I5.40001172.38.1540002192168.0330000I921680430000从表4-9可以看出，在专用网内主机192.168.0.3向互联网发送IP数据报，其TCP端口
号选择为30000。NAPT把源IP地址和TCP端口号都进行转换（如果使用UDP,则对UDP
的端口号进行转换。原理是一样的）。另一台主机192.168.0.4也选择了同样的TCP端口号
30000。这纯属巧合（端口号仅在本主机中才有意义）。现在NAPT把专用网内不同的源IP地址都转换为同样的全球IP地址。但对源主机所采用的TCP端口号（不管相同或不同），

**关键词**: NAPT 地址转换机制 表4-9NAPT地址转换表举例 方向字段 原先的IP地址和端口号 转换后的IP地址和端口号 专用网 互联网 源IP地址 TCP源喘口 源IP地址TCP源喘口 源IP地址TCP源端口 目的IP地址 TCP目的端口 NAPT把源IP地址和TCP端口号都进行转换 UDP端口号


### 关键词提取 - 分块 16
则转换为不同的新的端口号。因此，当NAPT路由器收到从互联网发来的应答时，就可以从IP数据报的数据部分找出运输层的端口号，然后根据不同的目的端口号，从NAPT转换
表中找到正确的目的主机。
应当指出，从层次的角度看，NAPT的机制有些特殊。普通路由器在转发IP数据报时，对于源IP地址或目的IP地址都是不改变的。但NAT路由器在转发IP数据报时，一定要更
换其IP地址（转换源IP地址或目的IP地址）。其次，普通路由器在转发分组时是工作在网
络层的。但NAPT路由器还要查看和转换运输层的端口号，而这本来应当属于运输层的范
畴。也正因为这样，NAPT曾遭受了一些人的批评，认为NAPT的操作没有严格按照层次的
关系。但不管怎样，NAT（包括NAPT)已成为互联网的一个重要构件[RFC3022]。
4.9多协议标签交换MPLSIETF于1997年成立了MPLS工作组，为的是开发出一种新的协议。这种新的协议就是
多协议标签交换MPLS(MultiProtocolLabelSwitching)。“多协议”表示在MPLS的上层可以•189•

**关键词**: NAPT NAPT转换表 NAT路由器 网络层 运输层 MPLS

