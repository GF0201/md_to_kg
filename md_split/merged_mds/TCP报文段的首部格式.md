### 关键词提取 - 分块 1
连续发送出去，而不需要等待对方的确认。这样，信道利用率就提高了。
在讨论滑动窗口时，我们应当注意到，图中还有一个时间坐标（但以后往往省略这样
是指“向着时间增大的方向
向着时的时间坐标）。按照习惯，向前，而则是向后““““””间减少的方向”
。分组发送是按照分组序号从小到大发送的。
分组的序号送窗口二二II发I6|7|8|9|10|llI12|(a)发送窗口是5送窗口一向前
7
546发
3289
 101112伽t(b)收到个确认后送窗口向前滑动发图5-12一
连续ARQ协议的工作原理连续ARQ协议规定，发送方每收到一个确认，就把发送窗口向前滑动一个分组的位置。
图5-12(b)表示发送方收到了对第1个分组的确认，千是把发送窗口向前移动一个分组的位
置。如果原来已经发送了前5个分组，那么现在就可以发送窗口内的第6个分组了。
接收方一(cid:7183)都是采用累积确认的方式。这就是说，接收方不必对收到的分组逐个发送
确认，而是在收到几个分组后，对按序到达的最后—个分组发送确认，这就表示：到这个分
组为止的所有分组都已正确收到了。

**关键词**: 连续ARQ 发送窗口 滑动窗口 确认 信道利用率 分组序号 时间坐标


### 关键词提取 - 分块 2
组为止的所有分组都已正确收到了。
累积确认有优点也有缺点。优点是容易实现，即使确认丢失也不必重传；但缺点是不(cid:7126)向发送方及时反映接收方已经正确收到所有分组的信息。
例如，如果发送方发送了前5个分组，而中间的第3个分组丢失了。这时接收方只(cid:7126)对前两个分组发出确认。发送方无法知道后面三个分组的下落，而只好把后面的三个分组都
再重传一次。这就叫作Go-back-N（回退N)，表示需要再退回来重传已发送过的N个分组。
可见当通信线路质量不好时，连续ARQ协议会带来负面的影响。
在深入讨论TCP的可靠传输问题之前，必须先了解TCP的报文段首部的格式。
5.5TCP报文段的首部格式TCP虽然是面向字(cid:7188)流的，但TCP传送的数据单元却是报文段。一个
TCP报文段分为首部和数据两部分，而TCP的全部功(cid:7126)都体现在它首部中各字段的作用。因此，只有弄清TCP首部各字段的作用才(cid:7126)掌握TCP的工作原理。下面讨论TCP报文段的首部格式。

**关键词**: 计算机网络 累积确认 Go-back-N ARQ协议 TCP报文段 首部 TCP TCP传送的数据单元 数据 TCP的全部功能 TCP首部各字段的作用 TCP的工作原理


### 关键词提取 - 分块 3
TCP报文段首部的前20个字(cid:7188)是固定的（如图5-13所示），后面有4n字(cid:7188)是根据需要而增加的选项(n是整数）。因此TCP首部的最小长度是20字(cid:7188)。
首部固定部分各字段的意义如下：()源端口和目的端口各占2个字(cid:7188)，分别写入源端口号和目的端口号。和前面图5-5所示的UDP的分用相似，TCP的分用功(cid:7126)也是通过端口实现的。
(2)序号号增加到232-1后，下一个序号就又回到0。也就是说，序号使用mod232占4字(cid:7188)。序号范围是[O,232—l]，共232（即4294967296)个序号。序
运算。TCP是面•225•1
向字(cid:7188)流的。在一个TCP连接中传送的字(cid:7188)流中的每一个字(cid:7195)都按顺序编号。整个要传送
的字(cid:7188)流的起始序号必须在连接建立时设置。首部中的序号字段值则指的是本报文段所发送
的数据的第一个字(cid:7188)的序号。例如，一报文段的序号字段值是301,而携带的数据共有100

**关键词**: 计算机网络 TCP报文段首部 选项 n 源端口 目的端口 序号 字流


### 关键词提取 - 分块 4
字(cid:7188)。这就表明：本报文段的数据的第一个字(cid:7188)的序号是301,最后一个字(cid:7188)的序号是400。
显然，下一个报文段（如果还有的话）的数据序号应当从401开始，即下一个报文段的序号
字段值应为401。这个字段的名称也叫作报文段序号。
“”8位0T:源端口
』偏移TCP
首部数据RUACSPSR
GKHTNN检验和保留S
Y序号确认号
FI1624目的端口31愚20
固字
定节
首的
部窗门紧急拒针曹发送在前IP首部IP数据报的数据部分图5-13TCP报文段的首部格式(3)确认号占4字(cid:7188)，是期望收到对方下一个报文段的第一个数据字(cid:7195)的序号。例
如，B正确收到了A发送过来的一个报文段，其序号字段值是501,而数据长度是200字(cid:7188)
（序号501~700)，这表明B正确收到了A发送的到序号700为止的数据。因此，B期望
收到A的下一个数据序号是701,千是B在发送给A的确认报文段中把确认号置为701。
请注意，现在的确认号不是501,也不是700,而是701。

**关键词**: 计算机网络 报文段序号 确认号 数据字节序号


### 关键词提取 - 分块 5
请注意，现在的确认号不是501,也不是700,而是701。
总之，应当记住：若确认号＝N，则表明：到序号N-1为止的所有数据都已正确收到。
由千序号字段有32位长，可对4GB（即4千兆字(cid:7188)）的数据进行编号。在一(cid:7183)情况下可保证当序号重复使用时，旧序号的数据早已通过网络到达终点了。
(4)数据偏移占4位，它指出TCP报文段的数据起始处距离TCP报文段的起始处项字段，因此数据偏移字段是必要的。但应注意，“数据偏移有多远。这个字段实际上是指出TCP报文段的首部长度。由千首部中还有长度不确定的选
＂的单位是32位字（即以4字
(cid:7188)长的字为计算单位）。由千4位二进制数(cid:7137)够表示的最大十进制数字是15,因此数据偏移
的最大值是60字(cid:7188)，这也是TCP首部的最大长度（即选项长度不(cid:7126)超过40字(cid:7188)）。
(5)保留
占6位，保留为今后使用，但目前应置为0。
下面有6个控制位，用来说明本报文段的性质，它们的意义见下面的(6)~(1)。

**关键词**: 计算机网络 序号字段 数据偏移 TCP报文段 首部长度 选项长度


### 关键词提取 - 分块 6
下面有6个控制位，用来说明本报文段的性质，它们的意义见下面的(6)~(1)。
(6)紧急URG(URGent)当URG=1时，表明紧急指针字段有效。它告诉系统此报•226•1
文段中有紧急数据，应尽快传送（相当千高优先级的数据），而不要按原来的排队顺序传送。
例如，已经发送了很长的一个程序要在远地的主机上运行。但后来发现了一些问题，需要取
消该程序的运行。因此用户从键盘发出中断命令(Control-C)。如果不使用紧急数据，那么这两个字符将存储在接收TCP的缓存末尾。只有在所有的数据被处理完毕后这两个字符才被交付接收方的应用进程。这样做就浪费了许多时间。
当URG置1时，发送应用进程就告诉发送方的TCP有紧急数据要传送。于是发送方TCP就把紧急数据插入到本报文段数据的最前面，而在紧急数据后面的数据仍是普通数据。
这时要与首部中紧急指针(UrgentPointer)字段配合使用。
然而在紧急指针字段的具体实现上，由于过去的有些文档有错误或有不太明确的地方，
这就导(cid:7175)人们对有关的RFC文档产生了不同的理解。于是，2011年公布的建议标准RFC

**关键词**: 紧急URG 紧急指针 URGent TCP 紧急数据 控制位 报文段性质 缓存 发送应用进程 RFC文档


### 关键词提取 - 分块 7
6093,对紧急指针字段的使用方法做出了更加明确的解释，并更新了几个重要的RFC文档，
如RFC793,RFC1011,RFC1122等。
(7)确认ACK(ACKnowledgment)仅当ACK=1时确认号字段才有效。当ACK=0时，确认号无效。TCP规定，在连接建立后所有传送的报文段都必须把ACK置为1。
(8)推送PSH(PuSH)当两个应用进程进行交互式的通信时，有时在一端的应用进程
希望在键入一个命令后立即就(cid:7126)够收到对方的响应。在这种情况下，TCP就可以使用推送
(push)操作。这时，发送方TCP把PSH置l，并立即创建一个报文段发送出去。接收方
“向前）交付接收应用进程，而不再等到
TCP收到PSH=1的报文段，就尽快地（即“推送整个缓存都填满了后再向上交付。
虽然应用程序可以选择推送操作，但推送操作很少使用。
(9)复位RST(ReSeT)当RST=1时，表明TCP连接中出现严重差错（如主机崩溃
或其他原因），必须释放连接，然后再重新建立运输连接。将RST置为1还用来拒绝一个非
法的报文段或拒绝打开一个连接。RST也可称为重建位或重置位。

**关键词**: 紧急指针 确认号 ACK PUSH PSH RST


### 关键词提取 - 分块 8
法的报文段或拒绝打开一个连接。RST也可称为重建位或重置位。
(10)同步SYN(SYNchronization)在连接建立时用来同步序号。当SYN=1而ACK
=0时，表明这是一个连接请求报文段。对方若同意建立连接，则应在响应的报文段中使
SYN=1和ACK=1。因此，SYN置为1就表示这是一个连接请求或连接接受报文。关千连
接的建立和释放，在后面的5.9(cid:7188)还要进行详细讨论。
(11)终止FIN(FINish,意思是“完了”“终止”)用来释放一个连接。当FIN=1时，表明此报文段的发送方的数据已发送完毕，并要求释放运输连接。
(12)窗口占2字(cid:7188)。窗口值是[O,216—l]之间的整数。窗口指的是发送本报文段的
一方的接收窗口（而不是(cid:7151)己的发送窗口）。窗口值告诉对方：从本报文段首部中的确认号
算起，接收方目前允许对方发送的数据量（以字(cid:7188)为单位）。之所以要有这个限制，是因为接收方的数据缓存空间是有限的。总之，窗口值作为接收方让发送方设置其发送窗口的
依据。
：�＇字
厂言二：：：一：；二二勹立是告
气

**关键词**: 计算机网络 连接建立 连接请求报文段 连接接受报文 连接释放 运输连接 接收窗口 发送窗口 确认号 数据缓存空间


### 关键词提取 - 分块 9
依据。
：�＇字
厂言二：：：一：；二二勹立是告
气
间还可接收l000个字(cid:7188)数据（字(cid:7188)序号是701~1700)，你在给我发送数据回
息
视频讲解：飞勹二二逑”时，必须考虑到我的接收缓存容最。
瞿总之，应当记住：窗口字段明确指出了现在允许对方发送的数据量。窗口值经常在动态变化着。
•227•(13)检验和占2字节。检验和字段检验的范围包括首部和数据这两部分。和UDP
用户数据报一样，在计算检验和时，要在TCP报文段的前面加上12字节的伪首部。伪首部
的格式与图5-5中UDP用户数据报的伪首部一样。但应把伪首部第4个字段中的17改为6
(TCP的协议号是6)，把第5字段中的UDP长度改为TCP长度。接收方收到此报文段后，仍要加上这个伪首部来计算检验和。若使用1Pv6,则相应的伪首部也要改变。
(14)紧急指针占2字节。紧急指针仅在URG=1时才有意义，它指出本报文段中
的紧急数据的字节数（紧急数据结束后就是普通数据）。因此，紧急指针指出了紧急数据的
末尾在报文段中的位置。当所有紧急数据都处理完时，TCP就告诉应用程序恢复到正常操

**关键词**: 计算机网络 接收缓存容量 窗口字段 TCP报文段 检验和 伪首部 紧急指针


### 关键词提取 - 分块 10
末尾在报文段中的位置。当所有紧急数据都处理完时，TCP就告诉应用程序恢复到正常操
作。值得注意的是，即使窗口为零时也可发送紧急数据。
(15)选项长度可变，最长可达40字节。当没有使用”选项”时，TCP的首部长度是20字节。最后的填充字段仅仅是为了使整个TCP首部长度是4字节的整数倍。
TCP最初只规定了一种选项，即最大报文段长度MSS(MaximumSegmentSize)[RFC
6691]。请注意MSS这个名词的含义。MSS是每一个TCP报文段中的数据字段的最大长度。
数据字段加上TCP首部才等于整个的TCP报文段。所以MSS并不是整个TCP报文段的最
大长度，而是“TCP报文段长度减去TCP首部长度”。
为什么要规定一个最大报文段长度MSS呢？这并不是考虑接收方的接收缓存可能放不
下TCP报文段中的数据。实际上，MSS与接收窗口值没有关系。我们知道，TCP报文段的
数据部分，至少要加上40字节的首部(TCP首部20字节和IP首部20字节，这里都还没有
考虑首部中的选项部分），才能组装成一个IP数据报。若选择较小的MSS长度，网络的利

**关键词**: 计算机网络 TCP 紧急数据 操作 选项 首部 MSS 报文段长度 接收缓存 IP数据报


### 关键词提取 - 分块 11
考虑首部中的选项部分），才能组装成一个IP数据报。若选择较小的MSS长度，网络的利
用率就降低了。设想在极端的情况下，当TCP报文段只含有1字节的数据时，在IP层传输
的数据报的开销至少有40字节（包括TCP报文段的首部和IP数据报的首部）。这样，对网
络的利用率就不会超过1/41。到了数据链路层还要加上一些开销。但反过来，若TCP报文
段非常长，那么在IP层传输时就有可能要分解成多个短数据报片。在终点要把收到的各个短
数据报片装配成原来的TCP报文段。当传输出错时还要进行重传。这些也都会使开销增大。
因此，从提高网络传输效率考虑，MSS应尽可能大些，只要在IP层传输时不需要再分片就行。由千IP数据报所经历的路径是动态变化的，因此在某条路径上确定的不需要分片
的MSS,如果改走另一条路径就可能需要进行分片。因此最佳的MSS实际上是很难确定的。
在连接建立的过程中，双方都把自己能够支持的MSS写入这一字段，以后就按照这个数值
传送数据，两个传送方向可以有不同的MSS值气若主机未填写这一项，则MSS的默认值

**关键词**: 计算机网络 IP数据报 首部 选项部分 TCP报文段 MSS 网络利用率 数据链路层 开销 传输效率 分片 路径 默认值


### 关键词提取 - 分块 12
传送数据，两个传送方向可以有不同的MSS值气若主机未填写这一项，则MSS的默认值
是536字节（这个数值来自576字节的IP数据报总长度减去TCP和IP的固定首部）。因此，
所有互联网上的主机都应能接受的报文段长度是536+20（固定首部长度）＝556字节。
随着互联网的发展，又陆续增加了几个选项，如窗口扩大选项、时间戳选项等（见建
议标准RFC7323)。以后又增加了有关选择确认(SACK)选项（见建议标准RFC2018)。这
些选项的位置都在图5-13所示的选项字段中。
窗口扩大选项是为了扩大窗口。我们知道，TCP首部中窗口字段长度是16位，因此最
大的窗口大小为64KB（见下一节）。虽然这对早期的网络是足够用的，但对千包含卫星信心注：流行的一种说法，在TCP连接建立阶段“双方协商MSS值”，但这是错误的，因为这里并不存在任何的协商，而一只是方把MSS值设定好以后再通知另一方而已。
•228•道的网络气其传播时延和带宽都很大，要获得高吞吐率需要更大的窗口大小。
窗口扩大选项占3字(cid:7194)，其中有一个字(cid:7194)表示移位值S。新的窗口值等千TCP首部中

**关键词**: MSS 窗口扩大选项 时间戳选项 选择确认(SACK)选项


### 关键词提取 - 分块 13
16+S)。移位值允许使用的最大值是14,相当千窗口最大值增大的窗口位数从16增大到(
到il6+14)_l=230_1。
窗口扩大选项可以在双方初始建立TCP连接时进行协商。如果连接的某一端实现了窗口扩大，当它不再需要扩大其窗口时，可发送S=O的选项，使窗口大小回到16。
时间戳选项占10字(cid:7194)，其中最主要的字段是时间戳值字段(4字(cid:7194)）和时间戳回送回答字段(4字(cid:7194)）。时间戳选项有以下两个功(cid:7126)：第一，用来计算往返时间RTT（见后面的5.6.2(cid:7194)）。发送方在发送报文段时把当前时钟的时间值放入时间戳字段，接收方在确认该报文段时把时间戳字段值复制到时间戳回送回答字段。因此，发送方在收到确认报文后，可以准确地计算出RTT。
AgainstWrappedSequencenumbers第二，用于处理TCP序号超过232的情况，这又称为防止序号绕回PAWS(Protect
)。我们知道，TCP报文段的序号只有32位，而每增加
232
个序号就会重复使用原来用过的序号。当使用高速网络时，在一次TCP连接的数据传送

**关键词**: 计算机网络 TCP连接 窗口扩大选项 时间戳选项 时间戳值字段 时间戳回送回答字段 返还时间RTT 防止序号绕回PAWS


### 关键词提取 - 分块 14
232
个序号就会重复使用原来用过的序号。当使用高速网络时，在一次TCP连接的数据传送
中序号很可(cid:7126)会被重复使用。例如，当使用1.5Mbit/s的速率发送报文段时，序号重复要6
小时以上。但若用2.5Gbit/s的速率发送报文段，则不到14秒序号就会重复。为了使接收方(cid:7126)够把新的报文段和迟到很久的报文段区分开，可以在报文段中加上这种时间戳。
我们将在后面的5.6.3(cid:7194)介绍选择确认选项。
5.6TCP可靠传输的实现本(cid:7194)讨论TCP可靠传输的实现。
我们首先介绍以字(cid:7188)为单位的滑动窗口。为了讲述可靠传输原理的方便，我们假定数
据传输只在一个方向进行，即A发送数据，B给出确认。这样的好处是使讨论限千两个窗口，即发送方A的发送窗口和接收方B的接收窗口。如果再考虑B也向A发送数据，那么还要增加A的接收窗口和B的发送窗口，这样总共有4个都不断在变化大小的窗口。这对讲述可靠传输的原理并没有多少帮助，反而会使问题变得更加烦琐。
5．6l以字为节单位的滑动口窗、
、c

**关键词**: 计算机网络 TCP 序号 时间戳 滑动窗口


### 关键词提取 - 分块 15
5．6l以字为节单位的滑动口窗、
、c
pT,的滑窗动是口以字(cid:7194)为位单。的为了便说千明滑动窗口的工作原、理，我1
1故意把后面图5l
4(cid:7169)图－517中的字(cid:7188)编号都取得很、iJ（实际的窗小多为数千字(cid:7194)儿I
见假定A欠
4到了B发来的石
角认报文段，其中窗口是欠L到
欠L＿下个字(cid:7194)序号是31（请注的＿(cid:7172)
了
1°）根据这两数个据A就构口大
o
字2(cid:7194)，而确认号是3l
（这表明B期望组的序号）而(cid:7172)序
lj号3O为止的数据已经送窗口，如图5-14所示。
CD注：这种信道常称为长粗管道(longfatpipe)。
扫一扫颖
二意•229•

**关键词**: 滑动窗口 字节单位 长粗管道

