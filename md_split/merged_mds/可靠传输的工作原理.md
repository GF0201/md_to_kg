### 关键词提取 - 分块 1
以及网络技术的进步，同一个名词socket却可表示多种不同的意思。例如：(1)允许应用程序访问连网协议的应用编程接口API(ApplicationProgrammingInterface),即运输层和应用层之间的一种接口，称为socketAPI,并简称为socket。
(2)在socketAPI中使用的一个函数名也叫作socket。
(3)调用socket函数的端点称为socket,如“创建一个数据报socket”。
(4)调用socket函数时，其返回值称为socket描述符，可简称为socket。
(5)在操作系统内核中连网协议的Berkeley实现，称为socket实现。
上面的这些socket的意思都和本章所引用的RFC793定义的socket（指端口号拼接到IP地址）不同。请读者加以注意。
5.4可靠传输的工作原理我们知道，TCP发送的报文段是交给IP层传送的。但IP层只能提供尽最大努力服务，
也就是说，TCP下面的网络所提供的是不可靠的传输。因此，TCP必须采用适当的措施才
能使得两个运输层之间的通信变得可靠。
理想的传输条件有以下两个特点：
(1)传输信道不产生差错。

**关键词**: socket API socketAPI 函数名 端点 描述符 实现 IP层 TCP 报文段 传输信道 可靠性


### 关键词提取 - 分块 2
能使得两个运输层之间的通信变得可靠。
理想的传输条件有以下两个特点：
(1)传输信道不产生差错。
(2)不管发送方以多快的速度发送数据，接收方总是来得及处理收到的数据。
在这样的理想传输条件下，不需要采取任何措施就能够实现可靠传输。
然而实际的网络都不具备以上两个理想条件。但我们可以使用一些可靠传输协议，当
出现差错时让发送方重传出现差错的数据，同时在接收方来不及处理收到的数据时，及时告
诉发送方适当降低发送数据的速率。这样一来，本来不可靠的传输信道就能够实现可靠传输
了。下面从最简单的停止等待协议气井起。
5.4.1停止等待协议全双工通信的双方既是发送方也是接收方。下面为了讨论问题的方便，我们仅考虑A
发送数据而B接收数据并发送确认。因此A叫作发送方，而B叫作接收方。因为这里是讨
论可靠传输的原理，因此把传送的数据单元都称为分组，而并不考虑数据是在哪一个层次上
传送的气“停止等待”就是每发送完一个分组就停止发送，等待对方的确认。在收到确认
后再发送下一个分组。
1.无差错情况停止等待协议可用图5-8来说明。图5-8(a)是最简单的无差错情况。A发送分组Ml，发

**关键词**: 计算机网络 传输信道 可靠传输 理想传输条件 传输层 全双工通信 发送方 接收方 分组 停止等待协议 确认


### 关键词提取 - 分块 3
完就暂停发送，等待B的确认。B收到了M1就向A发送确认。A在收到了对M1的确认后，O注：在计算机网络发展初期，通信链路不太可靠，因此在链路层传送数据时都要采用可靠的通信协议。其中最简单的协议就是这种
层使用的可靠传输协议要复杂得多（见后面5.6节）。
停止等待协议“”。在运输层并不使用这种协议，这里只是为了引出可靠传输的问题才从最简单的概念讲起。在运输＠注：运输层传送的协议数据单元叫作报文段，网络层传送的协议数据单元叫作IP数据报。但在般讨论问题时，都可把它们简称为分组。
一•221•就再发送下一个分组M2。同样，在收到B对M2的确认后，再发送M狂A发送M1k发送M2巨-发送M3巨�.8I
确认M1确认M2确认M3AMB,丁-＿－．．．-一＿一＿、＿一X＿一＿＿-一＿＿＿－超时重传M,.4它J
发送|/确认M1发送M2(a)无差错情况lt
(b)超时重传2.出现差错图5-8停止等待协议图5-8(b)是分组在传输过程中出现差错的情况。B接收M]时检测出了差错，就丢弃M1,
其他什么也不做（不通知A收到有差错的分组）印。也可(cid:7126)是M]在传输过程中丢失了，这

**关键词**: 计算机网络 链路层 可靠通信协议 运输层 报文段 IP数据报 分组 超时重传 差错检测 差错传输


### 关键词提取 - 分块 4
其他什么也不做（不通知A收到有差错的分组）印。也可(cid:7126)是M]在传输过程中丢失了，这
时B当然什么都不知道。在这两种情况下，B都不会发送任何信息。可靠传输协议是这样
设计的：A只要超过了一段时间仍然没有收到确认，就认为刚才发送的分组丢失了，因而重
传前面发送过的分组。这就叫作超时重传。要实现超时重传，就要在每发送完一个分组时设
置一个超时计时器。如果在超时计时器到期之前收到了对方的确认，就撤销己设置的超时计
时器。其实在图5-8(a)中，A为每一个已发送的分组都设置了一个超时计时器。但A只要在
超时计时器到期之前收到了相应的确认，就撤销该超时计时器。为简单起见，这些细(cid:7188)在图5-8(a)中都省略了。
这里应注意以下三点
第一，A在发送完一个分组后，必须暂时保留已发送的分组的副本（在发生超时重传时使用）。只有在收到相应的确认后才(cid:7126)清除暂时保留的分组副本。
第二，分组和确认分组都必须进行编号气这样才(cid:7126)明确是哪一个发送出去的分组收到了确认，而哪一个分组还没有收到确认。

**关键词**: 计算机网络 可靠传输协议 超时重传 超时计时器 分组编号


### 关键词提取 - 分块 5
第三，超时计时器设置的重传时间应当比数据在分组传输的平均往返时间更长一些。
图5-8(b)中的一段虚线表示如果M]正确到达B同时A也正确收到确认的过程。可见重传时
间应设定为比平均往返时间更长一些。显然，如果重传时间设定得很长，那么通信的效率就CD注：在可靠传输的协议中，也可以在检测出有差错时发送＂否认报又“给对方。这样做的好处是(cid:7135)够让发送方及早知道出现了差错。不过由于这样处理会使协议复杂化，现在实用的可靠传输协议都不使用这种否认报文了。
＠注：编号并不是一个非常简单的问题。分组编号使用的位数总是有限的，同一个号码会重复使用。例如，10位的编号
范围是0-1023。当编号增加到1023时，再增加一个号就又回到O,然后重复使用这些号码。我们的家用电表、水表，以及汽
车中的里程表，都有类似的问题。因此，在所发送的分组中，必须(cid:7136)够区分开哪些是新发送的，哪些是重传的。对千简单链路上
传送的帧，如采用停止等待协议，只要用1位编号即可，也就是发送完0号帧，收到确认后，再发送l号帧，收到确认后，再发

**关键词**: 超时计时器 重传时间 平均往返时间 可靠传输协议 否认报文 分组编号 帧 停止等待协议


### 关键词提取 - 分块 6
送0号帧。但是在运输层，这种编号方法有时并不(cid:7135)保证可靠传输（见习题5-18)。
•222•会很低。但如果重传时间设定得太短，以致产生不必要的重传，就浪费了网络资源。然而，在运输层重传时间的准确设定是非常复杂的，这是因为已发送出的分组到底会经过哪些网络，以及这些网络将会产生多大的时延（这取决千这些网络当时的拥塞情况），这些都是不确定
因素。图5-9中把往返时间当作固定的（这显然不符合网络的实际情况），只是为了讲述原
理的方便。关千重传时间应如何选择，在后面的5.6.3节还要进一步讨论。
3.确认丢失和确认迟到图5-9(a)说明的是另一种情况。B所发送的对M1的确认丢失了。A在设定的超时重传
时间内没有收到确认，并无法知道是自已发送的分组出错、丢失，或者是B发送的确认丢
失了。因此A在超时计时器到期后就要重传M1。现在应注意B的动作。假定B又收到了
重传的分组M1。这时应采取两个行动。
第一，丢弃这个重复的分组M1
第二，向A发送确认。不能认为已经发送过确认就不再发送，因为A之所以重传M1,不向上层重复交付。
就表示A没有收到对M1的确认。
A,BMI送发丁3
l­

**关键词**: 编号方法 可靠传输 重传时间 网络资源 运输层 分组 往返时间 超时重传 确认丢失 确认迟到


### 关键词提取 - 分块 7
就表示A没有收到对M1的确认。
A,BMI送发丁3
l­
L＿--超时重M--发送M超时重MBAl：确认MlI传送M发2—I传
发送M收下迟到的确认
2
但什么也不做(a)确认丢失(b)确认迟到图5-9确认丢失和确认迟到图5-9(b)也是一种可能出现的情况。传输过程中没有出现差错，但B对分组M]的确认
迟到了。A会收到重复的确认。对重复的确认的处理很简单：收下后就丢弃，但什么也不做。
B仍然会收到重复的M1,并且同样要丢弃重复的Mj，并重传确认分组。
通常A最终总是可以收到对所有发出的分组的确认。如果A不断重传分组但总是收不到确认，就说明通信线路太差，不能进行通信。
使用上述的确认和重传机制，我们就可以在不可靠的传输网络上实现可靠的通信。
像上述的这种可靠传输协议常称为自动重传请求ARQ(AutomaticRepeatreQuest)。意思
是重传的请求是自动进行的，因此也可见到自动请求重传这样的译名。接收方不需要请求发送方重传某个出错的分组。

**关键词**: 计算机网络 确认 超时重传 自动重传请求ARQ


### 关键词提取 - 分块 8
4.信道利用率停止等待协议的优点是简单，但缺点是信道利用率太低。我们可以用图5-10来说明这个问题。为简单起见，假定在A和B之间有一条直通的信道来传送分组。
•223•图5-10停止等待协议的信道利用率太低假定A发送分组需要的时间是TD。显然，几等千分组长度除以数据率。再假定分组正
确到达B后，B处理分组的时间可以忽略不计，同时立即发回确认。假定B发送确认分组
需要时间TA。如果A处理确认分组的时间也可以忽略不计，那么A在经过时间(To+RTT+
八）后就可以再发送下一个分组，这里的RTT是往返时间。因为仅仅是在时间几内才用来
传送有用的数据（包括分组的首部），因此信道的利用率U可用下式计算：TD(5-3)U=L+RTT+T请注意，更细致的计算还可以在上式分子的时间几内扣除传送控制信息（如首部）所DA花费的时间。但在进行粗略计算时，用近似的式(5-3)就可以了。
我们知道，式(5-3)中的往返时间RTT取决千所使用的信道。例如，假定1200km的信
道的往返时间RTT=20ms,分组长度是1200bit,发送速率是1Mbit/s。若忽略处理时间和

**关键词**: 信道利用率 停止等待协议 往返时间 分组长度 数据率 确认分组 信道 粗略计算 控制信息 首部 发送速率


### 关键词提取 - 分块 9
道的往返时间RTT=20ms,分组长度是1200bit,发送速率是1Mbit/s。若忽略处理时间和
一般都远小千T矿，则可算出信道的利用率U=5.66%。但若把发送速率提高到10
TA(TA
Mbit/s,则U=5.96X10-3。信道在绝大多数时间内都是空闲的。
从图5-10还可看出，当往返时间RTT远大于分组发送时间几时，信道的利用率就会
非常低。还应注意的是，图5-10并没有考虑出现差错后的分组重传。若出现重传，则对传
送有用的数据信息来说，信道的利用率就还要降低。
为了提高传输效率，发送方可以不使用低效率的停止等待协议，而是采用流水线传输
（如图5-11所示）。流水线传输就是发送方可连续发送多个分组，不必每发完一个分组就停
顿下来等待对方的确认。这样可使信道上一直有数据在不间断地传送。显然，这种传输方式
可以获得很高的信道利用率。
//饕荨鬟�:当使用流水线传输时，就要使用下面介绍的连续ARQ协议和滑动窗口协议。

**关键词**: 计算机网络 往返时间RTT 分组长度 发送速率 信道利用率 处理时间 发送速率提高 信道空闲 往返时间RTT远大于分组发送时间 停止等待协议 流水线传输 连续ARQ协议 滑动窗口协议


### 关键词提取 - 分块 10
//饕荨鬟�:当使用流水线传输时，就要使用下面介绍的连续ARQ协议和滑动窗口协议。
图5-11流水线传输可提高信道利用率5.4.2连续ARQ协议滑动窗口协议比较复杂，是TCP协议的精髓所在。这里先给出连续ARQ协议最基本的概念，但不涉及许多细节问题。详细的滑动窗口协议将在后面的5.6节中讨论。
图5-12(a)表示发送方维持的发送窗口，它的意义是：位千发送窗口内的5个分组都可•224•连续发送出去，而不需要等待对方的确认。这样，信道利用率就提高了。
在讨论滑动窗口时，我们应当注意到，图中还有一个时间坐标（但以后往往省略这样
是指“向着时间增大的方向
向着时的时间坐标）。按照习惯，向前，而则是向后““““””间减少的方向”
。分组发送是按照分组序号从小到大发送的。
分组的序号送窗口二二II发I6|7|8|9|10|llI12|(a)发送窗口是5送窗口一向前
7
546发
3289
 101112伽t(b)收到个确认后送窗口向前滑动发图5-12一
连续ARQ协议的工作原理连续ARQ协议规定，发送方每收到一个确认，就把发送窗口向前滑动一个分组的位置。

**关键词**: 计算机网络 连续ARQ协议 滑动窗口协议 TCP协议 发送窗口 信道利用率 分组序号


### 关键词提取 - 分块 11
图5-12(b)表示发送方收到了对第1个分组的确认，千是把发送窗口向前移动一个分组的位
置。如果原来已经发送了前5个分组，那么现在就可以发送窗口内的第6个分组了。
接收方一(cid:7183)都是采用累积确认的方式。这就是说，接收方不必对收到的分组逐个发送
确认，而是在收到几个分组后，对按序到达的最后—个分组发送确认，这就表示：到这个分
组为止的所有分组都已正确收到了。
累积确认有优点也有缺点。优点是容易实现，即使确认丢失也不必重传；但缺点是不(cid:7126)向发送方及时反映接收方已经正确收到所有分组的信息。
例如，如果发送方发送了前5个分组，而中间的第3个分组丢失了。这时接收方只(cid:7126)对前两个分组发出确认。发送方无法知道后面三个分组的下落，而只好把后面的三个分组都
再重传一次。这就叫作Go-back-N（回退N)，表示需要再退回来重传已发送过的N个分组。
可见当通信线路质量不好时，连续ARQ协议会带来负面的影响。
在深入讨论TCP的可靠传输问题之前，必须先了解TCP的报文段首部的格式。

**关键词**: 计算机网络 发送窗口 累积确认 Go-back-N协议 ARQ协议


### 关键词提取 - 分块 12
在深入讨论TCP的可靠传输问题之前，必须先了解TCP的报文段首部的格式。
5.5TCP报文段的首部格式TCP虽然是面向字(cid:7188)流的，但TCP传送的数据单元却是报文段。一个
TCP报文段分为首部和数据两部分，而TCP的全部功(cid:7126)都体现在它首部中各字段的作用。因此，只有弄清TCP首部各字段的作用才(cid:7126)掌握TCP的工作原理。下面讨论TCP报文段的首部格式。
TCP报文段首部的前20个字(cid:7188)是固定的（如图5-13所示），后面有4n字(cid:7188)是根据需要而增加的选项(n是整数）。因此TCP首部的最小长度是20字(cid:7188)。
首部固定部分各字段的意义如下：()源端口和目的端口各占2个字(cid:7188)，分别写入源端口号和目的端口号。和前面图5-5所示的UDP的分用相似，TCP的分用功(cid:7126)也是通过端口实现的。
(2)序号号增加到232-1后，下一个序号就又回到0。也就是说，序号使用mod232占4字(cid:7188)。序号范围是[O,232—l]，共232（即4294967296)个序号。序

**关键词**: 计算机网络 TCP 报文段首部 字流 TCP报文段 首部格式 字段 工作原理 固定部分 源端口 目的端口 序号


### 关键词提取 - 分块 13
运算。TCP是面•225•1

**关键词**: TCP 计算机网络

