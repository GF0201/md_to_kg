在转发到 同 一个输出端 口 ） ， 那么后 到达的分组就必须 在输入端 口排 队 等 待。 采用这种交换
方式的路由器例 子如思科 公 司 的 1 2000 系列 交换路由器 ， 其 互 连网络的速率达 60 Gbit/s 。

4 . 7

I P 多播

4.7. 1

IP 多 播 的 基本概念

1 98 8 年 Ste ve De e ring 首次在其博 士 学位论文 中 提出IP多播的概念。1 99 2年3 月 I ETF
在互(cid:7110)网范 围 首次试验I ETF 会 议 声 音的多播 ， 当时有 20 个 网 点 可 同 时听到会议的声 音。 IP
多 播 是需要在互 (cid:7110) 网 上增加更多的智(cid:7126)才(cid:7126) 提供的一种服务 。 现在 IP 多播 ( multicas t, 以
前 曾 译为组播 ） 已成为互(cid:7110) 网的一个热门课题。 这 是由千有许多的应用需要由一个源 点发送
到 许多个终点 ， 即 一对多的通信。 例如 ， 实时信 息的交付（如新 闻 、 (cid:7122) 市行情等）、 软 件更
新 、 交互式会议等。 随 着 互(cid:7110)网的用户 数目的急剧 增加， 以及多媒体通信的开 展 ， 有更多的

业 务需要多播 来 支 持。

与单播相 比 ， 在一对多的通 信 中 ， 多播可大大(cid:7188)约 网 络 资 源。 图 4-58( a )是 视 频 服 务 器
用单播方式向 90 台 主机传送同样的视频(cid:7188)目。 为此， 需要发送 90 个单播 ， 即 同 一个视频分
组要发送 90 个副本。 图 4-58( b )是视频服务器用多播 方 式向属千同 一个多播组的 90 个成员
传送(cid:7188)目。 这 时， 视频服务器只需把视频分组当作多播数据报 来 发送， 并且 只 需 发 送 —次。
， 民 和 凡 各 转发 l
路由器

在转发分组时 ， 需要把收到的分组复制成3个副本 ， 分别 向

R 1

R2

个副本。 当分组到达目的局 域 网 时 ， 由千局 域网具有硬件多播功(cid:7126) ， 因此不 需要复制 分组 ，
在局 域网 上的多播组成员 都(cid:7126)收到这个视频分组。

视频服务器 M

送 90 次单播

发

R2

1 个压//

| V
R1 已三复伟
个
1炒 <
产
J1 个

I

R

产I f
。卢．
—=＝ ＝＝

3

l

立怼

1

多 播
3

一一一一一产女－一一一一一一一一一巨－－－－－
：三 ——-- , ^!'.b:m:tl
1 、、
I 三］
心

＇，  ；�
1 · · ·
:
， 编
编 俨． 编 ｀
么
、、-----------------------------------------------------

X(
· · ·
．，�｀

多 』心1

• • •

l
｀�

个

个

、

．

·

`

｀

，
:
＾ ，＇

共有 90 个主机接收视频节 目

(a)

单 播

．

多 播 组成 员 共有 90 个
多 播

(b)

＼

，

、

图 4-58 单 播 与 多 播 的 比 较

当多播组的主机数很大时（ 如成千 上万个 ） ， 采用多播方式就可明显地减 轻 网络中各种
资 源的消 (cid:7107)。 在互(cid:7110)网范 围的多播要靠路由器 来 实现 ， 这 些路由器必 须 增加一 些(cid:7126)够识 别多
播数据报的软件。 (cid:7126)够运行多播 协 议的路由器称为多播路 由 器( multicas t router )。 多播路由器

当然 也可以转发普通的单播IP数据报。

为了适应 交互 式 音 频和视频信 息的多播 ， 从1 99 2 年起， 在互(cid:7110)网 上开始试验虚拟的多

播主干 网 MBO N E ( Multicas t Backbone  On the I nte r N Et )。 MBO N E 可把分组传播给地点分散
但属千一个组的许 多 台 主机。 现在多播主千网 已经有了相 当大的规模。

• 1 79  •

在互(cid:7110)网上进行多播就叫作 IP 多 播。 IP多 播所传送的分组需要使用 多 播 IP 地址。
我们知 道， 在互(cid:7117)网中每一 台 主 机必须有一个全球唯 一的 IP 地址。 如果某 台 主机现在

想 接收某个特定多播组的分组 ， 那么怎样 才(cid:7126)使这 个 多 播数据 报传送到这 台 主机？

显然 ， 这个多播数据报的目的地址一定不(cid:7126) 写 入 这 台 主机的 IP 地址。 这 是 因 为在 同 一
时间可(cid:7126)有成千上万 台 主机加入 到 同 一个多 播组。 多播数据 报不可(cid:7126)在 其首部写 入这样多的
主机的 IP 地址。 在多 播 数据报的目的地址写 入的是 多 播组的标识符， 然后设法让加入到这

个多播组的主机的IP地址与多播组的标 识符关(cid:7110)起来 。

其实多播组的标识符就是 IP地址 中 的 D 类地址。 D 类 I P 地址 的前 四 位 是1 1 1 o , 因此
D 类地址范 围是 224.0 .0 .0 到 239. 255. 255 . 255。 我们就用 每 一 个 D 类地址标 志 一个 多 播组 。
这样 ， D 类地址共可标志 228
个多播组， 也就是 说 ， 在 同 一 时 间 可 以 允 许有超 过 2.6 亿的多
播组在互(cid:7110)网上运行。 多播数据报也是 “ 尽 最大 努 力 交 付
， 不 保证 －定(cid:7126)够交付 多 播组 内
的所有成员 。 因此， 多 播 数据报和 一(cid:7183) 的 IP数据报的 区 别就是 它使用D 类IP地址作为目的
地址， 并且首部中的协 议字段值是 2, 表明使用网 际组管 理协 议I GMP。

＂

显 然 ， 多 播地址 只 (cid:7129) 用 千 目 的 地址 ， 而 不 (cid:7129) 用 千 源 地址 。 此外 ， 对 多 播 数据报不产 生

IC MP差 错报文。 因此， 若在PI N G 命 令 后 面键 入多播地址 ， 将 永 远不会收到 响 应。

IP 多播可以分为两种。 一 种 是 只 在 本 局 域网上进行硬 件 多 播 ， 另 一种则是 在 互 (cid:7110)网的
范 围进行多播。 前一种虽然 比 较 简 单 ， 但 很重要， 因 为现 在 大部分主机都是通过局 域网接入
到 互(cid:7110)网的。 在互(cid:7110) 网 上进行多播的最后 阶段 ， 还是要把 多 播数据报在局 域网上用硬件 多 播
交付多播组的所有成员 （ 如图 4-58( b)所示）。 下面就先讨 论这种硬件多播。

4. 7 .2  在 局 域 网 上进行硬件 多 播

互 (cid:7110) 网 号码指派管理局 IANA 拥 有 的以太网地址块的高 24 位 为00 -00 -5E, 因此 TCP/IP
协议使用的以太网地址块的范 围是从00 -00 -5E-00 -00 -00 到 00 -00 -5E -FF -FF-FF。 在第 3 章
3.3.5 (cid:7188) 已 讲 过 ， 以太网 MAC 地址字段中的第 1 字 (cid:7199)的最低位为1 时即 为多 播地址 ， 这种
多 播地址数 占 IANA 分配到的地址数的一 半。 但 IANA 只 拿出 2“个地址 ， 即01 -00 -5 E-00 -
00 -00 到 O l -00 -5E- 7F-FF-FF 的地址作为以太网多播地址。 或者说 ， 在 48 位的多播地址中，
前 25位都 固定不变 ， 只 有后 23 位可用作多播。 但 D 类 IP地址可供分配的有 28 位。 这 28
位中只有后 23位才 映射以太网多播地址中的后 23 位 ， 因此是多对一的映射 关 系（ 如图 4-59
所 示 ） ， 即 28 位 中 的前 5 位 不 (cid:7126) 用 来构成以太 网 多 播 地 址 。 例 如 ，
IP 多 播 地 址
224.1 28. 64.32 (即 E0 -80 -40 - 20) 和 另 一个 IP多 播地址 224 .0 .64.32 （即 E0 -00 -40 - 20) 转换成
以太网的多 播地址都是01 -00 -5E-00 -40 -20 。 因此收到多播数据报的主机 ， 还要在 IP 层 利 用
IP数据报首部的IP地址进行过滤 ， 把不是 本 主机要接收的数据报丢弃。

2 8 位

16

24

31

这 5 位 不 使 用

\\｀
; ,

':

0

8 ,  言兀三三三

0 0 0 000 0110 1: 1 1  1

E
1 010

表示 多 播

0 000 0 0 0；上°

尸 前

25 位 固 定 不 变 一;/三二上 后 23 位来 自 D 类 1P 地 址

勹

图4-59 D 类 lP 地址 与 以 太 网 多 播地址 的 映射关 系

——

• 1 80

•

下面就讨 论进行I P 多播所需要的协议 。

4.7.3

IGMP

网 际组管理协议
1 .  I P 多播需要两种协议

和 多 播路 由 选择协议

图 4-60 是 在互 (cid:7118) 网 上传送多播数据 报的例子。 图中标有IP地址的四 台
主机都参加了一个多播组 ， 其组地址是 226. 1 5.37. 1 23。 显 然 ， 多播数据 报
应当传送到 路由器 R ) ， 民 和 R3, 而不应当传送到路由器 凡 ， 因 为与 凡 连接的局 域 网 上现在
没有这个多播组的成员 。 但这 些路由器又 怎样知 道多播组的成员 信 息 呢 ？ 这就要利用一个协
议 ， 叫 作 网 际组管理协议I GMP (I nte rne t Group Manageme nt Protocol)。

视频讲解

1 2 8.56.24.34
参加多播组
226. 1 5 .37. 1 23

135 .27. ?4.52
早慧 三

2!

＝三

\M P 三二］
／沁～归 、三

八 1 `＿督

14.56

.

130 ._l �.
尸三

）

P

早凳
三一一 二二沁°乌 1443

二＝」 参加多播组
226. 1 5 .37. 1 23

lGM

2!

R4�

图 4-60

IGMP 使 多 播 路 由 器知 道 多 播组成员 信 息

图 4-60 强 调了 IGMP的本 地使 用 范 围 。 请 注 意 ，

IGMP并非在互(cid:7110) 网 范 围 内对所有多

播组成员 进行管理的协议 。I GMP 不知 道 IP多播组包含的成员数 ， 也不知 道这 些成员 都分

布 在哪 些 网 络 上。I GMP 协 议是 让 连接在本地局域网 上的多播路由器知道本局域网上是 否有

主机（严格讲 ， 是 主机 上的某个进程 ） 参加或退出了某个多播组。

显 然 ， 仅有 I GMP 协 议是 不(cid:7126)完成多播任 务 的。 连接在局 域 网 上的多播路由器还必须

和 互 (cid:7110)网上的其他多播路 山 器协 同 工 作 ， 以便把多播 数据 报用最小代价传送给所有的组成员 。

这 就需 要使用多 播 路 由 选择协议。

然 而 多 播 路 由选 择 协 议 要 比单播路由选 择 协 议复 杂 得 多 。 我 们 可以通过 一个简单的例
子来说明。 我 们 假定 图 4-6 1 中有两个多播组。 多播组 M 1 的成 员 有主机 A, B 和C , 而多播

组 队 的成员 有主机D, E 和 F。 这 些主机分布 在三个网 络 上 C N 1 , N 2 和 N 3)。

飞

多 播 组 M I
( A, B , C）  多 播组 M2
(D, E, F)

-- - - --- - - - ------ -
、～·'， “ %
I  \、
Rl 三 A ,//

,',N-
｀  ｀．仁
IG三一-己尸＿＿＿ N,

、、、 、 三 ，＇，＇ - -．

N
F  I
、 、 、 - - - -�，夕

、 、 - D
、、 、、 、、 一

, B三 //

二 一 ' - ' ， 2 ' r ' ,，',

--- - - - - - - ---- - - --

～ - 、 - 、 ～

~ -－ －

- ，_

又笃．另 、

l

｀ ｀ ｀

～

俨 ｀

｀

图4-6 1 用 来说 明 多 播路 由 选择的例子

路由器 R 不应当向网络 N 3 转发多播组 M ] 的分组， 因 为网络 凡 上没有多播组 M 1 的成
员 。 但是 每一 台 主机可以随时加入或 离 开 一个多播组。 例 如， 如果主机 G 现在加入了多播

• 1 81

•

组 M 1, 那么从这 时起， 路由器 R 就必 须也向网络 N 3 转发多播组 M 1 的分组。 这 就是说， 多

播转 发 必须动态地适应 多 播组成 员 的 变 化 （ 这 时 网 络拓扑并 未 发 生 变 化 ） 。 请 注 意， 单 播 路

由选择 通常在 网 络 拓 扑发生变化 时才需要更新路由 。

再看 一种情况 。 主机 E 和 F 都 是 多 播组 M2 的成 员 。 当 E 向 F 发送多播数据报时， 路由
器 R 把这个多播数据报转发到 网络 N 3 。 但 当 F 向 E 发送多播数据报时， 路由器 R 则把多播
数据报转发到 网络 N 2 。 如果路由器 R 收到 来 (cid:7151) 主机A 的多播数据报 (A 不 是多播组 M2 的

成员 ， 但也可向多播组发送多播数据报）， 那么路由器 R 就应 当 把 多 播数据报转发到 N 2 和

N 3 。 由 此可见， 多 播 路 由 器 在 转 发 多 播 数 据报 时 ， 不 (cid:7129) 仅 仅根 据 多 播数 据 报 中 的 目 的 地址，

而是还要考虑这个多播数据报从什么地方来 和要到 什么地方去 。

还有一种情况 。 主机 G 没有参加任 何多播组， 但 G 却 可向任 何多播组发送多播数据报 。
例如， G 可向 多 播组 M 1 或 M2 发送多播数据报 。 主机 G 所在的局 域 网 上可 以没有任何多播
组的成员 。 显然 ， 多 播数据报所经过的许多网络， 也不一定非要有多播组成员 。 总 之， 多 播
数据报可 以 由 没有加 入 多 播组 的 主机发 出 ， 也可 以通过没有组成员接入 的 网 络 。

正 因 为如此，

IP 多播就成为比较复杂的问题。 下面介 绍 这 两种协 议的要点。

2 . 网 际组管理协议 I G M P

IGMP已有了三个版本 。

1 989 年 公 布的 RFC 111 2 C IGMPv l) 早 已成为 了 互(cid:7110) 网 的标准

协议 ( STD5) 。 200 2年10 月 公 布的建议标准I GMPv3是 最新的[ RFC 3376] 。

和 网 际控制报 文 协 议 IC MP 相 似， I GMP使用 IP数据报传 递其报文（即 IGMP报文加
上 IP 首部构成I P 数据报）， 但它也向 IP 提供服务 。 因此， 我们不把I GMP 看成是 一个单独
的协议， 而是 属 于整个网 际 协 议I P 的一个组成部分 。
从概念 上讲， I GMP的工作可分为两个阶段 。
第 一 阶 段 ： 当 某 台 主 机加入新的多播组时， 该 主机应向多播组的多播 地址发送一个
IGMP 报文， 声明 (cid:7151) 己要成为该组的成 员 。 本地的多播路由器 收到I GMP报文后， 还要利用
多播路由选择协议把这种组成员 关系转发给互(cid:7110) 网 上的其他多 播路由器 。

第 二 阶段 ： 组成员 关系是 动 态的 。 本地多播路由器要 周 期 性 地探询本地局 域 网 上的主
机， 以便知 道这 些主机是 否还继 续是组的成员 。 只要有一 台 主机对某个组响应， 那么多播路
由器就认为这个组是 活跃的。 但一个组在经过几次的探询后 仍然 没有一 台主机响应， 多播路
由器就认为本网络 上的主机 已经都离开了这个组， 因此也就不再把这个组的成员 关系转发给

其他的多播路由 器 。

I GMP 设计得很仔细， 避 免了多播控 制 信 息 给 网 络 增加大瞿的开销 。 I GMP 采用的一 些

具 体 措 施 如下 ：

(

1 ) 在主机和多播路由器之间的所有通信 都使用 IP 多播 。 只要有可(cid:7126)， 携 带 I GMP 报

文的数据报都用 硬件多播 来 传送 。 因此在支 持硬件多播的网络上， 没有参加 I P 多播的主机

不会 收到 IGMP 报文 。

( 2) 多 播路由器在探询组成员 关系时， 只需要对所有的组发送一个请 求 信 息的询问报文，
而不 需要对每一个组发送一个询问报文（ 虽然 也 允 许对一个特 定组发送询问报文） 。 默认的
询问速率是每1 25 秒发送一次（ 通 信 量并不太大） 。

(3) 当 同 一个 网 络上连接有几个多播路 由 器 时， 它们(cid:7126)够迅速和有效地选择 其中的一个

来 探询主机的成员 关系。 因此， 网 络 上 多个多播路由器并不会 引 起 I GMP通 信 量的增大。

• 1 8 2 •

(4 ) 在I GMP 的询问报文中有一个数值 N, 它指明一个最长响应时间（默认值为10 秒）。
当收到询问时， 主机在0 到 N 之 间 随机选择发送响 应所 需经过的时延 。 因此， 若 一 台 主机
同 时参加了几个多播组， 则主机对每一个多播组选择不 同的随机数 。 对应 于 最小时延的响应
最先发送 。

(5) 同 一个组 内 的每一 台 主机都要 监 听 响 应 ， 只要有本组的其他主机先发送了响 应 ， (cid:7149)

己就可以不再发送响应了 。 这样就抑 制了不必要的通信 量 。

多播路由器并不 需 要 保 留组成 员 关系的准 确 记录 ， 因 为向 局 域 网上的组成 员 转发数据

报是使用硬件多播 。 多播路由器只需要知道网络 上是 否 (cid:7169) 少 还有一 台 主机是 本组成 员 即 可 。
实 际上， 对询问报文 每一个组只需有一 台 主机发送响应 。

如果一 台 主机 上有多个进程都加入了某个多播组 ， 那么这 台 主机对发给这个多播组的

每个多播数据报只接收一个副 本 ， 然 后 给主机中的每一个进程发送一个本地复制的副 本 。

最后 我们还要 强 调指出 ， 多播数据报的发送者 和接收者 都不知 道（也无法找出） 一个
多播组的成 员 有多少 ， 以及这 些 成 员 是哪 些主机 。 互 (cid:7119) 网中的路由器和 主机都不知 道哪个应
用进程将要向哪个多播组发送多播 数据报 ， 因为任 何应用进程都可以在任 何时候向任何 一个
多播组发送多播数据报 ， 而这个应用进程并不需要加入这个多播组。

I GMP 的报 文 格式可参 阅 有关 文 档 [ RFC3376] ， 这里从略 。

3. 多播路 由 选择协议

虽然 在 TCP/I P 中I P 多播协 议 已成为建议标 准 ， 但多播路由选择 协 议（用来 在多播路由

器之 间传播路由信 息） 则 尚 未 标 准化 。

在多播过程中一个多播组中的成 员 是 动 态变化 的 。 例如在收 听 网 上 某个广播(cid:7188) 目 时 ，

随时会有主机加入或 离 开这个多播组。 多播路由选 择 实 际上就是要找出以源主机为根(cid:7188)点的
多 播转发 树 。 在多播转发树 上 ， 每一个多播路由器向树的叶(cid:7188)点方向转发收到的多播数据报 ，

但在多播转发树 上的路由器不会收到重复的多播数据报（即多播数据报不应在互(cid:7119)网中兜 圈
子） 。 不难看出， 对不 同 的多播组对应千不 同 的多播转发树 。 同 一个多播组 ， 对不 同 的源点
也会有不 同的多播转发树 。

已有了多种实用的多播路由选择协议 ， 它们在转发多播数据报时使用了以下的三种方法：

(1 ) 洪泛 与 剪 除 。 这种方法 适 合于较小的多播组 ， 而所有的组成 员 接入的局 域网也是 相
邻 接的 。 一 开始 ， 路由器转发多播数据报使用洪 泛的方法（这就是 广 播） 。 为了避 免 兜 圈 子 ，
e  Path  Broadcas ting)的策 略 。 RPB 的要点是： 每一个
采用了叫作反 向 路径广播 RPB ( Re ve rs
路由器在收到 一个多播数据报时， 先检查数据报是 否是从源点经最短路径传送来 的 。 进行这
种检查很容 易 ， 只 要从本路由器 寻找到源点的最短路径上（ 之 所以叫作反向路径， 因 为在计
算最短路径时是把源点当作终点的） 的第 一个路由器是 否就是 刚 才把多播数据报送来 的路由
器 。 若是 ， 就向所有其他方向转发刚 才收到的多播数据报（但进入的方向除外） ， 否则就 丢

弃而不转发。 如果本路由器有好几个相 邻路由器都处在到源点的最短路径上（也就是说 ， 存
在 几条 同样长度的最短路径） ， 那么只(cid:7126)选择 一条最短路径， 选 择的准则就是 看这 几条最短
路径中的相 邻 路由器谁的IP地址最小 。 图4-6 2的例子说明了这 一概 念 。

• 1 83 •

． 转发 多 播数据报

．贮X 收到 后 即 丢 弃

夕 ＿ - － － － -

, ', 暴~、

+

、

-

剪 除没有
、组成员 的树枝

已

图4-62 反 向 路径 广 播 RPB和 剪 除

为简单起见， 在图 4-6 2 中的网络用路由器之间的链路来 表示。 我 们 假定各 路由器之间
的距 离 都是1 。 路由器 R 1 收到源点发来 的多播数据报后， 向 民 和 民 转发。 民 发现 民 就在

(cid:7149)已到源点的最短路径上 ， 因此向 民 和 凡 转发收到的数据报。 民 发现 民 不在(cid:7149) 已到源点

R7

一 R 1

一 凡一 R2

的最短路径上， 因此丢 弃 民 发来的数据报。 其他路由器也这样转发。 凡 到源点有两条最短
一 源点； R7 - R5 - R3 - R 1 - 源点。 我们再假 定 凡 的I P 地址比 民 的
路径：
I P 地址小 ， 所以我们只使用前一条最短路径。 因此 R7 只转发 凡 传过来 的数据报， 而 丢 弃
民 传过来 的数据报。 最后就得 出了用来 转发多播数据报的多 播转发树（ 图中用粗线表 示），
以后就按这个多播转发树来转发多 播数据报。 这 样就避免了多播数据报兜 圈 子， 同 时每一个
路由器也不会接收重复的多播数据报。

如果在多播转发树上的某个路 由 器发现它的下游 树枝（即 叶(cid:7188) 点 方向） 已 没 有 该多播
组的成员 ， 就应把它和下游的树枝 一起剪 除。 例如， 在图 4-6 2 中 虚线椭 圆 表示 剪 除的部分。
当某个树枝有新增加的组成员 时， 可 以 再接入到多播转发树上。

( 2) 隧道技术( tunne ling )。 隧 道技 术 适用千多播组的位置在地理上很 分 散的情况。 例如
在图 4-63 中， 网 N 1 和网 N 2 都 支 持 多 播。 现在 N 1 中的主机向 N2 中 的一 些主机进行多播。
但路由器 凡 和 民 之间的网络 并不 支 持 多 播 ， 因而 R 1 和 民 不(cid:7126)按 多 播地址转发数据报。 为
此， 路由器 凡 就对多播数据报进行再次 封装， 即 再加上 普通数据 报首部， 使之成为向单一
目的站发送的单播( unicast )数据报， 然后通过 ＂ 隧道 ” ( tunne l )从 民 发送到 R

'

和 N

沪
中 的
N
多 播数据报
2
数 据

1

首 部 1

，

首 部

隧 道 中 通 行 的
单 播 IP 数据报

图4-63 隧道技术在 多 播 中的应用

单播数据报到达路由器 民后 ， 再由路 由 器 民 剥去其首部， 使它又 恢 复成原 来 的多播数
据报， 继续向多个目的站转发。 这 一点和英 吉 利 海 峡 隧 道运送汽车的情况相 似。 英 吉 利 海 峡
隧 道不 允 许 汽车在隧道中行驶。 但是 ， 可以把汽车放置在隧道中行驶的 电气 火车上来 通过隧

道。 过了隧 道后， 汽车又可以继续在公路上行驶。 这种使用隧 道技 术传送数据报又叫作 I P

• 1 84  •

中的 IP(IP-in- IP)。

(3) 基千核心的发现技术。 这种方法对千 多 播 组的大 小 在较大范围 内 变化时都适合。 这
种方法是对每 一个多 播 组 G 指定一个核心(core)路由器， 给 出 它的IP单播地址。 核 心 路由器
按照前面讲过的方法创 建出对应于多 播 组 G 的转发树。 如果有 一个路由器 R 1 向 这个核心 路
由器发 送 数据 报， 那么它 在途中经过的 每 一个路由器都 要检查其内 容。 当数据 报到达参加了
多 播 组 G 的路由器 凡 时， 民 就 处理这个数据 报。 如果 民发 出 的是一个多 播 数据 报，其目

的地址是 G 的组地址， 民 就 向 多 播 组 G 的成员转发 这个多 播 数据 报。 如果 民发 出 的数据
报是一个请求加入多 播 组 G 的数据 报， 民 就把这个信 息加到它的 路由中， 并 用隧道技 术 向
R 1 转发 每一个多 播 数据 报的一个副本。 这 样， 参加到多 播 组 G 的 路由器就从核 心 向 外增多
了， 扩大了多 播转发树的覆 盖范围。

目前 还没 有 在 整个互联网范围 使用的多 播 路由选择协议。 下面是一些建议 使用的多 播

路由选择协议。

距 离 向 量 多 播路由选择协议 DVMRP(Distance  Vector M ulticast Routing  Protocol)是在互
联网上 使用的第一个多 播 路由选择协议[RFC 1075]。 由 千 在 UN IX系 统中实现R IP的 程序叫
作 routed, 所以 在 routed 的前面加表示多 播的字母 m , 叫作 m routed, 它 使用 DVM RP 在 路
由器之间传 播 路由信 息。

基于核心的转发树 CBT (Core Based Tree)  [RFC  2189,  2201]。 这个协议 使用核 心 路由器
作为转发 树的根节点。 一个大的 自 治 系 统 AS 可划分为几个区域， 每一个区域 选择一个核 心
路由器 （也叫作中心 路由器 center router, 或 汇 聚点 路由器 rendezvous router )。

开放最短通路优先的 多播扩展 MOSPF (M ulticast extensions to OSPF)  [RFC 1585]。 这个
协议是单播 路由选择协议 OSPF 的扩 充， 使用于一个 机 构 内 。 M OSPF 使用多 播链路状态 路
由选择 创 建 出 基于源 点的多 播转发树。

协议 无 关 多 播－稀疏方式 PIM-SM (Protocol

Independent M ulticast-Sparse M ode)  [RFC
7761,  STD83] 。 这是唯 一成为互联网标准的一个协议 ， 它 使用和 CBT 同样的方法构成多 播
转发 树。 采用 “ 协议无 关 ” 这个名 词是强调： 虽 然 在建立 多 播转发 树时是使用单播 数据 报来
和远 程 路由器联系 的， 但 这 并 不 要求使用特定的单播 路由选择协议 。 这个协议适用千组成员

的分布 非常 分散 的情 况 。

协议 无 关 多 播 － 密 集 方 式 PIM-DM (Protocol Independent M ulticast-Dense M ode)  [RFC

3973]。 这 个 协议 适 用千 组成 员 的分布 非常集中的情况， 例如 组成员 都 在 一个 机构 之 内 。
PIM-DM 不 使用 核 心 路由 器， 而 是 使用洪 泛方式转发 数据 报。

4 . 8  虚拟专用网 VPN和 网络地址转换 NAT

4.8. 1

VPN

虚拟专用 网

由于IP地址的 紧缺， 一个 机构 能够 申 请到的 IP地址 数往往远小 千本 机构所拥有的主机

数。 考虑到互联网并 不 很 安 全， 一个 机构 内 也 并 不需 要把所有的主机 接入到外部的互联网。
实际上， 在许 多情况 下， 很 多 主机 主要 还是和本 机构内的其他 主机进行 通信 （例如， 在大 型
商 场 或 宾 馆中， 有 很 多 用 于 营 业 和管理的计 算 机。 显 然这 些计 算 机 并 不都需 要 和互联网相
连）。假定在 一个 机构 内 部的计 算 机 通信 也是采用 TCP/ IP协议， 那么从原则上讲， 对于这 些

• 185  •

