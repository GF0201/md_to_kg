”

文

(Tweet)。 我国的新浪微博(www. w eibo.c om)、 腾讯微博(t.qq. c om )等就是这种性质的社交

网站。 职业性社交网站领英L inkedl n 也是很受欢迎的网站。

目前在我国最为流行的社交网站就是微信 (we ixi n.qq.c om)。 微信最初是专为手机用户使

用的聊天工具， 其功能是

“

收发信息、 拍照分享、 联系朋友

”

。 但几年来经过多次系统更新，

现在微信不仅可传送文字短信、 图片、 录音电话、 视频短 片， 还可提供实时音频或视频聊天，

甚至可进行网上购物、 转账、 打车， 等等。 现在微信的功能已远远超越了社交领 域。 原来微

信仅限千在手机上使用， 但新的微信版本已能够安装在普通电脑上。 我们知道， 电子邮件可

以发送给网上任何

一

个并不认识你的用户， 也不管他 是 否愿意接收你发送的邮件。 各种博客

和微博也可 供任何上网用户浏 览。 但微信只能在确定的朋友圈中交换信息。 正 是由千朋友之

间 更加需要交换信息， 而微信的功能 又不断在扩展， 因此微信在我国已成为几乎每个网民都

必备的应用软件。

6.5  电子邮件

6.5.1  电子邮件概述

大家知道， 实时通信的电话固然使用方便， 但有两个严重缺点。 第

一

，

电话通信的主叫和被叫双方必须同时在场。 第二， 有些电话常常不必要地打

视频讲解

断 被叫者的工作或休息。

电子邮件(E- ma i l)是互联网上使用最多的和最受用户欢迎的

一

种应用。 电子邮件把邮件

发送到收件人使用的邮件服务器， 并放在其中的收件人 邮箱(ma i l box)中， 收件人可在自己

方便时上网到自己使用的邮件服务器进行读取。 这相当于互联网为用户设立了存放邮件的信

箱， 因此e- mai

l 有时也称为

“

电子信箱

”

。 电子邮件不仅使用方便， 而且还具有传递迅速和

费用低廉的优点。 据有的公司报道， 使用电子邮件后可提高劳动生产率 30 ％以上。 现在电

子邮件不仅可传送文字信息， 而且还可附上声 音和图像。 由于电子邮件和手机的广泛使用，

现已迫使传统的电报业务退出市场， 因为这种传统电报既贵又慢， 且很不方便。

19 8 2年ARPANE T 的电子邮件问世后， 很快就成为最受广大网民欢迎的互联网应用。

电子邮件的两个最重要的草案标准， 是 200 8年更新的简单邮件传送协议 SMT P (Simp le  Ma i l
T ra nsfer Prot oc o l) [ RFC 5321]和互联网文本报文格式[ RFC 5322]。

由于互联网的SMTP只能传送可打印的7 位ASCII码邮件， 因此在19 9 6年又发布了通

用互联网邮件扩充 MIME (Mu ltip u rp ose  I nterne t  Mail E xt ensi ons)[ RFC  2045, 草案标准］。

MIME 在其邮件首部中说明了邮件的数据类型（如文本、 声音、 图 像、 视像等）。 在MIME
邮件中可同时传送多种类型的数据。 这在多媒体通信的环境下是非常有用的。

一个电子邮件系统应具有图6- 16 所示的三个主要组成构件， 这 就是用户代理、 邮件服

务器， 以及邮件发送协议（如SMT P ) 和邮件读取协议（如PO P3)。 PO P3 是 邮局协议(Post

Office Prot oc o l)的版本3。 凡 是有TC P连接的， 都经过了互联网， 有的甚至可以跨越数千公

里的距离。 这里为简洁起见， 没有画出网络。 在互联网中， 邮件服务器的数量是很大的。 正

是这些邮件服务器构成了电子邮件基础结构的核心。 在图6 -16 中为了说明问题， 仅仅画出

了两个邮件服务器。

•  293  •

发 件 入

发 送 方

用 户 代理 发送 邮 件 服 务 器

收 件 人
用 户 代理

发 送 邮 件

SMTP

连接

TCP

用 户 邮箱

邮 件缓存

发送方
邮 件 服 务 器

邮 件 服 务 器

图 6- 1 6 电 子 邮件 的 最 主 要 的 组成构件

用户代理 UA ( Us er A gen t)就是用户与电子邮件系统的接 口 ， 在大多数情况下 它就是运

行在用户计算机中的

一

个程序。 因此用户代理又称为电子邮件 客户端软件 。 用户代理向用户

一

个很友好的接 口（ 目 前主要是窗 口 界面） 来发送和接收邮件。 现在可供大家选 择的用

提供
户代理有很多种。 例如 ， 微软公司的O u tloo k Exp ress 和我 国 张小龙制作的F oxmai
受欢 迎的电子邮件用户代理。

l , 都是很

用户代理至少应当具有以下 4 个功能 。

( 1 ) 撰 写 。 给用户提供编辑信件的环境。 例如， 应让用户能创 建便千使用的通信 录（有

常用的人名和地址）。 回信时不仅能 很方便地从来信中提取 出 对方地址 ， 并自动地将此地址

写入到邮件中合适的位置， 而且还能方便地对来信提出的问题进行答复（系统自动将来信 复

制

一

份在用户撰写回信的 窗 口 中 ， 因而用户不需要再输入来信中的问题）。
( 2) 显 示。 能方便地在计算机屏 幕上显示出来信（包括来信附上的声音和图像）。

(3) 处理。 处理包括发送邮件和接收邮件。 收件人应能根据情况按不 同方式对来信进行

处理。 例如 ， 阅读后 删 除、 存盘、 打 印 、 转发等 ， 以及自建 目 录对来信进行分类保存。 有时

还可在读取信件之前先查看

一

下邮件的发件人和长度等 ， 对千 不 愿收的信件可直接在邮箱中

删 除。

(4 ) 通 信 。 发信人在撰 写完 邮件后 ， 要利用邮件发送协议将邮件发送到用户所使用的邮

件服务 器。 收件人在接收邮件时 ， 要使用 邮件读取协议从本地邮件服 务 器接收邮件。

互联网上有许多 邮件服 务器可供用户选 用（有些要收取少量的邮箱使用费用）。 邮件服

务器 24 小时不间断 地工作， 并且具 有 很大 容量的邮件信 箱。 邮件服务 器的功能是发送和接

收邮件 ， 同时还要向发件人报 告邮件传送 的结果（ 已 交 付 、 被 拒 绝、 丢 失 等）。 邮件服 务器

按照客户服务 器方式工作。 邮件服务 器需要使用两种不 同的协议 。

一

种协议用于用户代理向

邮件服务 器发送邮件或在邮件服务 器之间发送邮件 ， 如SM TP 协 议 ， 而 另

一

种协 议用千用

户代理从邮件服务器读取 邮件 ， 如 邮 局协议POP3。

这里应当注意 ， 邮件服务器必须能 够 同 时充当客户和服 务 器。 例如 ， 当邮件服务 器A

•  29 4  •

一

向 另

个邮件服 务 器 B 发送邮件时， A 就作为SMT P 客户， 而 B 是SMT P 服务器。 反之，

当 B 向 A 发送邮件时， B 就是SMT P 客户， 而 A 就是S MT P 服务器。

图 6-1 6 给出 了 计 算机 之 间发送和接收电子邮件的 几个重要 步 骤。 请 注意， SMT P 和

PO P3（或IM AP ) 都是使用TC P连接来传送邮件的， 使用TCP 的目的是为了可靠地传送

邮件。

0 发件人调 用 计 算机中 的 用 户 代理撰写和编辑要发送的邮件。

＠ 发件人点击屏 幕上的

“

发送邮件

”

按钮， 把发送邮件的工作全都交给用户代理来完

成。 用户代理把邮件用 SMT P 协 议发给发送方邮件服务 器， 用户代理充当 SMT P 客户， 而

发送方邮件服 务 器充 当 SM TP 服 务 器。 用户代理所进行的这 些工作， 用户是看不到的。 有

的用户代理可以让用户在屏 幕上看 见邮件发送的进度显示。 用户所使用的邮件服 务 器 究竟在

什么 地方， 用户并不知道， 也 没必要知道。 实 际上， 用户在把写好的信件交付给用户代理后，

就什么 都不用管了。

8 S MT P 服 务 器 收到用户代理发来的邮件后， 就把邮件 临时存放在邮件缓存 队 列 中，

等待发送到接 收方的邮件服务 器（等待时间的长短取决于邮件服务器的处理能力和 队 列中待

发送的信件的数量。 但这种等待时间

般都远远大千 分组在路 由器中等待转发的排队时间 ）。
0 发送方邮件服务 器的SMT P 客户与接 收方邮件服务 器的SMT P 服 务器 建立TCP连 接，

一

然后就把邮件缓存 队列中的邮件依 次发送出去。 请注意， 邮件 不 会在互联网中 的某个 中 间 邮

件服 务器落地 。 如果 SMT P 客户还有
来已建立的TCP连接上重复发送。 如果SMT P 客户无法和SMT P 服 务 器建立TCP连接（例

个邮件服务器， 那么 可以在原

些邮件要发送到同

一

一

如， 接 收方服 务器过 负 荷 或出了故 障 ）， 那么 要发送的邮件就会继 续保存在发送方的邮件服

务 器中， 并在稍 后

一

段时间 再进 行新的 尝 试。 如果 SMT P 客户超过了规定的时间还不能把

邮件发送出去， 那么 发送邮件服 务 器就把这种情况通知用户代理。

© 运行在接 收方邮件服务 器中的 SMT P 服 务器进程 收到邮件后， 把邮件放入 收件人的

用户邮箱中， 等待收件人进行读取。

0 收件人在打算 收信时， 就 运行计算机中的用户代理， 使用PO P3（或 IMAP ) 协议读
取发送给自己的邮件。 请 注意， 在图6-1 6 中， PO P3 服务 器和PO P3 客户之间的箭头表示的

是邮件传送的方向。 但它们之间的通信是由PO P3 客 户发起的。

请注意 这 里有两种不同的通信方式。 一种是
“

”

一

推 " (p ush ) :  SMT P 客户把邮件

“

”

过来。 细心
SMT P 服 务器。 另
的读者可能会 想到这样的问题 ： 如果让图 6-1 6 中的邮件服务器程序就在发送方和接 收方的

(p ull ) : PO P3 客户把邮件从PO P3 服 务器

种是

拉

拉

“

“

推

给

“

计算机中运行， 那么 岂不是可以直接把邮件发送到收件人的计算机中？

“

答案是

不行

”
。 这 是因为并非所有的计算机都能 运行邮件服务器程序。 有些计算机可能

没有足够的存储 空间来运行 允许程 序在后 台运行的操作系 统， 或是可能没有足够的CP U 能
力来运行邮件服务器程序。 更重要的是， 邮件服务器程序必须不间断地运行， 每天 24 小时

都必须不间断地连接在互联网上， 否则就可能使很多外面发来的邮件无法接 收。 这样看来，

让用户的计算机运行邮件服务 器 程 序显然是很不现实的（

一

般用户在不使用计算机时就将机

器关 闭 ）。 让来信 暂时存储在用户的邮件服务器中， 而 当 用户方便时就从邮件服务器的用户

信 箱中读取来信， 则是

一

种比较 合理的做法。 在F oxmai l 中使用

一

种

“

＂

特快专递

服 务。 这

种 服 务就是从发件入的用户代理直接利用 SMT P 把邮件发送到接 收方邮件服 务器。 这 就加

快了邮件的交付（ 省 去在发送方邮件服务器中的排队等待时间 ）。 但 这种

特快专递

和邮

“

”

• 295 •

政的E MS 直接把邮件送到用户家中不同， 它并没有把邮件直接发送到收件人的计算机中。

但有些邮件服务器为 了 防 止 垃 圾邮件和计算机病 毒， 拒 绝接收从

一

般用户直接发来的邮件。

电子邮件 由 信 封( en velop e)和内容(c ont ent )两部分组成。 电子邮件的传输程 序根据邮件信

封上的信息来传送邮件。 这与邮 局 按照信封上的信息投递信件是相似的。

在邮件的信封上， 最重要的就是收件人的地址。 TCP /IP 体系的电子邮件系统规 定 电子

邮件 地址(E -mai l address )的格式如下 ：

用 户 名 ＠ 邮 件 服 务 器 的 域 名

(6- 1)

在 式 (6 -1 )中， 符 号

“

“

@

应读 作

“

at "， 表示

＂

“

在

" xyz@abc .c om " 中， “abc .c om " 就是邮件服务器的域名， 而

的意思。 例如， 在电子邮件地址
x yz" 就是在这个邮件服务

“

器中收件人的用户名， 也就是收件 人 邮箱名， 是收件人为自己定义的字符 串 标识符。 但应注

意， 这个用户名在邮件服务器中必须是唯

一

的 （ 当用户定义自己的用户名 时， 邮件服务器要

负 责 检查该用户 名在本服务器中的唯

一

性）。 这样就保证 了 每

一

个电子邮件地址在世界范 围

一

内是唯

的。 这 对保证电子邮件能够在整个互联网范 围内的准确交付是十分重要的。 电子邮
一

件 的用户

般采用容易记忆的字符 串 。

6 . 5 .2 简 单邮件传送协议 SMTP

下面介绍SM TP 的

一

些主要特点。

SMT P 规定了在两个相互通信 的 SMT P 进程之间应如何交换信息。 由于SM TP 使用客

户服 务器方式， 因 此 负 责 发送邮件的 SMT P 进 程 就是 SM TP 客户， 而 负 责接收邮件的

SM TP 进程就是S MT P 服务器。 至千邮件内部的格式， 邮件如何存储， 以及邮件系统应以多

快的速度来发送邮件， SM TP 也都 未做出规 定。

SMT P 规定 了 14 条 命 令和 21 种应答信息。 每 条 命 令用几个字 母组成， 而每

种应答信
个3位数字的代码开始， 后面 附上 （也可不 附 上） 很简 单的文字

一

息

般只有

一

行信息， 由

一

一

说明 。 下面通过发送方和接收方的邮件服务器之间的 SM TP 通信的三个阶段介绍几 个最主

要的 命 令和响应信息。

1 . 连接建立

发件人的邮件送到发送方邮件服 务器的邮件缓存后， SM TP 客户就 每 隔

一

定时间 （ 例如

30 分钟） 对邮件缓存 扫 描

一

次。 如发现有邮件， 就使用SM TP 的熟知端 口 号码 25 与接收方

邮件服务器的 SMT P 服务器建立 TCP连接。 在连接建立后， 接收方 SM TP 服务器要发出

" 220 S ervic e  ready " （ 服务就 绪）。 然后SM TP 客户向SM TP 服务器发送HE LO 命 令， 附上

发送方的主机名。 SM TP 服务器 若 有能力接收邮件， 则回答：

250 O K "， 表示已准备好接

收。 若SM TP 服务器不可用， 则回答

“
4 21S ervic e not  avail abl e "（服务不可用）。

“

一

如在

定时间内 （ 例如 三天） 发送不 了 邮件， 邮件服务器会把这个情况通知发件人。

SM TP 不使用 中 间的 邮件服务器。 不管发送方和接收方的邮件服务器相 隔 有多远， 不管

在邮件传送过 程中要经过多少个路 由器， TCP连接 总是在发送方和接收方这 两个邮件服务
一

器之间直接建立。 当接收方邮件服务器出故 障 而不能工 作时， 发送方邮件服务器只能等待

段时间 后再 尝 试和 该 邮件服务器 建立 T CP 连接， 而 不能 先找

一

个中间的邮件服务器 建立

TCP连接。

•  29 6  •

2 . 邮件传送

邮件的传送从MAIL 命 令开始 。 MA I L 命 令 后 面 有发件人的地址 。 如 ： MAILF RO M :
”
。 否则，

<xiexi re n @tsi n ghu a .or g .  e n >。 若 SM TP 服务器已准备好接收邮件， 则回答
返回

个代码， 指出原 因。 如 ： 451（处理时出错）、 45 2（存储 空间不够） 、 500 （命 令无法

250 O K

一

“

识别） 等。

下面跟着

一

个或多个 RCP T 命 令， 取决于把 同

一

格 式为 RCPT TO : ＜收件人地址＞。 RCP T 是 recip ie nt （收件人） 的缩写 。 每发送
命 令， 都应当有相应的信息从SM TP 服务器返回， 如 ：
方的系统中， 或

“
550N o  suc h  us er he re "（无此用户）， 即不存在此邮箱。

一

个邮件发送给

个或多个收件人， 其
一
个 RCPT
250 O K "， 表示指明的邮箱在接收

“

RCP T 命令的作用就是 ： 先 弄清接收方系统是 否 己做好接收邮件的准备， 然后才发送邮

件。 这样做是为 了 避免浪费通信 资源， 不 至 千发送了 很长的邮件以后才知道地址 错误。

再 下面就是 DATA 命 令， 表示要开始传送邮件的内容 了 。 SM TP 服务器返回的信息是 ：
”

" 354 St art mai l  i np ut ; e nd wit h  <C RLF >. <CRLF >
不能接收邮件， 则 返回 4 2 1（服务 器不可用）， 500 （命 令无法识别） 等。 接着SMT P 客户就
发送邮件的内容。 发送完 毕 后， 再发送<CRLF > .<CRLF > （两个回车换行中间用
表示邮件内容结束。 实 际上在服务器端看到的可打印字符只是
”

个英文的句点。 若邮件收到

。 这里<CR LF >是

的 意思。 若

回车换行

个点隔开）

一

一

”

“

了 ， 则SM TP 服务器返回信息

250 0K "， 或返回差错代码。

虽然SM TP 使用 TCP连接试图使邮件的传送可靠， 但

“

发送成功

”

并不等千

“

收件人

读取 了 这个邮件

个邮件传送到接收方的邮件服务器后 （ 即接收方的邮件服务器收下

”
。 当

一

了这个邮件）， 再往后 的情 况如何 ， 就 有以下 几种可能性 ：

(1 ) 接收方的邮件服务器 刚收到邮件后就出了 故 障， 使收到的邮件全部丢失（在收件人

读取信件之前）。

( 2) 收件人 由 千 某种 原 因， 未检查自己的邮箱， 不知道邮箱中有新的来信。
( 3) 收件人很长时间 不 删 除邮箱中的过期邮件， 导致有限的邮箱容最用尽， 无法再接收

新的邮件。

(4 ) 邮件服务器根据某种 原 则 ， 误 判 某些邮件属千垃圾邮件， 就把收到的某些邮件转入

到垃圾邮件的文件夹。 收件人应从垃圾邮件的文件夹中清理出未收到的非垃圾邮件。

因此， 使用电子邮件的人 ， 应当养成及时收取和清理自己的邮箱的好 习惯。

3. 连接释放

邮件发送完 毕 后， SM TP 客 户 应发送 QUIT 命 令。 SM TP 服务器 返回的信息是

“

22 1

“

（服务关 闭）

, 表示SMT P 同意 释放TCP连接。 邮件传送的全部过程即结束。

这 里再 强 调

一

下， 使 用 电 子 邮件的用 户 看 不 见 以 上 这 些 过程， 所 有这 些 复 杂 过 程都被

电子邮件的用户代理屏 蔽了。

已经广泛使用多年的 S MTP 存在着

一

些缺点。 例如， 发送电子邮件不需要经过 鉴别。

这 就 是说 ， 在 F RO M 命 令后面的地址可以任意填写。 这就大大方便 了 垃圾邮件的作者， 给

收信人 添加了 麻烦（有人估计， 在全世 界所有的电子邮件中， 垃 圾邮件至少 占到 50 ％以上，

甚至高达 9 0 %）。 又如， SM TP 本来就是为传送ASCII码而不是传送二进制数据设计的。 虽
然后来有了M IME 可以传送二进制数据（见后面 6 .5.6 节的介绍）， 但在传送非ASCII码的

长报文时， 在网络上的传输 效率是不高的。 此外， SM TP 传送的邮件是明文， 不利 千保密。

•  29 7  •

为了解决上述问题 ， 200 8年10 月 颁布的草案标准 RFC 5321 对S MTP 进行了扩充 ， 成
为扩充 的S MT P ( Ext end ed  S MTP) ， 记为 ES MTP 。 RFC 532 1 在许 多 命令中增加了扩展的参

数 。 新增加的功能 有 ： 客户 端的鉴 别 ， 服 务器接受二进制报 文 ， 服 务器接受分块传送的大报

文 ， 发送前先检 查报 文的 大 小 ， 使用安 全传输 TLS （ 见下

一

章 7.6 .2 节） ， 以及使用国际化

地址等 。 考虑 到 现 在的许 多 SM TP 邮 件 服务器可能还没有 升 级 到 ES MTP , 因此特规 定使用

ES MT P 的 客户 端 在准 备传送报 文时 ， 不是发送HELO 而 是发送 EHLO 报 文 。 如 果 EHLO 报
一

文被对方服务器端拒 绝 ， 就表明对 方 仍 然是

个标准的 S MTP 邮件服务 器 （不使用扩展的

参数） ， 因而 就 要按照原来使用的S MTP 参数进行 邮件的传送 。 如 果 EHLO 报文被接受了 ，

那么 客户端就可以使用 ES MTP 扩展的参数传送报文了 。

6.5.3  电子邮件 的 信 息格式

一个 电子邮件分 为 信 封和内容两大部分 。 在草案标准 RFC 5322 文档中只规 定了邮件内

容中的首部(h ead er)格式 ， 而对 邮件的主体(bod y)部分则让用户自 由撰写 。 用户写好首部后 ，

邮件系统自动地将信封所需的信息提取出来并写 在信封上 。 所以用户不需要填写 电子邮件信

封上的信息 。

邮件内容首部包 括
“
一

”

一

些关键字 ， 后 面加上 冒 号 。 最重要的关键字是： To 和Su b ject 。

To :

后面填入

个或多 个收件人的 电子邮件地址 。 在 电子邮件软件中 ， 用户把经常
通信的对 象 姓 名和 电子邮件地址写到地址簿(add ress boo k)中 。 当撰写 邮件时 ， 只需打开地址
簿 ， 点击收件人名字 ， 收件人的 电子邮件地址就会自动地填入 到 合适的位置上 。

"Su b ject : " 是邮件的主题 。 它 反 映了 邮件的主要内容 。 主题类似千文件系统的文件名 ，

便于用户查找 邮件 。

邮件首部还 有
”

一
项是抄 送

＂

“
C c :

。 这 两 个 字符来自

“
C arbon c op y " ， 意思是 留 下

一

个

“ 复 写 副本

。 这是借用 旧的名词 ， 表示应给某 某人发送

一

个 邮件副本 。

有些 邮件系统 允许用户使用关键字 B e

e

( Bli nd  c arbon c op y)来实现盲复 写 副本 。 这是使

发件人能 将邮件的副本送给某人 ， 但不希望此事为收件人知道 。 B e

e 又称为暗送 。

首部关键字还有

“
F ro m " 和

“

Dat e " ， 表示 发件 人的电子邮件 地址和发 信 日 期 。 这 两项

一

般都 由 邮件系统自动填入 。

一

另

个关键字是

“

Rep l y- To ", 即对方回信所用的地址 。 这 个地址 可 以与发件人发信时

所用的地址不同 。 例如有时 到外地借用他人的 邮 箱给自己的朋友发送邮件 ， 但仍希望对方将

回信发送到 自 己的邮箱 。 这

一
项可以事先设置好 ， 不需要在每次写信时进行设置。

6.5.4  邮件读取协议 POP3 和 IMAP

现在常用的 邮件读取协议 有两 个 ， 即 邮 局协议第3 个版本 PO P3 和网际报文 存取协议

I MAP

( Int ernet  Mess age A e
一
邮局协议 PO P 是

e ess  Prot o e o l ) 。 现分别讨论 如 下 。

个 非常简 单、 但功能 有 限的 邮件读取协议 。 邮局协议PO P 最初公布

千19 84年 。 经过几 次更新， 现在使用的是19 9 6年的版本 PO P3 [RFC  1939 ,  S T D53] ， 大 多
数的 ISP 都 支持PO P3。

PO P3 也 使用 客户 服 务器的工作方式 。 在接收 邮件的用户计算机中的用户代 理必须 运行
PO P3 客户程 序 ， 而在收件人所连接的 IS P 的邮件服务器中则运行PO P3 服 务器程 序 。 当 然 ，

这 个 ISP 的邮件服务器还必须运行S MTP 服 务器程序 ， 以便接收发送方邮件服务器的SMT P

•  29 8  •

客户程序发来的邮件。 这 些请 参阅图6 -16 。 PO P3 服务器只有在用户 输入 鉴别信息（用户名

和 口 令） 后， 才 允许对邮箱进行读取。
一

PO P3 协议的

个特点就是只要用户从PO P3 服务器读取了邮件， PO P3 服 务器就把该

邮件删 除。 这在某些情况 下 就不够方便。 例如， 某用户在 办 公 室的 台式计算机上接收了

一

个

邮件， 还来不及写回信， 就 马 上 携 带 笔 记本 电脑出 差 。 当他 打 开 笔记本 电脑写回 信 时，

PO P3 服 务器上却已经删 除了 原来已经看过的邮件 （ 除非他 事先将这 些邮件复 制到笔记本电
一

一

脑中）。 为了解决这

问题， PO P3 进行了

些功能 扩充， 其中 包括让用 户 能 够 事先设 置

邮件读取后仍 然在 PO P3 服务器中存放的时间[ RFC 244 9

, 建议 标准］。

一

另

个读取邮件的协议是网际报文存取协议IMAP, 它比 PO P3 复 杂得多 。 IMA P 和PO P
都按客户服务器方式工作， 但它们有很大的差别。 现在较新的版本是 2003年3 月修订的版本

4 , 即 IMAP4 [ RFC 3501 , 建议标准］。 不过在 习 惯上， 对这 个协议大家很少加上版本 号
而经常简单地用IMAP 表示 IM A P4 。 但是对 PO P3 却不会忘记写上版本 号

“
3

”

。

“

4 "'

在使用 IMAP 时， 在用户的计算机上运行IMAP 客户程 序， 然后与接收方的邮件服务

器上的IMA P 服务器程 序 建立 TCP连接 。 用户在 自 己的计算机上就可以操 纵邮件服务器的
一

一

邮箱， 就 像在本地操纵

样， 因此 IMA P 是

个联机协议 。 当用户计算机上的IMA P 客户程

序 打开 IMA P 服务器的邮箱时， 用 户 就可看到邮件的首部 。 若用户需要打 开某个邮件， 则该

邮件才传到用户的计算机上。 用 户 可以根据需要为 自 己的邮箱创 建便千分类管理的层次式的

邮箱文件夹， 并且能 够 将存放的邮件从某

一

个文件夹中移动到 另

一

个文件夹中。 用 户也可 按

某种条件对邮件进行查找。 在用户 未发出删 除邮件的命令之前， IMAP 服务器邮箱 中的邮件
一
直保存 着。

IMA P 最大的好处就是用户 可 以在不同的地方使用不同的计算机（例如， 使用 办 公 室的

计算机、 或家中的计算机， 或在外地使用笔记本电脑） 随时上网阅读和处理自 己在邮件服务

器中的邮件。 IMAP 还 允许 收件人只读取邮件中的某

一

个部分。 例如， 收到了

一

个 带有视像

附件（此文件可能 很大） 的邮件， 而用户使用的是无线上网， 信道的传输速率很低。 为了节

省 时间， 可以先 下 载邮件的正文部分， 待以后有时间 再读取或 下 载 这 个 很大的附件。

IMA P 的缺点是如果用户没有将邮件复 制到自己的计算机上， 则邮件

一

直存放在IMA P

服务器上。 要 想查阅 自 己的邮件， 必须先上网。

下 面的表 6- 2 给出了I MA P 和 PO P3 的主要功能的比较。

表 6-2

I MAP 和 POP3 的主要功 能比较

操作位置

操作 内 容

收件箱

发件箱

阅 坎 、 标记 、 移动 、 删 除 邮 件 等

客 户 端 与 邮 箱 更 新 同 步

IMAP

POP3
仅 在 客 户 端 内

保存到 已 发送

客 户 端 与 邮 箱 更 新 同 步

仅 在 客 户 端 内

创 建 文 件 夹

新 建 自 定 义 的 文件 夹

客户 端 与 邮 箱 更 新 同 步

仅 在 客 户 端 内

草 稿

保存草稿

客 户 端 与 邮 箱 更 新 同 步

仅 在 客 户 端 内

垃 圾 文 件 夹

接 收 并 移 入 垃圾 文 件 夹 的 邮 件

广 告 邮 件

接 收 并 移 入 广 告 邮件 夹 的 邮 件

支 持

支 持

不 支 持

不 支 持

最后 再 强 调

一

下， 不要把邮件读取协议 PO P3 或 IM A P 与邮件传送协议SM TP 弄混。 发

件人的用户代理向发送方邮件服务器发送邮件， 以及发送方邮件服务器向接收方邮件服务器

发送邮件， 都 是使用SM T P 协议 。 而 PO P3 或 IMAP 则是用户代理从接收方邮件服务器上读

•  299  •

取邮件所使用的协议。

6.5.5  基 千 万 维 网 的 电子邮件

从前面的图6 -16 可看出， 用户要使用电子邮件， 必须在自己使用的计算机中安装用户

代理软件 UA。 如果外出到某地而 又 未携带自己的笔记本电脑， 那么 要使用别人的计算机进

行电子邮件的收发， 将是非常不方便的。

现在这个问题解决了。 在 20 世纪 9 0年代中期， Hotmai l 推出了基千万维网的电子邮件
( W ebmai l)。 今天， 几乎所有的著名网站以及大学或公 司 ， 都 提 供了万维网电子邮件。 常用
( @h otmai l .c om )， 雅
的万维网电子邮件有 谷歌的Gmai l

C @ gma让c om )， 微软的Hotmai l

虎的 Y ah oo 邮 箱 ( @ yah oo.c om )。 我国的互联网技术 公司也都提供万维网邮件服务， 例如，
网易邮 箱 ( @163.e om 或＠1 26 .c om ) 、 新浪邮箱 ( @si na.c om 或＠si na.c n ) 和腾讯的 QQ 邮
箱 C @qq .c om ) 等。

万维网电子邮件的好 处就是 ： 不 管在 什么 地方（在任何

一

个国家的网 吧 、 宾 馆或朋友

家中）， 只要能够找到上网的计算机， 在打 开任何

一

种浏 览器后， 就可以非常方便地收发电

子邮件。 使用万维网电子邮件不需要在计算机中再安装用户代理软件。 浏 览器本 身可以向用

户 提供非常友好的电子邮件界 面（和原来的用户代理提供的界面相似）， 使用户在浏 览器上

就能够很方便地撰写和收发电子邮件。

例如， 你使用的是网易的 163 邮箱， 那么 在任何

一

个浏 览器的地址栏中， 键入 163 邮

箱的 URL (mai l. 163.c om)， 按 回车键后 ， 就 可以使用 16 3 电子邮件了， 这和在家中
方便。 你曾经接收和发送过的邮件 、 已删 除的邮件以及你的通信录等 内 容， 都照常呈现在屏

样

一

幕上。

我们知道， 用户在浏 览器中浏 览各种信息时需要使用 HTTP 协议。 因此， 在浏 览器和

互联网上的邮件服务器之间传送邮件时， 仍 然使用HTTP 协议。 但是在各邮件服务器之间传

送邮件时， 则仍然使用SM TP 协议。

6.5.6  通用 互联 网 邮件扩 充 MIME

1 .  M I M E 概述

前 面所述的电子邮件协议SM TP 有以下缺点 ：

(1 ) SM TP 不能传送可执行文件或其他的二进制对 象。 人们曾试图将二进制文件转换为

SM TP 使用的ASCII 文本， 例如流行的 UN IX UUenc od e/ UUd ec od e 方案， 但 这 些 均 未形成

正式标准或事实上的标准。

( 2) SM TP 限千传送 7 位的ASCII码。 许多其他非英语国家的文字（如中文 、 俄文， 甚

至 带重音符号的法文或德文） 就 无法传送。 即使在SM TP 网关将E BCDIC码 （ 即扩充的二／
一

十进制交换码） 转换为ASCII 码， 也会遇到

些 麻烦。

(3) SM TP 服务器会拒 绝超过

一

定长度的邮件。

( 4) 某些SM TP 的实现并没有完全按照SM TP 的互联网标准。 常见的问题如 下 ：

•  回车 、 换行的删 除和增加；

•  超过76 个字符 时的处理 ： 截断 或自动换行 ；

•  后面多余 空格的删 除；

•  300  •

•  将 制 表 符 tab 转换为若干个 空 格 。
千 是在 这种情况 下 就提 出 了 通用 互联网 邮件扩充 MIME [RFC  2045~2049 , 前三个 文档
是草案标准］ 。 MIME 并 没 有 改动 或取代 SMTP 。 MIME 的 意 图 是 继续使用 原 来 的 邮件格式 ，
但 增 加 了 邮件主体 的 结构 ， 并 定 义 了 传送 非 ASCII 码 的 编 码 规 则 。 也 就 是 说 ， MIME 邮件
可在现有 的 电子 邮件程序 和 协 议 下 传送 。 图 6- 1 7 表 示 MIME 和 SMTP 的 关 系 。

荨

二

7 位 ASCII 码

图 6- 1 7 MIME 和 SMTP 的关系

MIME 主要包括 以 下 三部 分 内 容 ：

( 1 )   5 个新 的 邮 件 首 部 字 段 ， 它 们 可 包 含 在 原 来 的 邮 件 首 部 中 。 这些字段提供 了 有 关 邮

件 主 体 的 信 息 。

(2) 定 义 了 许 多 邮件 内 容 的 格 式 ， 对 多 媒体 电 子 邮件 的 表示方法进行 了 标准化 。

(3) 定 义 了 传送编码 ， 可 对任 何 内 容格式进行转换 ， 而 不 会 被 邮件 系 统 改 变 。

为适应 千 任 意 数 据 类 型 和 表示 ， 每 个 MIME 报 文 包 含 告 知 收 件 人 数 据 类 型 和 使用 编码

的 信 息 。 MIME 把增加 的 信 息 加 入 到 原 来 的 邮件首部 中 。

一

下 面 是 MIME 增 加 的 5 个新 的 邮件 首 部 的 名 称及 其 意 义 （ 有 的 可 以 是选项 ） 。
( 1 )  MIME-Version: 标志 MIME 的版本 。 现在 的版本号是 1 .0 。 若无此行 ， 则 为英文文本 。
(2) Content-Description : 这 是 可读 字 符 串 ， 说 明 此 邮 件 主 体 是否 是 图 像 、 音频或视频 。
(3) Content-Id: 邮件 的 唯
(4) Content-Transfer-Encoding : 在 传送 时 邮 件 的 主 体 是 如 何编码 的 。
(5) Content-Type : 说 明 邮件主体 的 数 据 类 型 和 子类 型 。
上 述 的 前 三 项 的 意 思很 清 楚 ， 因 此下 面 只 对 后 两项 进 行 介 绍 。

标识 符 。

2 . 内 容传送编码

下 面 介 绍 三种 常用 的 内 容传 送编码 (Content-Transfer-Encoding) 。
最 简 单 的 编 码 就 是 7 位 ASCII 码 ， 而 每 行 不 能 超 过 1 000 个 字 符 。 MIME 对这种 由

一

ASCII 码构成 的 邮件 主 体 不 进 行任何转换 。

”

另
“

种 编 码 称 为 quoted-printable , 这 种 编 码 方 法 适 用 千 所 传 送 的 数据 中 只 有 少 量 的 非
ASCII 码 ， 例 如 汉 字 。 这种编码方法 的 要 点 就是 对 千 所 有 可 打 印 的 ASCII 码 ， 除特殊字符等
号
和 不 可 打 印 的 ASCII 码 以及 非 ASCII 码 的 数据 的 编 码方
”
法 是 ： 先 将 每 个 字 节 的 二 进 制 代 码 用 两 个 十 六 进 制 数 字 表 示 ， 然 后 在 前 面 再 加 上

外 ， 都不改变 。 等 号
”

个 等 号

一

=

=

”

”

”

= " 。 例 如 ， 汉 字 的

（ 共
有 32 位 ， 但 这 四 个 字 节 都 不 是 ASCII 码 ） ， 其 十 六 进 制 数 字 表 示 为 ： CFB5CDB3 。 用
quoted-printable 编 码表 示 为 ： ＝CF=B5=CD=B3 , 这 1 2 个 字 符 都 是可 打 印 的 ASCII 字 符 ， 它

1 0 1 1 0 1 0 1   1 1 00 1 1 0 1   1 0 1 1 00 1 1

的 二进 制 编码 是 ：

1 1 00 1 1 1 1

系 统

•  3 0 1   •

CD

”

”

“
=

”

的 二进制代
一

们 的 二进制编码
码 为 00 1 1 1 1 0 I , 即 十 六进制 的 3D , 因 此等号

”
需 要 96 位 ， 和 原 来 的 32 位相 比 ， 开销达 200% 。 而 等 号

一

= " 的 quoted-printable 编码为

=3D

。

一

对于 任 意 的 二 进制 文件 ， 可 用 base64 编 码 。 这种编码方法是先把二进制 代码划 分 为

”

“

个 24 位 单 元 划 分为 4 个 6 位组 。 每

个个 24 位 长 的 单 元 ， 然 后 把 每
个 6 位组按 以 下 方法
转换成 ASCI I 码 。 6 位 的 二进制代码共有 64 种 不 同 的 值 ， 从 0 到 63 。 用 A 表示 O , 用 B 表
”
示 l ， 等 等 。 26 个 大 写 字母排列 完 毕后 ， 接 下 去 再排 26 个 小 写 字 母 ， 再 后 面 是 1 0 个数字 ，
最 后 用
I " 表 示 63 。 再用 两个 连 在

个 等 号
组 的 代码 只 有 8 位或 1 6 位 。 回 车和 换 行 都忽 略 ， 它 们 可在任何地方插入 。

一
表示 62 , 而 用

一
分 别 表示最后

起 的 等 号

=＝

和

一

一

+

”

“

”

= "

下 面 是

个 base64 编 码 的 例 子 ：

24 位 二进制代码
划 分 为 4 个 6 位组
对 应 的 base64 编 码
用 ASCII 编码发送

0 I 00 1 00 1  00 1 1  000 I  O 1 1 1 1 00 1
0 1 00 1 1   000 1 0 1

T

F

1 1 1 00 1
5

0 1 00 1 0
S

0 1  0 1 00 1 1  0 1 0 1 0 1 00 0 1 000 1 1 0 00 1 1 0 1  0 1

不 难 看 出 ， 24 位 的 二进制代码采用 base64 编码后变成 了 32 位 ， 开 销 为 8 位 ， 占 32 位

的 25% 。

3. 内 容 类 型

MIME 标 准 规 定 Content-Type 说 明 必 须 含 有 两 个 标 识 符 ， 即 内 容 类 型(type) 和 子 类 型

“

I " 分开 。

一

(subtype) ， 中 间 用
M l ME

直 到 现 在 还是草案标准 。 除 了 内 容类 型 和 子 类 型 ， MIME 允许发件人和收件人

自 己 定 义专 用 的 内 容类 型 。 但 为 避 免可 能 出 现名 字冲 突 ， 标准要求为专用 的 内 容 类 型 选 择 的

名 字 要 以 字 符 串 X－开 始 。 后 来 陆 续 出 现 了 几 百 个子 类 型 ， 而 且 子 类 型 的 数 目 还在 不 断地增

加 。 现在 可 以 在 网 站 上 查 出 现有 的 MIME 类 型 和 子 类 型 的 名 称 ， 以 及 申 请新 的 子 类 型 的 具
体 步骤 [W-MEDIA-TYPE] 。 表 6-3 列 出 了 MIME 常 用 的 内 容 类 型 、 子 类 型 举 例 及 其说 明 气

内 容类型

表 6-3 可 出 现在 M I M E Content-Type 说明 中 的 类型及子类型举例
说明

子类型举例

text （ 文 本 ）

image （ 图 像 ）

audio （ 音频 ）

video （ 视频 ）

plain, html, xml, css

gif, jpeg, tiff

basic, mpeg, mp4

mpeg, mp4, quicktime

不 同 格 式 的 文 本

不 同 格 式 的 静 止 图像

可 听 见 的 声 音

不 同 格 式 的 影 片

一

叩 注 ： ASCII 码原 来 定 义 为 7 位码 。 但最初 为 了 增 加 检错 能 力 就增加 了

一

个 奇 偶 检验 位 ， 因 而使 用

个字节 ( 8 位 ） 表示

个 ASCII 1i马 。 千是 ASCII 码就变成 了 8 位码 ， 但 其 最 高 位

定 是 O , 而 后 面 的 7 位就是最初定 义 的 ASCII 编 码 。

＠ 注 ： GJF (Graphics Interchange Format), JPEG (Joint Photographic Expert Group) 和 TIFF (Tagged  Image File Fonnat)都是静

止 图 像 （ 如 照 片 ） 格 式 的 标 准 ， 前 两 者 是 压缩 的 ， 后 者 可 以 是 压缩 的 ， 也 可 以 是 不 压缩 的 。 而 MPEG (Motion  Picture  Experts

Group)是活动 图 像 （ 如 电影 ） 的 压缩标准 ， 包括 MPEG 视 频 、 MPEG 音频和 MPEG 系 统 （ 视频 音 频 同 步 ） 三 个 部 分 。 QuickTime

一

一

是 苹 果 公 司 的 媒体播放机 。 VRML (Virtual  Reality  Modeling  Language)是虚拟现实建模语 言 。 PDF (Portable  Document  Format)是

一

一

Adobe 公 司 开发 的

种 电子 文 件 格 式 。 ZIP 是

种 文件压缩算法 。

•  302  •

内 容类型

子类型举例

说明

model （ 模型 ）

vrml

3D 模 型

application （ 应用 ）

octet-stream, pdf, j avascript, zip

不 同 应用 程序 产 生 的 数据

message （ 报 文 ）

http, rfc822

封 装 的 报 文

multipart （ 多 部 分 ）

mixed, alternative, parallel, digest

多 种类 型 的组合

续表

MIME 的 内 容 类 型 中 的 multipart 是 很 有 用 的 ， 因 为它 使 邮件增加 了 相 当 大 的 灵活性 。

MIME 标准为 multipart 定 义 了 四 种 可 能 的 子 类 型 ， 每 个子 类 型 都提供重 要 功 能 。

一

( 1 )   mixed 子 类 型 允 许 单 个 报 文 含 有 多 个 相 互独 立 的 子 报 文 ， 每 个 子 报 文 可 有 自 己 的 类
型 和 编 码 。 mixed 子 类 型 报 文使用 户 能 够 在 单 个 报 文 中 附上 文 本 、 图 形和 声 音 ， 或者用 额外
个 备 忘 录 ， 类似商业信笺含有 的 附件 。 在 mixed 后 面还 要 用 到
数据段发送
个 关 键 字 ， 即
Boundary= ， 此 关 键 字 定 义 『 分 隔 报 文 各 部 分 所 用 的 字 符 串 （ 由 邮 件 系 统 定 义 ） ， 只 要 在 邮
-- “ 开 始 ， 后 面 紧跟上述
件 的 内 容 中 不 会 出 现这样 的 字 符 串 即 可 。 当 某

行 以 两 个 连 字 符

一

一

一

”

的 字符 串 ， 就表示 下 面开始 了 另

个 子报 文 。

一

(2)  alternative 子 类 型 允 许 单 个报 文 含 有 同

数据 的 多 种 表 示 。 当 给 多 个使 用 不 同 硬件 和
软 件 系 统 的 收件 人 发 送 备 忘 录 时 ， 这种 类 型 的 multipart 报 文 就 很有 用 。 例 如 ， 用 户 可 同 时
用 普通 的 ASCII 文 本 和 格 式化 的 形 式 发送 文 本 ， 从 而 允 许 拥 有 图 形 功 能 的 计 算机用 户 在 查
看 图 形 时选择格式化 的 形 式 。

(3)  parallel 子 类 型 允 许单 个 报 文 含有 可 同 时 显 示 的 各个 子 部 分 （ 例 如 ， 图 像 和 声 音 子 部

一

分 必 须

起播放 ） 。
一

一

一

(4) digest 子 类 型 允 许 单 个 报 文 含 有
一
下 面 显 示 了

个 MIME 邮件 ， 它 包 含 有

组其他报 文 （ 如 从讨 论 中 收集 电子 邮件 报 文 ） 。
一

个 简 单解释 的 文 本 和 含 有 非 文 本信 息 的 照 片 。

邮件 中 第

部 分 的 注解 说 明 第 二 部 分含有

张照片 。

From: xiexiren@tsinghua.org.cn
To: xyz@ l 63 .com
MIME-Version:  1 .0
Content-Type: multipart/mixed; boundary

=

qwertyuiop

--qwertyuiop
XYZ :

你 要 的 图 片 在 此 邮件 中 ， 收 到 后 请 回 信 。

谢希仁

--qwertyuiop
Content-Type: image/gif
Content-Transfer-Encoding: base64

…data for the image （ 图 像 的 数据）…

--qwertyuiop--

一

”

上 面 最 后

行表示 boundary 的 字 符 串 后 面还有两个连字符

-－ “ ， 表 示 整 个 multipart 的

结 束 。

•  303  •

