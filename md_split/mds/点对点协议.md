一

一

两 大类 ：

类就是 前面 所说的最基本的比特差错， 而另

类传输差错则更复杂 些， 这就是收

到的 帧并没有出 现比特差错， 但 却出 现了 帧丢失 、 帧重复或帧失序。 例如， 发送方连 续传送

一

三个 帧 ：

［＃ 1 ]-[#2]-[#3]。 假定接收端收到的每

个 帧都没有比特差错， 但 却出 现下面的 几种

情况 ：

帧丢 失 ： 收到 [#l ]-[#3 ]（ 丢 失 [#2]）。

帧重 复 ： 收到 [# 1 ]-[#2]-[ #2]-[ #3 ]（ 收到两个 [#2] )。

一

帧 失 序 ： 收到 [# 1 ]-[ #3 ]-[ #2]（后发送的 帧 反而先到达了接收端， 这与

一

般数据链路 层的

传输概念不

样）。

”

＂

“

＂

以上 三种情况都属千

出 现传输 差错

， 但都不是这 些 帧 里有

比特差 错

。 帧 丢 失很

容 易 理解。 但出 现帧重复和 帧 失序 的情况则较为复杂， 对这些 问 题我 们 现在 不 展开讨论。 在

学 完第 5章的 5 .4 节后， 我 们就 会 知道在什么情况下接收端可能会 出 现 帧重复或 帧 失序。

“

”

“

”

总之， 我们 应 当明确，

无比特差错

与

无传输差错

并 不是 同样的概念。 在数据链

路 层使用 CRC 检验， 能够实 现 无比特差错的传输， 但这 还 不是可 靠传输。

我 们 知道， 过去 OSI的 观 点是 ： 必须让数据链路 层向 上提供可 靠传输。 因此 在 CRC 检
错的基础上， 增 加了 帧编号、 确认和 重传机制。 收到 正确的 帧就要向发送端发送确 认。 发送

一

端 在

定的 期 限内 若没有收到 对 方的确 认， 就认为出 现了差错， 因 而就进行重传， 直到收到

对方的确 认为 止。 这种方法在 历 史上 曾 经 起到很好的作用。 但 现在的通信线路的 质量 已 经大

大 提高了， 由通信链路 质量不好 引 起 差 错的概率 已 经大 大 降低。 因此， 现在 互联网就 采取了

区别 对 待的方法 ：

对于通信 质量 良好的有线传输链路， 数据链路 层协议不使用确 认和重传机制， 即不要

求数据链路 层向上 提供可 靠传输的服务。 如 果在数据链路 层传输数据时出 现了差错并 且需要

进行 改 正， 那么 改正差错的任务就 由上 层协议 （例如， 运输 层的 TCP协议） 来 完成。

对千通信 质量较差的 无线传输链路， 数据链路 层协议使用确 认和重传机制， 数据链路

层向 上提供可 靠传输的服务（见 第 9章）。

实 践证明， 这样 做可 以提高通信 效率。

可 靠传输协议将在 第 5 章中讨论。 本章介绍的数据链路 层协议都不是可 靠传输的协议。

3.2  点对点协议 PPP

在通信线路 质量较 差的 年代， 在数据链路 层使用可 靠传输协议 曾 经是

种好 办法。 因
此， 能实 现可 靠传输的 高级数据 链路控制 HDLC (High-level Data Link Control)就成为当时比

较流行的数据链路 层协议。 但现在 HDLC 已很 少使用了。 对千 点对 点的链路， 简单 得 多的

点 对点 协议 PPP (Point-to-Point Protocol)则是目 前使用 得最广泛的数据链路 层协议。
3 .2. 1  PPP 协 议的特 点

一

我们 知道， 互 联网用户通常都要连接到某个 ISP 才能接入到 互 联网。 PPP协议就是用户

计算 机和 ISP进行通信时 所使用的数据链路 层协议（如图3-9 所示）。

•  78  •

用

户

已从互联网 管理机构
申 请 到
批 IP 地址

一

ISP

至互联网

- PPP 协议

伸

图

3-9

用 户 到

ISP

的链路 使 用

协议

PPP

PPP协议是 IET F在 1 992 年制定的。 经过 1 993 年和 1994 年的 修订， 现在的 PPP协议

在 1 994 年就 已成为 互联网的 正式 标准 [R FC 1 66 1 ,  STD5 1 ]。

1 .  PPP 协议应满足的 需 求

IET F 认为， 在设计 PPP协议时必须考虑以下多方面的 需 求 [RFC 1 547] :
( 1 ) 简单 IET F在设计互 联网体 系结 构时把 其中最复 杂的部分放在 TCP协议中， 而
网 际协议 IP则相对比较简单， 它 提供的 是 不可 靠的数 据 报服务。 在这种情况下， 数 据 链路

层没有必要 提供比 IP协议更多的 功能。 因此， 对数 据 链路层的 帧， 不 需要 纠 错， 不需要 序

“

”

号， 也 不 需要 流星控制。 IET F把

简单

作为 首要的 需求。

简单的设计还 可使协议在 实现时 不容 易出 错， 从 而使 不同厂 商在协议的 不同实 现上的

一

互操作性提高 了。 我们知 道， 协议 标准化的

个 主要 目的就是 提高协议的 互 操作性。

一

总之， 这种数据 链路层的协议非常简单 ： 接收方每收 到

CRC 检验正确， 就收下这个 帧 ； 反之， 就 丢 弃这个 帧， 其他什么也不做。

个 帧， 就进行 CRC 检验。 如
一

(2) 封装成帧

PPP协议必须规定特 殊的字符作为 帧定界符（ 即 标 志

个 帧的开始和

结 束的字符）， 以 便使接收端从收 到的比特 流中能 准确 地找出 帧的开始和结 束位 置。

一
(3) 透 明性

PPP协议必须保证数 据传输的 透 明性。 这就是说， 如 果数 据中 碰巧出现

了和 帧定 界符

样的比特 组合时， 就要 采 取有效的 措施来解 决这个 问题（见 3 .2.2 节）。

一

(4) 多 种网络 层 协议

PPP协议必须能够 在同

条物理链路上同时 支 持 多 种网络 层 协

议（如 IP和 IPX 等） 的 运行。 当 点对点链路所连接的是 局域网或路 由器时， PPP协议必须

同时 支 持在 链路所连接的 局域网或路 由器上 运行的各种网络层协议。
一

一

一

除了要 支 持多种网络层的协议外， PPP还必须能够在多种 类型的

(5) 多种 类型链路
链路 上 运行。 例如， 串行的（

次 只发送

个比特 ） 或 并行的（

次 并行地发送多个比特），

同步的或 异 步的， 低速的或高速的， 电的或 光的， 交换的（ 动 态的 ） 或非 交换的（ 静 态的）

点对点链路。

这里特别要 提到的是在 1 999 年 公 布的在以 太网上 运行的 PPP, 即 PPP over Ethernet, 简
个 典型 例子。 PPPoE是

称为 PPPoE [RFC  25 1 6]， 这是 PPP协议能够 适应多种类 型 链路的

一

为宽带 上网的 主 机使用的 链路层协议。 这个协议把 PPP 帧 再 封装在以 太网 帧中（ 当 然还要

一

增 加

些能够识别各用户的 功能）。 宽带上网时 由千数 据传输速率较高， 因此可以 让多个连

一

一

个用户利用 ADSL进
条 到 ISP的宽带 链路。 现在， 即使 只有
接在以 太网 上的用户 共享
行宽带上网（ 并 不和 其 他人 共享 到 ISP的 宽带 链路 ）， 也是使用 PPPoE协议， 见 后面的 3 .5 .4

节的讨论。

•  79  •

订

(6) 差错检测(e

or detection)

PPP协议必须能够对接收 端收到的 帧进行 检测， 并 立

即 丢弃有差错的 帧。 若在 数据链路 层不进行 差错检测， 那么 已出现 差 错的 无用 帧就还要在网

络中 继 续向 前转发， 因 而 会 臼 臼 浪 费 许多的网 络 资源。

一

(7) 检测连接状 态

PPP协议必须具 有

种机制能够及时（不 超过几分钟 ） 自 动 检 测

一

出链路是 否处千正常 工作状 态。 当出现 故 障的链路 隔了

段时间 后又重 新 恢 复正常 工作时，

就特别 需要有这种及时 检测功能。

一

(8 ) 最 大传送单元

PPP协议必须对 每

种类 型的点 对 点链路设 置 最 大传送单元

MTU的标准默 认 值 气 这样 做 是为了 促进 各种实 现之 间的 互 操作性。 如 果高 层协议发送的
分 组过 长并 超过 MTU的数 值， PPP就要 丢 弃这样的 帧， 并 返 回差错。 需要强调的是， MTU

是数据链路 层的 帧可以 载荷的 数据 部分 的 最 大 长度， 而 不是帧的 总 长度。

一

(9) 网络 层 地址协商

PPP协议必须提供

种机 制使通信的两个网络 层（例如， 两个

IP 层） 的实体能够通过协商 知道或能够 配置 彼此的网 络层地 址。 协商的 算 法 应尽可能简单，

并 且能够在 所有 的情况 下 得出协商 结 果。 这 对拨号连 接的链 路特别重要， 因为如 果仅仅在链

路层 建 立了连 接 而不知道对方网络层地 址， 则还不能够 保证网络层 可以传送分 组。

一

(10 ) 数据 压 缩协商

PPP协议必须提供

种 方 法来协商使用数据 压缩算 法。 但 PPP

协议并不要 求将数据 压缩算 法进行标准化。

在 TCP/IP协议 族中， 可 靠传输 由 运输 层的 TCP协议 负 责， 因此数据链路 层的 PPP协

议不 需 要进行 纠 错， 不需要设 置序 号， 也不 需要进行 流 量 控制。 PPP协议不 支 持多点线路

一

（ 即

个 主 站 轮 流和链路上的 多个从 站进行通信）， 而 只 支 持点对点的链路 通信。 此外，

PPP协议只支 持 全 双工链路。

2 .   PPP 协议的 组成

一

PPP 协议有 三个 组 成 部分：
(1 )

个 将 IP数据 报封装到 串行链路的方 法。 PPP 既 支 持异 步链路 （ 无奇偶检验的 8 比
特数 据）， 也 支 持面向比特的同 步链 路。 IP数 据 报在 PPP 帧中就是 其信息部分。 这个信息部
分的 长度 受最 大传送单元 MTU的 限制。

一

(2)

个用来 建 立、 配 置 和 测 试数 据 链路 连接 的 链 路 控 制 协 议 LCP (Link  Control

一

Protocol)。 通信的 双方可协商

一

@
些 选项。 在RFC 1661中 定义了 1 1种类 型的 LCP分 组。

一

(3)

套网络 控制 协议 NCP (Network Control Protocol)

, 其中的 每

个协议 支 持 不同的

网络层协议， 如 IP、 OSI的 网 络层、 DECnet和 AppleTalk等。

协 议 的 帧 格 式

3 .2 . 2   PPP

1 . 各字 段的 意义

PPP的 帧格式如图3 -10 所示。 PPP 帧的 首部和 尾部分别为 四个字段和两个字段。

一

“

首部的 第

个字段 和 尾部的 第 二个字段都是标志字段 F( Flag)， 规定为 Ox7E（符号

Ox "

表示它 后 面的字符是用 十 六进制表示的。 十 六进制的 7E的 二进制表 示是 0 1111110 )。 标志

注： MTU 的默认值是 1 500 字节 。 在 RFC 1 66 1 中 ， MTU 叫 作 最大接仅单 元 M R U (Maximum Receive Unit) 。

CD
＠ 注 ： TCP 的早 期版本 也 叫 什 NCP, 但它 和这里所讨论 的 NCP 没有 关 系 。

•  80

•

一

一
字段 表示

个 帧的 开始或结 束。 因 此标志字段就是 PPP 帧的定 界符。 连续两 帧之间只需要

一

用

个标志字段。 如 果出现 连续两个标志字 段 ， 就 表示这是

个 空 帧 ， 应当丢 弃。

首部中的地 址字段 A 规定为 OxFF（ 即 111111 1 1 ) ， 控制字 段 C 规定为 Ox0 3（ 即
0 0 0 0 0 0 11 )。 最初 曾考虑以后 再对这两个字段的 值进行 其 他定义 ， 但 至 今也没有给 出。 可 见
这两个字段实 际上并没有 携带 PPP 帧的信息。，

，

可 变 长度

IP 数据报

字节 1

I

1

2

2

不超过 1 500 字节
PPP帧

图 3- 10 PPP帧的格式

PPP首部的 第 四个字段是 2字 节的协议字段。 当协议字段为 Ox0 0 21 时 ， PPP 帧的信息
字段就是 IP 数据 报。 若为 OxC0 21, 则信息字段是 PPP 链路 控制协议 LCP的数据 ， 而
Ox80 21 表示这是网络层的 控制 数据。

信息字段的 长度是可变的 ， 不 超过 150 0 字 节。

尾部中的 第 一个 字段 ( 2字 节 ） 是使用 CRC的 帧检验序列 FCS。

2 . 字 节填 充

一

一

当信息字段中 出现和标志字段

一

样的比特(Ox7E) 组合时 ， 就必须采 取

些 措施使这种形

式 上和标志字段

样的比特 组合不出现在信 息字段中。

当 PPP使用 异步传输时 ， 它把转义符定义为 Ox7D （ 即 0 1111 10 1 ) ， 并使用 字 节填充 ，

RFC 1662规定了如 下 所述的 填 充方法：

一

(1 ) 把信息字段中出现的每

一

个 Ox7E字 节转变成为 2字 节序列(Ox7D, Ox5E)。

一

(2) 若信息字段中 出现

个 Ox7D的字 节（ 即出现了和转义字符

样的比特 组合） ，则

把 Ox7D转变成为 2字 节序列(Ox7D, Ox5D)。

一

(3) 若信 息字段中 出现 ASCII 码的 控制字符（ 即数 值 小于 Ox20 的字符） ， 则在 该字符前
“
面要 加入

个 Ox7D字 节 ， 同时将 该字符的编码 加以 改变。 例如 ， 出现 Ox0 3（在 控制字符中

“

是

传输结 束

ETX )就要把 它转变为 2字 节序列(Ox7D, Ox23)。

巾千在发送端进行了字 节填 充 ， 因 此在链路 上传送的信息字 节数就 超过了原来的信息

字 节数。 但接收端在收到数据后 再进行与发送端字 节 填 充相反的变 换 ， 就可以正确地 恢复出

原来的 信息。

3 . 零比特 填充

一

PPP协议用在 SONET/SDH链路时 ， 使用同步传输（

连 串的比特 连 续传送） 而 不是 异

步传输（ 逐个字符地传送 ）。 在这种情况下 ， PPP协议采用 零比特 填 充方法来实现 透明传输 。

零比特 填 充的具体 做法是： 在发送端 ， 先 扫描 整个信息字段（通常用硬件实 现 ， 但也

一

可用 软件实现 ， 只是 会慢些）。 只要发现有 5个 连 续 1 , 则 立 即 填入

个 0。 因此经过这种 零

一

比特 填 充后的数据 ， 就可以 保证在信息字段中不 会 出现 6个 连续l。 接收端在收到

个 帧时 ，

•  8 1  •

先 找到标志字段 F 以确 定一个帧的边界， 接着 再用硬件对其 中的比特流 进 行 扫 描 。 每 当
发现 5 个连续 1 时， 就把这 5 个连续 l 后的一个 0 删 除， 以还原 成 原 来的信 息比特流（如
图 3-11 所 示 ） 。 这样就保证 了 透明 传输： 在所传送的数据比特流 中 可以传送任 意 组合的比特

流， 而不会 引 起对帧边界的错 误判 断 。

信息字段 中 出 现 了 和
标 志字段 F 完全
样
的 8 比特组合

一

发送端在 5 个连续 1 之后
填入 0 比特再 发送 出 去

在接收端把 5 个连续 l
之 后 的 0 比特删 除

0

0

F

1
o

0

1

1

1

1

o
1
1
Au

0

o

0

1

0

1

0

发

送

端

填

入

比

特

o

1
o

0

1

1

1

1

1

1
o

0

0

1

0

1

0

接

收

端

删

入

的

0

上
特七

0
几
V
填
除

3 .2.3  PPP 协议的工作状态

图 3- 1 1 零 比特 的 填充 与 删 除

上一节我们通过 PPP帧的格式讨论了 PPP帧是怎样组成的。 但 PPP链
路一开始是怎样被初始 化的？ 当 用户拨号接入 ISP后， 就建立 了 一 条从用户
个人 电脑到 ISP的物理连接 。 这时， 用户个人 电脑向 ISP发送一系列的链路
控制协议 LCP分组（封装 成 多个 PPP帧 ）， 以便建立 LCP连接 。 这些分组及其响应选择 了
将要使 用的一 些 PPP参数。 接着还要进行网络层配置， 网络控制协议 NCP给新接入的用户
个人 电脑分配一个临 时的 IP地址 。 这样， 用户个人 电脑就成为互联网上的一个有 IP地址的
主机 了 。

视频讲解

当 用户通信完毕 时， NCP释放网络层连接， 收回原 来分配出去的 IP地址 。 接着， LCP

释放数据链路层连接 。 最后释放的是物理层的连接 。
上述过程可用如 图 3 - 1 2所 示的状态图来描述 。
PPP链路的起始 和终止状态永远是图 3 - 1 2中的 “ 链路静止 ”

用户个人 电脑和 ISP的路 由 器之间并不存在物理层的连接 。

(LinkDead)状态， 这时在

LCP 链路
终止

链路故障或
关 闭 请求

鉴 别 失败

设备之间无链路I 物理链路I

LCP 链路

功或无须鉴别 1

置协商

已 鉴 别 的 LCP 链路

l

已 鉴 别 的 LCP 链 路
和 NCP 链路

• 82 •

图 3- 1 2

PPP 协 议 的 状态 图

当 用户个人 电 脑 通过调制解 调器 呼 叫 路 由 器时（通 常 是在屏 幕上用 鼠 标点击 一个连接

按 钮 ）， 路 由 器就 能 够检测到调制解 调器发出的载 波 信 号 。 在 双方建 立 了 物 理 层连接后，
PPP就进入 “ 链路建立 ” ( Link E stabli sh)状态， 其目的是建 立链路层的 LCP连接。

这时 LCP开始协商 一 些配置 选项， 即发送 LCP的配置请求帧(Configure-Request)。 这是
个 PPP 帧， 其协议字段置为 LCP 对应的代码， 而信 息字段包含特定的配置请求。 链路的另
一 端可以发送以下几种响 应 中 的一种：

(1)配置确认帧 (Configure-Ack )： 所有选项都接受。
(2)配置否认帧 (Configure-N ak )： 所有选项都理解但不 能接受。
(3)配置拒绝帧 (Configure-Reject)： 选项 有的无法识 别或不能接受， 需要协商。
LCP 配置选项包括链路上的最大帧长、 所使用的鉴别协议(Authentication Protocol)的规
约（如果有的话）， 以及 不使用 PPP 帧中的地址和控制字段（因 为这两个字段的值是 固 定的，
没有任何信 息量， 可以在 PPP帧的首部中省略这两个字节）。

协商 结束后双方就建立了 LCP 链路， 接着就进入 ＂ 鉴别 ” (Authenticate)状 态。 在这一
状态， 只允许传送 LCP 协议的分组、 鉴 别协议的分组以及 监测链路质量的分组。 若使用 口
令鉴别协议 PAP ( Pa s sword Authentication  Protocol)， 则 需要发起通信的一方发送身 份标识 符
和 口 令。 系统可 允 许用户 重试若干次。 如 果 需要有 更 好的安 全性， 则 可使用更加复 杂 的 口 令

握手鉴别协议CHAP (Challenge-Hand shake Authentication  Protocol)。 若鉴别 身 份 失 败， 则 转
到 “ 链路终止 ” ( Link Terminate)状态。 若鉴别成功， 则 进入 “ 网络层协议 ” ( Network -Layer
Protocol)状态。

在

“ 网 络层协议 ”

状 态， PPP 链路两 端的网络控制协议 NCP 根据网络层的不同协议互

相交换网络层特定的网络控制分组。 这个步 骤是很重要的， 因 为现在的路 由 器都能够同时支

持 多种网络层协议。 总之， PPP协议两 端的网络层可以运行不同的网络层协议， 但仍然 可使
用同一个 PPP协议进行通信。

如果在 PPP链路上运行的是 IP 协议， 则 对 PPP链路的每一端配置 IP 协议模块（如分
配 IP地址） 时就要使用 NCP中 支 持 IP的协议 IP控制协议 IPCP ( IP Cont rol Protocol)。

IPCP分组也封装成 PPP帧（其中的协议字段为Ox8 021) 在 PPP链路上传送。 在低速链路上

运行时， 双方还可以协商 使 用压缩的TCP和 IP首部， 以减 少 在链路上发送的比特数。

当 网络层配置完 毕后， 链路就进入可进行数据通信的 ＂ 链路打开 ” ( Link Open)状态。 链
路的两 个 PPP 端点可以彼 此 向对方发送分组。 两个 PPP 端点还可发送回 送请求 LCP 分组

( Echo-Request)和回 送 回 答 LCP分组(Echo-Reply)， 以检 查链路的状态。

数据传输结束后， 可以由 链路的一端发出 终止请求 LCP 分组(Terminate-Request)请求终
止链路连接， 在收到对方发来的终 止确认 LCP 分组(Terminate-Ack )后， 转到 “ 链路终止 ”
状态。 如 果链路出现故 障， 也 会从 “ 链路打开 “ 状态转到 “ 链路终止 ” 状态。 当 调制解 调器
的载波 停 止后， 则 回 到 ＂ 链路静止 ” 状态。

图 3-12 右 方的灰色方框给出 了 对 PPP 协议的几个状态的说明 。 从设备之间无链路开始，

到先建 立物理链路， 再建立链路控制协议 LCP 链路。 经过鉴 别后再建立网络控制协议 NCP

链路， 然 后才能交换数据。 由 此可见， PPP协议 已 不是纯粹的数据链路层的协议， 它还包含

了 物理层和网络层的内容。

•  83  •

