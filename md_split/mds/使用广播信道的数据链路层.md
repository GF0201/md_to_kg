3 . 3   使 用 广播信道的数据链路层

一

广播 估道可以进 行

对多的通信。 下 面要讨论的 局 域 网使 用的 就是广播信道。 局域网

是在 20 世 纪 70 年代 末发 展起 来的。 局 域 网技术在计算机网络中 占 有非常重要的地位。
3 .3 . 1   局 域 网 的数据链路层

一

局域网 最 主要的特点是 ： 网络 为

个单位 所 拥 有 ， 且 地 理 范 围 和站点

数目均 有 限。 在 局域 网 刚 刚出现时， 局域 网比 广域 网具 有 较 高的数据率、

视频讲解

较 低 的时 延和 较 小的 误码率。 但 随 着 光 纤技术在 广域 网中 普 遍使 用， 现在

广域 网也具有很高的数据率和很低的 误 砃率。

一

局域网具有如 下的

一
些 优点 ：

( 1 ) 具 有 广播 功能， 从

个 站 点 可很方 便地 访 问 全网。 局 域网上的 主机可 共 享连接在 局

域 网上的各种 硬件和 软件 资源。

(2) 便于系统的 扩 展和逐 渐地 演 变 ， 各设备的位 置可 灵 活调 整和 改变。
(3) 提高了系统的可 靠性 (reliab巾ty)、 可 用性(availability)和 生 存性 (survivability)。
局域网可按网络 拓 扑进 行 分类。 图 3- 1 3(a)是 星 形网。 由于 集 线器 (hub)的 出现和 双绞

线 大 量 用千 局域网中 ， 星形以 太网以及 多 级 星形结 构的以 太网获得了非常 广 泛的 应 用。 图

3 - 1 3 (b)是 环 形网 ， 图 3- 1 3(c)为 总 线网 ， 各 站直 接连在 总线 上。 总线两端的 匹 配电 阻 吸收在

总线上传 播的电磁波 信 号的能 量， 避 免在 总线上产生有 害的电磁波反 射。 总线网以传 统以 太

网 最为 著名， 但以 太网 后来 又 演变成了 星形 网。 经过 四 十 多 年的发 展， 以 太网的速率 已大 大
10 Gbit/s（数据中心） 和
提 高。 现在最常 用的以 太网的速率是 1 Gbit/s（家 庭或中 小 企 业） 、
10 0  Gbit/s（ 长距 离传输） ， 且 其速率仍 在 继 续 提高。 现 在以 太网 已成为了 局域网的同义 词，

因此本章从本 节开始都是 讨论以 太网技术。

匹 配电阻

(a) 星 形 网

(b) 环 形 网

(c) 总 线 网

图 3- 1 3 局 域 网的拓 扑

局域网可使 用多种传输媒体。 双绞线最 便 宜， 原来 只 用于低速 ( 1 ~2 Mbit/s )基带 局域
网 。 现在从 10 Mbit/s 至 10 Gbit/s的 局域网都可使 用 双绞线。 双绞线 已成为 局域网中的 主 流
传输媒体。当数据率更高时 ， 往往 需要使 用 光纤作为传输媒体。

必须指出， 局域网工作的层 次跨越了数据链路层和物理层。 由于 局域网技术中有 关数

一

据链路层的内容比较 丰 富 ， 因此我们就把 局域网的内容放在数据链路层这

章中讨论。 但这

并不表示 局域网仅仅和数据链路层有 关。

一

共 享信道要 着重 考虑的

个 问题 就是如 何使 众多 用户能够 合 理 而方 便地 共 享通信媒体

资源 。 这在技 术 上有两种方 法：

( 1 ) 静态划分信道， 如 在第 2 卓的 2.4 节中 已 经介绍过的频 分复 用、 时 分复 用、 波 分复

•  84  •

用 和码分复用等。 用 户 只要分 配到 了信道就不 会和 其 他用 户发 生 冲 突。 但这种划分信道的方

法代 价较高， 不 适合千 局域网使用。

(2) 动态媒体接入控制， 它 又 称为 多点接入(multiple access)， 其特点是信道并非 在用 户

通信时 固定分 配给用 户。 这 里又分为以下两类 ：

•  随机接入 随机接入的特点是所有的用户可随机地发送信息。 但 如 果 恰巧有两个

一

或更多的用 户在同

时 刻发送信息， 那么 在共享媒体 上就要产生 碰撞 （ 即发 生了 冲

一
突）， 使 得这些用 户的发送都 失败。 因此， 必须有解 决 碰撞的网络协议。

•  受控接入

受 控接入的特点是用户不能随机 地发送信息 而必须服从

定的 控制。

这 类的 典 型代表有分 散 控制的 令 牌 环 局域网和 集 中 控制的多点线路 探询(poiling)

,

或称为 轮询。

属千随机接入的以 太网将被重点讨论。 受 控接入则 由于 目 前在 局域网中使 用 得 较 少，

本 书不 再讨论。
”

由千以 太网的数 据率 已 演进到每 秒 吉比特 甚至高达 40 0 吉比特， 因此通常就用

“

传统

以 太网

来表示最 早流行的 10 Mbit/s速率的以 太网。 为了讨论原 理， 下 面我们就从传 统以

太网开始。

1 . 以 太网的 两 个主要标准

以 太网是 美 国 施 乐 (Xerox)公 司的 Palo Alto 研 究 中心 （简 称为 PARC )千 1 975 年 研制 成

一

功的。 那时， 以 太网是

种基带 总线 局域网， 当时的数据率为 2.94 Mbit/s。 以 太网用 无源电

缆作 为总线来传送数 据 帧， 并以 曾经 在历 史上表示传 播电磁波的 以 太(Ether)来 命名。 1976

年 7 月 ， Metcalfe和 Boggs发表 他们的以 太网 里程 碑论 文 [METC76]。 1 980 年 9 月， DEC公
司、 英特 尔(Intel)公 司和 施 乐公 司 联 合 提出了 10 Mbit/s以 太网规 约的 第

个 版本 DIX V l

一

( DIX 是这 三个公 司名称的 缩 写）。 198 2 年又 修 改为 第 二 版规 约（实 际 上也就是最后的 版

一

本）， 即 DIX Ethernet V2 , 成为 世 界 上 第
在此基 础上， IEEE 80 2 委 员 会

0

个 局域网 产 品的规 约。

一

的 80 2.3 工 作 组千 198 3 年制定了 第

个 IEEE的以 太网

标准 IEEE 80 2.3 [W-IEEE80 2.3]， 数 据率为 10 Mbit/s。 80 2.3 局域网 对以 太网标准中的 帧格式

一

一

做了很 小的

点更 动， 但 允 许基 于这两种标准的硬件实现可以在同

个 局域网上 互 操作。 以

太网的两个标准 DIX Ethernet V2与 IEEE的 80 2.3标准 只有很 小的差别， 因此很多人也常把

“

”

80 2.3 局域网简称为

以 太网

（ 本 书也经常不严格 区分它们， 虽 然严 格 说来， “以 太网
“

一

一

当是指符 合 DIX Ethernet V2标准的 局域网）。

＂

出千有关 厂 商 在 商 业上的 激 烈 竞 争， IEEE 80 2 委 员 会当初未能形成

个 统

的、

最 佳

的

局域网标准， 而是被 迫制定 了 几个不同的 局域网标准， 如 80 2.4 令牌 总线网 、

80 2.5 令
牌环网等。 为了使 数 据链路层能更好地 适应多种 局域网标准， IEEE 80 2 委 员 会就把 局域网
的数 据链路层 拆成两个 子层， 即 逻辑链路控制 LLC(Logical  Link  Control) 子层和 媒体接入控
制 MAC(Medium Access Control) 子层。 与接入到传输媒体有关的内容都放在 MAC 子层， 而

＄ 注 ：

IEEE 802 委 员 会 [W-IEEE802]是专 门 制 定 局 域 网 和 城域 网 标 准的机构。 截至 2020 年 7 月 ， 其 下 属 仍 在 活动的工作

组 只 有 5 个 ， 即 ： 802. l一高层 局 域 网 协议 工 作 组 ； 802.3—— 以 太 网 工 作 组 ； 802. 1 1

——

无 线 局 域 网 工 作 组 ； 802. 1 5

无线个

人 区 域 网 工 作 组 ； 802. 1 9—

－ 无 线 共存 工 作 组 。 其 余的都 已经暂时或完全停 止 了 活动 。

—

•  8 5  •

”

应

LLC 子层则与传输媒体无关， 不管采用何种传输媒体和 MAC 子层的局 域网对 LLC 子层来
说都是透明 的（如 图3-14 所示）。

逻辑链路控制

媒体接入控制

数据链路层

站 点 l

站 点 2

图 3- 1 4 局 域 网 对 LLC 子 层 是 透 明 的

然而到 了 2 0 世 纪 9 0 年代后， 激烈 竞 争的局 域网市场逐渐明 朗。 以太网在局 域网市场
中 已 取得 了 垄 断地位， 并且几乎成为了 局 域 网的代名词。 这里 不必叙述后来陆续出现的多种
以太网标准的详细过程。 目前使用最多的局 域网只剩 下 DIX Ethernet  V2 （ 简 称为以太网），
而 不 是 IEEE 8 02 委 员 会制定的几种局 域网。 IEEE 8 02 委 员 会制定的逻辑链路控制子层 LLC
（即 IEEE 8 02.2 标 准） 的作用 已 经 消 失 了 ， 很多厂 商 生产的适配器上就仅装有 MAC 协议而
没有LLC 协议。 本 章 在介 绍 以太 网时就不再考虑 LLC 子层。 这样对以太网工 作 原理的讨论

会 更加简 洁。

2 . 适配器 的作用

首 先 我们从一般的概念上讨论一下计算机是 怎样连接到局 域网上的。
计算机与外 界 局 域 网的连接是通过适配器( adapter)。 适配器本来是在 主机箱内插入的一
块网络接 口 板（或者是在笔记 本 电脑中插入一 块 PCMCIA 卡 个人计算机存储器卡接 口
适配器）。 这种接 口 板又称为网 络接 口 卡 NIC ( Network  Interface Card)或简称为
。 由

“ 网卡 ”

于现在计算机主板上都 已 经 嵌入 了 这种适配器， 不再使用单独的网卡 了 ， 因 此本书使用适配
器这个更准确的术语。 在这种通信 适配器上面装有处理器和存储器（包括 RAM 和R OM )。
适配器和局 域网之间的通信是通过 电缆或双绞线以串 行传输方式进 行的， 而适配器和计算机
之间的通 信 则 是通过计算机主板上的 1 /0 总线以并行传输方式进行的。 因 此， 适配器的一个
重要功能就 是要进行数据串 行传输和并行传输的转换。 由 千网络上的数据率和计算机总线上
的数据率并不相 同 ， 因 此在适配器中必须 装有对数据进 行缓存的存 储 芯 片 。 在主板上插入适
配器时， 还必须把管理该适配器的设备驱动程序安 装在计算机的操作系统中。 这个驱动 程序
以后就会告诉适配器， 应 当 从存 储器的 什么位置上把多长的数据块发送到局 域网， 或者应 当
在存储器的 什么位置上把局 域网传送过来的数据块存 储下来。 适配器还要能够实现以太网协
议。

请 注 意 ， 虽 然 我们把适配器的内容 放 在数据链路层中讲 授 ， 但适配器所实现的功 能却
包含 了 数据链路层及物理层这两个层次的功能。 现在的芯片 的集成度都很高， 以致很难把一
个适配器的功能严格按照层次的关系精确 划分开。

适配器在接收和发送各种帧时， 不使用计算机的CPU。 这时计算 机中的CPU 可以处理

其他任务。 当 适配器收到有差错的帧时， 就把这个帧直接丢 弃而不必通 知计算机。 当 适配器
收到正 确的帧时， 它 就使用中断来通 知该计算机， 并交付协议栈中的网络层。 当 计算机要发
送 IP数据报时， 就 由协议栈把 1P数据报向 下 交给适配器， 组装成帧后发送到局域网。 图 3-15
表示适配器的作 用。 我们特别要注 意 ， 计算机的硬件地址（在本章的 3.3.5 节讨论） 就在适

•  86 •

配器的ROM中， 而计算 机的 软件地 址
存 储器中。

卫主丿 竺

IP地 址（在 第 4章 4.2.3 节讨论）， 则在计算 机的

生 成 发送的数据
处理收到的数据
图 3- 1 5 计算机通过适配器和 局 域 网 进行通信

把帧发送到 局 域 网
从局域网 接 收帧

3 . 3 .2  CSMA/CD 协 议

一

最 早的以 太网是 将许多计算机都 连接 到

“

根 总线上。 当初认为这种 连

接方 法 既简单 又可 靠， 因为在 那个时代普 遍 认为：
一

＂

有 源器件不可 靠， 而 无

视频讲解

源的电缆线 才是最可 靠的
总线的特点是： 当

。
台计算 机发送数 据 时， 总线上的所有计算 机都能 检 测 到这个数 据。

一

这种就是 广播通信方式。 但我们 并不 总是要在 局域网上进行

一

一

一

上 实现

对

的通信， 可以使每

台计算 机的 适配器都 拥有

一

对多的 广播通信。 为了在 总线
个与 其 他适配器都不同的地 址。

在发送数 据 帧时， 在 帧的首部 写 明接收 站的地 址。 现在的电子 技术 可以很 容 易 做 到： 仅当数

一

据 帧中的目的地 址与 适配器ROM中 存放的硬件地 址
适配器 对不是发送给自 己的数 据 帧就 丢 弃。 这样， 具有广播特性的 总线上就 实现了
“

” “

” “

“

”

”

致时， 该 适配器 才能接收这个数 据 帧。

对

的

一

一

通信。

人们也常把 局域网上的计算 机称为

主机

工 作站

站点

或

站

。 在本 书中， 这

几个名词都可以当成是同义 词。

一

为 了通信的 简 便， 以 太网 采 取了以 下两种 措施：

第

， 采用较为 灵 活的 无连接的 工作 方式， 即不必先 建 立连接就可以 直接发送数 据。

适配器 对发送的数 据 帧 不进行编号， 也不要求对方发回 确认。 这样 做可以使以 太网工作 起来

非常 简单， 而 局域网信道的 质量 很 好， 因 通信 质量不 好产生差错的概率是很 小的。 因此， 以

太网提 供的 服 务 是 尽 最 大 努 力 的交付 ， 即 不可靠的交付。 当目的 站收到有 差 错的数 据 帧时
（例如， 用 CRC 查 出有差错 ）， 就把 帧 丢 弃， 其 他什么也不 做。 对有差错帧是否需要重传则
些数 据。 于 是

由 高层 来决定。 例如， 如 果高层使用 TCP协议， 那么 TCP就 会发现 丢 失了

一

一

经过

定的时间后， TCP就把这些数 据重 新传 递给以 太网进行重传。 但 以 太网并不知道 这

是重传帧 ， 而 是 当 作新的 数据 帧来发送。

一

一
我们知道， 总线上 只要有

一

时 间 只 能 允许

在同
据被 破坏。 因此， 如 何协调 总线上 各计算 机的 工作就是以 太网要解 决的

台计算机在发送数 据， 总线的传输 资 源就被 占用。 因此，
台计算机发送 数据， 否则 各计算 机之间就 会 互相 干 扰， 使 得所发送数

一

一
个重要 问题。 以 太

网采用最 简单的 随机接 入， 但有很 好的协议用来 减少冲 突发 生的概率。 这 好比有

屋子的人

在开讨论 会， 没有 会议 主 持人 控制 发 言。 想发 言的 随时可发 言， 不需要 举手示意。 但我们还

必须有个协议来协调 大 家的发 言。 这就是： 如 果你 听见有人 在发 言， 那么 你就必须等别人 讲

一
完了 才能发 言（ 否则就 干扰 了别人的发 言 ）。 但有时 碰巧两个或更多的人同 时发 言了， 那么

旦发 现冲 突， 大 家都必须立即 停 止发 言， 等 听 到没有人发 言了 你再发 言。 以 太网 采用的协

•  8 7  •

调方 法和上面的 办法非常 像， 它使用的协议是 CSMA/CD, 意 思是载波 监 听 多点接入／碰撞
检测(Carrier Sense Multiple Access with Collision Detection)。

第二， 以 太 网发送的数据都使用 曼彻斯特 (Manchester)编码的信号。 我们在 第 2 章的

2.2.2 节中 已经 简单 地 介绍过 曼彻斯特编码了。 我们 知道， 二进制基带数字信号通常就是高 、

一

低电压交替出现的信号。 使用这种信号的最 大 问题就是当出现

长 串 连续的 1或 连 续的 0 时 ，

接收端就 无法从收到的比特 流中提取位同步（ 即比特同步 ） 信号。 如图 3-16 所 示， 曼彻斯

一

一

一

特编码的编码方 法是把每

“

”

个 码元 再分成两个相等的间 隔。 码元 1是前
“

”

一

后

个间 隔为高电压。 码元 0 则正好相反， 从 高电压变到低电压 （也可采用相反的 约定， 即

个间 隔为低电压 而

一

l是

前高 后低

而 0 是

前低 后高

)。 这样就 保证了在每

个比特的正中间出现

的转换， 而接收端就 利用这种电压的转换很方 便地把位同步信号提取出来。 但是从 曼 彻斯特

编码的 波 形图也 不 难看出 其 缺 点， 这就是它 所 占的频带 宽度比原 始的基带信号 增 加了

倍

次电压
一

（ 因为每 秒传送的 码元数 加 倍了 ）。

，

，

比特流

曼彻斯特

差分曼彻斯特

：

}

，

:

：

1
: 0 : 0 : 0 :
:
}

: 二:  :  :  :

}

，

  。 1

,
＇
＇
，
'

1

图3- 1 6 曼彻斯特编码

下面介绍 CSMA/CD协议的要点。

“

＂

”

”

线 上。 协议的 实 质是

＂
载 波 监 听

和

”

碰撞检测 "。

多点接入

就是说明这是 总线 型 网络， 许多 计算机以多点接入的方式 连接在

“

”

＂

一

根 总

载波 监听

“
也就是

”

边发送 边监听

。 这 里必须指出， 在通信 领域， 在 大多数情况下 ，

＂

”

Carrier的 标 准 译 名是
”

Carrier有多种意 思， 如

“

“
载 波
“

” “

”

“

。 但对千以 太网， 总线 上 根本没有什么

载波

。 其 实 英语

”

”
承 运 器

传 导 管

或

“
运 载工具

”

等。 因此在以 太 网中， 把

Carrier 译为

载体

或

媒体

可能更 加 准确些。 考虑到

载 波

这个 译 名 已经在我 国广

泛流行 了好 几 十年 ， 本 书也就 继 续使用这个 不准确的 译 名。 我们 知道， 载 波 监 听就是 不管在

想要发送 数据 之前 ， 还是在发送 数据 之 中 ， 每个站 都必须不停地检测信道 。 在发送 前检测信

道， 是为了 避 免冲 突。 如 果 检 测出 已经有 其他站在发送， 则本 站就 暂时 不要 发送数据。 在发

送中 检测信道， 是为了及时发现如 果有 其他站也在发送， 就 立 即中 断本 站的发送。 这就称为
碰撞检测。“

”

碰撞检测

是 适配器 边发送数据 边检测 信道 上的信号电压的变化情况。 当两个或 几

个 站 同时 在 总线 上 发送数据时， 总线 上的信号电压变化 幅 度将 会增大（ 互相 叠 加）。 当适配

一

器 检测到的信号电压变化 幅 度 超过

“

”

“
定的 门 限 值时， 就 认为 总线上 至少有两个 站同时在发送

“

”

＂

数据， 表明产生了 碰撞。 所 谓

碰撞

就是发 生了 冲 突。 因此

碰撞检测

也称为

冲 突检

一

一

测

。 这时， 总 线上传输的信号产生了 严重的 失 真， 无法从 中恢 复出有用的信息来。 因此，

任何

个 正在发送数据的 站，

“
得 继 续进行 无 效的发送， 白 臼 浪 费 网络 资源， 然后等 待

一

段随机时间 后再 次发送。

旦发 现 总线上出现了 碰撞， 其适配器就要 立 即 停 止发送， 免
＂

一

既 然每

个 站 在发送数据之前 已经 监 听到信道为

空 闲

， 那么为什 么 还会出现数据在

总线 上的 碰撞 呢 ？ 这是 因为电磁 波 在总线上 总是以有 限的速 率传 播的。 这和我们 开讨论 会时

•  8

8   •

相似。 一 听见会场 安 静 ， 我们就立即发言， 但偶 尔 也会发生几个人 同 时抢着发言而产 生冲 突
的情况。 图3-17 所示的例子可以说明 这种情况。 设图中的局 域网两 端的站A和B相距 1 k m,
用 同 轴 电 缆相连。 电磁波在 1 k m 电缆的传播时延约 为 5 µ s （这个数字应当 记住）。 因 此， A
向 B发出的数据， 在约 5 µ s 后才能传送到B。 换言之 ， B若在A发送的数据到达B之前发
送 自 己的帧（ 因为这时B的载波 监 听 检测不到A所发送的信 息）， 则必然要在某个时间和A
发送的帧发生碰撞。 碰撞的结果是两个帧都变得无用。 在局 域网的分析中， 常把总线上的单
程端到 端传播时延记为r。 发送数据的站 希 望 尽 早 知 道 是 否发生 了 碰撞。 那么， A 发送数据
后 ， 最 迟要经过多长时间才能知 道 自 已发送的数据和其他站发送的数据有没有发生碰撞？从
图3-17 不 难看出， 这个时间最多是 两倍的 总 线端到 端 的 传播时延(2 i) ， 或总线的端到 端往返
传播时延。 由 千局 域网上任意 两个站之间的传播时延有长有短， 因 此局 域网必须 按最坏情况
设计 ， 即取总线两 端的两个站之间的传播时延（这两个站之间的距离最大） 为端到端传播时
延。

t = O   --

1  km

t

＂
t = 2, — 8 -

`；五 尸］户
丿

丿
丿

t = 2, - 8 ｀f； 国三三

丿
户 工
气
三
尸

t = t - 8
B 检测 到 信道 空 闲
发 送数据
t = , - 8 / 2

发生碰撞
t = '[

B 检测 到 发生碰撞
停 止 发送

图3- 1 7 传播时延对载波监听的影响

显 然 ， 在使用 CSMA/CD 协议时 ， 一个站 不 可 能 同 时进行发 送 和 接收 （ 但必须边发 送
边监听信道 ） 。 因 此使用 CSMA/CD 协议的以太网不 可能进行 全双工通 信而只能进 行 双 向 交
替通信（半双工通信）。

下面是 图 3-17 中的一 些重要的时刻。
在 t = 0 时 ， A发送数据。 B检测到信 道为空 闲 。
在 t =  r - 8 时（这里 r > 8 > 0) , A发送的数据还 没有到达B时 ， 由 千B检测到信 道 是

空 闲 的 ， 因 此B发送数据。

经 过时间 8 /2 后 ， 即在 t =  r  - 8/ 2 时， A发送的数据和B发送的数据发生 了 碰撞 ， 但

这时A和B都不 知 道发生 了 碰撞。

在 t = r 时 ， B检测到发生 了 碰撞 ， 于 是 停 止发送数据。
在 t =2 r - 8 时， A也检测到发生 了 碰撞 ， 因而也停 止发送数据。
A和B发送数据均 失 败 ， 它们都要推迟 一段时间再重新发送。

•  89  •

一

一

由此可 见， 每 一 个 站在 自 已发送 数据 之后的

一

小 段 时 间 内 ， 存 在 着 遭 遇 碰撞的 可能 性。

这

小段时 间是 不确定的， 它 取 决 千 另

一

一

个发送数据的 站到本 站的 距离。 因此， 以 太网 不能

保证在检测到信道 空 闲 后的 某

一
时 间 内，

定能够把自 己的数据 帧成 功地发送出 去（ 因为 存

在 产生 碰撞的可能）。 以 太 网的这

特点称为发送 的 不确 定 性。 如 果 希 望在以 太网 上发 生 碰

撞的机 会很 小， 必须使 整个以 太 网的平 均通信量 远 小 千以 太网的最高数据率。

从图3-1 7可看出， 最 先 发送数据 帧的 A 站， 在发送数据 帧后 至 多经过时间 正 就可知道

所发送的数据 帧是 否遭 受了 碰撞。 这就是 6 --0 的情况。 因此以 太网的端到端往 返时间 江 称
个 很重要的 参数。 争用 期 又称为 碰 撞 窗 口(collision
为 争 用 期(contention period)， 它是
window)。这 是 因为

个 站在发送 完数据 后， 只有通过 争用 期的

， 即 经过争用 期 这

考验

一

一

“

”

一

段时 间 还没有检测 到碰撞 ， 才能 肯定这次发送 不会发生 碰撞。 这时， 就 可以放心把这

帧数

据顺利发送完 毕。

以 太网使用 截断二进制 指 数退避(truncated binary  exponential  backoff)算法来确定 碰撞后

重传的时机。 截 断 二进制指数 退 避 算法并不复杂。 这种 算法 让发 生碰撞的 站在 停 止发送数据

一

后， 不 是 等 待信道 变为 空 闲 后就 立 即再发送数据 ， 而是 退避

个随机的时间 。 这点很容 易 理

解， 因为几个发 生 碰撞的 站将 会同时 检测到信道 变成了 空 闲。 如 果大家都同时重传， 必 然接

连 发 生碰撞。 如 果采用 退 避 算法， 生成了最 小 退 避时间的 站将最 先获发送 权。 以 后 其 余的 站

的 退避时间到了， 但发 送数据之前 监 听到信道 忙， 就不 会 马上发送数据了。

为了尽可能减 小 重传时再 次发 生 冲 突的概率， 退 避 算法有如下具体的规定：

( I ) 基 本退 避时间 为 争用 期 2 r, 具体的 争用 期时 间 是 51 .2 µs。 对千 10 Mbit/s以 太网，
在 争 用期内 可发送 51 2比特， 即 64字 节。 也可以说 争用 期是 512 比特 时 间。 1比特时间就

是 发送 1比特所 需的时 间。 所以这种 时间单位与数据率 密切相关。 为了方 便， 也 可以 直接使
用 比特 作 为 争用 期的单位。 争用 期是 51 2比特， 即 争用 期是发送 512比特所 需的时间。

一

k

(2) 从离散的 整数 集 合 [O, I , … ， （2

-1) ］中随机 取出

个数， 记为 r。 重传 应 推 后的时间就

是 r 倍的 争用 期。 上 面的参数 K按下 面的公式(3-1 )计算：

k = Min［重传 次数 ， 1 O]

(3 -1)

可 见 当重 传 次数 不 超过 10 时， 参数 K 等于重传 次数 ； 但 当 重传 次数 超过 10 时， K就不

一

再 增 大 而

直 等于 10。

(3) 当 重传达 1 6 次仍不能成 功时（这表明同时 打 算发送数据的 站 太 多， 以 致连 续发 生

冲 突）， 则 丢 弃 该 帧， 并向高层 报 告。

一

例如， 在 第 1 次 重传时， k =  1 , 随机数 r 从整数 {O, 1 }中 选

一

个数。 因此重传的 站可 选

择的 重传 推迟时间 是0 或 2 r, 在这 两个时间中随机 选择

个。

若 再 发生 碰撞， 则 在 第 2 次重传时， k =  2 , 随机数 r就从 整数 {O, 1 ,   2,  3 }中 选

一

因此 重传 推迟的时间是在 0 , 2 r.， 士和 6 r这 4个时 间中随机地 选取

个。

一

个数。
一

同样， 若 再发 生 碰撞， 则 重传时 k =  3 , 随机数 r就 从 整数 { O, 1 , 2, 3 , 4, 5 , 6, 7 }中 选

个

数。 依此类 推。

若连 续 多 次发 生 冲 突， 就表 明可能有较 多的 站参与 争用信道。 但使用 上述 退 避 算法可

使重 传 需 要 推 迟 的 平均时间随 重传 次数 而 增大（这也称为 动 态退避）， 因 而 减 小发 生 碰撞的

概率， 有 利 千 整个 系统的 稳定。

一

一

我们还 应注意到， 适 配器 每发送

个 新的 帧， 就要 执行

次 CSMA/CD 算法。 适 配器

•  90

•

对过 去发 生过的 碰撞并 无记 忆功能。 因此， 当好几个 适配器 正 在 执行指数 退 避算 法时， 很可

一

能有某

个 适配器发送的 新帧能够 碰 巧 立 即成 功地插入到信道中， 得到了发送 权， 而 已经 推

迟好几 次发送的 站， 有可能很 不 巧， 还要 继 续 执行 退避算 法 ， 继 续 等 待。

一

一

现在考虑

种 情况。 某个 站发送了

个很 短的 帧， 但 在发送 完 毕之前并没有 检 测出 碰

撞。 假 定这个 帧 在 继续向前传 播到达目的 站之前和别的 站发送的 帧发 生了 碰撞， 因 而目的 站

将 收到有 差 错的 帧 （当然 会把它 丢 弃）。 可 是发送 站 却 不知道这个 帧发 生了 碰撞， 因 而 不 会

一

重 传这个 帧。 这种 情况显 然是我们所 不 希 望的。 为了 避 免发 生这种 情况， 以 太网规定了

一

个

最 短 帧 长 64字 节， 即 512比特。 如 果要发送的数据 非常 少， 那么必须加入
使 帧 长 不 小千 64字 节。 对于 10 Mbit/s以 太网， 发送 512比特的时间 需要 51.2 µs, 也就 是

些 填 充字 节，

上 面 提到的 争用 期。

由此可见， 以 太网 在发送数据时， 如 果在 争用 期（ 共发送了 64字 节） 没有发 生 碰撞，

一

一

一
那么后 续发送的数据就

定 不 会发 生 冲 突。 换 句话说， 如 果发 生 碰撞， 就

一
定是在发送的前

64字 节之内。 由千

检测到 冲 突就 立 即中 止发送， 这时 已经发送出去的数据

定 小千 64字

节， 因此 凡长度 小 千 64 字 节的 帧都是 由 于冲突而异 常 中 止的 无效帧。 只要 收到了这种 无效

帧， 就 应当立 即将 其 丢 弃。

前 面 已经 讲过， 信号在以 太网 上传播 1 km 大 约需要 5 µs。 以 太网上最 大的端到端时 延

一

半 （ 即 25 .6 µs )， 这相当千以 太网的最 大端到端 长度 约 为 5 km。 实 际上
必须小千 争用 期的
的以 太网 覆盖范围 远远没有这样 大。 因此， 实用的以 太网都能在 争用 期 5 1 .2 µs内 检测到可

能发 生的 碰 撞。 以 太网的 争用 期确 定为 51.2 µs , 不仅考虑到以 太网的端到端时 延， 而 且还

包括 其 他的许多因素， 如 存在的转发器所 增 加的时 延， 以及下 面要 讲到的强 化 碰撞的 干扰信

号的 持 续时间 等。

一

下 面介绍 强化碰撞的概念。 这就 是 当发送数据的 站

旦发 现发 生了 碰 撞时， 除 立 即 停

止发送数据外， 还要 再 继 续发送 32比特或 48 比特的 人 为 干 扰信号 (jamming signal)， 以 便 让
所有用户都知道现在 已经发 生 了 碰撞（如图 3-18 所 示）。 对千 10 Mbit/s以 太 网， 发送 32
（或 48 )比特 只需要 3 . 2 （或 4.8 ) µs。

-----------------------------------l

图3- 1 8 人为干扰信号的加 入

从图 3-18 可以看出， A 站从发送数据 开始到发现 碰撞并 停 止发送的时间间 隔 是 T

。 A

站 得知 碰撞 已经发 生时所发送的强 化 碰撞的 干扰信号的 持 续时间 是 TJ。图中的 B 站 在 得知

B

发 生 碰撞后， 也要发送人为 干扰信号， 但为简单 起见， 图3-18 没有 画出 B 站所发送的人为

B

1

一

干扰信号。 发 生 碰撞使 A 浪 费时间 T

+ T

。 可 是 整个信道被 占用的时间 还要 增 加

个单 程

端到端的传 播时 延 r。 因此 总线被 占用的时间 是 TB + T.尸 r。

•  91  •

以太网还规定 了 帧 间 最 小 间 隔为 9.6 µ s , 相当 于 96 比特时间。 这样做是为了 使刚刚 收

到数据帧的站的接收缓存来得 及清理， 做好接收下一 帧的准 备。

根据以上所讨论的， 可以把CSMA/CD 协议的要点归 纳如下：
( 1)准 备 发送： 适配器从网络层获 得 一个分组， 加上以太网 的首部和尾部（见后面的

3.4.3 节）， 组成以太网 帧， 放入适配器的缓存中。 但在发送之前， 必须 先检测信道。

(2)检测信 道： 若检测 到 信 道忙， 则 继续不停地检测， 一 直等待信 道转为空 闲 。 此时若

在 96 比特时间内信 道保持空 闲 （保证 了 帧间最小间隔）， 就发送这个帧。

(3)在发送过程中仍不停地检测信 道， 即网络适配器要边 发 送边监听。 这里只有两 种可

能性：

CD发送成功： 如果在争用期内一 直 未 检测到碰撞， 就 认为发送成功（如果接收方收到
了 有差 错的帧， 就 丢 弃 它 ， 后续的工 作 由 高 层来处理）。 发送完 毕后， 其他 什么也 不做。 然
后回到( 1)。

＠发送 失 败： 在争用期内检测到碰撞。 这时立即停 止 发送数据， 并按 规定发送人为干

扰信号。 适配器接着就执行指数退避算法， 等待 r 倍 512 比特时间后， 返回到步骤(2)， 继
续检测信道。 但若重传达 16 次仍不能成功， 则 停 止 重传而向上报错。

以太网 每发送完一 帧 ， 一定要把 已发送的帧 暂时保 留 一 下。 如果在争用期内检测出发

生 了 碰撞， 那么还要在推 迟一段时间后再把这个暂时保 留的帧重传一次。

3 . 3 . 3   使用 集线 器的星 形 拓 扑

传统以太 网 最 初使用粗 同 轴 电 缆 ， 后来演 进到使用比较便 宜 的细 同 轴 电 缆， 最后发展
为使用更便宜和更 灵活的双绞线。 这种以太网采用星 形拓 扑， 在 星 形的中心 则 增加 了 一种可
靠性非常高的设备， 叫 作 集线器( hub)， 如图 3-19 所示。 双绞线以太网总是和集线器配合使
用的。 每个站 需要用两 对无屏 蔽 双 绞线（放在一 根 电 缆内）， 分别用于发送和接收。 双 绞 线
的两 端使用R J-45 插 头。 由 千集线器使用了大规模集 成 电 路芯 片， 因 此集线器的可靠性就大
大提高 了 。 199 0 年 IEEE 制定出星 形以太网 lOBASE-T 的标准 8 02.3i。 ”1O " 代表 10 Mbit/s

的数据率， BASE 表 示 连接线上的信 号 是基带信 号， T 代表双 绞线。 实践证明 ， 这比使用具
有大量机械接头的无源电缆要可靠得 多。 由 于使用双 绞线电缆的以太网价格便宜和使用方便 ，
因 此粗 缆和细缆以太网 现在都 已 成为历 史， 并已从市场上消 失 了 。

站 点

集线器 ／ RJ-45 插头

两 对双绞线

图3- 1 9 使 用 集线器的双绞线 以 太 网

但 lOBASE-T 以太网 的通信 距 离 稍 短， 每个站到集线器的距 离 不超过100 m。 这种性价
比很高的 lOBASE-T 双绞线 以太网 的 出 现 ， 是局域 网 发 展 史上的 一个非 常重要的 里程碑， 从
此以太网的拓 扑就从总线型 变为更加方便的星 形网络， 而以太网也就在 局 域 网 中 占 据 了 统治
地位。

•  92  •

使双 绞线能够传送高速数据的主 要措 施 是把双 绞 线的绞 合度做 得 非常精 确 。 这样 不 仅
可使特性 阻抗均 匀 以减少失 真， 而且大大减少 了 电磁波辐射和无线电频率的千扰。 在多对双
绞线的 电缆中， 还要使用更加复 杂的绞 合方法。

集线器的一 些特点如下：
(1)从表面上看， 使用集线器的局 域网在物理上是一个星 形 网， 但 由 千集线器使用 电子
器件来模拟实际 电 缆线的工 作 ， 因 此整个系统仍像一个传统以太网那 样 运行。 也就是说， 使
用 集 线 器 的 以 太 网 在 逻 辑 上 仍 是 一 个 总 线 网 ， 各 站 共 享 逻 辑 上 的 总 线 ， 使 用 的 还 是
CSMA/CD 协议（更 具体些 说， 是各站中的适配器执行 CSMA/CD 协议）。 网络中的各站必
须 竞 争对传输媒体的控制， 并且在 同 一时刻至 多 只 允许一个站发送 数据。

(2)一个集线器有许 多端 口 G)

' 例如， 8 至 16 个， 每个端 口 通过R J-45 插 头（与 电 话 机
使用的插 头 R J-11 相似， 但略大一 些） 用两对 双 绞线与一台计算机上的适配器相连（这种插
座 可连接 4 对双绞线， 实际上只用 2 对， 即发送和接收各使用一对双绞线）。 因 此， 一个集
线器很像一个多端 口 的转发器。

(3)集线器工作在物理层， 它 的每个端 口 仅仅 简 单地转发 比特 收到1 就转发 1 , 收
到 0 就转发 O, 不 进行碰撞检测。 若两个端 口 同时有信 号 输入（即发生碰撞）， 那么所有的
端 口 都将收不到正确的帧。 图3-2 0 是具有 三个端 口 的集线器的示意图。

图3-20 具有三个端 口 的集线器

(4)集线器采用 了 专 门 的芯 片， 进 行 自 适应 串 音回波 抵 消 。 这样就可使端 口 转发出去的

较强信 号 不致对该端 口 接收到的较弱 信 号 产 生干扰（这种干扰即近端 串 音）。 每个比特在转
发之前还要进行再生整形并重新定时。

集线器本身必须 非常可靠。 现在的堆叠式( stack able)集线器 由 4~8 个集线器堆叠起来使
用 。 集线器一 般都有少量的容错能力和网络管理功能。 例如， 假定在以太网中有 一个适 配器
出了 故障， 不停地发送以太网帧。 这时， 集线器可以检测到这个问题， 在内部断开 与出故 障
的适配器的连线， 使整个以太网仍然能够正常工作。 模块化的机箱 式 智 能集线器有很 高的可
靠性。 它 全部的网络功能都以模块方式实现。 各模块 均 可进 行 热插拔， 出故 障时不 断 电即可
更换或增 加新模块。 集线器上的指示灯还可显示网络上的故 障情况， 给网络的管理带来了 很
大的方便。

IEEE  8 02.3 标准还可使用光纤 作为传输媒体， 相应的标准是 lOBASE-F 系列， F 代表光

CD 注： 集 线 器的端 口

(port)

就 是 集线 器 和 外接计算机的

个 硬 件 接 口

一

( interface)

。 在运 输 层 要 经 常 使 用 软件端 口

(port)

， 它 和

集 线 器的硬件端 口 是两 个 不 同 的概念 。 本 书 以 前 曾 把集线器的硬件端 口 称 为接 口 ， 是 为 了 避免和运输层的端 口 弄混 。 考虑 到 大 多

数 文 献 使 用 的是

port,

因 此现在改用 译 名

端 口

“

”

。

•  93  •

纤 。 它 主要用作 集线器之间的 远程连接 。
3 . 3 .4  以 太 网 的信道利 用 率

一

一
下面我们讨论

下以 太网的信 道利用率 。

假 定

个 10 Mbit/s以 太网 同时有 10 个 站在工作， 那么每

扫 一扫

f .

熙贾目
月匕 惑$
．心 ．石

抵池牲

视频讲解

一

j
个 呫所 生

发送数据的 平 均速率 似 乎应当是 总数据率的 1/10

（ 即 1Mbit/s ) 。 其实 不 然，

因为 多个 站在以 太网 上同时 工作就可能 会发 生碰撞 。 当发 生碰撞时， 信 道 资源实 际上是被 浪
一

费了 。 因此， 当扣 除碰撞所 造成的信 道损 失后， 以 太网 总的信 道利用率并 不能达到 10 0 %。
个 站在发送 帧时出现了 碰撞 。 经过

图 3-21 的例子是以 太网的信 道被 占用 的情况 。

一

个 争用 期 2 T后 ( T是以 太网 单程端到端传 播时 延）， 可能 又出现了 碰撞 。 这样 经过 若 干个 争

用 期后， 一个 站就发送成 功了 。 假 定发送 帧需要的时间是 To 。 它等千 帧长 (bit) 除以发送速率

( 10  Mbit/s ) 。

发 生 碰 撞

—、

I

占 用 信 道 时 间

！ 争 用 期 ｝ 争 用 期 ｝
，

. . .

: 争 用 期
2 T

To

一

发 送

帧 所 需 的平 均 时 间

图 3-2 1 以 太 网的信道被 占 用 的情况

一

一

我 们 应当注意 到， 成 功发送

个 帧需要 占用 信道的时间是 T。 + t， 比这个 帧的发送时间

一

一

要多

个 单程端到端时 延 T。 这是 因为 当

一
个 站发送 完最后

个比特时， 这个比特 还要在以

一

太网上传 播 。 在最极端 的情况 下， 发送 站在传输媒体的

端， 而比特在媒 体上传输到另

端

所需的时间是 t。 因此， 必须在经过时间 T。 + T后以 太网的媒体 才 完 全进入 空 闲状 态， 才能

允 许 其 他站 发送数据 。

从图 3-21可看出， 要 提高以 太网的信 道利用率， 就 必须减 小 T与 几之比 。 在以 太网中

定义了 参数 a, 它是以 太网单程端到端时 延 T与 帧的发送 时 间 T。之比：

T-

＿

＿

a

。

T

(3-2)

--

一

当 a
一

0 时， 表示 只要

发 生碰撞， 就 立 即可以 检测出来， 并 立 即 停 止发送， 因 而信 道
资源被 浪 费的时间非常非常 少 。 反之， 参数 a 越大， 表 明 争用 期所 占的比例 越大， 这就使 得
每发 生
次碰撞就 浪 费了 不 少的信 道 资源， 使 得信 道利用率明显 降低 。 因此， 以 太网的 参数
a 的 值应 当 尽 可能 小 些 。 从 （3-2)式可看出， 这就要 求(3-2)式分子 T的数 值要 小些， 而分 母 T。
的数 值要 大 些 。 这就是说， 当数据率

定时， 以 太网的 连线的 长 度 受 到 限制（ 否 则 T的数 值

一

会 太大）， 同时 以 太网的 帧长不能 太 短（ 否 则 To的 值 会 太 小， 使 a 值太大） 。
一

一

现在考虑

种 理想 化 的情 况 。 假 定以 太网上的各 站发送数据都 不 会产生 碰 撞（这显 然
种特 殊的调 度方 法）， 并 且能够非常有效地利用网络
个 站立 即发送数据 。 这样， 发送

帧 占用线路的时间
Smax

旦空 闲就有 某

一

一

一

已经 不是 CSMA/CD, 而 是 需要使用

的传输 资源， 即 总线

是 T。 + T， 而 帧本身的发送时间 是 To 。 于是我们可计算出 极限信 道 利用率

为 ：

•  94  •

s

max

T
飞 ＋ r

l+ a

(3-3)

(3-3)式的意义是： 虽 然实际的以太网不可 能有这样 高的极 限 信 道利用率 ， 但(3-3)式指
出了 只 有 当 参数 a 远 小 千 l 才能得到尽可能 高 的 极 限信道利 用 率。 反之， 若参数 a 远大于 l
（即每发生 一次碰撞 ， 就要浪 费 相 对较多的传输数据的时间） ， 则 极 限 信 道利用率就 远 小 千
l ， 而这时实际的信 道利用率就更 小 了 。 据统计 ， 当 以太网的利用率达 到 3 0％时就 已 经 处 千
重 载的情况。 很 多的网络容量被网 上的碰撞消耗掉 了 。

3 .3 .5  以 太 网 的 MAC 层

1 .  MAC 层 的硬件地址

在局 域 网 中， 硬件地址又称为物理地址或 MAC 地址（因 为这种地址用

在 MAC 帧中）。

视频讲解

大家 知 道 ， 在所有计算机系统的设计中， 标识系统(identification sy stem)(i)都是一个核 心
问题。 在标识系统中 ， 地址就是识 别 某个系统的一个非常重要的标识 符 。 在讨论地 址问题
时， 很 多 人常常引 用 著 名 文献 [SHOC78] 给 出 的 如 下 定 义 ：

“ 名 字 指 出 我们 所 要寻找 的 那 个 资源 ， 地址指 出 那 个 资源在何处 ， 路 由 告诉我们 如 何

到 达该处。 ”

这个非形式的定义 固 然很简 单 ， 但有时 却 不够准 确 。 严格地讲 ， 名 字应 当 与 系统 的 所
在 地 无 关 。 这就像我们每一个人的名字一 样 ， 不随我们所处的地点而改 变。 为此 IEEE 8 02
标准为局 域 网规定了 一种 48 位的全球地址（一般都简 称为 “ 地址 ” ) ， 这就是局域网上的每
一台计算机中固 化在适配器的R OM 中 的 地址。 因 此， 请特别注 意 下 面 两 点：

(1)假定连接在局 域网上的一台计算机的适配器坏 了 而我们更换了 一个新的适配器 ， 那
也 就 改 变 了 ， 虽 然这台计算机的地理位置一点也没有变化 ，

么这台计算机的局 域 网 的 “ 地址 ”
所接入的局 域网也没有任何改变。

(2)假定我们把位 于 南 京的某局 域网上的一台笔 记 本 电脑携带到北 京 ， 并连接在北京的
某局 域网上。 虽然这台 电脑的地理位置改变了 ， 但只要 电脑中的适配器不变 ， 那么该 电脑在
北京的局 域网中的 “ 地址 ” 仍然和它 在南京的局 域网中的 “ 地址 ” 一样。

“

由 此可见 ， 局 域 网 上的某台主机的 “ 地 址 ” 并不指明 这台主机位 千 什么地方。 因 此 ，
或标识符 [PER LOO] 。 不过， 计算
严格 地讲 ， 局 域 网 的
机的名字通常都是比较适合人记忆的不太长的字符 串 ， 而这种 48 位 二 进制的 “ 地址 ” 却 很
不像一 般计算机的名字。 但现在人们还是习惯 于把这种 48 位的 “ 名字 ” 称为 “ 地址 ”。 本书
也采用这种习惯用法， 尽 管这种说法并不严格。

应 当 是 每 一 个 站 的

名 字

地址

”

“

“

请 注 意 ， 如 果 连接在局 域 网上的主机或路 由 器安 装有多个适 配器 ， 那 么 这样的主机或

路 由 器就有多个 “ 地址 ＂。 实际上 ， 这种 48 位 “ 地址 ” 应 当 是某个接 口 的标识符。

也 注 ： 名 词 咖ntification 原 来 的 标 准 译 名 是 “ 标 识 ” [MINGCI94] 。 2004 年 出 版 的 《现代汉 语 规 范 词 典 》 给 出

读 音 是 “ biaozhi

（ 读 音 是 “ 志

”

) ， 并 且 说 明 ： 现 在 规 范词 形 写 作

“

标 志 ”

。 现 在 教 育 部 国 家 语 言 文 字 工 作 委 员 会 发 布

“

“

”

标 识

的

第 一 批异

形 词 整理表

”

规 定 今后 不 再 使 用

“

标 识

”

而应 当 用

“

标 志

”

。 但 [MINGCI94] 又将 flag 译 为 “ 标 志 ”。 这 样 ， 若 identification 和 flag

均 译 为 “ 标 志

”

就 会 引 起 混 乱 。 因 此 ， 本 书 采 取 这 样 的 做 法 ： 作 为 动 词 用 时 ， 我 们 使 用

“

标 志

”

， 但 作 为 名 词 使 用 时 ， 我 们 用

“ 标 识

” (identification)和 “ 标 志 ” (flag) 。 请 读 者 注 意 。

•  95  •

在制定 局域网的地 址 标准时， 首先 遇到的 问题就 是 应 当用多 少位来表示

个网络的地

一

址字段。 为了 减少 不必要的开销， 地 址字段的 长度 应 当尽可能地 短些。 起初人们 觉 得用 两个
字 节（ 共 16位 ）表示地 址就够了， 因为这

共可表示 6 万多个地 址。 但 是， 由于 局域网的

一

迅速发 展， 而处在 不同地点的 局域网之间 又 经常需要交换信息， 这就 希 望在各地的 局域网中

的 站 具有 互不相同 的物理地 址。 为 了使用户在 买到 适配器 并把机器连到 局域网后 马 上就能 工

一

作， 而不需要 等待网络 管理 员给 他先分 配

个地 址， IEEE 80 2 标准规定 MAC地 址字段可采

一

用 6字 节 ( 48 位） 或 2字 节 ( 1 6位 ） 这 两 种中的

种。 6字 节地 址字段 对 局部范 围 内使用

的 局域网的确 是 太 长了， 但是 由 千 6字 节的地 址字段可使 全 世界 所有的 局域网 适配器都 具有

不相同的地 址， 因此 现在的 局域网 适配器实 际上使用的都 是 6字 节 MAC地 址。

现在 IEEE的 注册管理机构RA(Registration  Authority) 是局域网 全 球地 址的 法定 管理机

构 [W-IEEERA]， 它 负 责分 配地 址字段的 6个字 节中的前 三个字 节 （ 即高位 24位）。 世 界上

凡要 生产局域网 适配器的 厂家都必须 向 IEEE 购 买 由这 三个字 节构成的这个号（ 即地 址 块 ），
这个号的 正式名称 是组织唯一标识符 OUI(Organizationally  Unique Identifier)， 通常也叫作 公
司 标识符(company_id)
因为

个公 司可能 购 买了 几个 O UI， 也可能有 几个 小公 司 合 起来 购 买

[RFC  70 42]。 但 应 注意， 24位的 OUI不能够单 独用来 标 志

个 OUI。 例如， 华

个公 司，

一

一

一

一

为公 司 购 买了多个 OUI， 其中的

位 ） 则 是 由 厂家 自行指 派， 称为 扩展标识符(extended identifier)， 只要 保证生产出的 适配器

个 是 A8 -E5-44气 地 址字段中的后 三个字 节（ 即低位 24
24

一

没有重复地 址 即可。 可 见购 买了

个 O UI， 就可以 生成出 2

个不同的 6 字 节 ( 48 位 ）

MAC地 址， 这 种地 址又称为 E UI-48 , 这里 E UI表示 扩展的 唯一标识符(Extended Unique

Identifier)。 E UI-48 的使用范 围 并 不 局 限千 局域网的硬件地 址， 而 是可以用 千 软件接口。 在

生产适配器时， 这 种 6字 节的 MAC地 址 已被 固化在 适配器的ROM中。 因此， MAC地 址

“

“

也叫作 硬件地址(hardware address)或 物理地址 气 可 见
或 适 配器标识符 E UI-48。 当这 种 适配器 嵌入到某 台计算机（或手机 ） 后， 适配器 上的 标识

实 际上就 是 适 配器地址

MAC地 址

符 EUI-48 就成为这 台计算机（或手机 ）的 MAC地 址了。

一

IEEE规定地 址字段的 第

I/G位为 0 时， 地 址字段表示

一
字 节的最低有效位为 I/G位。 I/G表示 Individual/Group。 当
个单个站 地址。 当 I/G位为 1时表示 组地址， 用来进行 多播

一

一

“

“

”

”

一
（以前 曾 译为 组播 ）。 需要指出， 有的 书把上述最低有效位 写为

第

位

一
， 但

第

的定

义 是含 糊 不 清的。 这 是 因为在地 址 记法中有 两 种 标准 ： 第

一

种 记法 是把每

字 节的 最 低 位

（ 即最低有效位） 写在最 左边（ 第

位 ）。 IEEE 80 2.3 标准就采用这 种 记法。 例如， 十进制

数 1 1的 二进制表示是 10 11, 最高位 写在最 左边。 但 若使用 IEEE 80 2.3 标准的 记法， 就 应当

记为 1 10 1, 把 最低位写在 最左边。 当我们 阅读 80 2.3 标准的有关 文档时， 需要特别 注意。 第

一

一

二种 记法 是把每

字 节的 最 高位（ 即最高有效位 ） 写在最 左 边（这也叫 第

位 ）。 在发送数

汴 ： 这 里 的

是 十 六进制 数 字在 局 域 网 地址 中 的 一 种标准记法 。 每

个 二进 制 数 字 用 一 个 十 六进制 数 字 表 示 ，

而 每 两 个 十 六 进 制 数 字 与 它 后 面 的 两 个 十 六进制 数 字之 间 用 连 字 符 隔 开 。 另 一 种 记法 是 在

A8-E5-44

CD

如

4

后 面 写 上 一 连 串 的 十六进制 数 字 ，

Ox

OxA8E544 。

＠ 注 ： 地址有平 面地址(flat address)和层次地址(hierarchical address) 两大类 。 平 面 地址 也 叫 作 非层次地址， 就 是 在 分配 地址
时 按 顺 序 号 一 个 个地挨着 分 配 。 层次地址 是 将 整 个地址 再 划 分 为 几 个 部 分 ， 而 每 部 分 按 一 定 的 规律 分 配 号 码 。 像我们 的 电 话 号 码

就 是 一 种 层 次 号 码 ， 电 信 网 中 的 交换机按照 国 家 号 一 区 号 一 局 号 一 用 户 号 的 顺序可 以 准确地找到用 户 的 电话 。 但 局 域 网 的

字 节

的 地 址 是 一 种 平 面 地 址 。 适配器根据 全 部 的

位地址决定接收或 丢 弃 所 收 到 的 MAC 帧 。

6

48

•  9 6  •

据时， 两 种记法都是按照字节的顺序发送， 但每一个字节中先发送哪 一位 则 不 同： 第一 种记
法先发送最低位， 但第二 种记法则 先发送最 高位 。

IEEE 还考虑到可能有人并不愿 意 向 IEEE 的 RA 购 买 OUI 。 为此，

IEEE 把地址字段第
一字节的最低第二位规定为 G /L 位， 表示 Global/Local。 当 G /L 位为 0 时是全球管理（保证
在全球没有相 同 的地址）， 厂 商 向 IEEE 购 买 的 OUI 都属 于 全球管理 。 当 地址字段的 G /L 位
为1 时是本地管理， 这时用户 可任意分配网络上的地址 。 采用2字节地址字段时全都是本地

管 理 。 但应当 指 出 ， 以太网几乎不理会这个 G /L 位 。

这样， 在全球管理时， 对每 一个站的地址可用 46 位的二进制数字来表示（最低位和最
低第二位均为 0 时） 。 剩下的 46 位 组成的地址 空间可以有 246个地址， 已经超过 7 0 万亿个，
可保证世界上的每 一个适配器都可有一个唯 一的地址 。 当 然， 非无限 大的地址 空间总有用完
的时候 。 但据测算， 至少在近期还不需要考虑 MAC 地址耗尽的问题。

当 路 由 器通 过 适 配器连接到局 域 网时， 适 配 器上的硬件地 址 就 用来标志 路 由 器的某个

接 口 。 路 由 器如果同 时连接到两个网络上， 那么它 就 需要两个适配器和两个硬件地址 。

我们知 道 适配器有过滤功 能 。 当 适配器从网络上每收到一个 MAC 帧 就 先 用硬件检 查
MAC 帧 中的目的地址 。 如果是发往本站的帧则收下， 然后再进 行其他的处理 。 否 则 就将此
帧 丢 弃， 不再进行 其他的处理 。 这样做就不浪 费 主机的处理机和内存 资源了 。 这里 ” 发往本
站的帧 “ 包括以下三种帧：

(1)单播( unica st)帧（一对一）， 即收到的帧的 MAC 地址 与 本站的 MAC 地址相同
(2)广播(b roadca st)帧（一对全体）， 即发送给本局域网上所有站点的帧（全 l 地址）。
(3)多播( multica st)帧（一对多）， 即发送给本局 域网上一 部分站点的帧 。
所有的适配器都至少应当 能够识 别前 两 种帧， 即能够识 别单播和广 播地址 。 有的适 配
器可用编 程方法识别多播地址 。 当 操 作系统 启 动 时， 它 就把适配器初 始 化， 使适配器能够识

别 某些多播地址 。 显 然， 只有 目 的地址才能使用广播地址和多播地址 。

以太网适配 器还可 设置为一种特殊的工 作方式， 即混 杂 方 式( p romi scuou s mode)。 工 作
在混杂方式的适配器只要 “ 听到 “
有帧在以太网上传输就都悄 悄 地接收下来， 而不管这些 帧
发往哪个站 。 请注 意， 这样做实际上是 ＂ 窃 听 “ 其他站点的通信而并不中断其他站点的通信 。
网络上的黑 客( hacker 或 c racker)常利用这种方法非法获取网上用户 的 口 令 。 因 此， 以太网上
的用户 不愿 意 网络上有工 作在混 杂方式的适配 器 。

但混 杂 方式有时却 非常有 用 。 例 如 ， 网络维 护和管理人 员 需要用这种方式来监视和分
析以太网上的流量， 以便找 出 提 高网络性能的具体措施 。 有一种很有用的网络工 具 叫 作 嗅探
器 ( Sniffer)就使用 了 设置为混 杂 方式的网络适配器 。 此外， 这种嗅探器还可帮 助 学 习 网络的
人 员 更好地理解各种网络协议的工 作 原 理 。 因 此， 混 杂 方式就像一把双刃 剑 ， 是利是弊要看
你怎样使用它 。

2.  MAC 帧 的格式

常用的以太网 MAC 帧格式有两 种标准， 一种是 DIX Ethernet  V2 标准（即以太网 V2 标
准）， 另 一种是 IEEE 的 8 02.3 标准 。 这里只介 绍使用得最 多的以太网 V2 的 MAC 帧格式
（如图 3-22 所示） 。 图中假定网络层使用的是 IP 协议 。 实际上使用其他的协议也是可以的 。

•  97 •

广廿

子 兀

6

6

2

I

I

'

目的地址

源地址
- - - - - - - -� - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -1
�

类型

I

I

IP 数据报

IP 层

46 - 1 500

FC勹 MAC 层
1- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - ;  _ _ _ _ _ _ _ _ _ _ _ _  _

� --------------------------------------------- i

I

以太网 MAC 帧

物理层

发
送

7 字节

- - - - - - - - - - l e字贯
l O l O l O l O l O l iI O l O l O l l

l O l O l O l O l O l O l O . ． ．

前 同 步码

帧开始
定界符

图 3 -22 以 太 网 V2 的 MAC 帧格式

以太网 V2 的 MAC 帧较为简单， 由 五个字段组成。 前两个字段分别为 6字节长的 目 的

地址和源地址字段。 第三个字段是2字节的类型字段， 用来标志上一层使用的是 什么协议，
以便把收到的 MAC 帧的数据上交给上 一层的这个协议。 例 如 ， 当 类 型字段的值是 Ox 08 00
时， 就表示上层使用的是 IP数据报。 第四个字段是数据字段， 其长度在46 到 1500字节之
间 (46字节是这样得 出的： 最小长度 64 字节减 去 1 8 字节的首部和尾部就得 出数据字段的
最 小长度）。 最后一个字段是4字节的帧检验序列 FCS（使用 CR C 检验 ）。 当 传输媒体的误
码率为 1 X 10-8 时， MAC 子层可使未检测到的差错 小 千1 X 10-14。 FCS 检 验的范 围 就是整个
的 MAC 帧， 从目的地址开始到 FCS 为止的这五个字段， 但不包括物理层插入的 8 字节的
前同步码和帧开始定界符。

这里我们要指出， 在以太网 V2 的 MAC 帧格式中， 其首部并没有 一个帧长度（或数据
长度） 字段。 那么， MAC 子层又怎样 知 道从接收到的以太网帧中取出多少字节的数据交付
上一 层协议呢？我们在前面 讲述图 3-16 的曼彻斯特编 码 时 已 经讲过， 这种曼彻 斯特编 码的
一个重要特点就是： 在曼彻斯特编码的每一个码元（不管码元是 1 或 0) 的正中间 一定有一
次 电 压的转换（从高到低或从低到高）。 当 发送方把一个以太网 帧发送完毕后， 就 不再发送
其他码元 了 （既不发送 1, 也不发送 0)。 因 此， 发送方网络适配器的接 口 上的 电 压也就不再
变化 了 。 这样， 接收方就可以很容 易 地找到以太网帧的结束位置。 在这个位置往前数4字节
C FCS字段长度是4字节）， 就能确定数据字段的结束位置。

当 数据字段的长度小 于 46 字节时， MAC 子层就会在数据字段的后面 加入 一个整数字
节的填 充字段， 以保证以太网的 MAC 帧长不小 于 64字节。 我们应当 注 意到， MAC 帧的首
部并没有指出在数据字段中是否 有填充字段。 接收端的 MAC 子 层在剥 去 MAC 帧的首部和
尾部后 ， 就把剩 下的部分交给上面的 IP层。 那么IP层怎样知 道这里有没有填充字段呢？大
家 知 道， IP协议的首部有一个 “ 总长度 ” 字段 。 如果 IP数据报的 “ 总长度 “ 超 过或等 千46
字节， 那么肯定就没有填充字段。 反之， 如果 “ 总长度 “ 小 千 46 字节， 那么就很容 易把填
充字段计算出。 例如， 若 IP 数据报的总长度为42 字节， 填 充字段就应当 是 4 字节。 当
MAC 帧把46字节的数据上交给IP层后 ， IP层就把其中最后4字节的 填 充字段丢 弃。

从图 3-22 可看出， 在传输媒体上实际传送的要 比 MAC 帧还多 8 个字节。 这是囚 为当
一个站 在刚 开 始接收 MAC 帧 时， 由 于 适配器的时钟 尚 未 与到达的 比特流达成同步， 因 此
MAC 帧的最前面的若干位就无法接收， 结果使整个的 MAC 成为无用的帧。 为了 接收端迅
速实现位 同 步 ， 从 MAC 子 层向下传到物理层时还要在 帧的前 面插入 8 个字节（ 由 硬件生

•  98 •

成）， 它 由 两个字段 构成。 第

个字段是 7个字 节的 前同步码 ( 1和 0 交替 码）， 它的作用是

一

使接收端的 适配器在接收 MAC 帧时能够 迅速调 整 其时钟频率， 使它和发送端的时钟同步，

“

”

也就是

实现位同步

（位同步就是比特同步的意 思）。 第 二个字段是 帧开始定 界符， 定义为

一

10 10 10 11。 它的前 六位的作用和前同 步 码
“MAC 帧的信息 马上就要来了， 请 适配器 注意接收。 ” MAC 帧的 FCS字段的 检验范 围不包

样， 最后的 两个连 续的 1就是 告 诉接收端 适配器 ：

括前同步 码和 帧开始定 界符。 顺 便 指出， 在使用 SONET/SDH进行同步传输时 则不需要用前

一

同步 码， 因为在 同步传输 时收发 双方的位同步 总是

直保持着的。

还需 注意， 在以 太网上传送数据时是以 帧为单位传送的。 以 太网在传送 帧时， 各 帧 之

一

间 还必须有
就都属于 同

一

定的间 隙。 因此， 接收端 只要 找 到 帧开始定 界符， 其后 面的连 续 到达的比特 流
个 MAC 帧。 可见以 太网不需要使用 帧结 束定 界符， 也不需要使用字 节插入来

保证 透明传输。

一

IEEE 80 2.3标准规定 凡出现下 列情况之
(1) 帧的 长度不 是 整数个字 节 ；
(2) 用收 到的 帧检验序列 FCS 查出有差错 ；
(3) 收 到的 帧的 MAC 客户数据字段的 长度不在 46

的 即为无效的 MAC 帧 ：

~

150 0 字 节之间。 考虑 到 MAC 帧 首

部和 尾部的 长度 共有 18 字 节， 可以 得出有效的 MAC 帧 长度为 64 ~ 1518 字 节之间。

对于 检 查出的无效 MAC 帧就 简单地 丢 弃。 以 太网不 负 责重传 丢 弃的 帧。

一

最后要 提
一

式的 区别就是以下三点。

下， IEEE 80 2.3标准规定的 MAC 帧格式与上面所 讲的以 太网 V2 MAC 帧格

“

”

第

， IEEE 80 2.3规定的 MAC 帧的 第 三个字段是

长度 ／类 型

。 由于以 太网有效 帧的

“

”

“

类 型

段就表示

最 大 长度是 1518 字 节。 因此当这个字段 值大千 Ox0 60 0 时（相当千 十进制的 1 5 36 )， 这个字
样。 只有当这个字段 值
， 即 MAC 帧的数据部分 长度。 显 然， 在这种情况 下， 若数据

。 这样的 帧格式就和以 太网 V2 MAC 帧格式完 全

小于 Ox0 60 0 时 才表示
字段的 长度与 实 际的 长度字段的 值不
经 讲过， 由 于以 太网采用了曼彻斯特编码， 长度字段本来并无实 际意义。

致， 则 该 帧为无效的 MAC 帧。 实 际上， 前 面我 们 已

长度

一

“

“

”

一

第 二， 当
LLC子层的 LLC 帧。

长度 ／类 型

字段 值 小千 Ox0 60 0 时， 数据字段必须装入上 面的 逻辑链路 控制

第 三， 在 80 2.3标准的 文 档中， MAC 帧的 帧格式包括了 8 字 节的前同步 码和 帧开始定

界符。 有些教科书也是这样 引用的。 不过这并不 影 响我 们对以 太网工作原 理的 理解。

由千现在广泛使用的 局域网 只有以 太网， 因此 LLC 帧 已经 失 去了原来的意义（见本章

”

”

以 太网的 两个 主要标准

3 . 3 .1 节 第 1 小 节
但 大 家也常常把它称为 IEEE 80 2. 3标准的 MAC 帧。
3 .4 扩展的 以太 网

)。 现在 市 场上 流行的都是以 太网 V2的 MAC 帧，

在 许多情况下， 我们 希 望把以 太网的 覆 盖范 围 扩 展。 本 节先讨论在物理层把以 太 网 扩

扫 一扫

展， 然后讨论在数据链路层把以 太网 扩展。 这 种扩展的 以太网在网络 层 看 来

一

仍然是
3.4. 1  在物理层 扩展 以 太 网

个网络。

以 太网上的 主机之间的 距 离不能 太远（例如，lOBASE-T以 太网的 两 台

视频讲解

•  99  •

