地域名 服务 器下载 名 字和地址的全部数据库 ， 维护存放 (cid:7164) 己最近 使用 的域 名 的高速缓存 ， 并

且只在从缓存中找不 到 名 字时才 使用域 名 服务 器 。 维护本地域 名 服务 器数据库的主机 (cid:7166) 然 应

该定期 地检查域 名 服 务器以获 取新的映射信 息 ， 而且主机必须从缓存中删 掉无效的项。 由于
域 名 改 动并不频 繁 ， 大多数网点不需花太多精 力就(cid:7130)维护数据 库 的一(cid:7175) 性 。

文件传 送协议

6 . 2

6.2 . 1  FTP 概述

文件传送协议 FTP( File  Trans fer Protocol )  [ RFC  959,  STD9] 曾 是 互 (cid:7110) 网

扫 一扫

罄回

封
谤
怒
匪

视 频 讲 解

上使用得最广 泛的文件传送协 议 。 FTP 提供交互 式的访问 ， 允 许 客 户 指明文 件的类型与格式

（如指明是 否使用 ASCII 码） ， 并允 许 文 件 具有存取权 限 （ 如访问文件的用户 必须经过授权 ，
并 输入有效的口令） 。 FTP 屏 蔽了各 计算机系统的细(cid:7188) ， 因而适 合千在异构网络中任 意 计算
机之间传送文件 。

在互(cid:7110) 网 发展的早 期 阶段 ， 用 FTP 传送文 件 约 占 整个互 (cid:7110) 网 的通信 最的三分之 一 ， 而

由 电 子邮 件和域 名系统所产 生的通信 量远小千 FTP 所 产 生的通信 量 。 只是 到 了 1 995 年 ，
WWW 的通信 量才 首次超过 了 FTP。

在下面 6.2.2和 6.2.3(cid:7188)分别 介 绍 基千 TCP的 FTP和基于 UDP的简单文件传送协议 TFTP,
它们都是 文 件 共 享 协 议中的一 大类， 即 复制 整个文件 ， 其特 点是 ： 若要存取一个 文 件 ， 就必
须先获 得一个本地的文件副本。 如果要修 改 文 件 ， 只(cid:7126)对文件的副本进行修 改 ， 然后 再将 修
改后的文件 副本传回到 原(cid:7188)点。

文 件 共 享 协 议中的另 一 大类是 (cid:7116)机访 问 ( on-line acce s

s ) 。 (cid:7110)机访问意 味 着 允 许多个程序
同 时对一个文件进行存取 。 和数据库系统的不 同 之处是用户 不需要调用一个特殊的客户 进程 ，
而是由操作系统 提供对远地共 享 文 件进行访问的服务 ， 就如同对本地文件的访问一样 。 这 就
使用户 可以用远地文件作为输入和输 出 来 运行任 何应用程序 ， 而操作系统中的文件系统则 提

供对共 享 文 件的透 明 存 取 。 透明存取的优 点是： 将 原 来用千处理本地文件的应用程序用来 处

理远地文 件 时 ， 不需要对该 应 用 程 序做明显的改 动 。 属 千文 件 共 享 协 议的有网 络 文 件 系 统
N F S  ( Ne twork  File  Sys te m)  [C OME0 6] 。 网 络 文 件 系 统 N FS 最初是 在 UNIX 操作 系 统环境下
实 现 文 件和目录共 享的 。 N FS 可 使本地计算机共 享 远地的资 源 ， 就像这 些 资 源 在本地一样 。
由千 NFS 原先是 美 国 SUN 公 司 在 TCP/IP网络上创 建的 ， 因此目前 N FS 主要应用在 TCP/IP
,  N e tWare 等操作系统上运行 。 NFS 还没
网络上 。 然 而现在 N FS 也可在 OS/2, MS-Windows
有成为互(cid:7110) 网的正 式标准 。 经过 几次修订更 新 ， 现在的最新版本 ( N FSv4) 是 20 1 5 年 3 月
发布的建议标准 [ RFC 7530 ] 。 限千篇 幅 ， 本书不讨 论 N FS 的详细工作过程 。

扫 一扫

6.2 .2  FTP 的 基本 工 作 原 理

网络环境中的一项基本应用 就 是 将 文 件从一 台 计 算机中复 制到 另 一 台 可
(cid:7126)相 距 很远的计算机中。 初 看起来 ， 在两 台 主机之间传送文 件是 很 简单的事

情 。 其 实 这 往往非常困 难 。 原 因是 众多的计算机厂 商 研 制出的文件系统多达

视 频 讲 解

数 百种 ， 且 差 别很大 。 经常遇到的问题是：
(1 ) 计算机存储数据的格 式不 同 。
( 2) 文件的目录结构和文件 命 名 的规定 不 同 。

(3) 对千相 同的文件存取功(cid:7126) ， 操作系统使用的命令 不 同 。

•  269  •

(4 ) 访问控制方法不 同 。
文件传送协议 FTP 只 提供 文 件传送的一 些 基本的服务 ， 它使用 TC P 可靠的运输服务。

FTP 的主要功(cid:7126)是 减少或 消 除在不 同 操作 系 统下处理文件的不兼容性。

FTP 使用客 户 服务 器 方式。 一个 FTP 服务 器进程可 同 时为多个客户 进程 提供服 务。 FTP

的服 务 器进程由两大部分组成： 一 个主进程 ， 负 责接 受新的请 求；另 外有若干个从属进程 ，
负 责处理单个请 求。

主进程的工作步骤如下 ：
(1 ) 打开 熟知端 口 （端口 号 为 21 ) ， 使客户 进程(cid:7126)够连接上。

( 2) 等 待 客 户 进程发出连接请 求。

(3) 启 动从属进程处理客户 进程发来 的请 求。 从属进程对客 户 进程的请 求处理完 毕后即

终止 ， 但从属进程在运行期间根据需要还可(cid:7127) 创 建其他一 些子进程。

(4) 回 到 等 待 状 态 ， 继 续 接 受 其他客 户 进程发来 的请 求。 主 进程与从属进程的处理是并

发进行的。

FTP 的工作情况如图 6-5 所示 。 图中的椭圆圈 表 示 在 系 统中运行的进程。 图中的服务器

端有两个从属进程： 控制进程和数据传送进程。 为简单起见， 服 务 器 端的主进程没有画 上。
客 户 端 除了控制进程和数据传送进程外 ， 还有一个用户 界面进程用来 和用户 接口。
“

在进行文 件传输时， FTP 的客 户 和服 务器 之 间要建立两个并行的 TC P 连接：

控制连接
＂
和 “
。 控制连接在整个会话 期 间 一直 保 持 打开 ， FTP 客 户 所发出的传送请 求 ， 通
过控制连接发送给服 务 器 端的控制进程， 但控制连接并不用来 传送文件。 实 际 用 千传输文件

数 据连接

”

的 是
“

“

数 据连接

＂

数 据传 送 进程

。 服 务 器 端的控制进程在接 收到 FTP 客 户 发送来 的文件传输请 求后就创 建
”
和 “ 数 据连接

， 用来 连接客 户 端和服 务 器 端的数据传送进程。 数据传送
”

”

进程实 际 完成文 件的传送 ， 在传送完 毕后关 闭 “ 数据传送连接
用了一个分离的控制连接 ， 因此 FTP 的控制信 息是带外( out of band)传送的。

并结束运行。 由千 FTP 使

客 户 端

FTP

数据连接

TCP

服 务 器端

FTP

图 6-5

FTP 使 用 的两个 TCP 连接

当客 户 进程向服 务 器 进程发出建 立 连接请 求 时 ， 要寻找连接服 务 器进程的熟知端 口 21 ,
同时还要告诉 服 务 器进程(cid:7149) 己的 另 一个端口号码， 用于建立数据传送连接。 接 着 ， 服 务 器进
程 用 (cid:7167) 己传送数 据 的熟 知端 口 20 与 客 户 进程 所 提供的端 口 号 建 立数 据 传送连接。 由千

FTP 使用了两个不 同 的端口 号 ， 所以数据 连接与控制连接不会发生 混乱。

使用两个独立的连接的主要好处是 使协 议更加 简单和更容 易 实 现 ， 同 时在传输 文 件 时

还可以利 用 控制连接对文件的传输进行控 制 。 例 如， 客 户 发送

“

请求终止传输

＂
。

FTP 并非对所有的数据 传 输 都是 最佳的。 例 如， 计算机 A 上运行的应用程序要在远地
计算机 B 的一个很大的文件末尾添加 一行信 息。若使用 FTP, 则应先将此文件从计算机 B

•  270

•

传送到 计算机 A, 添加上这 一 行信 息 后 ， 再用 FTP将 此 文 件 传 送到 计算机 B, 来 回传送
这样大的文 件很花时间。 实 际 上这种传送是不必要的， 因 为计 算机 A 并没有使用该 文件的

内 容。

然 而网络 文件 系 统 N FS 则采用另 一种思路。 NFS 允许应用 进程打开一个远地文件 ， 并
(cid:7129)在该文件 的 某 一个特定 的 位 置 上开始读 写 数 据。 这样 ， N FS 可使用 户 只 复制一个大 文 件
中的一个很小的片 段 ， 而不需要复制整 个 大 文件。 对千上述例子， 计算机 A 中的 NFS 客 户
软 件 ， 把要添加的数据和在文 件后面写数据的请求 一起发送到远地的计算机 B 中的 N FS 服
务器 ， N FS 服 务器更新文 件后返 回应答信 息。 在 网络上传送 的 只 是少 量 的修改 数 据。

6.2.3

TFTP

简 单文 件传送协议

TCP/IP协 议族中还有一个简 单文件传送协议 TFTP(Trivial  F ile  Trans fer

Protocol ) ， 它是 一个很小 且 易 千 实现的文件传送协 议 [ RFC 1 350,  STD33]。
虽 然 TFTP也使用客 户 服务器方式 ， 但它使用 UDP数据报 ， 因 此 TFTP需
要 有 (cid:7151) 己的差 错 改 正 措 施。 TFTP 只支 持 文 件传输而不支 持 交 互。 TFTP 没有一个庞 大的命
令 集 ， 没有列目录的功(cid:7126) ， 也不(cid:7126)对用户 进行身 份 鉴 别 。

视频讲解

TFTP的主要 优点有两个。 第 一 ， TFTP可用千 UDP环境。 例如， 当需要将程序 或 文件 同
时向许 多机器下载时就往往需要使用 TFTP。 第 二 ， TFTP 代码所 占的 内存较小。 这 对较小的

计算机或某 些特 殊用途的设备是很重要的。 这 些设备不需要硬盘 ， 只需要 固化 了 TFTP、 UDP

和 IP的小 容量只读存储器即可。 当 接通电源后， 设备执行只读存储器中的代码 ， 在网络上广
播一个 TFTP请求。 网络上的 TFTP服务器就发送响应 ， 其中包 括可执行二 进制程序。 设备收
到此文件后将其放入内存， 然后开始运行程序。 这种方式增加了灵活性 ， 也减少了开销。

TFTP的主要特点是 ：
(1 ) 每次传送的数据报 文中有 51 2字(cid:7188)的数据 ， 但最后 一次可不 足 51 2字(cid:7188)。
( 2) 数据报文按序编号 ， 从 1 开始。

(3) 支 持ASCII 码 或 二进制传送。

(4 ) 可对文件进行读或 写 。

(5 ) 使用很简单的首部。
TFTP的工作很像停 止等 待 协 议（ 见第 5 章 5.4 . 1 (cid:7188) ）。 发送完 一个文件块后就等 待对方
的确认， 确认时应指明所确认的块编号。 发完数据后在规定时间内 收不到确认就要 重发数据
PDU。 发送确认PDU 的一方若在规 定时间 内 收不到下一个文 件 块 ， 也要重发确认PDU。 这
样就可 保 证 文 件的传送不(cid:7175) 因 某 一个数据报的丢 失而告失败。

在一 开始工作时。 TFTP 客 户 进程发送一个读请求报文 或 写请 求 报 文 给 TFTP 服 务器进
程 ， 其熟知端口号 码 为 69。 TFTP服务器进程要选 择一个新的端口和 TFTP客 户 进程进行通
信 。若文件长度恰好为 51 2字(cid:7188)的整数倍 ， 则在文件传送完 毕 后 ， 还必须在最后发送一个只
含首部而无数据的数据报文 。若文件长度不是 51 2字(cid:7188)的整数倍 ， 则最后传送数据报文中的
数据字段一定不满 51 2字(cid:7188) ， 这 正好可作为文件结束的标志。

6 . 3   远程终端协议 TE LN ET

TEL N ET 是 一个 简 单 的 远 程 终 端 协 议 [ RFC 854,  STD8] 。 用 户 用

视频讲解

•  271

•

