但目前实 际上还是使用多个独立的单播 。

(3) 交互式音频／视频

这 种类型是用户使用兀联网和其他人进行实 时交互式通信 。 现

在的互联网电话或互联网电视会议 就 属 千 这 种类 型 。

“

“

请注意 ， 对 千流式音频／视频的

下 载

， 实 际 上并没有把

＂

“

下 载

的内容存储在硬盘上 。

“

因此当

边 下 载边播放

”

结束后 ， 在用户的硬盘上没有 留 下 有关播放内容 的 任何痕迹 。 播放

流式音频／视频的用户 ， 仅仅能够在屏 幕上观看播放的内容 。 用户既不能 修改节目内容 ， 也

不能把播放的内容存 储 下 来 ， 因此也 无法进行转发 。 这 对保护版权非常有利 。

不过技术 总是在不断进 步的 ， 现在已经有了能够存 储在网上播放的流式音频／视频文件

的软件 。

我们 现在常见的词汇流媒体( st r eami n gm ed i a)就是上 面 所说的流式音频／视频 。 流媒体最

主要的特点就是不是全部都 收录 下来 再 开始 播放 。 在 国外 的

一

些文献 中 ， 常见到 st r eami n g

一 词 ， 网上有人译为

“

串 流

“

”

或

流播

“

， 但目前还没有 找到对 st r eam i n g 更好 的译 名 。

限于篇 幅 ， 下 面简单介绍 上面的第

一

种和第三 种音频／视 频类型的服务 。

8 . 2   流式存储音频／视频

“

流式存储音频／视频

”

中的

“

存储

“

二字 ， 表明这 里所讨 论的流式音频／视频文件不是

实时产生的 ， 而是已经录制 好 的 ， 通常存储在光盘或硬盘中 。 不过有时为了简便 ， 往往 省 略

“

“ 存 储

二字 。 在讨 论从网上 下 载这 种文件之前 ， 我们 先 回忆

一

下使用传统的浏 览器是 怎样

从服务 器 下 载已经录制好的音频／视颜 文件的 。 图8-4 说 明 了 下 载 的 三 个步 骤 。

客 户 机
一1�
I

，

，

服 务 器

GET 音 频／视频 文 件

R ESPONSE

图 8-4 传 统 的 下 载 文 件 方 法

0 用户从客户机(c li ent mac hi ne)的浏 览器上用 HTTP 协议向服务器请求下载 某 个音频／

视频文件 ， GET 表示请求下 载的HTTP 报 文 。 请 注意 ， HTT P 使用 TCP连接 。

＠ 服务器如有此文件就发送给浏 览器 ， R ESPO NS E 表示服务器的HTTP 响应报 文 。 在

响应报 文中装有用户所要的音频／视频文件 。 整个下载过程可能会 花 费 很 长的时间 。

＠ 当浏 览器 完 全 收 下 这 个文件后（所需的时间取决 千音频／视频文件的大小 ） ， 就可以

传送给自己机器上的媒体播放器进行解压缩 ， 然后播放 。

为什么 不能直接在浏 览器中播放音频／视频文件呢？这是因为播放器并没有集成在 万维

网浏 览器中 。 因此 ， 必须 使用
个单独的应用 程 序来播放这 种音频／视频节目 。 这 个应用 程
序通常称为媒体播放器(m edi ap l ayer) 。 现在流行的媒体播 放 器有 R ealN etw o rk s 的 R ealP layer、
微软的 W i nd ow s M edi a P layer 和苹果 公司的 Qui c kTi me 。 媒体播放器具有的主要功能是： 管

一

• 374  •

理用户界面、 解压缩、 消 除时延抖动和处理传输带来的差错。
“

请注意 ， 图8 -4 所示传统的下载文件的方法并没有涉及

流式

”
（ 即 边 下 载边播放 ） 的概

念。 传统的下载方法最大缺点就是历时 太 长 ， 这往往使下载者不愿继续等待。 为此 ， 已经找

出了几种改进的措 施。

8.2. 1  具 有 元 文 件 的 万 维 网 服 务器

一

第

种改进的措 施就是在 万 维网服务 器中 ， 除了 真 正的音频／视 频文件 外 ， 还增加 了

一

个元 文件 (met afile )。 所谓元文件 （ 请注意 ， 不是源文件） 就是

一

种非常小的文件 ， 它 描 述 或

指明其 他 文件 的

一

些 重要信息。 这里的元文件保存了有关这 个音频／视 频文件的信息。 图 8 - 5

说明了使用元文件下载音频／视频文件的几 个步骤。

客 户 机
I

服 务 器

「导；

l

GET

元 文 件

RESPONSE

2

音 频／视砌

RESPONSE

图 8-5 使 用 具 有 元 文件 的 万 维 网 服 务 器

0 浏 览 器用户 点击所要看的音频／视频文件的超链 ， 使用 HT T P 的GE T 报文接入到万

维网服务 器。 实际上 ， 这 个超链并没有直接指向所请求的音频／视 频 文件 ， 而是指向

文件。 这 个元文件有实际的音频／视频文件的统

一

资源定位符 URL。

一

个 元

＠ 万 维 网服务 器把该元文件装 入 HT T P 响应报 文的主体 ， 发回给浏 览器。 在响应报文

中还有指明该音频／视频文件类型的首部。

＠ 客户机浏 览 器收到万 维网服务 器的响应 ， 分析其内容类型首部行 ， 调 用相关的媒体

播放器（客户机中可能装有 多 个媒体播放器 ） ， 把提取出的元文件传送给媒体播放器。

0 媒体 播放器使用元文件 中的 URL 直接和万 维网服务 器 建立TCP连接 ， 并向 万维网

服务器发送HT TP 请求报 文 ， 要求 下载浏 览 器 想要的音频／视频文件。

0 万 维网服务器发送HT TP 响应报文 ， 把该音频／视 频文件发送给媒体播放器。 媒体播

放器在存 储了 若 干 秒的音频／视 频文件后 （ 这是为了 消 除 抖 动） ， 就以音频／视频流的形式边

下载、 边解压缩、 边播放。

8 .2.2  媒体服务 器

为了 更好地提供播放流式音频／视 频文件的服务 ， 现在最为流行的做法就是使用两 个分
个 媒体服 务器

开的服务 器。 如 图 8 - 6 所示 ， 现在使用

个普通的 万 维网服务器 ， 和 另

一

一

(me di a se r ver)。 媒体服务器和万 维网服务器 可以运 行在

一

个端系统内 ， 也 可以运行在两个不

同的端系统中。 媒体服务器与普通的万 维网服务 器的最大 区别就是， 媒体服务器是专门为播

放流式音频／视 频文件而设计的 ， 因此能够 更 加 有 效地为用户提供播放流式多 媒体文件的服

务。 因此媒体服务器也 常被称为流式服 务器(st re ami n gse rve r)。 下 面我们介绍其工作原理。

• 375  •

客 户 机l
：一I

; �，

服 务 器

GET： 元 文 件

RESPONSE

0
GET 音 频／视 频 文 件
..  媒体

RESPONSE

图 8-6 使 用 媒体 服 务 器

在 用户端 的媒体 播 放 器 与 媒体服 务 器 的 关系是客户与服 务器 的 关系。 与 图 8-5 不同的是，

现 在媒体播 放 器不 是 向 万 维 网 服 务器而 是 向 媒体服务器请求音频／视频文件。 媒体服务器和

媒体 播 放 器之 间 采 用 另 外 的 协议进行交互 。

采 用 媒体服 务器后 ， 下载音频／视 频文件的前三个步 骤 仍 然和上

一

节所述 的

一

样 ， 区别

就 是 后 面两 个步 骤 ， 即 ：

0 ~＠ 前三 个 步 骤与 图 8 -5 中的相同。

0 媒体播放 器 使用元文件中的 URL 接入到媒体服务器 ， 请求 下 载浏 览器所请求 的音频

／视频 文件。 下 载 文件可 以 使用上

一

小节讲过的HT T P/TC P , 也 可 以 借 助 于使用 UDP 的任何

协议 ， 例 如 使 用 实 时 运输协议 RT P （ 见 8.3.3 节）。

© 媒体 服 务器给出响应 ， 把该音频／视频文件发送给媒体播放器。 媒体播放器在 迟 延了

若 干 秒 后 （ 例如 ， 2 ~5 秒） ， 以流的 形 式边下载、 边解压缩、 边播放。

上 面 提 到 ， 传送音频／视频 文件可以使用 TC P , 也 可以 使用 UDP 。 起初人们选 用 UDP

来传送。 不采用 TC P 的主 要 原 因是担心当网络出现分组丢失时 ， TC P 的重传机制会使重传

的 分组不能 按时到达接收端 ， 使 得媒体播放器 的 播放不流 畅。 但后来 的实践经验发现 ， 采用
UDP 会有以 下 几 个缺点。

( I ) 发送端按 正 常播 放的速率发送流媒体数据帧 ， 但由 于网络 的情况 多 变 ， 在接收端的

播放器很难做到始 终按规定的速率播放。 例如 ， 一个视 频节目需要以1M bit/s 的速率播放。

如果 从媒体服 务 器到媒体播放器之间的网络容量突然 降 低到 IM bit/s 以 下 ， 那么 这时就 会出

现播放器 的 暂 停 ， 影响正 常 的 观 看 。

( 2) 很 多 单位 的 防 火墙 往往 阻 拦 外部 UDP 分组的进入 ， 因而使用 UDP 传送多媒体文件

时 会 被 防 火墙 阻拦掉。

(3) 使用 U DP 传送流式 多 媒 体 文 件时 ， 如果在用户端希望能 够 控制媒体 的 播放 ， 如进
行 暂 停、 快进等 操 作 ， 那么 还 需要使用 另外的协议 RT P （ 见 8. 3. 3 节） 和 RTSP （ 见 8. 2. 3

节） 。 这样就增加 了 成 本和 复 杂 性 。

于 是 ， 现 在 对 流 式存储音频／视 频 的播放 ， 如 Y ouTu b e 和 N et flix

G)

, 都采用 TC P 来传送。

图 8 - 7 说明了使 用TC P 传送流 式 视 频的 几个主要步骤 [ KURO l7]。

句 注 ： YouTube ( （由 管 ） 是 全球砓人 的 视频 网 站 ， 能 支 持 数 百 万 用 户 同 时 观 看流畅 的 视 频 节 目 ， 也 支 持 网 民 上 传 自 己制 作

的 共 亨 视 频 节 目 。 Netfli x （ 奈 飞 ， 或 网 飞 ） 是 世 界 上 最 大 的 在 线 影 片 租 赁 提 供 商 ， 可 提 供 超 过 85 000 部 DVD 电 影 的 租 赁 服 务 ，

以 及 4000 多 部影 片 或 者 电 视 剧 的 在 线 观 看 服 务 。

•  376  •

视频 义 件

待
发
送
的

TC P
发送缓存

TCP
接收缓存

丿:

应 用 程 序 缓 存
1
1
b

1 等 时 地 从缓 存 中 把
帧读 出 ， 解压缩 ，

圈 显 示 在 屏 幕 上

互 联 网 上传送

图 8-7 使 用 TCP 传送流式视频 的 主 要 步 骤

客 户 机

步 骤 0 ： 用 户 使用HT T P 获 取存 储在万维网服 务器 中 的 视频文件 ， 然后把视频数据传送

到TCP发送缓存 中 。 若发送缓存已填满 ， 就 暂时 停 止 传送 。

步 骤 ＠ ： 从 TCP发送缓 存通过互联网 向客户 机中的T CP 接 收 缓存传送视频数据 ，直到

接收缓存被填满 。

步 骤 ＠ ： 从TCP接收缓存把视频数据 再传送到应用 程 序 缓存 （ 即媒体播放器的缓存） 。

这 叫作预先存 储 。 当预先 存 储在缓存 中的视频数据 存 储 到

一

定数量时 ， 就开始播放 。 这 个 过

一

程

般不超过1 分 钟 。

步 骤 0 ： 在播放时 ， 媒体播放器等时地（ 即 周 期性地） 把视频数据按帧读出 ， 经解压缩

后 ， 把视频节目显示在用户的 屏 幕上 。

请注意 。 这 里只有步 骤 0的读出速率是严格按照源 视 频 文件的规 定速率来播放的 。 而前

面的三个步骤 中的数据传送速率则可以是任意的 。 如果 用 户 暂 停 播放 ， 那么 图中的三个缓 存

将很快被填满 ， 这 时 TCP 发送缓 存 就 暂 停读取所要传送的视频 文件 ， 否 则就会引起视频数
据的丢 失 。 以 后 ， 当用户 继 续 播放时 ， 媒体播 放 器每读 出 n b it ,  T CP 发送缓存就可以从存
储的视频文件再读取 n bit

。 如果客 户 机中的 两个缓存经 常处 于 填满状态 ， 就能够较好地应

付网络中偶 然出现的拥 塞 。

如果 步 骤 ＠ 的 传送速率 小 千 步 骤 0的读出速率 ， 那么 客户机 中的两个缓存 中的存量就会

逐渐减少 。 当媒体播放器缓存的数据被取 空 后 ， 播放就 不 得不 暂 停 ，直到后续的视频数据重

新注入进来后才能 再继 续 播 放 。 实践证明 ， 只要在步 骤 ＠的 TC P 平均传送速率达到视频节
目 规定的播放速率的两倍 ， 媒体播放器

般就能流畅地播放网上 的视频节目 。

一

这 里要指出 ， 如果是 观看实况 转 播 ， 那么 最好应当首 先考虑使用 UDP 来传送 。 如果使

用TCP 传送 则当 出现网络严重拥 塞 而产生播放的 暂 停时 ， 就会使人难千接受 。 使用 UDP
传送时 ， 即使 因网络拥塞 丢 失 了

些 分组 ， 对 观 看的感觉也会比突 然出现 暂 停要好些 。

一

顺便指出 ， 我们在家中的 宽 带上网并不能 保证 媒 体 播放 器

一

定 能够 流 畅地回 放任何视

频节目 。 这是因 为 网络 营 运商 只 能 保证 ， 从用户 家 中到 网络运 营商的某个路 由器之间的这 段

网络的数据速率 。 但 从网络运 营 商到互联网上 下 载 视频 的某个媒体服务器的这段网络状况 则

是未知的 ， 很可能在某些时段会 出 现

一

些网络拥 塞 。 此外 ， 还要考虑所选 的视频 节目的清晰

度所要求的传输带 宽 。 我们都知道 ， DVD 质量 的 视频和高清电视或 4 K 超高清视频 节目所

要求的网速就相 差 很远 。

流 式 媒体播放 器问世后就 很受欢 迎 。 网 民们不需要 再 随 身携 带 刻录 有视频节目的光 盘 ，

只要有能够上网 的 智能 手机或轻巧的平板电脑 ， 就能 够随时上网观看各种视频音频节目 。 曾

经在城市 中 很热 闹的光盘 销 售商店 ， 由 千受到流式媒体的冲 击 ， 现已变得相当萧 条 。

• 377  •

8 . 2 .3  实 时 流式协议 RTSP

实 时流式协议 RTS P ( Real - Ti m e  S t reami n g P ro toc ol )是 I E TF 的MM USIC 工作组(M u l tip ar t y

M Ui timedi a S ess ion C on t rol  WG, 多 方 多媒 体会话控 制 工 作组）开发的协议 ， 现在是 RTS P 2.0
[ RFC  7 826, 建议 标准］。 RTSP 是为 了 给流 式 过 程 增 加 更 多的功 能 而设计的协议。 RTS P 本 身

一

并不传送数据 ， 而仅仅是使媒体播放器能 够控制多媒体流的传送 （ 有点 像文件传送协议FT P
有

个控制信道 ） ， 因 此 RTSP 又称为带外协议 (ou t
一

-o f-band p ro toc ol

)。

RTSP 协议以客户－服 务器 方 式 工作 ， 它是

个 应 用层的 多 媒 体 播 放 控制 协议 ， 用来

使 用户 在 播 放从互联网 下 载的 实 时 数 据 时 能 够进行控 制 （ 像在影碟机上 那样的控 制 ） ， 如 ：

暂 停／继 续 、 快退 、 快进等。 因此 ， RTS P 又 称为

互联网录像机遥控协议

“

”
。

RTSP 的语法和操 作与 H T TP 协议的相似 （所有的请求和响应报 文都是 ASC I I 文本 ）。

但 与 H T T P 不同的地方是 RTS P 是有状态的协议 ( H T T P 是无 状 态 的 ）。 R TSP 记录客户机所

处千 的 状 态 （ 初始化状态 、 播放状态或 暂 停 状 态 ）。 RFC 7826 还规 定 ， RTS P 控制 分 组既可
在 TC P 上传送 ， 也可在 UDP 上传送。 RTS P 没 有 定 义音频／视频的压缩方案 ， 也 没 有规 定音
频／视 频在 网 络 中 传 送时应如何封装在 分 组 中。 RTS P 不规 定音频／视频流在媒体播放器 中 应

如 何 缓 存。

在 使 用 RTS P 的播放 器 中比较 著 名 的是苹果公司的 Qui c k Tim e和 Real N etwo rks 公司的

Real Pl ayer。

图 8- 8 表 示 使 用 RTS P 的媒 体 服 务 器 的工作过程。

客 户 机
1
I
一

服 务 器

GET: 元 文 件

RESPONSE

S ETUP

RESPONSE

PLAY

RESPONSE

音 频／视频流

TEARDOWN

RESPONS E

媒体
服 务 器

0 浏 览 器 使用 H T T P 的 G E T 报文向 万 维网服 务 器请求音 频／视 频文件。

图 8-8 使 用 RTSP 的 媒 体 服 务 器 的 工 作 过程

＠ 万维网服 务 器从浏 览器发送携 带有元文件的响应。
＠ 浏 览器把收 到的元文件传送给媒体播放器。

0 媒体播放 器的 R TS P 客户 发送S E T UP 报 文与媒体服务器的 RTSP 服 务器建立连接。

© 媒体 服 务器的 RTS P 服 务器发送响应 RES PO NS E 报 文。

0 媒 体 播 放 器的 RTS P 客户 发送 PLAY 报文开始 下载音频／视频文件 （ 即开 始 播放 ）。

＠ 媒体服 务器的 RTS P 服 务器发送响应 RES PO NS E 报 文。

• 37 8  •

此 后 ， 音 频／视 频 文 件 被 下 载 ， 所 用 的 协 议 是 运 行 在 UDP 上 的 。 可 以 是 后 面要 介绍 的

RTP , 也 可 以 是 其 他 专 用 的 协 议 。 在 音 频／视频 流 播 放 的 过 程 中 ， 媒 体 播 放 器 可 以 随 时 暂 停

（ 利 用 PAUSE 报 文 ） 和 继 续播放 （ 利 用 PLAY 报 文 ） ， 也 可 以 快进或快退 。

© 用 户 在 不 想 继续 观看 时 ， 可 以 由 RTSP 客 户 发送 TEARDOWN 报 文 断开连接 。
0 媒体服务器 的 RTSP 服务器发送响应 RESPONSE 报 文 。
请 注 意 ， 以 上 编 号 的 步 骤 0 至 0 都使 用 实 时 流 协 议 RTSP 。 在 图 8-8 中 步骤 ＠ 后 面 没 有
则 使 用 另 外 的 传 送 音 频／视频数据 的 协 议 ， 如 RTP 。

“

”

编 号 的
音 频／视频流
8 . 3   交互式音频／视频

限 千 篇 幅 ， 在 本 节 中 我们 只 介 绍 交 互式音频 ， 即 IP 电 话 。

IP 电 话 是 在 互 联 网 上传 送 多
个 例 子 。 通过 IP 电 话 的 讨 论 ， 可 以 有 助 千 了 解 在 互 联 网 上传 送 多 媒 体信 息 应

一

媒 体 信 息 的
当 解 决好哪些 问 题 。
8.3. 1

IP 电 话概述

1 . 狭 义 的 和 广 义 的 I P 电话

IP 电话有 多 个英 文 同 义词 。 常 见 的 有 VoIP (Voice  over  IP),  Internet  Telephony 和 VON

“

”

“

(Voice On the Net) 。 但 IP 电 话 的 含 义 却 有 不 同 的解释 。
狭义 的 IP 电话就是指在 IP 网 络上 打 电话 。 所谓

”

交 换 网
不过 在互联 网 中 至 少 要 有

一

个 IP 网 络 。

的 简 称 。 这 里 的 网 络可 以 是 互 联 网 ， 也 可 以 是包含有传 统 的 电 路 交换 网 的 互联 网 ，

IP 网 络

就是

使用 IP 协 议 的 分 组

广义 的 IP 电 话 则 不仅仅是 电话通信 ， 而 且 还 可 以 是在 IP 网络上进行 交 互 式 多 媒体 实 时
通 信 （ 包括话音 、 视像等 ） ， 甚 至 还 包 括 即 时传信 IM (Instant  Messaging) 。 即 时传 信 是在 上

网 时 就 能 从屏幕上 得 知 有 哪 些朋 友 也 正 在 上 网 。 若有 ， 则 彼此可在 网 上 即 时 交换信 息 （ 文 字

的 或 声 音 的 ） ， 也 包 括 使 用
Skype 、 QQ 和 MSN Messenger [CHEN07] ， 很 受 网 民 的 欢迎 。
的 多 媒体服务平 台 ， 是 话 音 、 视像 、 数据综合 的 基础 结 构 。 在 某 些 条件 下 （ 例 如 使 用 宽 带 的

点 对 多 点 的 多 播 技 术 。 目 前 流 行 的 即 时 传 信 应 用 程 序 有 微 信 、

IP 电话可看成是

个 正 在 演 进

一

一

一

局 域 网 ） ，

IP 电 话 的 话 音 质 量甚至还优千普通 电话 。

下 面讨 论狭 义 的 IP 电话 [COLLO l ] ， 而广 义 的 IP 电话在原理上是

样 的 。

其 实 IP 电 话 并 非新概念 。 早在 20 世 纪 70 年代初期 ARPANET 刚开始运行 不 久 ， 美 国

一

即 着手 研 究 如 何在计算机 网 络上传送 电话信 息 ， 即 所 谓 的 分组话音通信 。 但在很长
里 ， 分组话音通 信 发 展 得 并 不 快 。 主 要 的 原 因 是 ：

段 时 间

( 1 ) 缺 少 廉价 的 高质 量 、 低速率 的 话 音 信 号编解码软件和 相 应 的 芯 片 。

(2) 计算机 网 络 的 传输速率和 路 山 器处理速率均 不 够 快 ， 因 而 导致传输时 延 过 大 。
(3) 没 有 保 证 实 时通信服务质量 QoS (Quality of Service) 的 网 络协议 。
(4) 计 算机 网 络 的 规模较 小 ， 而通信 网 只 有在 具 有

定规模后 才 能产 生经济效 益 。

一

2.  I P 电话 网 关

然 而 到 了 20 世 纪 90 年代 中 期 ， 上述 的 几 个 问 题 才 相 继 得 到 了 较好 的 解 决 。 千 是美 国 的

•  379 •

