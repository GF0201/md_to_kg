成），它由两个字段构成。第个字段是7个字节的前同步码(1和0交替码），它的作用是一使接收端的适配器在接收MAC帧时能够迅速调整其时钟频率，使它和发送端的时钟同步，“”也就是实现位同步（位同步就是比特同步的意思）。第二个字段是帧开始定界符，定义为一10101011。它的前六位的作用和前同步码
“MAC帧的信息马上就要来了，请适配器注意接收。”MAC帧的FCS字段的检验范围不包样，最后的两个连续的1就是告诉接收端适配器：括前同步码和帧开始定界符。顺便指出，在使用SONET/SDH进行同步传输时则不需要用前一同步码，因为在同步传输时收发双方的位同步总是直保持着的。
还需注意，在以太网上传送数据时是以帧为单位传送的。以太网在传送帧时，各帧之一间还必须有
就都属于同一定的间隙。因此，接收端只要找到帧开始定界符，其后面的连续到达的比特流
个MAC帧。可见以太网不需要使用帧结束定界符，也不需要使用字节插入来保证透明传输。
一IEEE802.3标准规定凡出现下列情况之
(1)帧的长度不是整数个字节；
(2)用收到的帧检验序列FCS查出有差错；
(3)收到的帧的MAC客户数据字段的长度不在46的即为无效的MAC帧：~1500字节之间。考虑到MAC帧首部和尾部的长度共有18字节，可以得出有效的MAC帧长度为64~1518字节之间。
对于检查出的无效MAC帧就简单地丢弃。以太网不负责重传丢弃的帧。
一最后要提
一式的区别就是以下三点。
下，IEEE802.3标准规定的MAC帧格式与上面所讲的以太网V2MAC帧格“”第，IEEE802.3规定的MAC帧的第三个字段是长度／类型。由于以太网有效帧的“”“类型段就表示最大长度是1518字节。因此当这个字段值大千Ox0600时（相当千十进制的1536)，这个字
样。只有当这个字段值
，即MAC帧的数据部分长度。显然，在这种情况下，若数据。这样的帧格式就和以太网V2MAC帧格式完全小于Ox0600时才表示
字段的长度与实际的长度字段的值不
经讲过，由于以太网采用了曼彻斯特编码，长度字段本来并无实际意义。
致，则该帧为无效的MAC帧。实际上，前面我们已长度一““”一第二，当
LLC子层的LLC帧。
长度／类型字段值小千Ox0600时，数据字段必须装入上面的逻辑链路控制第三，在802.3标准的文档中，MAC帧的帧格式包括了8字节的前同步码和帧开始定界符。有些教科书也是这样引用的。不过这并不影响我们对以太网工作原理的理解。
由千现在广泛使用的局域网只有以太网，因此LLC帧已经失去了原来的意义（见本章””以太网的两个主要标准3.3.1节第1小节
但大家也常常把它称为IEEE802.3标准的MAC帧。
3.4扩展的以太网)。现在市场上流行的都是以太网V2的MAC帧，在许多情况下，我们希望把以太网的覆盖范围扩展。本节先讨论在物理层把以太网扩扫一扫展，然后讨论在数据链路层把以太网扩展。这种扩展的以太网在网络层看来一仍然是
3.4.1在物理层扩展以太网个网络。
以太网上的主机之间的距离不能太远（例如，lOBASE-T以太网的两台视频讲解•99•主机之间的距离不超过200m)，否则主机发送的信号经过铜线的传输就会衰减到使CSMA/CD协议无法正常工作。在过去广泛使用粗缆或细缆以太网时，常使用工作在物理层
的转发器来扩展以太网的地理覆盖范围。那时，两个网段可用一个转发器连接起来。IEEE
802.3标准还规定，任意两个站之间最多可以经过三个电缆网段。但随着双绞线以太网成为以太网的主流类型，扩展以太网的覆盖范围已很少使用转发器了。
现在，扩展主机和集线器之间的距离的一种简单方法就是使用光纤（通常是一对光纤）和一对光纤调制解调器，如图3-23所示。
光纤以太网集线器光纤
调制解调器光纤
调制解调器图3-23主机使用光纤和一对光纤调制解调器连接到集线器光纤调制解调器的作用就是进行电信号和光信号的转换。由千光纤带来的时延很小，并且带宽很宽，因此使用这种方法可以很容易地使主机和几公里以外的集线器相连接。
如果使用多个集线器，就可以连接成覆盖更大范围的多级星形结构的以太网。例如，一个学院的三个系各有一个lOBASE-T以太网（如图3-24(a)所示），可通过一个主干集线器
把各系的以太网连接起来，成为一个更大的以太网（如图3-24(b)所示）。
三个独立的碰撞域一个更大的碰撞域(a)三个独立的以太网(b)一个扩展的以太网图3-24用多个集线器连成更大的以太网这样做可以有以下两个好处。第一，使这个学院不同系的以太网上的计算机能够进行
跨系的通信。第二，扩大了以太网覆盖的地理范围。例如，在一个系的lOBASE-T以太网中，
主机与集线器的最大距离是100ill,因而两台主机之间的最大距离是200m。但在通过主干
集线器相连接后，不同系的主机之间的距离就可扩展了，因为集线器之间的距离可以是100m（使用双绞线）或更远（如使用光纤）。
但这种多级结构的集线器以太网也带来了一些缺点。
(1)如图3-24(a)所示的例子，在三个系的以太网互连起来之前，每一个系的lOBASE-T
以太网是一个独立的碰撞域(collisiondomain,又称为冲突域），即在任一时刻，在每一个碰
撞域中只能有一个站在发送数据。每一个系的以太网的最大吞吐量是10Mbit/s,因此三个
系总的最大吞吐量是30Mbit/s。在三个系的以太网通过集线器互连起来后就把三个碰撞域
变成一个碰撞域（范围扩大到三个系），如图3-24(b)所示，而这时的最大吞吐量仍然是一个
系的吞吐量10Mbit/s。这就是说，当某个系的两个站在通信时所传送的数据会通过所有的
集线器进行转发，使得其他系的内部在这时都不能通信（一发送数据就会碰撞）。
•100•(2)如果不同的系使用不同的以太网技术（如数据率不同），那么就不可能用集线器将
它们互连起来。如果在图3-24中，一个系使用10Mbit/s的适配器，而另外两个系使用
10/100Mbit/s的适配器，那么用集线器连接起来后，大家都只能工作在10Mbit/s的速率。
集线器基本上是个多端口（也称为接口）的转发器，它并不能把帧进行缓存。
3.4.2在数据链路层扩展以太网扩展以太网更常用的方法是在数据链路层进行的。最初人们使用的是网桥(bridge)。网桥对收到的帧根据其MAC帧的目的地址进行转发和过滤。
当网桥收到一个帧时，并不是向所有的端口转发此帧，而是根据此帧的目
的MAC地址，查找网桥中的地址表，然后确定将该帧转发到哪一个端口，或者是把它丢弃
（即过滤）。
视频讲解1990年问世的交换式集线器(switchinghub)，很快就淘汰了网桥。交换式集线器常称为以太网交换机(switch)或第二层交换机(L2switch)，强调这种交换机工作在数据链路层。
“交换机”并无准确的定义和明确的概念。著名网络专家Perlman认为：“交换机”应
当是一个市场名词，而交换机的出现的确使数据的转发更加快速了[PERLOO]。本书也使用
这个广泛被接受的名词以太网交换机。下面简单地介绍以太网交换机的特点。
1.以太网交换机的特点以太网交换机实质上就是一个多端口的网桥，通常都有十几个或更多的端口，和工作
在物理层的转发器、集线器有很大的差别。以太网交换机的每个端口都直接与一个单台主机
或另一个以太网交换机相连，并且一般都工作在全双工方式。以太网交换机还具有并行性，
即能同时连通多对端口，使多对主机能同时通信（而网桥只能一次分析和转发一个帧）。相
互通信的主机都独占传输媒体，无碰撞地传输数据。换句话说，每一个端口和连接到端口的
主机构成了一个碰撞域，具有N个端口的以太网交换机的碰撞域共有N个。
以太网交换机的端口还有存储器，能在输出端口繁忙时把到来的帧进行缓存。因此，
如果连接在以太网交换机上的两台主机，同时向另一台主机发送帧，那么当这台主机的端口
繁忙时，发送帧的这两台主机的端口会把收到的帧暂存一下，以后再发送出去。
以太网交换机是一种即插即用设备，其内部的帧交换表（又称为地址表）是通过自学
习算法自动地逐渐建立起来的。实际上，这种交换表就是一个内容可寻址存储器CAM
(ContentAddressableMemory)。以太网交换机由于使用了专用的交换结构芯片，用硬件转发
收到的帧，其转发速率要比使用软件转发的网桥快很多。
以太网交换机的性能远远超过普通的集线器，而且价格也不贵，这就使工作在物理层的集线器逐渐地退出了市场。
对千传统的10Mbit/s的共享式以太网，若共有10个用户，则每个用户占有的平均带
宽只有1Mbit/s。若使用以太网交换机来连接这些主机，虽然在每个端口到主机的带宽还是
10Mbit/s,但由于一个用户在通信时是独占而不是和其他网络用户共享传输媒体的带宽，因
此对于拥有10个端口的交换机的总容量则为100Mbit/s。这正是交换机的最大优点。
从共享总线以太网转到交换式以太网时，所有接入设备的软件和硬件、适配器等都不需要做任何改动。
以太网交换机一般都具有多种速率的端口，例如，可以具有10Mbit/s,100Mbit/s和1Gbit/s的端口的各种组合，这就大大方便了各种不同情况的用户。
•101•虽然许多以太网交换机对收到的帧采用存储转发方式进行转发，但也有一些交换机采
用直通(cut-through)的交换方式。直通交换不必把整个数据帧先缓存后再进行处理，而是在
接收数据帧的同时就立即按数据帧的目的MAC地址决定该帧的转发端口，因而提高了帧的转发速度。如果在这种交换机的内部采用基于硬件的交叉矩阵，交换时延就非常小。直通交
换的一个缺点是它不检查差错就直接将帧转发出去，因此有可能也将一些无效帧转发给其他
的站。在某些情况下，仍需要采用基千软件的存储转发方式进行交换，例如当需要进行线路
速率匹配、协议转换或差错检测时。现在有的厂商己生产出能支持两种交换方式的以太网交
换机。以太网交换机的发展与建筑物结构化布线系统的普及应用密切相关。在结构化布线系
统中，广泛地使用了以太网交换机。
2.以太网交换机的自学习功能我们用一个简单例子来说明以太网交换机是怎样进行自学习的。
假定在图3-25中的以太网交换机有4个端口，各连接一台计算机，其MAC地址分别
是A,B,C和D。交换表最重要的就是两个项目：目的MAC地址和转发端口。在一开始，以
太网交换机里面的交换表是空的（如图3-25(a)所示）。
cA从端口l发送
B从端口3发送一一帧给B
帧给A一(a)交换表开始是空的(b)交换了两帧后的交换表图3-25以太网交换机中的交换表假定A先向B发送一帧，从端口1进入到交换机。交换机收到帧后，先查找交换表。
现在表中没有B的地址。千是，交换机把此帧的源地址A和端口1写入交换表中，并向除
端口1以外的所有端口广播这个帧（从端口1收到的帧显然不应再从端口1转发出去）。
广播发送可以保证让B收到这个帧，而C和D在收到帧后，因目的地址不匹配将丢弃此帧。这一过程也称为过滤。
由千在交换表中写入了项目(A,1)，因此以后不管从哪个端口收到帧，只要其目的地址
是A,就把收到的帧从端口1转发出去送交A。这样做的依据是：既然A发送的帧是从端
口1进入交换机的，那么从端口1转发出的帧肯定到达A。
接下来假定B通过端口3向A发送一帧。交换机查找交换表，发现交换表中的MAC
地址有A,表明凡是发给A的帧（即目的地址为A的帧）都应从端口1转发。显然，现在
应直接把收到的帧从端口1转发给A,而没有必要再广播收到的帧。交换表这时用源地址B
写入一个项目(B,3)，表明今后如有发送给B的帧，应从端口3转发。
经过一段时间后，只要主机C和D也向其他主机发送帧，以太网交换机中的交换表就
会把转发到C或D应当经过的端口号(2或4)写入交换表中。这样，交换表中的项目就逐
渐增多了，以后再转发帧时就可以直接从交换表中找到转发的端口，而不必使用发送广播帧•102•的方法了。
考虑到有时可能要在交换机的端口更换主机，或者主机要更换其网络适配器，这就需
要及时更改交换表中的项目。为此，当交换表中写入一个项目时就记下当时的时间，只要超
过预先设定的时间（例如300秒），该项目就自动被删除。用这样的方法保证交换表中的数
据都符合当前网络的实际状况。这就是说，图3-25中的交换表实际上是有三列，即MAC
地址、端口和写入时间。
以太网交换机的这种自学习方法使得以太网交换机能够即插即用，不必人工进行配置，因此非常方便。
但有时为了增加网络的可靠性，在使用以太网交换机组网时，往往会增加一些冗余的
链路。在这种情况下，自学习的过程就可能导致以太网帧在网络的某个环路中无限制地兜圈
子。我们用图3-26的简单例子来说明这个问题。
在图3-26中，假定一开始主机A通过端口交换机＃l向主机B发送一帧O。
由千交换表目前是空的，因此交换机＃l收到帧0后就向本交换机的所有其他端口进行广播发送。我们现在观察其中一个帧的走向：离开交换机＃l端口3的帧＠到达交换机＃2端口1,然后向交换机＃2所有其他端口广播发送；广播发送的帧中有一个帧＠到达交换机＃2端口2;
交换机＃2端口2把这个帧（帧0)发送到交换机＃l端口4,接着又向交换机＃1所有其他端口广播发送帧；广播发送的帧中有一个帧0到达交换机＃l端口3;上述过程就这样无限制地循环兜圈子(O一＠－0－0)。显然，这就白臼消耗了网络资源。
以太网
交换机＃1以太网
交换机＃2AlO三图3-26在两个交换机之间兜圈子的帧为了解决这种兜圈子问题，IEEE的802.ID标准制定了一个生成树协议STP(Spanning
TreeProtocol)。其要点就是不改变网络的实际拓扑，但在逻辑上则切断某些链路，使得从一
台主机到所有其他主机的路径是无环路的树状结构，从而消除了兜圈子现象。
3.从总线以太网到星形以太网大家知道，传统的电话网是星形结构，其中心就是电话交换机。那么在20世纪70年代中期出现的局域网，为什么不采用这种星形结构呢？这是因为在当时的技术条件下，还很难用廉价的方法制造出高可靠性的以太网交换机。所以那时的以太网就采用无源的总线结构。
这种总线式以太网一问世就受到广大用户的欢迎，并获得了很快的发展。
然而随着以太网上站点数目的增多，使得总线结构以太网的可靠性下降。与此同时，
大规模集成电路以及专用芯片的发展，使得星形结构的以太网交换机可以做得既便宜又可靠。
在这种情况下，采用以太网交换机的星形结构就成为以太网的首选拓扑，而传统的总线以太•103•网也很快从市场上消失了。
总线以太网使用CSMA/CD协议，以半双工方式工作。但以太网交换机不使用共享总
线，没有碰撞问题，因此不使用CSMA/CD协议，而是以全双工方式工作。既然连以太网的
重要协议CSMA/CD都不使用了（相关的“争用期”也没有了），为什么还叫作以太网呢？
原因就是它的帧结构未改变，仍然采用以太网的帧结构。
3.4.3虚拟局域网便包：的扫一扫／有整／／：／///／成i//：／：／求／
／／／／／／换：p这差：无缺/:J
／逻虚拟局域网其实只是局域网给用户提供的一种服务，而并不是一种新型局域网。
1988年IEEE批准了802.3ac标准，这个标准定义了以太网的帧格式的扩展，以便支持虚
拟局域网。虚拟局域网协议允许在以太网的帧格式中插入一个4字节的标识符（如图3-27
所示），称为VLAN标签(tag)，用来指明发送该帧的计算机属千哪一个虚拟局域网。插入
VLAN标签的帧称为802.lQ帧。
／／64802.IQ帧2字节6以太网
MAC帧46-1500数据4FCS000000100000000呵2字节·..2字节伽图3-27插入VLAN标签后变成了802.lQ帧VLAN标签字段的长度是4字节，插入在以太网MAC帧的源地址字段和类型字段之间。
VLAN标签的前两个字节总是设置为Ox8100（即二进制的1000000100000000)，称为IEEE
•104•802.lQ标签类型。VLAN标签的后两个字节中，前面4位实际上并没有什么作用，这里不
讨论，后面的12位是该虚拟局域网VLAN标识符VID(VLANID)，它唯一地标志了
802.lQ帧属于哪一个VLAN。12位的VID可识别4096个不同的VLAN。插入VLAN标签
后，802.lQ帧最后的帧检验序列FCS必须重新计算。
当数据链路层检测到MAC帧的源地址字段后面的两个字节的值是Ox8100时，就知道
现在插入了4字节的VLAN标签。由千用于VLAN的以太网帧的首部增加了4个字节，因
此以太网的最大帧长从原来的1518字节(1500字节的数据加上18字节的首部和尾部）变
为1522字节。
这样的802.lQ帧在什么地方使用呢？我们可以用图3-28给出的简单例子来说明。交换
机＃l连接了7台计算机，组成了一个局域网（一个广播域）。现在把局域网划分为两个虚拟
局域网VLAN-10和VLAN-20。这里的10和20是虚拟局域网的编号，由交换机管理人员设
定。这个编号就是图3-27中的VID字段的值。
』:：飞，交换机＃II接入链护一／VL/1+0\/L/2\I汇聚链路1…....凭屈．．…．0点罕v三图3-28利用以太网交换机构成虚拟局域网现在我们有了两个较小的广播域。每台计算机都是通过接入链路(accesslink)连接到以
太网交换机的。管理人员划分虚拟局域网的方法有多种。例如，按交换机的端口划分，或按
MAC地址划分。每台主机并不知道自己的VID值（但交换机必须知道这些信息）。这些主机通过接入链路发送到交换机的帧都是标准的以太网帧。
在一个用多个交换机连接起来的较大的局域网中，可以灵活地划分虚拟局域网，不受
地理位置的限制。一个虚拟局域网的范围可以跨越不同的交换机。当然，所使用的交换机必
须要能够识别和处理虚拟局域网。在图3-28中，在另外一层楼的交换机＃2连接了5台计算
机，并与交换机＃l相连接。交换机＃2中的两台计算机加入到VLAN-10,而另外3台加入到
VLAN-20。这两个虚拟局域网虽然都跨越了两个交换机，但都各自是一个广播域。
连接两个交换机端口之间的链路称为汇聚链路(trunklink)或干线链路。
现在假定A向B发送帧。由于交换机＃l能够根据帧首部的目的MAC地址，识别B属
千本交换机管理的VLAN-10,因此就像在普通以太网中那样直接进行帧的转发，不需要使
用VLAN标签。这是最简单的情况。
现在假定A向E发送帧。交换机＃l查到E并没有连接到本交换机，因此必须从汇聚链
路把帧转发到交换机＃2,但在转发之前，要插入VLAN标签。不插入VLAN标签，交换机
#2就不知道应把帧转发给哪一个VLAN。因此在汇聚链路传送的帧是802.lQ帧。交换机＃2
在向E转发帧之前，要拿走已插入的VLAN标签，因此E收到的帧就是A发送的标准以太网帧，而不是802.lQ帧。图3-28说明了这种情况。
如果A向C发送帧，情况又怎样呢？这种情况就复杂些了，因为这是在不同网络之间
的通信。虽然A和C都连接到同一个交换机，但它们已经处在不同的网络中(VLAN-10和•105•VLAN-20)。这问题是互连网络中的通信问题，已经超过了本章数据链路层的范围。这要由属千上面的网络层中的路由器来解决。
一不过有的交换机中嵌入了个用专用芯片构成的转发模块，用来在不同的VLAN之间转发帧。这样就可以不必再使用另外的路由器，而就在交换机中实现了第3层的转发功能（由千使用硬件转发，转发帧的速率提高了，比使用路由器要快）。这种转发功能被称为第3层交换，而这种交换机常称为L3/L2交换机。
有了这种第3层交换机，连接到不同交换机的A和F,都能不需要经过另外的路由器而相互通信。更详细的转发过程这里就不继续讨论了。
3.5高速以太网随着电子技术的发展，以太网的速率也不断提升。从传统的10Mbit/s以太网直发展
到现在常用的速率为1Gbit/s的吉比特以太网，甚至更快的以太网。下面简单介绍几种高速一以太网技术。
3.5.1lOOBASE-T以太网lOOBASE-T是在双绞线上传送100Mbit/s基带信号的星形拓扑以太网，仍使用IEEE802.3的CSMA/CD协议，它又称为快速以太网(FastEthernet)。用户只要使用100Mbit/s的适配器和100Mbit/s的集线器或交换机，就可很方便地由lOBASE-T以太网直接升级到100Mbit/s,而不必改变网络的拓扑结构。所有在lOBASE-T上的应用软件和网络软件都可保持不变。
IOOBASE-T的适配器有很强的自适应性，能够自动识别10Mbit/s和100Mbit/s。1995年
IEEE已把lOOBASE-T快速以太网定为正式标准(IEEE802.3u)，是对现行的IEEE802.3标准的补充。
lOOBASE-T可使用以太网交换机提供很好的服务质量，可在全双工方式下工作而无冲一突发生。因此，CSMA/CD协议对全双工方式工作的快速以太网是不起作用的（但在半双工
定要使用CSMA/CD协议）。快速以太网使用的MAC帧格式仍然是IEEE方式工作时则802.3标准规定的帧格式。
然而IEEE802.3u的标准未包括对同轴电缆的支持。这意味着想从细缆以太网升级到快
速以太网的用户必须重新布线。因此，现在I0/100Mbit/s以太网都使用无屏蔽双绞线布线。
一100Mbit/s以太网的新标准改动了原10Mbit/s以太网的某些规定。我们知道，以太网有个重要的参数a,它必须保持为很小的数值。在3.3.4节曾给出了参数a的公式(3-2)
a=—:(3-2)这里r是以太网单程端到端时延，几是帧的发送时间。我们知道，To是帧长与发送速率一之比，可见为了保待参数a不变，可以使r与发送速率的乘积不变。在帧长一定的条件下，若数据率提高到10倍，可把网络电缆长度（因而使r)减小到原有数值的十分之。
一在100Mbit/s的以太网中采用的方法是保持最短帧长不变，对于铜缆100Mbit/s以太网，个网段的最大长度是100m,其最短帧长仍为64字节，即512比特。因此100Mbit/s以太网的争用期是5.12µs,帧间最小间隔现在是0.96µs,都是10Mbit/s以太网的1/10。
•106•