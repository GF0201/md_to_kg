可能收到多个 DHCP 提供报文。

0  DHCP 客户从几 个 DHCP 服务 器 中选 择其中的

一

个， 并向所选 择的 DHCP 服务器

发送 DHCP 请求报文 。

© 被选 择 的 DHCP 服务器发送确认报文 DHCPACK。 从这时起， DHCP 客户就 可以使

用这个 IP 地址了。 这种状 态叫 作 已 绑定 状 态， 因为在 DHCP 客户端的IP 地址和

MAC 地址 已经完成绑定， 并且可以开始使用得到的 临时I P 地址了。
DHCP 客户现在要根据服务 器提供的租用 期 T 设置两个计时器T 1 和T 2 , 它们的超

时时间分别是 0.5T 和0.875T 。 当超时时间到了就要请求更新租用期。

0 租用 期过了

一

新租用期。

半 （T 1 时间到）， DHCP 客户发送请 求报 文 DHCPRE Q UE S T 要求更

8  DHCP 服务器若 同意， 则发回确认报文 DHCPACK。 DHCP 客户得到了新的租用期，

重新设置计时器。

0  DHCP 服务 器 若不同意， 则发回 否 认报文 DHCPNACK。 这 时 DHCP 客户必须立即

停 止使用原来的IP 地址， 而必须重新 申 请IP 地址（回到步骤＠）。
若 DHCP 服务 器 不 响应 步 骤 0 的 请 求 报 文 DHCPRE Q UE S T , 则 在 租 用 期过 了

87. 5 ％时（兀 时间到）， DHCP 客户必须重新发送请求报文 DHCPRE Q UE ST （重复

步 骤 0)， 然后又继 续后面的步骤。

0  DHCP 客户可以随时提前终止服务器所提供的租用期， 这时只需向 DHCP 服务器发

送释放报文 DHCPRE LE ASE 即可。

DHCP 很 适 合千经常移动位置的计算机。 当计算机使用 Wi n dows 操作系统时， 点击

“

控制面板

”

“

“

的
“

网络
”

协议 后点击其

属 性

按钮， 若选 择

图标就可以找到某个连接中的

“

自 动获 得IP 地址

”

“

”

网络
“

和

下 面的菜单， 找到 TCP/ IP
”

自动获 得 DNS 服务器地址

选 项， 就 表示是使用 DHCP 协议。

6 . 7   简 单 网 络管理协议 S N M P

6.7. 1  网 络 管 理 的 基本概念

虽然网络管理还没有精确定义， 但它的内容可 归 纳为 ：

网络管理包括对硬件 、 软件 和 人 力 的使用、 综 合 与协调 ， 以 便 对网络 资源 进行监视、

测试、 配置 ｀ 分析、 评价和 控制 ， 这样就能 以合理的价格满足网络的
性 能 、 服务质量等 。 网络管理常简 称为网管 。

—

些 需 求 ， 如 实 时运行

我们可以看到， 网络管理并不是指对网络进行 行政上的管理。
网 络是

个非常 复 杂的分布式系统。 这是因为网络上有 很多不 同 厂家生产的 、 运行着

一

多种协议的节点（主要是 路 由 器）， 而这 些节点还在相互通信和交换信息。 网络的状态 总 是
一

一

不断地变化着。 可见， 我们必须使用

种机制来读取这 些 节 点上的状态信息， 有时还要把

些新的状态信息写入到这些节点上。

下 面简 单介绍网络管理模型中的主要构件 （ 如 图 6 -20 所示）。
管理 站 又称为管理器， 是整个网络管理系统的核 心， 它通常是个有着良好 图形界面的

高 性能的工作站， 并 由网络管理 员 直接操 作 和 控制。 所有 向被管设备 发送的命 令都是从管 理

站发出的。 管理站的所在部门也 常称为网络运行 中 心NOC (N etw ork Op erati ons Ce nt er)。 管

• 306  •

理站中的关键构件是管理程序 （ 如图6 - 20 中 有字母 M 的椭 圆形图标所示） 。 管理程序在运

行时就成为管理进程 。 管理站 （ 硬件） 或管理程 序 （ 软件） 都可称为管理者(manager)或管

理器， 所以这里的manager 不是指人而是指机器或软件 。 网络管理 员 (admi nistrat or)才是指人 。

大型网络往往实行多级管理， 因而有多个管理者， 而

一

个管理者

一

般只管理本地网络的设备 。

被 管 设 备

＼

被 管 设 备

网 管 协议＿ －  －  －

管

＠ － 管理程序 （ 运 行 SNMP 客 户 程 序 ）

＠ － 代理程序 （ 运 行 SNMP 服 务 器程序 ）

图 6-20 网 络 管 理 的 一 般模型

在被管网络中有很多的被管设 备 （ 包 括设备中 的 软件） 。 被管设备可以是主机、 路 由器、

打 印 机 、 集线器、 网 桥 或 调 制 解 调 器 等 。 在 每

一

个 被管 设 备 中 可 能 有 许 多 被管 对 象

(M anage d  O b ject ) 。 被管对象可以是被管设备中的某个硬件 （ 例如，

一

块网络接 口 卡）， 也可

以是某些硬件或软件 （ 例如， 路 由选 择协议） 的配置参数的 集合 。 被管设备有时可称为网络

元素或简称为网元 。 在被管设备中也会有

一

些不能被管的对象 （在 下 面 的 6.7. 2 节 将会讲到

对 象命名树， 所谓不能被管的对 象就是不在对 象命名树上的对 象） 。

一

在每

个被管设备中都要运 行

一

个 程 序以便和 管 理站 中 的管理 程 序进行通信 。 这 些运

行着的程 序叫作网络管理代理程序， 或简 称 为代理(age nt )

（ 如图6 - 20 中有字母A 的几 个椭

圆形图标所示） 。 代理程序在管理程序的命 令和控制 下 ， 在被管设备上采取本地的行动。

在 图 6 - 20 中还有

的作用 。

一

个重要构件就是网 络管理协议 ， 简称 为网管协议 。 后面还要讨论它

简单网络管理协议 SNMP (Sim ple  N etw ork M anagem ent  P rot oc ol )中的管理程 序和代理程

序按客户服务 器方式工作。 管理程序运行SNMP 客户 程序， 而代理程 序运 行SN MP 服 务器

程序 。 在被管对 象上运行的SN MP 服务 器 程 序 不 停 地 监 听来自管理站的SN MP 客户程序的

请求（或命令） 。

一

旦发现 了 ， 就立即返回管理站所需的信息， 或执 行某个动作（例如， 把

某个参数的设置进 行 更 新 ） 。 在网管系统 中往往是

一

个（或少数几 个） 客户程 序 与 很多的服

务器程序进行交兀 。

关千网络管理有

一

个 基 本 原理， 这 就是：

若要管理某 个 对 象 ， 就必 然 会 给该 对 象 添加

对象的影响必须尽 量 小 些 。

SNMP 正是按照这样的 基 本 原 理来设计的 。

一

些 软件 或 硬件 ， 但 这 种

“

“

添加

对原 有

SNMP 发布于 19 88年 。 O S I 虽 然在这之前就 已制定出许多的网络管理标准， 但当时

（ 到现在也很少） 却没有符合O S I 网管标准的产 品 。 SN MP 最重要的指导思 想就是要尽可

能简单。 SNMP 的基本功能 包括 监视网络性能、 检测 分析网络 差 错和配置网络设备等 。 在网

络 正常工作时， SNMP 可实现统计、 配置和测 试等功能 。 当网络出故 障时， 可实现各种差 错
检测和恢 复功能 。 经过近 二十年的使用， SNMP 不断 修订 完善， 较 新的版本是SNMP v3 , 而

•  30 7  •

前两个版本分别是SNM P v2 和SNMP v l 。 但

一

般可简称 为 S NM P 。 SNMP v3 最大的改进就

是安全特性。 也就是说 ， 只有被授权的人 员 才有 资格执 行 网络 管 理 的功能（如关 闭某
一

路 ） 和读取有关 网络 管 理的信 息（如读取
”

个配置文件的 内容）。 然 而SN MP 协议 已相 当 庞
， 整个标准共有 八个 RFC 文档[RFC 3411 -341 8 , ST D6 2]。 因此这里

简单

大 ，

一

“

一

条链

点也 不
一

只能给出

些最基本 的 概 念。

若网络元素使用的不是SNM P 协议而 是 另

种 网络管理协议 ， 那么 SNMP 协议就 无法
控制 该网络 元素。 这 时可使用委托代理( pro x y agent )。 委托代理能 提供如协议 转换和过 滤 操
作 等功能对被管对 象进行管 理。

一

S NMP 的 网络 管 理 由三个部分 组 成 ， 即 SNM P 本 身、 管理 信 息结构 SMI

(S truc tu re o f

M anagem ent I nformati on )和管理 信 息库 M I B (M anagem en t I n formatio n  Ba s e)。 下面简 述这 三

部分的作用。

SN MP 定义了 管理站和代理之 间所 交换的分组格式。 所交换的分组包含各代理中的对 象

（变量 ） 名及其状态（值 ）。 SNM P 负 责 读取和改变这些数值。

SM I 定义 了 命 名对 象和定义对 象 类 型（包 括 范 围和 长度） 的通用规则 ， 以及把对 象和

对 象的值进行编码的规则。 这样做 是 为了 确 保 网络管理数据的语法和语 义 无二 义性。 但从

SM I 的名称并不能看出 它的功能。 请 注 意 ， SM I 并不定义

一

个实体应管理的对 象数目 ， 也

不定义被管对象 名以及对 象 名及其值之 间的关联。

M IB 在被管理的实体中创建了命 名 对 象 ， 并规定了其类型。
为了更好地理解上述的 几个组成部分 ， 可以把它们和程 序设计进行

一

下对比。

我们在编 程时要使用某种语言， 而 这 种语言就是用来定义编 程的规则。 例如 ，

一

个变

量 名必须从字母开始而后面接着是字 母数字。 在网络 管 理 中 ， 这些规则 由SMI 来定义。

在程 序设计中必须对变量进行说 明 。 例如 ， i nt c ou nter , 表示 变 量c ou nter 是整数类型。

MI B 在网络 管 理 中就做这样的事情。 M I B 给每个对 象命名 ， 并定义对象的类型。

在编 程中的说明语 句之 后 ， 程 序 需 要 写 出

一

些语 句用来存储变最的值 ， 并在需要时改

变这些变量的值。 协议SNM P 在网络 管 理 中 完成这件任务。 SNM P 按照SM I 定义的规则 ，

存储、 改变和解释这些 已 山M IB 说明的对 象的值。

总之 ， SMI 建立规则 ， M IB 对变量进 行说明 ， 而S NMP 完成网管的动作。

一一

下 面就

介绍上述的三个构件。

6.7.2  管理信 息 结 构 SMI

管理 信 息结构SMI 是SN MP 的重要 组成部分。 根据 6. 7. 1 节所讲 ， SM I 的功能应当有

三个 ， 即规 定 ：

(1 ) 被管对 象应怎样命名；

( 2) 用来存储被管对 象的数据类 型 有 哪 些；

(3) 在 网络上传送的管理数据应如 何编 码。

1. 被管对象的命名

SMI 规 定 ， 所有的被管对 象都必须处 在对象命名树( object na mi n g t ree)上。 图6- 21 给出

了 对 象 命 名 树的

一

部分。 对 象 命名树的根没有 名 字 ， 它 的 下 面有 三个顶级对 象 ， 都是世 界上

著名的标准制定单位 ， 即IT U-T （过 去 叫作CCIT T ) 和ISO , 以及这 两个组织的联合体 ， 它

• 308  •

们 的标 号 分 别 是 0 到 2 。 图 中 的对 象 名 习 惯上用 英 文 小 写 表示 。 在 ISO 的 下 面 的
3 的 节 点 是 ISO 认 同 的 组 织 成 员 org 。 在 其 下 面 有
个 美 国 国 防 部 dod (Department  o f
Defense) 的 子 树 （ 标 号 为 6 ) ， 再 下 面就是 internet （ 标 号 为 1 ) 。 在 只 讨 论 internet 中 的对 象 时 ，
可 只 画 出 internet 以 下 的 子树 ， 并在 internet 节 点 旁边 写 上对 象标识符 1 .3 .6. 1 即 可 。

个 标 号 为

一

一

根

itu-t (0) is9 ( 1)  iso/itu-t

(2)

org (3)

dod,(6)
|
intem�t
／
mgmt (2)

(1)＜ 尸 1 .3 . 6 .1(iso.org.dod.intemet)

mib-2 ( 1 )＜� 1 .3 . 6. 1 .2 .  l (iso.org.dod.intemet.mgm t.mib-2)

sy�tem(l )  · ·  interfaces
/ I
/ 1 \
/1 \

(2)  at(3) ip(4) icmp(5) tcp(6) udp(7) egp(8). . .

/I

� ]-\  !I \

.

iplnReceives

(3)＜ 尸 1 .3 .6.1 .2.1 .4.3

/ 1 \   / 1 \   / 1 \

图 6-21 SMI规 定 所有被管对 象必 须在命 名 树上

一

在 internet 节 点 下 面 的 标 号 为 2 的 节 点 是 mgmt （ 管 理 ） 。 再 下 面 只 有

个节 点 ， 即 管理
信 息 库 mib-2 , 其对象标识符为 1 .3.6. 1 .2 . 1 。 在 mib-2 下 面包含 了 所有被 SNMP 管 理 的 对 象
（ 见 下 面 6.7.3 节 的讨 论 ） 。

2 . 被管对象 的数据类型

CD

一

了

) 来 定 义 数据 类 型 ， 但 又增 加
SMI 使 用 基 本 的 抽 象语法记法 l
些 新 的 定 义 。 因 此 SMI 既是 ASN. 1 的 子 集 ， 又 是 ASN. 1 的 超 集 。 ASN. 1 的 记法 很 严 格 ，

（ 即 I SO 制 定 的 ASN. l

“ 一

它 使得数据 的 含义 不 存 在 任 何 可 能 的 二 义性 。 例 如 ， 使 用 ASN. 1 时 不 能 简 单地 说

个 具

有 整 数值 的 变 量

， 而 必 须 说 明 该 变 量 的 准 确 格 式 和 整数取 值 的 范 围 。 当 网 络 中 的 计 算机对

数 据 项 并 不 都 使 用 相 同 的 表 示 时 ， 采用 这种精确 的 记法就尤其重要 。

“

”

一

我 们 知 道 ， 任 何 数 据 都 具 有 两 种 重 要 的 属 性 ， 即 值(value) 与 类 型(type) 。 这 里

值

是

“

”

”

一

则 是值集合 的 名 字 。 如 果给 定

种 类 型 ， 则 这 种 类 型

一

某个值集合 中 的

一
个元素 ， 而

的

个值就是 该 类 型 的

类 型
个 具 体 实例 。

SMI 把 数 据 类 型 分 为 两 大 类 ： 简 单 类型和结构化类型 。 简 单 类 型 是 最 基 本 的 、 直接 使

用 ASN. 1 定 义 的 类 型 。 表 6-4 给 出 了 最主 要 的 几种 简 单类 型 。

0 注：

ISO 原 以 为还会制 定 出 更 多 的抽 象语法记法 ， 但 实 际上到 目 前 为止并没有第 二 个 抽 象语法记 法 出 现 。 因 此 ASN . l 似

应 写 为 ASN 。 抽象语法 只 描述 数 据 的 结 构 形 式 且 与 具 体 的 编 码格 式无关 ， 同 时 也 不 涉 及 这 些 数据 结 构 在 计 算 机 内 如 何存 放 。

•  309  •

表 6-4 几种最主要的 简 单 类型

类型

大小

4 字节

在－2

3 1

3 1

到 2

— l 之 间 的 整 数

说明

4 字节

和 INTEGER 相 同

4 字节

32

在 0 到 2

- I 之 间 的 无 符 号 数

INTEGER

Interger32

Unsigned32

OCTET STRING

OBJECT IDENTIFIER

可 变

可 变

不超过 6553 5 字节 长 的 字节 串

对 象 标 识 符

IP Address

Counter32

Time Ticks

B ITS

Opaque

4 字节

由 4 个 整 数 组 成 的 IP 地址

4 字 节

可 从 0 增 加 到 2

32

的 整 数 ； 当 它 到 达 最 大值 时 就返 回 到 0

4 字节

记录 时 间 的 计 数 值 ， 以 1 / 1 00 秒 为 单位

比 特 串

可 变

不 解 释 的 串

SM I 定义了两种结构化数据类型， 即s eq u ence 和s eq u enceo f。
数据类型 seq u ence 类似于C 语 言 中的st ruct 或 record , 它是
一

一

些简 单数据类型的组合

（ 不

定要相同的类型） 。 而数据类型s eq u ence o f 类似于C语言中的 array , 它是同样类型

的简单数据类型的组合， 或同样类型的s eq u ence 数据类型的组合 。

3. 编码方法

SM I 使用 ASN .1 制定的基本 编码规则 BE R ( Basic E nco di n g Ru le)进行数据的编码 。 BE R

指明了每种数据的类型和值 。 在发送端用 BE R 编码， 可把用 ASN.
一

l 所表 述的报文转换成唯

的比特序列 。 在接收端用 BE R 进行解码， 就可得到 该比特序列所表 示的 ASN . 1 报 文 。

初看起来， 或许用两 个字段就 能 表 示类型和值。 但 由 千表示值可能需要多 个字节， 因

此还需要

一

个指出

“

要用多少字节表示值

”

的长度字段 。 因此 AS N. l 把所有的数据元素都

表示为 T -

L

- V 三 个字段组成的序列 （ 见图6 - 22 ) 。

T 字段( Tag)定 义 数 据的 类 型，

L 字段

( L en gt h )定义 V 字段的长度， 而 V 字段( Valu e)定 义 数 据的值 。

字节 l

可 变

数据 元 素 1 标记 T j 长度门

可 变

值 V

位

2

号编－

5

图 6-22 用 TLV 方法进 行编码

(1 )  T 字段又叫作标记字段， 占 1 字节 。
T 字段又 再分为以下 三个子字段 ：

多 。

T 字段比较 复 杂 ， 因为它要定义的数据类型较

•  类别 ( 2 位） 共 四种 ： 通用类(00 )， 即 ASN . l 定义的类型； 应用类(01 )， 即SM I 定
义的类型； 上 下文类(10 )， 即上下文所定义的类型； 专用类(11 )， 保 留为特定厂商
定 义的类型 。

•  格式 (1 位） 共 两种， 指出数据类型的种类 ： 简 单数据类型( 0 )， 结 构化数据类型

(1 ) 。

•  310  •

一

•  编号 ( 5 位 ） 用 来标 志 不 同 的 数据 类 型 。 编 号 的 范 围

般为 0 ~  30 。 当 编 号 大 千 30
时 ， T 字段就要 扩展 为 多 个字 节 （ 这种情 况很少 用 到 ， 可参考 ITU-T X.209 , 这 里
一
从 略 ） 。

表 6-5 是

些数据 类 型 的 T 字段 的编码 。

INTEGER

数据类型

OCTET STRJNG

OBJECT IDENTIFIER

NULL

Sequence, sequence of

IPAddress

Counter

Gauge

Time Ticks

Opaque

表 6-5 几种数据类型的 T 字段编码
类别

T 字段 （ 二进制 ）

00

编号

格式

00  。 000 1 0
00  。 00 1 00
00  。 00 1 1 0
00  。 00 1 0 1
0 1   。 00000
0 1   。 0000 1
0 1   。 000 1 0
0 1   。 000 1 1
O l  。 00 1 00

1 0000

I

000000 1 0

00000 1 00

00000 1 1 0

00000 1 0 1

00 1 1 0000

0 1 000000

0 1 00000 1

0 1 0000 1 0

0 1 0000 1 1

0 1 000 1 00

T 字段 （ 十六进制 ）

02

04

06

05

30

40

4 1

42

43

44

(2)  L 字段 又 叫 作长度字段 （ 单字 节 或 多 字节 ） 。 当 L 字 段 为 单 字 节 时 ， 其 最 高位为 0 ,

后 面 的 7 位 定 义 V 字段 的 长 度 。 当 L 字段为 多 个 字 节 时 ， 其 最 高 位 为 1 , 而 后 面 的 7 位定
义 后 续 字 节 的 字 节 数 （ 用 二进制 整数表 示 ） 。 这 时 ， 所 有 的 后 续 字 节 并置起来 的 二 进 制 整 数
定 义 V 字段 的 长度 。 图 6-23 给 出 了 L 字 段 的 格 式举例 。
、
r
o|1|o|
o|o|o|o|

入
指 出 V 字段长度 ＝ 2 字节

单 字 节 的 L 字段 田

2

V

262

人
指 出 后续字节 数 ＝
”o|o|o|o|o
、 尸
r

一～
字段 长度 ＝
字 节
o|1HIo|
1 |  |o|o|o|o|
|1|o||o|o|o|o|o|o|o|

指 出

多 字 节 的 L 字段

，

后 续字 节 数 ＝ 2-

图 6-23 L 字段 的格式举例

(3) V 字 段 又 叫 作 值 字段 ， 用 千 定 义数据 元素 的 值 。
根据 以 上 所述 ， 我们 给 出 两 个 用 十六进制 表 示 的 编 码例 子 。 例 如 ，

INTEGER 1 5 , 根 据
INTEGER 类 型 要 用 4 字 节 编 码 。 最后 得 出 TLV 编
表 6-5 , 其 T 字 段 是 02 , 再 根据 表 6-4 ,
码 为 02 04  00  00  00  0 F 。 又 如 IPAddress 1 92 . 1 .2.3 ,  IPAddress 的 T 字段是 40 , V 字段 需 要 4
字 节表 示 ， 因 此 IPAddress 1 92. 1 .2.3 的 TLV 编 码 是 40 04

O 1  02 03 。

co

6.7.3  管 理 信 息库 MIB

TLV 方法 中 的 V 字段还可嵌套其他数据 元素 的 TLV 字 段 ， 并 可 多 重嵌套 。

“

”

所 谓

管理信息

就 是 指 在 互 联 网 的 网 管框 架 中 被 管对象 的 集 合 。 被 管 对 象 必 须 维 持

一

可供管理程序 读 写 的 若干控制 和状态信 息 。 这些被管对象构成 了

个虚拟 的 信 息存储器 ， 所
以 才称 为管理信息库 MIB 。 管理程序就使用 MIB 中 这 些 信 息 的 值对 网 络进 行 管 理 （ 如 读 取
•  3 1 1  •
或重新 设置这些值 ） 。 只 有在 MIB 中 的 对 象 才 是 SNMP 所 能够 管 理 的 。 例 如 ， 路 由 器应 当

一

维持各 网络接 口 的 状 态 、 入分组和 出 分组 的 流 量 、 丢 弃 的 分组和有差错 的 报 文 的 统 计信 息 ，

而 调 制 解调 器 则 应 当 维持发送和 接 收 的 字 符数 、 码元传输速率和接 受 的 呼 叫 等 统 计信 息 。 因
一
此在 MIB 中 就必 须有 上面这样

些信 息 。

我们再看

下 图 6-2 1 , 可 以 找 到 节 点 mib-2 下 面 的 部 分 是 MIB 子 树 。 表 6-6 给 出 了 节

点 mib-2 所包含 的 前 八个信 息 类 别 代表 的 意 思 （ 在 后 面还有好几个类别 ） 。

表 6-6 节 点 mib-2 所包含的信息类别举例

类别

system

interfaces

address translation

ip

icmp

tcp

udp

egp

一

标号
( I )

(2)

(3)

(4)

( 5 )

(6)

(7)

(8)

所包含的信息

主 机 或路 由 器 的 操 作 系 统

各种 网 络 接 口

地址转换 （ 例 如 ，
IP

软 件

ARP

映射 ）

ICMP

软件

TCP

UDP

EGP

软件

软 件

软件

我们 可 以 用 个简 单例 子进

步 说 明 MIB 的 意 义 。 例 如 ， 从 图 6-2 1 可 以 看 出 ， 对 象 ip

的 标 号 是 4 。 因 此 ， 所有与 IP 有 关 的 对 象都从前缀 1 .3.6. 1 .2 . 1 .4 开 始 。

曰定 ：

( 1 ) 在 节 点 ip 下 面有个名 为 iplnReceives 的 MIB 变量 （ 见 图 6-2 1 ) ， 表示收到 的 IP 数据

报 数 。 这 个 变 量 的 标 号 是 3 , 变 量 的 名 字
而 相 应 的 数值表示 是 ：

1 . 3 .6. 1 .2. 1 .4.3 。

iso.org.dod.internet.mgmt.mib. ip. iplnReceives ,

一

(2) 当 SNMP 在 报 文 中 使用 MIB 变 量 时 ， 对 于 简 单类 型 的 变 量 ， 后 缀 0 指 具 有 该 名 字
iplnReceives 的 数值 表

的 变量 的 实例 。 因 此 ， 当 这个变量 出 现在 发送给路 由 器 的 报 文 中 时 ，
示 （ 即 变 量 的

一
个 实例 ） 就 是 ：

1 . 3 . 6. 1 .2. 1 .4. 3 .0 。
个 MIB 变量 的 数值 或 后 缀 是 完 全 没 有 办法进行推算 的 ， 必

(3) 请注 意 ， 对 于 分配给

须 查 找 已 发 布 的 标 准 。

上 面 所 说 的 MIB 对 象命 名 树 的 大 小 并没有 限 制 。 下 面给 出 若干 MIB 变 量 的 例 子 （ 见表
变 量

6-7 ) ， 以 便 更好地理解 MIB 的 意 义 。 这 里 的

是指特定对 象 的

个 实 例 。

表 6-7 M I B 变 量 的 例 子

“

”

一

M I B

变温

sysUpTime

ifNumber

itMtu

ipDefaultTTL

ipinReceives

ipForwDatagrams

ipOutNoRoutes

ipReasmOKs

ipFragOKs

ipRoutingTable

ip

ip

ip

ip

甲
ip

ip

所属类别

system

interfaces

interfaces

意 义

距上次重启 动 的 时 间

网 络接 口 数

MTU

特 定 接 口 的 最大传送单元
IP

在 生 存时 间 字 段 中 使 用 的值

接 收 到 的 数据 报 数 目

转 发 的 数据 报 数 目

路 由 选择 失 败 的 数 目

重 装 的 数据报数 目

分 片 的 数 据 报 数 目
IP

路 由 表

icmplnEchos

icmp

ICMP

收 到 的

回送请求数 目

•  3 1 2  •

续表

M I B 变量

所属类别

意 义

tcpRtoMin

tcpMaxConn

tcplnSegs

udplnDatagrams

tcp

tcp

tcp

udp

TCP 允 许 的 最 小 重传 时 间

允 许 的 最 大 TCP 连接数 H

已 收 到 的 TCP 报文段数 目

已 收 到 的 UDP 数 据 报 数 目

上面列 举的大多数项 目 的值可用

M IB 变量 ip Routi n gT ab le则定 义

一

一

个整数来表示 。 但M I B 也定义 了 更复 杂的结构。 例如，
些 MI B 变量定义 了 路 由表
一

个完整的路 由表。 还有其他

一

项 目 的 内容， 并 允许网络管理协议访问路 由 器 中的单个项 目 ， 包括前缀、 地址掩码以及下

跳地址等。 当 然， M IB 变量只给出了每个数据项的逻辑 定 义， 而

一

个路 由 器使用的 内部数

据结构可能与M IB 的定义不 同。 当

一

个查询到达 路 由 器时 ， 路 由 器上的代理软件负 责M IB

变量和路 由器用于存储信息的数据结构之间的映 射。

6.7 .4  SNMP 的 协议数据 单 元 和 报 文

实 际上， SN MP 的操作只有两种基本的管理功能 ， 即 ：

( 1 )

( 2)

＂

“

“

“

读

写

操作 ， 用Get 报 文来检测各被管对 象的状 况；

操作， 用S et 报 文来改变各被管对 象的状况。

SNMP 的这 些功能通过 探询操作来实现， 即SNM P 管理进程定时向被管理设备周 期性

地发送探询信息。 上述时间间 隔 可通过 SNMP 的管理信息库M IB 来建立。 探询的好处是：

一

第

， 可使系统相对简单； 第二， 能限制通过网络所产生的管理信息的通信量。 但探询管理

协议不够灵活， 而且所能管理的设备数 目 不能太多。 探询系统的开销也较大。 如探询频繁而

并 未得到有用的报告 ， 则通信线路和计算机的CP U 周 期就被浪费了。

但SN MP 不是完全的探询协 议 ， 它 允许不经过询问就能发送某 些信息。 这种信息称为

陷 阱(t rap )， 表示 它能够 捕 捉

”

事件

”
。 但这种 陷 阱信息的参 数是受限制的。

当被管对 象的代理 检 测到有事件发生时 ， 就 检查其门限值。 代 理只向管理进程报告达

到某些门限值的事件（这就叫作过滤）。 这种方法的好处是： 第

一

， 仅在严重事件发生时才

发送陷 阱 ； 第二， 陷 阱信息很简 单且所需字节数很少。

总之， 使用探询（至少是周 期性地） 以维 持对网络资源的实时 监视 ， 同 时也 采 用 陷 阱

机制报 告特殊事件 ， 使得SN M P 成为

一

种 有 效的网络管理协议 。

SNMP 使用无连接的 UDP , 因此在网络上传送SNM P 报 文的开销较小。 但 UDP 是不保

证 可靠交付的。 这里还要指出 ， SNMP 使用 UDP 的方法有些特殊。 在运行代理程序的服务

器端用熟知端 口 161 来接收Get 或S et 报 文和发送响应报文（与熟知端 口 通信的客户端使用

临时端 口 ） ， 但运行管理程序的客户端则使用熟知端 口 16 2 来接 收来自各代理的t rap 报文。

SNMP 现在共定义了如表 6 -8 所示的 8 种类型的协议数据单元[R FC 341 6 ,  ST D6 2]， 其

中P DU 编 号为4 的已经废 弃了。 在P DU 编 号后面是对应的T 字段值（十 六进制形式表示）。

表 6-8 SNMP 定义 的协议数据单元类型

PDU 编号 ( T 字段 ）

0  ( AO )

1
I

PDU 名 称

1

一

一

用 途

GetRequest

管理者从代理读取

个 或

组 变 量 的 值

• 313 •

续表

PDU 编 号 ( T 字段 ）

PDU 名 称

用 途

l

( A l )

GetNextRequest

管 理 者 从代理读取 MIB 树t 的 下

一

个变蛇的值 （ 即使不知道此变量 名 也 行 ）。 此

操 作 可 反 复 进 行 ， 特 别 是 按 顺 序

一 －

读 取 列 表 中 的 值 很 方 便

2  ( A2 )

Response

代 理 向 管 理 者 或 管 理 者 向 管 理 者 发送 对 扛 种 Request 报 文 的 响 应 ， 并提供差错

3  ( A3 )

5  ( A5 )

6  ( A6 )

7  ( A7 )

8  ( A8 )

码 、 差 错 状 态 等 信 息

SetRequest

管 理 者 对 代 理 的

一

个 或 多 个 M I B 变 量 的 值 进 行 设 置

GetBulkRequest

管 理 者 从代理读取 大 数 据 块 的 值 （ 如 大 的 列 表 中 的 值 ）

lnformRequest

管 珅 者 从 另

－

远 程 管 理 者 读 取 该 管 理 者控 制 的 代 理 中 的 变 量值

SNM Pv2Trap

代理 向 管 理 者 报 告 代 理 中 发 生 的 异 常 事 件

Report

在 管 理 者 之 间 报 告 某 些 类 型 的 差 错 ， 目 前 尚 未 定 义

和 大 多 数 TCP/ IP 协 议不

一

样 ， S NM P 报 文 没有固定的字段 。 相 反 ， 它 们使用标准

AS N .1 编 码 。 因此 ， SNMP 报文用人工进行编码和理解时都比较 困 难 。 为此 ， 在图6- 24 中
个SNM P 报文共 由 四 个部分组成 ， 即版本 、 首

给出 了 S NM P v l 的报文格式 。 可以看 出 ，

一

部 、 安 全 参 数 和 SNM P 报 文的 数 据 部 分 。 目 前 最新版本是版本 3 。 首部 包 括 报 文标识

(m es s age i dent i fic at i on )、 最大报文长度、 报文标志(m ess age flag) 。 报文标志 占1 字节 ， 其中

一

的每

位定 义安 全类型或其他信息 。 安 全参数用来产生报文摘要（见 下

一

章的7 .3. 1 节） 。

。

2

节字

『卉字8

1
卜

IP 数据报

UDP 数据报

SNM P 报 文

4

A

SNMP 报 叉 的 数据 部 分

类 型1 请求 1DI 差错状态l差错索 引1 名 1 值 1 名 1 值 「． ．． I
SNM P PDU 十

变量绑定

————

首部

—一

-

l__t

有 关 加 密信思的字段

图 6-24

SNMP 的 报 文格式

从图6- 24 可看出 ， 在SNM P PDU 前 面还有两个有关加密信息的字段 。 这是当数据部分

需 要加 密时才使用的两 个字段 。 与网络管理直接相 关的 是后面的SNMP P DU 部分 。 对千表

6- 8 给出的前 四 种P DU 的格式都是相同的 ， 即 由P DU 类 型、 请求 I D、 差错状态、 差错 索 引

以及变 量绑定这 几 个字段组成 。 PDU 的 各种类型以及类型的编 号和 T 字段的编码已在表 6- 8

中给出 。 下 面简单 介 绍

一

下 其他 字段的作用 。

(1 ) 请求 I D (req u est

I D)

由 管理进程设置的 4 字节整数值 。 代理进程在发送响应报

文时也要返 回此请求 ID 。 由千管理进程可 同时向 许多代理 发出请求读取变量值的报 文 ， 因

此设置 了 请 求 I D 可使管理进程 能 够 识 别 返 回的响应是对应于 哪

一

个 请求报文 。

( 2) 差错状态( errorst atus )  在请求报文中 ， 这 个字段是零 。 当代理进程响应时 ， 就填
一
l 表 示t oo Bi g（代理无法把 回答

个数字 。 例如 0 表示 no Erro r（

切 正常） ，

一

入 0 ~1 8 中的

一

装入到

个SNM P 报文之 中 ） ， 2 表示 noSuc hN am e（操作指明 了

一

个不存在的变量 ） ， 3 表

示badValu e（无 效值或无效语法 ） ， 等等[ RFC3416 ] 。

• 314  •

(3) 差错索 引 (error index)

在请求报 文 中 ， 这 个 字段 是 零 。 当 代 理 进 程 响 应 时 ， 若 出
现 noSuchName, badValue 或 readOnly 的 差错 ， 代 理 进 程 就 设 置一 个 整 数 ， 指 明 有 差 错 的 变

量 在 变 量 列 表 中 的 偏 移 。

(4) 变 量 绑定(variable-bindings)

指 明 一 个 或 多 个 变 量 的 名 和 对 应 的 值 。 在 请 求 报 文

中 ， 变 量 的 值 应 忽 略 （ 类 型 是 NULL ) 。

为 了 大致 了 解 ASN. l 给 出 的 定 义 的 形 式 ， 下 面 举 出 定 义 GetRequest-PDU 的 例 子 。 两 个

连 字 符

”

”

-－

后 面 的 是 注 解 。

Get-request-POU : := [OJ

IMPLICIT SEQUENCE {

--[O]表示上 下 文类 ， 编 号 为 0
－类 型 是 SEQUENCE
－－变量 request-id 的 类 型 是 integer32
-－变量 error-status 取 值 为 0 ~  1 8 的 整数

mteger32,
INTEGER  {0.. 1 8 } ,
INTEGER {O.. max-bindings} , －－变量 error-index 取 值为 0 ~ max-bindings 的 整 数

request-id

error-status

error-index

vanable-bindings  VarBindList  }

－－变量 variable-binding 的 类 型 是 VarBindL1st

但变量 VarBindList 是什 么 类 型 呢 ？ 还 需 要 继 续 定 义 （ 这 里 从 略 ） 。 上面 ASN . l 定 义 中

的 第 二 行 中 的 IMPLICIT 叫 作 隐 式 标记 ， 是 为 了 在 进 行 编 码 时 可 省 去 对 IMPLICIT 后 面 的 类

型 (SEQUENCE) 的 编 码 ， 使 最 后 得 出 的 编 码 更加 简 洁 。

下 面 我们 假 定 管 理 者 发送 GetRequest-PDU , 为 的 是 从某 路 由 器 的 代 理 进 程 获 得

“

收 到

的 信 息 。 从 图 6-2 1 可 以 查 出 ， mib-2 下 面第 7 个 节 点 是 udp , 而 udp 节
UDP 数据报 的 数 目
点 下 面 的 第 一 个 节 点 就 是 udpinDatagrams 。 由 千 这 个节 点 已 经 是 叶 节 点 （ 即 没 有 连 接在 它 下

”

面 的 子 节 点 了 ） ， 读 取 这 个 节 点 的 数值 时 应在 节 点 标识 符 后 面 加 上 O , 即 1 . 3 . 1 . 1 .2 . 1 . 7 . 1 .0 。 这

样 ， 可得 出 GetRequest-PDU 的 ASN. l 编 码 ， 如 图 6-25 所示 。

T

I  L

OBJECT IDENTIFlER1  09 10 1  03 06 0 l \2 O l  Ol  O l  OO
I .   3.  6.  I .   2.  I .   7.  I .  0

图 6-25 GetRequest-PDU 的 ASN. 1 编 码

可 以 把 图 中 各 字 段 的 十六 进 制 编 码 表 示 如 下 。

AO I D

0 2  04 0 5  A E  5 6  02

02 0 1  00

02 0 1  00

30 OF

30 OD

reques曰d = 05 AE 56 02

-- GetRequest-PDU , 上 下 文 类 型 ， 长 度 1 o , 6  =  29
-- INTEGER 类 型 ， 长 度 04 1 6 ,
-- INTEGER 类 型 ， 长度 0 1 1 6 • error status = oo , 6
- - INTEGER 类 型 ， 长度 0 1 1 6 ' error index =  00 1 6
-- SEQUENCE OF 类 型 ， 长度 OF 1 6 = 1 5
-- SEQUENCE 类 型 ， 长 度 OD 1 6 =  1 3

•  3 1 5  •

