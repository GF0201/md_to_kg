(2) 万 维网和 HTTP协议， 以及 万维网的 两种 不 同的信 息搜索 引 擎。
(3) 电子邮件 的传送过程， SM TP协议和 POP3 协议、
(4) 动态 主机配置协议 DHCP的特点 。
(5) 网络管理的三个组成部分 ( SNM P本身 、 管理信 息结构 SM I 和管理信 息库 M IB)

IMAP协议 使用的场合。

的作用。

(6) 系 统调用和应用编程接口的基本概念。

(7)  P2P文件 系 统。

域名 系统

D N S

6 . 1

6. 1 . 1   域 名 系 统概述

域名 系统 DNS (Domain  Nam e  System )是互联网使用的命 名 系 统， 用来把便于 人 们 使用
的机 器名 字转换 为 IP地址 。 域 名 系 统其实就是名 字系 统。 为 什么 不叫 “ 名 字 ” 而 叫 “ 域 名 “
呢？这 是 因为在 这种互联网的命 名 系 统中 使用了许 多 的 ＂ 域 ” (domain)， 因此就 出现了 ＂ 域
＂ 域名 系 统 ” 很明确地指明这种系 统是用在互联网中的。
名 “ 这 个名 词 。

许 多 应用 层软件经常直接使用域 名 系 统 DNS。 虽 然计 算 机的用户只是间 接 而 不是直接

使用域 名 系 统， 但 DNS 却为互联网的各种网络 应用提供了核心服务。

用户 与互联网上 某 台主机 通信时， 必须 要知道对方的 IP地址。 然而用户 很 难记住长达
32 位的二进制 主机地址。 即 使是点 分十进制 IP地址也并 不太 容 易记忆。 但在 应用 层为了便

千 用户 记忆各种网络 应用， 连接在互联网上的 主机 不仅 有 IP地址，而且 还有便于用户记忆
的 主机 名 字。 域 名 系 统 DNS 能够把互联网上的 主机名 字转换为 IP地址。

早 在ARPANET 时代， 整个网络上只有 数百 台计 算 机， 那时 使用一个叫 作 hosts 的文件，

列 出所有 主机 名 字和 相应的 IP地 址。 只要用户 输入 一 台 主机 名 字 ， 计 算 机就可很快地把这
台主机 名 字转换成 机器能够 识别的二进制 IP地址。

为什么 机 器 在 处理 IP数据报时 要 使用 IP地址 而 不 使用域 名 呢？这 是因为 IP地址的长
度是固 定的 32 位 （ 如果是 1Pv6地址， 那就是128 位， 也是定长的）， 而 域 名 的长度 并 不是

固 定的， 机 器 处理起来比 较 困 难。

从理论上讲， 整个互联网可 以只使用一个域 名 服务 器， 使它 装 入 互 联网上所有的 主机
名 ， 并 回 答所有对 IP地址的查询 。 然而这种做法 并 不可取。 因为互联网规模 很大， 这 样的
域 名 服务 器肯 定会 因过负 荷 而无法正常工 作， 而且一 旦 域 名 服务 器 出现故 障， 整个互联网就

会瘫痪。 因此， 早 在 1983 年互联网就开始采用 层次树状结构的命 名 方法， 并 使用分布 式的
域名 系统 DNS [RFC 1034, RFC 1035, STD13]。

互联网的域 名 系 统 DNS 被设 计成为一个联 机 分布 式 数据 库 系 统， 并 采用客户 服务器方
式。 DNS 使大多 数名 字 都在 本地进行解析(resolve)CD, 仅少量解析需要在 互联网上 通信 ， 因
此 DNS 系 统的效率 很高。 由千 DNS 是分布 式 系 统， 即 使单个计 算 机 出了故障， 也 不会妨碍

整个 DNS 系 统的正常运行。

心 注： 在 TCP/IP 的 文档 中 ， 这种地址转换常称为地址解析。 解 析 就 是转 换 的 意 思 ， 地址解析可能会包含 多 次 的查询请求

和 回 答过 程 。

•  261  •

域 名 到 I P 地址的解析是由分布在互(cid:7110)网上的许多域名 服务器程序（可简称为域 名 服 务

器） 共 同 完成的。 域 名 服务器程序在专设的(cid:7188)点 上运行， 而人们也常把运行域 名 服务器程序

的机器称为域名 服务器。

域 名 到IP地址的解析过程的要点 如下： 当某 一个应用进程需要把主机名 解析 为IP地址
时 ， 该应用进程就调用解析程序( re s olve r )， 并成为 DN S 的一个客户 ， 把待解析的域 名放在
DN S 请 求 报 文中， 以 UDP用户 数据报方式发给本地域 名 服 务 器（ 使用 UDP是为了减少开

销 ）。 本地域名 服务器在查找域 名后， 把对应的IP地址放在回答报文 中 返 回。 应用进程获得
目的主机的I P 地址后即 可进行通信。

若本地域 名 服务器不(cid:7126) 回答 该请求， 则此域 名 服务器就暂时成为 DNS 中的另 一个客户 ，

并向其他域名 服 务器发出查询请求。 这种过程直 (cid:7169)找到(cid:7126)够 回答 该请求的域 名 服 务器为止。
上述这种查找过程，后面还要进一步讨 论。

6. 1 .2  互联 网 的 域名 结 构

早 期 的互(cid:7110) 网使用了非等 级的 名 字 空 间， 其优 点 是 名 字简短。 但当互 (cid:7110) 网 上的用户 数
急 剧 增 加 时， 用非等 级的名 字 空间来 管 理 一个很大的而且是经常变化 的名 字集合是非常 困 难
的。 因此， 互(cid:7110)网后来 就采用了 层次树状结构的命名 方法， 就像全球 邮政系统和 电 话系统那
样。 采用这种命 名 方法， 任 何一个连接在互(cid:7110)网上的主机或路由器， 都有一个唯 一 的 层次结
” ( domain )是 名 字 空间中一个可被 管 理的划分。
构 的 名 字 ， 即 域名 ( domain name

)。 这 里 ， “

域

域还可以划 分为子域， 而子域还可继续划分为子域的子域， 这样就形成了顶 级域 、 二 级域 、

三 级 域， 等 等。

从语法上 讲 ， 每一个域 名 都 由 标号( labe l )序 列组成， 而各 标 号 之间用点 隔 开（ 请注 意 ，

这 里所说的

“ 点 ”

是英语中的句 号 ” . ＂， 不是中文的句 号 ”

。 ”)。 例如下面的域 名

mail.cctv. com

/／

1  \

三 级 域 名 ． 二 级 域 名 ． 顶 级 域 名

就是 中 央 电视 台用于收发 电 子 邮件的计算机（即 邮件服务器） 的域 名 ， 它 由 三个标 号组成，

其中标 号 com 是顶级 域 名 ， 标 号 cctv 是 二 级域 名 ， 标 号 mail 是三 级 域 名 。

DN S 规定， 域 名 中 的标 号 都由英 文 字 母和数 字组成， 每一个标号不超过 63 个 字符（ 但
为了记忆方便， 最好不要超 过1 2个字符）， 也 不 区 分大 小 写 字母（ 例如，CC TV 或 cctv 在

域 名 中是 等效的）。 标 号中除连字符（－）外不(cid:7126)使用其他的标 点 符号。 级 别 最低的域 名 写 在最

左边， 而级 别 最高的顶级 域 名则写在最右边。 由 多 个标号组成 的 完整域名 总共不超过 255 个
字符。 DNS 既不规定一个域 名 需要包 含多少个下级 域 名 ， 也不规定每一 级的域 名 代表什么
意 思。 各 级 域 名 由其上一 级 的域 名 管 理机构管理， 而最高的顶 级 域 名则由ICAN N 进行管理。
用这种方法可使每一个域名 在整个互(cid:7110)网范 围 内 是唯 一 的 ， 并且也容易设计出一种查找域 名
的机制。

需要注 意 的是 ， 域 名 只是个逻 辑 概 念 ， 并不 代表计算机所在的物 理 地点。 变长的域 名

和使用有助记忆的字符串 ， 是 为了便于人使用。 而IP地址是定长的32位二 进制数字则非常

便于机器进行处理。 这 里需要注 意 ， 域 名 中的
一 一对应的关系。 点分十进制I P 地址 中 一定是包 含三个

点

” 和点分十进制 I P 地址中的
， 但每一个域 名 中

“ 点 ”

”

”

“

“

点

点

并无

的数

“

•  262

•

目则不一定 正好是 三个。

截 (cid:7169) 20 20 年 6 月 的统计[W-Wiki] ， 现在全球顶 级 域 名 TLD ( Top  Le ve l Domain )在IANA

登记的 已有1 584个（其中有不到 80 个未使用）。 原 先的顶 级 域 名 共分为三大类：

(1 ) 国 家顶级域名 nTLD: 采用I SO31 66 的规定。 如： en 表示中 国 ， us 表示 美 国 ， uk 表

示 英 国 ， 等 等 气 国 家顶 级 域 名 又 常记为 ccTLD ( cc 表示 国 家代 码 country-code)。 截 (cid:7168)
20 20 年 6 月 为止 ， 国 家顶 级 域 名 总数 已达31 6个。

( 2) 通用 顶级域名 gTLD: 到 200 6 年1 2 月 为止 ， 通用顶 级 域 名 的总数 已经达到 20 个。

最先确定的通用顶级 域 名 有 7个 ， 即：

com（ 公 司 企 业 ） ， ne t（网络 服 务 机构） ， org（非 营 利 性组织） ，

int（ 国 际组织） ，

e du

（ 美 国 专用的教 (cid:7123) 机构） ， gov（ 美 国的政府部门 ） ， mil 表示（美 国 的军 事部门）。

以后又 陆续增加了1 3个通用顶 级 域 名 ：

ae ro（ (cid:7181) 空运输企业） ， as ia（ 亚太地区 ） ， biz（ 公 司 和企业） ， cat（使用加泰 隆人的语

言和文化 团 体） ， coop（ 合作 团 体） ， info（ 各种情况） ， jobs

（ 人 力 资 源 管理者 ） ， mobi（ 移

动 产 品 与 服务的用 户和 提供者 ） ， mus

e um（ 博物馆） ， name（个人） ， pro（有证书的专 业人

员 ） ， te l

( Te lnic (cid:7122) 份有限 公 司 ） ，

trave l（旅游 业）。

(3) 基础结构域名 ( infras tructure domain)： 这种顶 级域 名 只 有一个 ， 即 arpa , 用于反向域

名 解析 ， 因此又称为反 向 域 名 。

值得注 意的是 ， ICAN N 千 2011 年 6 月 20 日 在新加坡会议上正 式批准新顶级域名 ( N ew

gTLD) ， 因此任 何 公 司 、 机构都有权 向 ICAN N 申 请新的顶 级 域 名 。 新顶级 域 名 的后缀 特 点 ，

使企业 域 名 具有了显著的、 强 烈 的标志特 征。 因此， 新顶 级 域 名 被认为是 真 正的企业 网络 商

标 。 新 顶 级 域 名 是 企 业 品 牌 战 略发展的重要 内 容， 其 申 请 费 很高 (1 8 刀 美几）， 并 且 在2 O l3
｛广开始启 用。 目前 已 有 一 些 由 两个汉 字 组成的中文的顶 级域 名 出 现了， 例 如， 商 城 、 公 司 、

新 闻 等。 然 而中文顶级域 名 并 未 获得广 泛的使用（可(cid:7130)是使用不太方便吧）。

在 国 家顶 级 域 名 下注 册 的二 级 域 名 均由该 国 家 (cid:7151) 行确 定 。 例如 ， 顶 级 域 名 为 jp 的 日 本，

将 其教 (cid:7123)和企业机构的二 级 域 名 定 为 ac 和 CO , 而不用 e du 和 com。

我 国 把二 级 域 名 划分为 ＂ 类 别 域名
” 类 别 域 名

“

“

和

“

行政区域名

“

两大类。

共 7个 ， 分 别 为： ac （ 科研机构） ， com（工 、 商 、 金 融 等 企 业 ） ，

e du

（ 中 国 的教 (cid:7123) 机构） ， gov（中 国 的政府机构） ， mil（中 国 的 国 防 机构） ， ne t（ 提供 互 (cid:7110) 网络

服 务的机构）， org（非 营 利性的组织）。

“ 行政 区 域 名

“ 共 34 个 ， 适用千我 国 的各 省 、 (cid:7151) 治 区 、 直辖 市。 例 如： bj（北 京 市） ，

js （ 江 苏 省） ， 等 等。

关 千 我 国 的互(cid:7110)网络发展现状以及 各 种 规定（ 如 申 请 域 名 的手续）， 均可在中 国 互 (cid:7116) 网

网络信息 中 心C N NIC 的网址上找到 [W-C N N JC ]。

用域 名 树来 表示互 (cid:7110) 网的域 名系统是最清 楚的。 图 6-1 是 互(cid:7110)网域 名 空间的结构， 它 实

CD 注 ： 实 际 上 ， 国 家 顶 级 域 名 也 包 括 某 些地 区 的 域 名 ， 如 我 国 的 香港 特 区 ( hk ) 和 台 湾 省 ( tw ) 也 都 是 ccTLD 里 面 的 顶

级域 名 。 此 外 ， 国 家 顶 级 域 名 可 以 使 用

一

个 国 家 自 己 的 又 字 。 例 如 ， 中 国 可 以 有

”

“

en

”

、 “ 中 国

和 繁 体 字 的 " I \?

”

这三 种 不

同 形 式 的 域名 。

• 2 63 •

际上是一个倒过来的树， 在最上 面的是根， 但没有对应的名 字。 根下 面一 级的节点 (1)就是最
高 一 级 的顶 级 域 名 （ 由千根 没有名 字， 所以 在根下 面一 级的域 名 就 叫 作顶 级 域 名 ）。 顶 级 域
名 可往 下划分子域， 即二级 域 名 。 再往下划分就是三级 域 名 、 四 级 域名 ， 等等。 图6-1 列 举
了一些域名 作为例子。 凡是在顶级 域 名 com 下注册的单位 都获 得 了 一个二 级 域 名 。 图 中给
出的例子 有： 中央 电 视台cctv , 以及 IBM 和华为等公司。 在顶 级 域 名 en （中国 ） 下 面举出
了几个二 级 域 名 ， 如： bj , edu 以及 com。 在 某 个二 级 域 名 下注册的单位就可 以获得 一个三级
域 名 。 图中给出的在 edu 下 面的三级 域 名 有：
tsinghua （清 华大学 ） 和 pku （北京大学 ）。 一
旦 某 个单位 拥有了一个域 名 ， 它就可以 自 己 决 定是否 要进 一 步划分其下属 的子域， 并 且 不必
由其上级 机构批准。 图中 cctv （ 中央 电视 台） 和 tsinghua （ 清 华 大 学） 都分别划分了 自 己的
下一 级的域 名 mail 和 WWW（ 分别是三级域 名 和 四 级 域 名 ） 气 域名 树的树 叶就是单台计 算
机的名 字， 它 不能再继续往下划分子域了。

根

顶级域名

二级域名

雯 尸勹／ 哭
hu严
厂． ．剪贯

三级域名

mail  •  • •  www

四 级域 名

熙？ ． ． ．
贮？勹
•  • •  pku ／ mail

• •  •  www

tsinghua

图6- 1 互 联 网 的域 名 空 间

应当注意 ， 虽 然 中 央 电 视 台和清 华 大 学 都各 有一 台计 算 机取 名 为 mail , 但它们的域名
并 不一样， 因为前者是 mail.cctv.com , 而后者是 mail.tsinghua.edu.cn。 因此， 即 使在世 界上
还有 很 多 单位的计 算 机取 名 为mail , 但是它们 在互联网中的域 名 都必须是唯 一的。

这 里 还 要 强 调指 出， 互联网的名 字 空间是按 照 机构 的组 织来划分的， 与物理的网络无

关， 与 IP地址中 的 “ 子网” 也 没有关 系 。

6. 1 .3  域名 服务器

上 面讲述的域 名 体 系是抽 象的。 但具体 实现域 名 系 统 则 是使用分布 在 各地的域 名 服务
器。 从理论上讲， 可 以让每 一级的域 名 都 有一个相对应的域 名 服务 器， 使所 有的域名 服务 器
构成和图6-1 相对应的 ＂ 域 名 服务 器树 ” 的结构。 但这 样做会 使域 名 服务 器的数量太 多 ， 使
域 名 系 统的运行效 率 降低。 因此 DNS 就采用划分区的办法来解决 这个问题。

一个服务 器所负 责管辖的（ 或 有权 限的） 范 围 叫作区(zone)。 各单位根据 具体情 况来划
分自 己管辖范围的区。 但 在一个区 中的所有节点 必 须是能够连通的。 每 一个区 设置 相应的权
限域名 服务器(authoritative name  server)， 用来保存 该区中的所有 主机的域 名 到 IP地址的映
射。 总之， DNS 服务器的管辖范围 不是以 ＂ 域 ” 为单位， 而是以 “ 区 ” 为单位的。 区是DNS

＠ 注 ： 根据[MfNGCI94] ， 对千树这样 的 数 据 结 构 ， 它 的 node 应 当 译 为

节 点

（ 不 是 结 点 ）。

＠ 注 ： 为 了 便于记忆 ， 人们愿意把用 作 邮件服 务 器 的 计算机取名 为

ma

•  264 •

仆 ， 而把用 作 网 站 服 务 器 的 计 算机取名 为 WWW。

“

”

服务器实际管辖的范围。 区可能等 千或小千域， 但一 定 不能大于域。

图6-2 是区的 不同划分方法的举例。假定abc 公司有下属部门 x 和 y , 部门 x 下 面又 分三

个分部门 u, v 和 W , 而 y 下 面 还有其下属部门 t。 图6-2(a)表示 abc 公司只设一个区abc.com。
这时， 区 abc.com 和域 abc.com 指的是同一件 事 。 但图 6-2(b)表示 abc 公司划分了两个区
（大的公司可能 要划分多个区）： abc.com 和 y.abc.com。 这 两个区都隶 属 于域 abc.com , 都
各设置了相应的权 限域 名 服务 器。 不 难看出， 区是 ＂ 域 ＂ 的子集。

根--------1~

org

com

edu

'， ， －－ - - － － － － － － － － － － － －  － － － － － － - - -| ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ ＿ 、 、
； 域 abc.com
／穴＼
区 abccom

\  x  \ ＇

abc \\

／ ＼

／穴＼

;

根-------1-------
＾ 丁 ＾

com

org

edu

区勹：；nom

abc

x

区�

com

-U

、 、

V 二） 二）

：

，＇，

(a)

(b)

图6-2 DNS 划分区的举例

图6-3 以图6-2(b)中公司 abc 划 分的 两个区为例 ， 给出了DNS 域 名 服务 器树状结构图。

这种 DNS 域 名 服务 器树状结构 图 可 以更准确 地反 映出 DNS 的分布 式结构。 在图6-3 中的每
一个域名 服务器都能够进行部分域 名 到 IP地址的解析。 当 某 个 DNS 服务 器 不能进行域名 到
IP地址的转换时， 它就设法找互联网上别的域名 服务 器进行解析。

根域名 服务 器

顶 级域名 服务 器

权 限 域 名 服 务 器

二三 二

二二立巴日 …

二｀三丿——言卢芦芦
五／

图6-3 树状结构的 DNS 域 名 服 务 器

从图 6-3 可看出， 互 联网上的 DNS 域 名 服务 器也是按照 层次安排的。 每 一个域名 服务
器都只对域名 体 系 中的一部分进行管辖。 根据 域 名 服务器所起的作用， 可 以把域 名 服务 器划
分为以下 四种 不 同的类型 ：

(1) 根域名 服 务器(root nam e   server)： 根域 名 服务 器是最 高 层 次的域 名 服务 器， 也是最
重 要的域名 服务 器。 所有的根域名 服务 器都知道所有的顶级域名 服务 器的域 名 和 IP地址。 根
域 名 服务器是最重 要的域 名 服务 器 ， 因为不管是哪一个本地域 名 服务 器， 若 要 对互联网上任
何一个域名 进行解析 （即转换为 IP地址 ） ， 只要 自 己无法解析， 就首先要求助于根域名 服务

•  265 •

器。 假定所有的根域名 服务器都瘫痪了， 那么 整个互(cid:7110)网中的 DN S 系统就无法工作。 全 世 界

的根域 名 服务 器只使用1 3个不 同 IP 地址的域 名 ， 即 a.roots

e rve rs

.ne t, b.roots

e rve rs

.ne t, … ,

e rve rs

m.roots
但请 注 意 ， 虽 然 互 (cid:7110) 网的根域名 服务 器 总 共只有1 3个域名 ， 但根域名 服务器并非仅 由 1 3 台

.ne t。 每个域 名 下的根域 名 服 务 器由专 门的公 司或 美 国 政府的某个部门 负 责运营。

机器所组成（ 如果仅仅依 靠这 1 3 台机器 ， 根本不可(cid:7126)为全世 界的互(cid:7110)网用户 提供令人满 意

的服务 ）。 实 际 上 ， 在互(cid:7110)网中是由 1 3套装置 (1 3 ins tallations, 也就是 1 3套 系 统） 构成这
1 3 组根域 名 服 务器的[W-ROOT]。 每一 套 装置在很多地点安 装根域 名 服务 器 （ 也可称为镜像
根 服 务 器 ） ， 但都使用同 一个域 名 。 负 责运 营 根域 名 服 务 器的公 司 大多在美 国 ， 但所有的根
域 名 服 务 器 却 分布 在全 世 界。 为了提供更可靠的服务 ， 在每一个地点的根 域 名 服 务 器 往 往 山
多 台机器组成（ 为了安 全起见 ， 这 些根域 名 服务 器的具 体位置是 严 格 保 密的 ， 不对外开放参
观）。 现在世 界 上 大部分 DN S 域 名 服 务 器 ， 都(cid:7126)就近找到 一个根域 名 服 务器查询 IP 地址
（ 现在这 些根域 名 服 务 器 都 已 增加了IPv6 地址）。 为了方便， 人们常用从A 到 M 的前1 3个
英 文 字 母中的一个 ， 来 表示 某组根域 名 服务器。 截 (cid:7169) 20 21 年3 月 24 日 ， 全球共有 1 375个
根域 名 服务 器 在运行 ， 其中在我 国 的共有37个（ 分布在北 京( 8 个） 、 上海 、 杭 州 ( 2个） 、 武
汉( 2个） 、 贵 阳 、 重 庆 、 广 州 、 西 宁(3个） 、 郑 州 ( 2个） 、 香港( 7个） 、 燠 门 ( 2) 、 台 北( 7个））。

由千根域 名 服务器 采用了任播(anycas t )技 术

, 因此当DN S 客 户 向某个根域 名 服务器的
IP地址发出查询报文时 ， 互 (cid:7110)网上的路由器就(cid:7126)找到 离这个 DN S 客 户 最近的一 个根域 名 服
务 器。 这样做不仅加快了 D N S 的查询过程 ， 也更加 合 理地利 用了互(cid:7110)网的资源。

CD

必须指出 ， 目前根 域 名 服 务 器在全 球的分布 仍 然 是 很不均衡的。 在某些地 区 根 域 名 服

务 器 还较 少 ， 这 就影 响了上网的速率。

需要注 意的是 ， 在许多情况下 ， 根域 名 服 务器并不直接把待查询的域 名 直 接转换成 IP
地址（ 根域 名 服 务 器也没有存放 这种 信 息 ） ， 而是告诉 本地域 名 服 务 器下一 步应当找哪 一个
顶级域 名 服 务 器进行查询。

由 千根域 名 服 务 器 在 DN S 中的地位特殊， 因此对根域 名 服务 器有许多具 体的要求 ， 如

必须(cid:7126)够运行某 些程序 等 [ RFC 7720 ]。

( 2) 顶级域名 服务器 （即 TLD 服务器 ） ： 这 些 域 名 服务 器 负 责 管理在 该顶级 域 名 服 务 器

注 册的所有二 级 域 名 。 当收到 D N S 查询请 求时， 就给 出相 应的回 答 （ 可(cid:7126)是 最后的结果，
也可(cid:7126)是下一 步应当找的域 名 服 务器的IP地址）。

(3) 权 限域名 服 务 器 ： 这 就是前面 已经讲过的负 责 一个 区 的域 名 服 务 器。 当一个权 限 域
名 服务 器还不(cid:7126)给出 最后的查询 回答时， 就 会告诉发出查询请 求 的 DNS 客 户 ， 下 一 步应当
找哪 一个权 限 域 名 服 务 器。 例 如在图 6-2(b)中， 区 abc.com 和 区 y.abc.com 各设有一个权 限
域 名 服 务 器。

(4 ) 本地域名 服务器( local name  s

e rve r )： 本地域 名 服 务 器 并不属 于图 6-3 所示的域 名 服
务 器 层 次结构， 但它对域 名系统非常重要。 当一 台 主机发出 DN S 查询请求时， 这个查询请
求 报 文 就 发送给 本 地域 名 服 务 器。 由此可看出本地域 名 服务 器的重要性。 每一个互(cid:7110)网服务
提供者 I SP, 或 一个大学 ， 甚 (cid:7169) 一个大 学 里的系， 都拥有一个本地域 名 服 务器 ， 本地域 名 服
务 器 离用户 较 近 ， 一 (cid:7183)不超过几个路由器的距 离。 当所要查询的主机也属千同 一个本地 I SP

CD 注 ： 任 播 的 I P 数据报 的 终 点 是

组 在 不 同 地点 的 主 机 ， 但具有相 同 的 I P 地址 。

I P 数据报交 付 离 源 占 最 近 的

台 主 机 。

•  266  •

一

一

时， 该本地域 名 服务器立即就(cid:7126)将所查询的主机 名 转换 为它的 IP 地址， 而不需要再去询问

其他的域名 服务器。

为了 提高域 名 服 务器的可靠 性 ， DN S 域 名 服务器都把数据 复制到 几个域 名 服 务器来 保
存， 其中的一个是 主 域 名 服 务 器 ( mas ter name  s erver ) ， 其他的是 辅助 域 名 服 务 器 ( s econdary
name  s erver )。 当 主域 名 服务器出故 障 时 ， 辅 助 域 名 服 务器可以保证 DN S 的查询工作不会中

断。 主域名 服 务器定期把数据复制到辅助 域 名 服 务器中， 而更 改数据只(cid:7126)在主域 名 服 务器中
进行。 这样就保证了数据的一(cid:7175) 性。

下面简 单 讨 论一下域 名 的解析过程。 这 里要注 意两点。
第 一 ， 主机向本地域 名 服务器的查询一(cid:7182)都采用递归 查询( recurs ive query )。 所谓递 归 查
询就是： 如果主机所 询问的本地域 名 服务器不知道被 查询域 名 的 IP 地址 ， 那么本地域 名 服

务器就以DN S 客 户 的身 份 ， 向其他根域 名 服务器继续发出 查询请求报文（即 替 该主机继续
查询）， 而不是 让 该主机(cid:7149) 己进行下一 步的查询。 因此 ， 递 归 查询返 回 的查询结果或 者是 所
要查询的IP地址， 或者 是 报错 ， 表示无法查询到所需的IP地址。

第 二， 本地域 名 服务器向根域 名 服 务器的查 询 通常采用迭代查询( iterative query ) 。 迭代

查询的特 点是这样的： 当 根域 名 服 务器收到本地域 名 服 务器发出的迭代查询请求报文时， 要
么给出所要查询的IP地址， 要么告诉 本地域 名 服务器： “你下 一 步 应 当向哪 一个域 名 服 务器
进行查询 ＂。 然后让本地域 名 服 务器进行后续的查询（而不是 替本地域 名 服 务器进行后续的
查询）。 根 域 名 服 务器通常是 把(cid:7149) 己知道的顶 级 域 名 服务器的I P 地址告 诉本地域 名 服 务器，

让本地域名 服务器再向顶级 域 名 服 务器查询。 顶级 域 名 服务器在收到本地域 名 服务器的查询
请 求后， 要么给出所要查询的IP地址， 要么告诉本地域名 服务器下一步应当向哪 一个权限 域
名 服务器进行查询， 本地域 名 服务器就这样进行迭代查询。 最后， 知道了所要解析的域 名 的

Jri

dn

IP 地址， 然后把这个结果返 回 给发起查询的主机。 当 然 ， 本 地域 名 服 务器也可以采用递 归
查询， 这 取决于最初的查询请求报文的设置要求使用哪 一种查询方 式。

归

图 6-4 用例子说明了这 两种查询的区 别。

一

－

'

＇
l
,

夏

器

良

l
l
＇
l
,
,
＇

l
l
l
l
＇
'
,

，
l
'
'
，
'
，
'
，

卢
/「
贮管
`II三

本地域名 服 务 器
dns.xyz.com

：＇

'
l
l
,
'

，

权 限 域 名 服务
dns.abc.com

良木

域

名

器

}

递

归

级

畔
dns

一

-

服

器务

eom

,
l
l
－
l
l
l
'

0

i
l

，
＇

l
l
l
1

l
l
＇
'
,

l
l
，
l
＇
'

＇
t
，
,
'

,

＇

l
，
l
'

顶
』
－－

了'

－

`

一

-

、
，

0

＠

@-

竺

＝

勹
尸
勹
递归 II�五亘勹

本 地 域 名 服 务 器
dns.xyz.com

/
尸
绕
)

,
'
，
'
`
｀
,
'­

－

＿

＿

-

权 限域 名 服务
dns.abc.com

查 询 。
I-

．．

令

m.xyz.com

m.xyz. com

(a) 本地 域 名 服 务 器 采 用 迭 代 查 询

(b)本地域 名 服 务 器 采 用 递 归 查询

图6-4 DNS 查询举例

假定域 名 为 m.xyz.com 的主机想知道另 一 台 主机（ 域 名 为 y.abc.com) 的IP地址。 例如 ，

•  267  •

主机 m.xyz.com 打算发送邮件给主机 y.abc.com 。 这 时就必须知道主机 y.abc.com 的 I P 地址 。
下面是 图 6-4( a )的几个查询步骤：

0 主机 m.xyz.com 先向其本地域 名 服 务 器 dns
＠ 本地域 名 服务器采 用 迭 代 查询 。 它先向一个根域 名 服 务 器 查询 。
＠ 根域 名 服 务 器告诉 本地域 名 服 务 器 ， 下 一次应 查询的顶级域 名 服务器 dns

.xyz.com 进行递 归 查询 。

.com 的 IP

地址 。

0 本地域 名 服 务器向顶 级 域 名 服 务 器 dns

.com 进行查询 。

© 顶 级 域 名 服 务 器 dns

.com 告诉本地域 名 服 务 器 ， 下 一 次 应 查询的权 限 域 名 服 务 器

dns

.abc.com 的 IP地址 。

0 本地域 名 服 务器向权 限域 名 服 务 器 dns

.abc.com 进行查询 。

0 权 限域 名 服务 器 dns

.abc.com 告诉本地域 名 服 务器 ， 所 查询的主机的IP地址 。

0 本地域名 服务器最后把查询结果告诉主机 m.xyz.com 。
我们注 意 到 ， 这 8 个步骤 总 共要使用 8 个 UDP用户 数据 报的报文 。 本地域 名 服务器经

过三次迭代查询后 ， 从权 限 域 名 服 务 器 dns

.abc.com 得到 了主机 y.abc.com 的IP地址 ， 最后

把结果返 回 给发起查询的主机 m.xyz.com 。

图 6-4( b )是本地域 名 服 务 器 采用递 归 查询的情况 。 在这种情况下 ， 本地域 名 服 务 器只
需向根 域 名 服 务器查询 一次 ， 后 面的几次查询都是 在 其 他几个域 名 服务器之间进 行的（ 步
骤 ＠ (cid:7169) 0) 。 只 是 在步骤 O ， 本地域 名 服 务 器从根域 名 服 务器得到 了所需的 IP 地址 。 最后
在步骤 O ， 本地域 名 服务 器把查询结果告诉 主机 m.xyz.com 。 整个的查询也是使用 8 个 UDP
报文 。

为了 提高 DNS 查询效率 ， 并减轻根域名 服 务器的负 荷和减 少 互(cid:7110)网上 的 DNS 查询报

文数量 ， 在域 名 服 务 器中广泛地使用了高速缓存（有时也称 为高速缓存域 名 服 务 器 ） 。 高速
缓存用 来 存放最近 查询过的域 名 以 及从何处获得域 名 映 射 叮言 息的记录 。

例 如 ， 在 图 6-4(a )的查询过程 中 ， 如果在不 久前已经有用户 查询过域 名 为 y.abc.com 的

IP地 址 ， 那么本地域 名 服务 器 就不必向根域 名 服务 器重新查询 y.abc.com 的I P 地址 ， 而是
直接把高速缓存中存放的上次查询结果（即 y.abc .com 的I P 地址） 告诉用户 。

假定本地域 名 服 务器的缓存中并没有 y.abc. com 的I P 地址 ， (cid:7102)是存放着顶 级 域 名 服 务 器

dns

.com 的 IP 地址 ， 那么本地域 名 服 务器也可 以 不向根 域 名 服 务 器进行查询 ， (cid:7103)是 直接向
com 顶 级 域 名 服务器发送查询 请 求报 文 。 这样不仅可以大大减轻根域 名 服务 器的负 荷 ， 而且

也(cid:7126)够使互(cid:7110)网上的DN S 查询请求 和 回 答 报 文的数量大为减 少 。

由于 名 字到地址的绑定 ＠并不经常 改 变 ， 为保持 高速缓存中的 内 容正 确 ， 域 名 服 务器应
为每项 内 容设置 计时器并处理超过合理时间 的项目 （ 例 如， 每个项目只存放两天） 。 当域 名

服 务 器 已 从缓存中删去某项信 息后又 被请求 查询该项信 息 ， 就必须重新到授权管理 该项的域
名 服务器中获取绑定信 息 。 当 权 限 域 名 服务 器 回答一个查询请求时， 在 响应 中 都指明绑 定有
效存在 的时 间 值 。 增 加此时间值可减少网络开销 ， 而减 少此时间值可 提高域 名 转换的准 确 性 。

不但在 本地域 名 服 务 器中需要 高速缓存， 在 主机 中 也很需要 。 许多主机 在 启 动 时从本

CD 注 ： 映射(mapping)指 讷 个 集 合 元 素之 间 的

种 对 应规 则 。

＠ 注 ： 绑 定(binding)指

个 对 象 （ 或事 务） 与 其某 种 屈 性 建 立某 种 联 系 的 过程 。

一

• 2 68  •

一

地域名 服务 器下载 名 字和地址的全部数据库 ， 维护存放 (cid:7164) 己最近 使用 的域 名 的高速缓存 ， 并

且只在从缓存中找不 到 名 字时才 使用域 名 服务 器 。 维护本地域 名 服务 器数据库的主机 (cid:7166) 然 应

该定期 地检查域 名 服 务器以获 取新的映射信 息 ， 而且主机必须从缓存中删 掉无效的项。 由于
域 名 改 动并不频 繁 ， 大多数网点不需花太多精 力就(cid:7130)维护数据 库 的一(cid:7175) 性 。

文件传 送协议

6 . 2

6.2 . 1  FTP 概述

文件传送协议 FTP( File  Trans fer Protocol )  [ RFC  959,  STD9] 曾 是 互 (cid:7110) 网

扫 一扫

罄回

封
谤
怒
匪

视 频 讲 解

上使用得最广 泛的文件传送协 议 。 FTP 提供交互 式的访问 ， 允 许 客 户 指明文 件的类型与格式

（如指明是 否使用 ASCII 码） ， 并允 许 文 件 具有存取权 限 （ 如访问文件的用户 必须经过授权 ，
并 输入有效的口令） 。 FTP 屏 蔽了各 计算机系统的细(cid:7188) ， 因而适 合千在异构网络中任 意 计算
机之间传送文件 。

在互(cid:7110) 网 发展的早 期 阶段 ， 用 FTP 传送文 件 约 占 整个互 (cid:7110) 网 的通信 最的三分之 一 ， 而

由 电 子邮 件和域 名系统所产 生的通信 量远小千 FTP 所 产 生的通信 量 。 只是 到 了 1 995 年 ，
WWW 的通信 量才 首次超过 了 FTP。

在下面 6.2.2和 6.2.3(cid:7188)分别 介 绍 基千 TCP的 FTP和基于 UDP的简单文件传送协议 TFTP,
它们都是 文 件 共 享 协 议中的一 大类， 即 复制 整个文件 ， 其特 点是 ： 若要存取一个 文 件 ， 就必
须先获 得一个本地的文件副本。 如果要修 改 文 件 ， 只(cid:7126)对文件的副本进行修 改 ， 然后 再将 修
改后的文件 副本传回到 原(cid:7188)点。

文 件 共 享 协 议中的另 一 大类是 (cid:7116)机访 问 ( on-line acce s

s ) 。 (cid:7110)机访问意 味 着 允 许多个程序
同 时对一个文件进行存取 。 和数据库系统的不 同 之处是用户 不需要调用一个特殊的客户 进程 ，
而是由操作系统 提供对远地共 享 文 件进行访问的服务 ， 就如同对本地文件的访问一样 。 这 就
使用户 可以用远地文件作为输入和输 出 来 运行任 何应用程序 ， 而操作系统中的文件系统则 提

供对共 享 文 件的透 明 存 取 。 透明存取的优 点是： 将 原 来用千处理本地文件的应用程序用来 处

理远地文 件 时 ， 不需要对该 应 用 程 序做明显的改 动 。 属 千文 件 共 享 协 议的有网 络 文 件 系 统
N F S  ( Ne twork  File  Sys te m)  [C OME0 6] 。 网 络 文 件 系 统 N FS 最初是 在 UNIX 操作 系 统环境下
实 现 文 件和目录共 享的 。 N FS 可 使本地计算机共 享 远地的资 源 ， 就像这 些 资 源 在本地一样 。
由千 NFS 原先是 美 国 SUN 公 司 在 TCP/IP网络上创 建的 ， 因此目前 N FS 主要应用在 TCP/IP
,  N e tWare 等操作系统上运行 。 NFS 还没
网络上 。 然 而现在 N FS 也可在 OS/2, MS-Windows
有成为互(cid:7110) 网的正 式标准 。 经过 几次修订更 新 ， 现在的最新版本 ( N FSv4) 是 20 1 5 年 3 月
发布的建议标准 [ RFC 7530 ] 。 限千篇 幅 ， 本书不讨 论 N FS 的详细工作过程 。

扫 一扫

6.2 .2  FTP 的 基本 工 作 原 理

网络环境中的一项基本应用 就 是 将 文 件从一 台 计 算机中复 制到 另 一 台 可
(cid:7126)相 距 很远的计算机中。 初 看起来 ， 在两 台 主机之间传送文 件是 很 简单的事

情 。 其 实 这 往往非常困 难 。 原 因是 众多的计算机厂 商 研 制出的文件系统多达

视 频 讲 解

数 百种 ， 且 差 别很大 。 经常遇到的问题是：
(1 ) 计算机存储数据的格 式不 同 。
( 2) 文件的目录结构和文件 命 名 的规定 不 同 。

(3) 对千相 同的文件存取功(cid:7126) ， 操作系统使用的命令 不 同 。

•  269  •

