7 . 3   鉴别

7 . 3 .1  报 文 鉴 别

(authentication)
一

一

是 网 络 安 全 中

在 网 络 的 应用 中 ， 鉴 别
不 相 同 的 概念 。 鉴 别 的 内 容有 二 。
是要鉴别 发信者 ， 即 验证通信 的 对 方 的 确 是 自 己所要通
信 的 对 象 ， 而 不 是 其 他 的 冒 充 者 。 这就是实体鉴别 。 实体可 以 是 发 信 的 人 ， 也 可 以 是
个 进
程 （ 客 户 或 服 务 器 ） 。 因 此这 也 常 称 为端点鉴 别 。 二 是 要鉴 别 报文 的 完整性 ， 即 对 方所传送
的 报 文没有被他人篡改过 。 至 于 报 文 是 否 需 要加 密 ， 则 是 与
性 质 不 同 的 问 题 。 有 的
报 文 需 要 加 密 （ 这要 另 找 措 施 ） ， 但许 多 报 文 并不 需 要 加 密 。

个 很 重 要 的 问 题 。 鉴 别 和 加 密 是

(authorization)

鉴 别

一

“

“

请注 意 ， 鉴 别 与 授权

也 是 不 同 的 概 念 。 授权涉及 的 问 题 是 ： 所进行 的 过 程

是 否 被 允 许 （ 如 是 否 可 以 对 某 文件进行读或写 ） 。

一

不 过 有 时 常 用 报文 鉴 别

词 包 含 上 述 鉴 别 的 两 个 内 容 ， 既 鉴 别 报 文 的 发 送 者 ， 也 鉴 别

报 文 的 完 整 性 。

下 面分 别 讨 论报 文 鉴 别 与 实 体 鉴 别 的 特 点 。

1 . 用 数 字签名 进行鉴别 （ 原 理 ）

我 们 知 道 ， 书 信 或 文 件 可 根据 亲 笔 签 名 或 印 章 来 鉴 别 其 真 实 性 。 但在 计 算 机 网 络 中 传

A

X

D

7-4

D

A

”

“

A

进行

为 了 进行 数 字签名 ，

送 的 报文 ， 则 可使 用 数 字签名 进 行 鉴 别 。 下 面就介绍 数字签 名 的 原理 。
用 其 私钥 SK
运算 （ 如 图

对 报 文
运算本
7-4
来 叫 作解 密 运 算 。 可 是 ， 还 没 有 加 密 怎 么 就 进 行 解 密 呢 ？ 其 实 D 运 算 只 是 把 报 文 变 换 为 某
种 不可 读 的 密 文 （ 因 此有 时 也 说 成
中
， 就是 为 了 避 免产 生这种 误解 。 A 把经 过 D 运算得
我们使用
到 的 密 文传送给 B 。 B 为 了 核 实签名 ， 用 A 的 公钥 进 行 E 运算 ， 还 原 出 明 文 X。 请 注 意 ，
任何人用 A 的 公钥 PK
哥
式 并 非为 了 保密 ， 而 是为 了 进行签名 和 核 实 签 名 ， 即 确 认此 明 文 的 确 是

A
进 行 E 运 算 后 都 可 以 得 出 A 发送 的 明 文 。 可 见 图

用 其私 钥 对 报 文 加 密 ， 但这样说不准 确 ） 。 在 图

而 不 是
A

所示 的 通信 方

解密运算

发送 的 。

D 运算

所示 ） 。

7-4

“

“

A 的 私钥 SK

l

签 名

密 文 DSK\（X)

、\ 密 又 DsK,,(X)

图

用 数 字签名 进 行 鉴 别

7-4

A
下 为什 么 数字签名 具 有 鉴 别 报 文 的 功 能 。

A

A

一

A
下 面 讨 论

B

(X)

D SKA

因 为 除

外 没 有 别 人持有

的 私 钥 SK

, 所 以 除

外 没 有 别 人 能 产 生 密 文

。

这样 ， B 确 信 报 文 X 是 A 签 名 发 送 的 。 这就鉴别 了 报 文 的 发送 者 。 同 理 ， 其他人如 果 篡 改
过报 文 ， 但 由 于 无法得到 A 的 私钥 SK
对 篡 改 后 的 报 文 进 行 D 运算 ， 那 么 B 对 收 到 的 报 文
进 行 核 实 签名 的 E 运 算 后 ， 将 会 得 出 不 可 读 的 明 文 ， 因 而 不 会 被欺 骗 。 这样就保证 了 报文
的 完 整性 。

一

A

数 字 签 名 还有 另

功 能 ， 就 是 发 送 者 事 后 不 能 抵 赖 对 报 文 的 签 名 。 这 叫 作 不 可否认 。
•  34 1   •

若A 要抵赖曾发送报文给 B , B 可把 X 及 D SKA( X) 出示给进行公 证的第三者。 第三者很容

易用P KA 去证实A 确实发送 X 给 B。

以上这 三项功能的关键都在千没有其他 人能够持有 A 的私 钥S KA o
但数字签 名仅对报文进行 了 签 名 ， 对报文 X 本 身 却 未保 密。 因为截获到 密文 D SKA ( X)

并知道发送者身份的任何人 ， 若通过某种手段获得了发送者的公 钥 P KA , 就能解出报文的
内容。 如果用 图 7-5 所示的方法 ， 就可同时实现保密通信和数字签 名。 图中S KA 和S KB 分
别为A 和 B 的私钥 ， 而P KA 和P KB 分别为A 和 B 的公钥。 请注意 ， 在许多情况下 ， 我们
用 A 的私钥对明
往往强 调的是使用何种 密 钥进 行运算 ， 这 时的表达方式可简 单些。 例如 ，

“

文 X 进行 签 名

可 记为 S KA( X)。 若

再 用 B 的公 钥 对此 签 名进行加 密

， 则可记为

“

“

＂

P Ks(S KA(X)) ， 而不必深 究使用的是 D 运算还是 E 运算。

A
A 的 私 钥 S K

8
］
B 的 私 钥 S K

A
A 的 公 钥 P K
了

B

•

加 密 与 解 密
签 名 与 核 实签 名
图 7-5 可保证机密 性 的 数 字 签 名

，

如 图7-5 所示的可保 证机密性的数字签 名方法 ， 虽然在理论上是正确的 ， 但很难用于现
”

“

实生活中。 因此这

节的小标题后边有

原 理

二字。 这是因为要对报 文（可能 很长的报文 ）

一

先 后要进行两次 D 运算和两次 E 运算 ， 这种运算量太大 ， 要花费非常多的计算机CPU 时间 ，

在很多情况下是无法令人接受的。 因此目前对网络上传送的大量报 文 ， 普 遍都使用开销小得

多的对称 密 钥加 密。 要实现数字签 名 当 然必须使用公钥 密码 ， 但

一

定要设法减小公钥 密码算

法的开销。 这 就要使用后面几 个小节所讨论的密码散列 函 数和报文鉴别码。

2. 密码散列 函 数

散 列 函 数（ 又称为杂 凑 函 数 ， 或 哈希 函 数） 在计算机领 域中使用得很 广 泛。 密码学对

散列 函 数 有 非 常 高 的 要 求 ， 因 此 符 合 密码 学 要 求 的 散 列 函 数 又 常称为 密 码 散 列 函 数
(c r yp t o grap h ic  h ash  funct ion)。 以后在不致产生错误 概 念时 ， 我们也 常把密码散列 函数简称为

散列 函 数。 具体说来 ， 密码散列 函 数 H( X)应具有以下 四个特点 ：

( 1) 虽然散列 函数的输入报文 X 的长度不受限制 ， 但计算出的结果 H( X)的长度则应是

较短的和 固 定的。 散 列 函 数的输出 H( X) 又称为散 列 值 ， 或散列。 散列 函 数采用确定算法 ，

因此相同的输入必定得出相同的输出。 虽然密码散列 函 数相当 复 杂 ， 但利用计算机 ， 散列 函

数的运算还是相 当快的。

( 2) 散列 函数的输入和输出的关系是多对一的。 若 散列值 H( X)的长度为 1 28 位 ， 那么

输出散列值只有 2

8

1
2

个有 限 多的可能值 ( 2

1 28

与IPv6 的地址数一样大 ， 是个 很大的数值 ）。

然而我们的输入报 文 X 却 有 无 限 多的取值。 可见必然会出现不同输入 却产生相同输出的碰

撞现象。 精心挑选 的密码散列 函 数应 当非常不 易发生碰撞 ， 即应具有很好的抗碰撞性。

•  34 2  •

(3) 若给出散列值 H(X), 则无人能找出输入报文 X。 也就 是说， 散列 函 数是

一

种单向 函

数(on e- w ay functi on )， 即逆 向变换是不可能 的（如 图 7 -6 所示）。

俨· ｀

任意 长度的明文 X

这是 要 发达的 个
I ` ·�` ••
心 婓 加光 的 明 文
长 度 不 限 ．
I

一一·· ··-·•

I

v

�

i

`

、

}

/
/

＇

＿

 ;

 ,

输 出 固 定 长度
的 散 列 值 H(X)
10010...
· ··· ····-·· · ·· ··· ···· ·一
一

1011
．

气．一

..- ---

．

霆

上述特点 的 另

一

种表述方法是：

图 7-6 密码散列 函 数是单 向 的

若已知 X 和 H(X), 则没有人能够找到 Y ( Y -=f:. X)， 使得 H( Y) = H(X) 。

但下 面 我们要讲到， 关千这 方面 的 研 究， 后来已有了
(4 ) 好 的 密码 散列 函数还具有这样
一

一

些特性 ： 散列 函 数输出 的每

一

些新的进展。

一

个比特， 都与输入 的

个比特有关； 哪怕仅改动输入 的

个比特， 输出也会相 差极大； 散列 函 数 的运算包括 许

一

每
多非线性运算。

通过许多学者 的不断 努力， 已经设计出

些实用的 密 码 散列 函数（或称为散列算法），
其中最出名 的就是M D5 和SHA - 1 。 M D 就是M ess age Di gest 的 缩写， 意思 是 报 文 摘要。
M D5 是报 文 摘要的第5 个版本。

一

设计者 Ri vest 曾提出
有相同报文摘要 的 另

一

报文摘要算法M D5 公布于 RFC 1321
一

个 猜 想， 即根据给定的M D5 报 文摘要代码， 要找出

一

个与原来报文

C 19 9 1年）， 并 获 得了非常广泛 的应用。 M D5 的

报文， 其难度在计算上几 乎 是不可能 的 。 但在 2004 年， 中国学者 王

小 云

CD

发表 了 轰动世界 的 密 码学论文， 证明可以用系统 的方法找出

一

对报 文， 这 对报 文具有

相同的M D5 报 文摘 要[ W -WANG]， 而这 仅需 15 分钟， 或不到 1 小时。 千是， M D5 的安全
一

性就产生了动摇。 随后， 又有许多学者开发了对 M D5 实 际的攻击。 于 是 M D5 最终被另

种叫作安全散列算法SHA (S ecu re Hash Al go rit hm) 的标准所取代。

下 面仍以M D5 为例来介绍报文摘要。 这 主要是考虑到目前新的 散列 函数（如SHA- 2)

是从 MD5 发展而来 的 。 对于有兴趣研 究 散列 函 数 的 读者， M D5 是个很好 的出发点。

M D5 算法 的大致过程如 下 ：
(1 ) 先把任意长 的 报 文按模 2

64

计算其余数 ( 64 位）， 追加在报文 的 后面。

( 2) 在报文和余数之间填充1 ~51 2 位， 使得填充后的 总长度是51 2 的整数倍。 填充的 首

位 是l， 后面都 是 0 。

(3) 把追加和填充后 的报文分割为许多 51 2 位 的数据块， 每个 51 2 位 的 报文数据再分成

4 个 1 28 位 的数据块依次送到不同的散列 函数进行 4 轮计算。 每
块进行 复 杂 的运算。 一直到最后计算出M D5 报 文摘要代码 ( 1 28 位）。
位都与原来报文中 的每

这样得出 的 M D5 报 文摘要代码中 的每

一

一

位 有关。 由此可见，

一

轮 又都按32 位 的 小数据

像M D5 这样的 密 码 散列 函 数实 际上已是个相当复 杂 的算法， 而不是简单 的 函数 了 。

SHA -1 是 由 美国标准与技术 协会NIS T 提出 的

一

个散列算法系列。 SHA-1 和M D5 相似，

O 注： 王 小 云 ， 女 ，

1 966 年 出 生 ， 山 东 大 学 和 清 华 大 学 教授 ， 中 国 科学 院 院 士 ， 主 要 研 究 领 域 为 密 码 学 和 信 息 安 全 学 。

• 34 3  •

但 其 散列值的长度为 1 60 位（比 MD5 的1 28 位 多 了 2 5 %）。 SHA- I 也是先把输入报 文 划分
为许多 51 2 位长的数据块， 然后经过 复杂运算后得出散列值。 SHA - I 比M D5 更安全， 但计
算起来却比M D5 要慢些。 19 9 5年发布的新版本SHA- I [RFC 3174 ]在安全性方面有了很大的
改进。

但 SHA- I 后来也被证明其实 际 安全性并未达到设计要求， 并且也曾被王 小 云 教授的研
究团 队 攻 破。 谷歌也 宣布 了 攻破 SHA- I 的消息。 现在 SHA- I 已被另外的两个版本 SHA- 2
[RFC 6 234 ]和SHA -3 [W -SHA3]所 替代。 SHA- 2 和SHA-3 都各 有好几 种变型。 前者有SHA-

224 ,  SHA- 2 56 ,  SHA -384 和SHA - 51 2 , 后者有SHA3- 224 ,SHA3- 2 56 ,  SHA3-384 和SHA3- 51 2。
在上面名称最后的3 位数字表示 散列的位数。 这里需要指出 ， SHA -3 采用 了与SHA - 2 完全

不同的散列 函 数。 现在许多组织都已 纷纷宣布 停用SHA - I。 例如， 微软千 2017年 1 月 1 日
起停止 支持SHA- I 证书 ， 而以前签发的SHA -1 证书也必须 更换为SHA - 2 证书。
＂
， 是指有人能 设 法找出具有相同散列值的

请注意 ， M D5 或SHA- I

对报 文。

被攻破

一

”

这样就动摇 了M D5 或SHA - I 的安全性。 但是， 密码学家目前 尚 无法把

X, 篡改为具有同样M D5 或SHA- I 散列值的另

一

报 文 Y。

一

个任意已知的报 文

3. 用报文 鉴 别 码 实 现报文 鉴别

一

下 面进

步 讨论怎样使用散列 函数来实现报文 鉴别。

下 面给出的三个简单 步骤， 给出鉴别报 文的初 步 概 念。
(1 ) 用户A 首 先根据 自 己的明 文 X 计算出散列 H( X)（例如， 使用M D5)。 为简单起见，

我们把得出的散列 H(X)记为 H。

( 2) 用户A 把散列 H 拼接在明 文 X 的后面 ， 生成 了 扩展的报 文( X, H)， 然后发送给 B 。
(3) 用户 B 收到了这 个扩展的报 文(X, H)。 因为散列的长度 H 是早已知道的固定值， 因

此很容 易把收到的散列 H 和明 文 X 分离开。 B 通过散列 函 数的运算， 计算出所收到的明文

X的散列 H( X)。 若 H(X) = H, 则 B 就认 为所收到的明文是 A 发送过来的。

但上述做法 实 际 上 是 不 可 行的。 设想某个入侵者创建了

个伪造的报 文 M , 然后也用
同样的方法计算出 其 散列 H( M) ， 并且冒充 A 把拼接有 散列的扩展报 文发送给 B 。 B 收到扩
展的报文( M , H( M)）后 ， 按 照上面步 骤(3)的方法进行验证 ， 发现

切都是正常的， 就会误认

一

一

为所收到的伪造报 文就是 A 发送的。

因此 ， 必 须设法对 上 述的攻击进行 防范。 解决的 办法可以是： A 把双 方 共 享的密钥 K

( K 就是

－

串 不太长的字符 串 ） 拼接到报 文 X 后， 进行散列运算 （如 图 7- 7 所 示 ）。 散列

运算 得 出 的结果为 固 定 长 度的 H(X +  K) , 称为报文 鉴 别 码 MAC (M ess age Aut h enti c ati on

Cod e)。 请注意 ： 局 域网中使用的媒体接入控制MAC 正好也使用这 三个字母 ， 因此在看到缩

写 词MAC 时应注意上 下 文 。 A 把报 文 鉴别码MAC 拼接在报 文 X 后面， 得到扩展的报 文，

发送给 B 。 我们注意 到 ， 共享 密 钥 K 并没有出现在网上传送的扩展的报 文中。

B 收到扩展的报 文 后 ， 把报 文 鉴别码MAC 与报 文 X进行分离。 B 再用同样的密 钥 K 与

报 文 X 拼接 ， 进行散列运算 ， 把得出的结果 H( X + K)与分离出的报文鉴别码MAC 进行比较。

如 相等 ， 就可确认 收到的报 文 X 的确是A 发送的。 只要入侵 者不 掌 握 密 钥 K , 就 无法伪造

A 的报 文 鉴别码M AC , 因 而无法伪造A 发送的报文。 像这样的报 文鉴别码称为数 字签名，

或数 字指纹。 图 7-7 所示的过程就 是 A 对报文进 行 了 签名 ， 而 B 对报文进 行了鉴别。

• 344  •

二 厂

图 7-7 用 报 文 鉴 别 码 MAC 鉴 别 报 文；

一

图 7-7 所 示 的 鉴 别 过程 并 没 有 执 行 加 密算法 ， 只 是在 计 算散 列 值 时 在 报 文 后 面拼接 了 密

钥 ， 因 此这种 鉴 别 报 文 的 方法 消 耗 的 计 算 资 源很 少 ， 但 却 能有 效地保护 报 文 的 完 整 性 。

一

在许多有关鉴别 的 文 献 中 ， 常常看到在 MAC 前面加上

个 H 的写法， 即 HMAC (Hashed
MAC) 。 MAC 与 HMAC 的 区 别 如 图 7-8 所示 [PETE 1 2 , 第 646 页 ］ 。 前 面 图 7-7 所 示 的 MAC
实 际上 就 是 HMAC 。 计算 HMAC 是规定把密钥 K 拼接在 明 文后 面 ， 然 后 使 用 密 码 散 列 算 法
对 其 进行 运 算 ， 得 出 的 散 列 值就 是 HMAC 。 但在 计 算 MAC 时 则 不
定 这样 做 。 首 先 ， 密
一
钥 K 不
定 非要拼接在 明 文 的 后 面 ， 只 要把密钥 K 作 为
个计算 MAC 的 参数 即 可 。 其 次 ，
可 以 有 多 种 计 算 MAC 的 算 法 ， 不
定 非要 使 用 严 格 的 密码散列 算 法 。 在 RFC 2 1 04 中 ， 对
各种 不 同 情 况 下 HMAC 的 计 算 方 法 都有 着 详细 的 规 定 。 但 在 本 书 中 ， 为 了 方便 ， 对 MAC
和 HMAC 可视为 同 义 词 。

一

一

图 7-8 MAC 与 HMAC 的 区 别

一

一
上 述 这 种 鉴 别 报 文 的 方 法 还 有

些 问 题 有 待 解 决 。 例 如 ， 采 用 怎 样 安 全 有 效 的 方法 来

分发通信双方共享 的 密 钥 K? 另

种 可 行 的 方法是采用 公钥 系 统 。 我们用 图 7-9 来 说 明 。

已 签 名 的 非 固 定 长 度
的报 文鉴别 码

不 安 全 的
互联网

－

-

报 文 X
扩 展 的 报 文一

1总立妳芯汹夕 飞$
发送

A 的 公

长度

的 报 文 鉴 别码

图 7-9 使用 已签名 的 报 文 鉴 别 码 对报 文 鉴 别

用 户 A 对报文 X 进 行 散列运算 ， 得 出 固 定 长 度 的 散 列 H(X) 。 用 自 己 的 私钥对 H(X)进 行

D 运算 （ 也 可 以 说成是用 私 钥 进 行加 密 ） ， 得 出 已 签名 的 但非 固 定长度 的 报 文 鉴别 码 MAC 。

•  345  •

请注 意 ， 这里没有对报文 X 进行加 密 ， 而 是对 很 短 的 散 列 H(X)进行 D 运算 ， 因 此这种运算
仍 然 是 很快 的 。 A 把 已签 名 的 非 固 定 长 度 的 报 文 鉴 别 码 MAC , 拼接在 报 文 X 后 面 ， 构成扩
展 的 报 文 发送给 B 。

B 收 到 扩 展 的 报 文 后 ， 先进行报 文 分 离 。 虽 然 B 不 知 道 已签名 的 报 文 鉴 别 码 的 长度 ，

但 由 千 报 文 X 是 明 文 ， 其 结 束处 可 以 设 有标记 ， 因此分 离 出 MAC 不 困 难 。 分离后 ， B 对报
文 X 进行散列 函 数运 算 ， 同 时 用 A 的 公 钥 对 分离 出 的 已 签 名 的 报 文 鉴 别 码 MAC 进行 E 运
算 （ 也 可 以 说成是用 公 钥 进 行解 密 ） 。 最后对这两个运算结果 H(X)进行 比较 。 如 相 等 ， 就说
切 正 确 。 由 千入 侵 者 没 有 A 的 私钥 ， 因 此 不 可 能伪 造 出 A 发 出 的 报 文 。 这 里 我 们 假 定

一

明
B 事 先 知 道 A 的 公钥 。

“

”

不 难 看 出 ， 采 用 这 种 方法 得 到 的 扩 展 的 报 文 ， 不 仅 是 不 可 伪 造 的 ， 也 是 不 可 否 认 的 。

图 7-9 所 示 的过程 ， 可 简 称 为 ：
7.3.2  实体鉴别

A 用 自 己 的 私 钥 进 行签 名 ， B 用 A 的 公钥 进 行 鉴 别

。

实 体 鉴 别 和 报 文 鉴 别 不 同 。 报 文 鉴 别 是 对 每

个 收 到 的 报 文 都 要 鉴 别 报 文 的 发 送 者 ，

一

而 实 体 鉴 别 是 在 系 统接入 的 全部持续 时 间 内 对和 自 已通信 的对方实体 只 需 验证

次 。

一

最 简 单 的 实体 鉴 别 过程如 图 7- 1 0 所示 。 A 向 远 端 的 B 发送 带 有 自 己 身 份 A （ 例 如 ， A
进行 加 密 。 B 收到此报文

的 姓 名 ） 和 口 令 的 报 文 ， 并且使用 双 方 约 定 好 的 共享对称 密 钥 K
进 行 解密 ， 从而 鉴 别 了 实体 A 的 身 份 。
后 ， 用 共享对称 密 钥 K

AB

AB

图 7- 1 0 仅 使 用 对 称 密 钥 传 送 鉴 别 实 体 身 份 的 报 文

然而这种 简 单 的 鉴 别 方法 具 有 明 显 的 漏 洞 。 例 如 ， 入 侵 者 C 可 以 从 网 络上截获 A 发给

B 的 报 文 ， C 并不 需要破译这 个报文 （ 因 为破译可 能 很 费 时 间 ） ， 而 是直接把这 个 由 A 加 密
的 报 文 发送给 B , 使 B 误认为 C 就是 A ; 然后 B 就 向 伪 装成 A 的 C 发送许 多 本 来应 当 发给
A 的 报 文 。 这就 叫 作 重放攻击(replay attack) 。 C 甚至还可 以 截 获 A 的 IP 地址 ， 然后 把 A 的
IP 地址 冒 充 为 自 己 的 IP 地址 （ 这 叫 作 IP 欺骗 ） ， 使 B 更 加 容 易 受骗 。
为 了 对 付 重 放 攻 击 ， 可 以 使 用 不 重 数 (nonce) 。 不 重 数 就 是

个 不 重 复 使 用 的 大 随机 数 ，

“ 一

一

一

”

次

即
开 。 图 7- 1 1 给 出 了 这个过程 。

数

A

。 在 鉴 别 过程 中 不 重数可 以 使 B 能够把重 复 的 鉴 别请求 和 新 的 鉴 别 请求 区 分

B

时 间

图 7- l l  使 用 不重数进行 鉴 别

•  346  •

在图7-11 中 ， A 首先 用 明文发送其身份 A 和

一

个不重数 RA 给 B 。 接着 ， B 响应 A 的

查问 ， 用共享的 密 钥 KAB 对 队 加 密 后发 回给A , 同时也给出了自己的不重数 RB。 最后 ， A

再响应 B 的查问 ， 用共享的 密 钥 KAB 对 岛 加 密 后发回给 B 。 这里很重要的

一

点是A 和 B 对

不同的会话必须使用不同的不重 数 集。 由 千 不重数不能重 复使用 ， 所以C 在进行重放攻击时

无法重复使用所截获 的不重数。

在使用公钥 密码体制时 ， 可以对不重数进行签名鉴别。 例如在图7-11 中 ， B 用其私钥

对不重数 凡 进行 签 名后发 回 给 A。 A 用 B 的公钥核实签 名 ， 如能得出自己原来发送的不重
数 RA ， 就 核实了和自 已通信的对方的确是 B 。 同样 ， A 也用自己的私 钥对不重数 岛 进行 签
名后发送给 B 。 B 用 A 的公钥核实签名 ， 鉴别了 A 的身份。

公 钥 密码体制 虽 然不必在互相通信的用户 之间 秘 密地分配共享 密 钥 ， 但仍 有受到攻击

的可能。 让 我们看下 面的例子。

C 冒 充是A , 发送报文给 B , 说：

“

我是A

”
。

一

B 选 择

个不重数 RB ， 发送给A , 但被C 截获 了。

C 用自 己的私钥S 尺 冒充是A 的私 钥 ， 对 彻 加 密 ， 并发送给 B 。

B 向A 发送报 文 ， 要求对方把解密用的公钥发送过来 ， 但这 报 文也 被C 截获 了。

C 把自 己的公钥P Kc 冒充是 A 的公钥发送给 B 。

B 用收到的公钥P 长 对收到的加 密的 岛 进行解密 ， 其结果 当然正确。 于是 B 相信通信

的对方是 A , 接着就向 A 发送许多敏感数据 ， 但都被C 截获 了。

然而上述这种欺骗手段不够高明 ， 因为 B 只要打电话询问

A 根本没有和 B 进行通信。 但下 面的

中 间 人攻击

欺骗性。 图7-12 是

中间人攻击

“

＂

“

一

“

下 A 就能 戳穿骗局 ， 因为
(man- i n- t h e- midd le att ack) 就 更加具有

的示意图。

B

时 间

图 7- 1 2 中 间 人攻击

从图7-12 可看出 ， A 想和 B 通信 ， 向 B 发送

我是A " 的报文 ， 并给出了自己的身 份。

“

“
C 截获 ， C 把这个报文原封不动地转发给 B 。 B 选 择

一

个不重数 RB

这个报文被
发送给A , 但同样被C 截获 后也照样转发给A 。

中间人

“

中间人C 用 自 己的私钥S Kc 对 彻 加 密后发 回给 B , 使 B 误以为是A 发来的。 A 收到
岛 后也用自己的私钥S KA 对 岛 加密后发 回 给 B , 但中途被C 截获 并 丢 弃。 B 向 A 索取其
公 钥 ， 这个报文被C 截获 后转发给 A。

C 把 自 己的公钥P Kc 冒充是 A 的公钥发送给 B ， 而C 也 截获 到 A 发送给 B 的公钥P K氏
B 用收到的公钥P Kc（以为是 A 的） 对数据 DAT A 加 密 ， 并发送给 A。C 截 获 后 用自
份 留 下 ， 然后再用 A 的公 钥P KA 对数据 DATA 加 密后发送给A 。
• 347  •

己的私 钥S 应 解密 ， 复制

一

A 收到 数据 后 ， 用 自 己 的 私 钥 SK
加 密 数据 已被 中 间 人 C 截 获并解密 了

份 ， 但 A 和 B 却 都 不 知 道 。

一

解 密 ， 以 为 和 B 进 行 了 保密通信 。 其 实 ， B 发送给 A 的

A

一

由 此可 见 ， 公 钥 的 分 配 以 及 认证 公 钥 的 真 实 性 也 是

个 非 常 重 要 的 问 题 。 关 于 这 点 我

们 在 后 面 ( 7.4.2 节 ） 还 要讨 论 。
7 .4  密钥 分配

一

由 于 密 码 算 法 是 公 开 的 ， 网 络 的 安 全 性 就 完 全 基 于 密 钥 的 安 全 保 护 上 。 因 此 在 密 码 学
密钥 管理 。 密 钥 管理包括 ： 密 钥 的 产 生 、 分 配 、 注入 、 验证和

中 出 现 了
使 用 。 本节 只 讨 论 密 钥 的 分 配 。

个 重 要 的 分 支

密 钥 分配 （ 或密 钥 分 发 ） 是 密 钥 管 理 中 最 大 的 问 题 。 密 钥 必 须 通 过 最 安 全 的 通 路 进 行
分配 。 例 如 ， 可 以 派 非 常 可 靠 的 信 使携 带 密 钥 分配给互相通信 的 各用 户 。 这种 方法称为网外
分配方式 。 但 随 着 用 户 的 增 多 和 网 络 流侬 的 增 大 ， 密 钥 更换 频 繁 （ 密钥 必 须 定 期更 换 才 能 做
到 可靠 ） ， 派信 使 的 办法 已 不 再适 用 ， 而 应 采 用 网 内 分配方式 ， 即 对密 钥 自 动 分 配 。
7.4.1  对称密钥 的 分配

一

一

对称密钥 分配存在 以 下 两个 问 题 。

一
， 如 果 n 个 人 中 的 每

第

两人 共享

个 需要 和 其 他 n - l 个人通信 ， 就 需 要 n(n - l )个 密 钥 。 但每
个密钥 ， 因 此密 钥 数是 n(n - 1 )/2 。 这常称 为 矿 问 题 。 如 果 n 是 个 很 大 的 数 ， 所

需 要 的 密 钥 数量 就 非 常 大 。

第 二 ， 通 信 的 双 方 怎 样 才 能 安 全 地得 到 共 享 的 密 钥 呢 ？ 正 是 因 为 网 络 不 安 全 ， 所 以 才

需 要 使用 加 密 技 术 。 但密钥 又 需 要 怎 样传送 呢 ？

一
大 家 都 信 任 的机构 ， 其任务就是给需要进行秘密 通信 的 用 户 临 时分配

目 前 常 用 的 密 钥 分配方式是 设立密钥 分配 中 心 KDC (Key  Distribution  Center) o   KDC 是
个会话密钥 （ 仅使 用
次 ） 。 在 图 7- 1 3 中 假 定 用 户 A 和 B 都 是 KDC 的 登 记 用 户 。 A 和 B 在 KDC 登 记 时 就 已经
＂
和 KB 。 为简 单 起
。 密 钥 分配分为三个步骤 （ 如 图 7- 1 3 中 带箭

在 KDC 的 服 务 器 上 安 装 了 各 自 和 KDC 进行通信 的 主密钥(master key)  K
见 ， 下 面在叙述时把
简 称 为
头 直 线 上 的 O , ＠ 和 ＠所示 ） 。

主 密 钥

密 钥

A

“

“

＂

一

A

密 钥 分配 中 心
KDC

B

＠

时 间

图 7- 1 3 KDC 对会话密 钥 的 分 配

0 用 户 A 向 密 钥 分 配 中 心 KDC 发送 时 用 明 文 ， 说 明 想 和 用 户 B 通信 。 在 明 文 中 给 出

•  348  •

