第 8 章 互联 网 上 的 音频／视频服务

本 章首 先对互联网提 供音频／视频服务进 行 概 述。 然后 介绍 流式音频／视频中的媒体服务

器 和 实时流式协议 R TSP, 并以IP 电 话 为 例 介绍交互式 音频／视频 所使用 的

一

些协议 ， 如实

时 运 输协议 RT P 、 实时传送控制协议 R TCP 、 H.323 以 及 会 话 发起协议S IP。 接着讨论改进
“

“

尽 最大努力交付

服务的

些措 施 ， 包括怎样使互联 网能 够 提 高服务质 量 ， 并介绍综合服

一

务I ntS erv、 资源预 留协议 RS VP 和 区分服务 DiffSe1-v 的要 点。

本章 最重要的内容是；
( 1 ) 多媒体信息的特点（如时 延和时 延 抖动 ， 播放时 延 等）。
(2) 流媒休的概 念。
(3) IP 电话使用 的几种协议。
“
(4) 改进

尽 最大努力交付

服务的几 种方法。

“

8 . 1  概述

计算机网络 最初是为传送数据 设 计的。 互联网 IP 层提 供的

“

尽 最 大 努 力交付

“

服务以

及 每 一 个 分组独立交付的策略 ， 对传送数据信 息 十分 合 适。 互联网使用 的 TCP 协议可以很

好地解 决 IP 层不能 提供可靠交付这

一

问题。

然而技术 的进步使许 多 用 户 开 始利用互联网传送 音 频／ 视 频 信息。 在许多 情况 下 ， 这种

音 频／视频常称 为 多 媒体 信 息 气 本来 电路交换的 公用 电 话 网 传送话音和多媒体信息早 已是成

熟的技术 。 例 如视频会 议 （ 又称 为电视会议） 原 先是使用 电 路交换的公用 电 话网。 使用 电 路

交 换的 好 处是：

一

旦 连接 建 立了 （也就 是 只 要拨通了 电 话） ， 各 种 信 号 在 电 话线路上的传输

质量 就有保证 。 但使用 公用 电 话 网 的缺 点 是价格太高。 因 此 要 想 办 法改用互联 网。

多 媒 体 信息 （ 包 括声音和图像 信息） 与 不 包 括 声 音 和 图 像 的 数 据信 息 有 很 大 的 区别 ，

其 中 最 主要 的 两 个特点如 下 。

一

第

， 多 媒体 信 息的 信 息量往 往 很 大 。

一

含 有 音 频 或 视频 的多媒体信 息 的 信 息 量
对 于 电 话 的 声音信息 ， 如 采 用 标 准的PCM 编 码 ( 8 kHz速 率 采样 ） ， 而每

个采样脉冲
用 8 位编 码 ， 则 得出 的 声音信 号的数 据率就 是 64 kb it/s 。 对 于高质量的立体声音乐CD 信息 ，
虽 然 它也使用PCM 编 码 ， 但其采样速 率 为 44. 1 kHz, 而 每
个 采样 脉冲用 1 6 位 编 码 ， 因此
这种双声道立体声音乐信号的数据率超过了1. 4 Mb it/s 。

下 面 是 简单的说明 。

般 都 很大 ，

一

一

印 注 ： 多 媒 体 信 息 和 传 统 数 据 信 息 不 同 ， 它 是 指 内 容 上 相 叮 关 联 的 文 本 、 图 形 、 图 像 、 声 音 、 动 画 和 活动 图 像 等 所 形 成 的

复 合 数 据 信 息 。 而 多 媒体业 务 则 应 有 使成件 、 交 且 忤 和 同 步 性 的 特 占 。 集成性 是 指 对 多 媒 体 信 息 进 行 存储 、 传 输 、 处 理 、 显 示 的

能 力 ， 玄 互 件 是 指 人 与 多 媒 体 1i v. 务 系 统之 间的相 叮 拧 制 能 力 ， 同 步 性 是 指 在 多 媒 体＼ I v. 务 终 端 上 显 示 的 图 像 、 声 音 和 文 字 是 以 同 步

方 式 上 1个 的 。 在 本 祁 中 ， 我 们 经 沿把音频／视频信 息 和 多 媒 体 信 息 作 为 同 义 词 来 使 用 ， 虽 然 它 们 并 不 严 格 地等 同 。

• 370  •

再看
一

码， 则

一

下数码 照 片。 假定分辨率为12 80 X  9 60 （ 中等质 量 ）。 若 每 个 像素用24 位进行编

张 未经压缩的照 片的字节数约合3. 52 M B （ 这里 1 B  = 8 bit ,

1 M  = 2

20

)。

活动图 像的信息量就 更大， 如不压缩的彩色电视信号的数据率超过 250 M bit/ s 。
因此在网上传送多媒体信息都无例外地采 用 各种信息压缩技术 。 例如在话音压缩方面 的

标准有 ： 移动通信的GS M C 13 kbit/ s ),  IP 电话使用的G. 729
( 8  kbi t/ s ) 和G.723. 1 ( 6. 4 kbit/ s
和 5.3 kbit/s )； 在立体声音 乐的压缩技术 有MP3 ( 12 8  kbit/ s 或1 1 2 kbi t/ s )。 在视频信 号方面
有 ： VCD 质量的MPE G1  (1 .5 M bit/ s ) 和 DVD 质 量的MPE G .2 (3~6 M bit/ s )。 由 于多媒体

信息压缩技术 本 身不是计算机网络技术 范畴， 本 书将不 讨 论 有关数据压缩方面的内容。

第二， 在传输 多 媒体数据 时 ， 对 时延和 时延抖动 均 有较 高的要 求 。

首先要说明的是， “ 传输 多 媒 体 数据

“

隐 含 地 表 示了

＂

边 传 输边播放

＂

的意思。 因为如

果 是把多媒体音频／视频 节 目 先 下 载到计 算机的硬盘中， 等 下载 完 毕后再 去 播放， 那么 在 互

联网上传输多媒体数据就 没有什么 更多的特点值得我们专 门来讨论 （ 仅仅是数据量非常大而

己 ）。 设 想 我们 想欣赏网上的某 个视频或音频节 目 。 如果必须先 花好 几 个 小时 （ 准确的时间

事先还不知道） 来 下 载它， 等下载完 毕 后才能开始 播放， 那么 这 显 然 是 很 不方便的。 因此，

今后讨论在互联网上传 输多媒体数据时， 都是指含有

边传输边播放

的特点。

“

”

我们知道， 模 拟的多媒体信 号只有经过数字化后才 能在互联网上传送。 就是对 模拟信
一

号要经过采样和 模数转换变为数字信 号， 然后将

定数量的比特组装成 分 组进行传送。 这 些

分 组在发送时的 时间间 隔都是恒定的， 通常称这样的分组为等 时的(i soc hronou s )。 这种等时

分组进入互联网的速率也是恒定的。 但传统的互联网本 身 是非等时的。 这是因为在使用 IP
个分组是独立地传送， 因而这些分组在到达接收端时就变成为非等时
协议的互联网中， 每

一

的。 如果我们在接收端对这些以非恒定速率到达的 分组边接收边还原， 那么 就
大的失真。 图 8 -1 说明了互联 网是非等时的这

特点。

一

一

定会产 生 很

模拟信 号

//＼／  尸 IIIh|IIIIIIIl|||| 了 「 门 门 丿

采 样 后 的 信 号

发送 的 分组
（ 等 时 的 ）

恒 定速率

三 叮联 网/二
\_-心/

到达 的 分 组
（ 非等 时 的 ）

OJ] 门

非恒 定 速 率

困 8- 1 互 联 网 是 非 等 时 的

要解决这

一

问题， 可以在接 收 端设置适 当大 小的缓 存

1

， 当 缓存 中的分组数 达 到

一

定 的

数量 后 再以恒 定速率按顺序将这些分组读 出进行还 原 播放。 图 8-2 说明了缓存的作用 。

到 达 的 分组
（ 非 等时 的 ）

�  I

二

缓 存 （ 队 列 ）

I I I I I I I I I I  匕二二二：

有 可 能 发 生
分 组 丢 失
＼
门

＼

经过缓存
变成等时 的

I  『|

［|

f

非恒 定 速 率

,

T

,

恒 定 速 率

图 8-2 缓存把非等 时 的 分组变换 为 等 时 的

从图8-2 可看出， 缓存实 际上就是

一

个先进先出的 队 列。 图中标明的 T 叫作播放时延，

这 就是从最初的分组开始到达 缓存算起， 经过时间 T 后就按固定时间间 隔把缓 存中的分组

句 注： 请 不 要 和 运输 层 TCP 的 缓 存 弄 混 。 这 里 所 说 的 缓 存 是 在 应 用 层 的 缓 存 。

• 371  •

按先后顺序依 次读出。 我们看 到 ， 缓存 使所有 到达的 分 组都经受 了 迟 延。 由 于分组以非恒定

速率到达， 因此早 到 达的分组 在 缓存 中 停 留的时间较长 ， 而 晚 到达 的 分组在 缓存 中 停 留的时

间 就 较 短。 从缓存 中取出分组是按 照固定 的 时 钟 节 拍 进 行的 ， 因此 ， 到达的非等时的分组，
经 过 缓存后再以恒 定 速 率 读 出 ， 就 变成 了 等 时 的分 组 （ 但 请 注 意 ， 时 延 太大 的 分组就 丢 弃

了 ）， 这 就在 很大程度上消 除 了 时延的抖动。 但 我 们 付 出的 代 价是增加 了 时 延。 以上所述的

概念可以用图8-3 来 说 明。

暴

愚

愚

＿

＿

＿

分
发

组
出

一

＿

暴
－

4

5

6

O推迟播放

l

2

3

到

达

组分
·

数

6

_

1

5

4

3

2

2

3

4

分
到

组
达

一

5

'
,
l
＇
l
l
,

6

口

2

1l

且1

4  5

6

＠ 再推迟播放 时 间

•  t

图 8-3 利 用 缓 存 得 到 等 时 的 分组 序 列

图8-3 画出 了 发送端

一
连 发送 6 个 等 时 的分 组。 如果 网络没有时延 ， 那么 到达的分组数

随时间的变化就如图中最左 边的阶梯状 的 曲 线所 示。 这 就 是 说 ， 只 要发送方

一

发出

一

在接收方到达的分组数就立 即 加 1 。 但 实 际的 网络 使 每

一

个 分组经受的时 延不同， 因此这

个分组，
一

串分组在 到达接收端时就变成 了 非等 时 的 ， 这 就 使得分组 到达的阶梯状 曲 线向 右 移 动， 并且

变成不均匀的。 图8-3 标注出 了 分组 l 的 时 延。 图中给出 了 两 个不 同的开始播放时刻。 黑色

小 圆点表示在播放时刻对 应 的 分组 已经 在 缓存 中 ， 而 空心小 圆 圈表 示 在 播放时刻对应的分组

尚 未 到 达。 我们 可 以 看 出 ， 即使推 迟 了 播 放 时间 （ 如 图 中 的 O ) ， 也 还有 可 能有某个迟到分

组赶不上播放（如 图中的 空 心 小 圆 圈）。 如 果 再 推 迟 播 放时 间 （ 如图中的＠） ， 则所有的 6 个

分组都不会错过 播放， 但 这 样 做 的 时 延 会 较 大。

然 而我们还有

一

些问题 没有 讨 论 。

首 先， 播放时 延 T 应 当选 为 多 大 ？ 把 T 选择得越大， 就可以消 除 更 大 的时 延 抖动， 但

所有分组经受的平均时延也 增 大 了 ， 而 这对某些实时 应 用 （ 如视频会 议 ） 是很不利的。 当然

这对单 向传输的视频节目 问 题 并不 太 大 （ 如从网上 下 载

一

段视频节 目 ， 只 要耐心 多等待

一

段

时间用来将分组放入 缓存 即 可） 。 如 果 T 选 择 得 太 小 ， 那 么 消 除时 延 抖动的 效 果 就较差。 因

此 播放时延 T 的选 择必须 折 中 考 虑。 在传送时延敏感(dela y s ensi

ti ve )的实时数据时， 不 仅传

输时延不 能太大， 而 且 时延抖动也必 须 受 到 限制。

• 372  •

其次， 在 互联网 上 传 输实时数据的分组时 有可能 会出现 差 错或 甚 至 丢 失。 如果 利 用

TCP 协议对这些出错或 丢 失的分组进行重传， 那么 时 延就会 大大增加。 因此 实时数据的传

输 在运输层就应采用用户数据报协议 UDP 而不使用 TCP 协议。 这 就 是 说 ， 对 千传送实时数

据， 我们宁 可 丢 失 少 量 分组 （ 当 然不能 丢 失太多 ）， 也不要太 晚 到 达的分组。 在连 续 的音频

或视频数据流中， 很少量分组的 丢失对播放效果的影响并不大 （ 因为 这 是 山人来进 行 主 观 评

价的）， 因而是可以容 忍的。 丢失容忍(loss tol eran t) 也是实时数据的 另

一

个 重 要 特 点。

由 千分组的到达可能 不 按 序， 但将分组还原和播放时 又 应 当 是 按 序的。 因 此在发 送 多

媒体分组时还应当给每
一

一

个分组加上序 号。 这表明还应 当 有相 应的协议 支持才行。

还有

种情况， 就是要使接 收端能够将 节目中本来就存在的 正 常的短 时 间 停 顿 （ 如话

音中的静默期或音乐中出现的几 拍停 顿 ） 和因某些分组产生的较大迟 延造成的

“

停 顿

开来。 这就需要在每

一

个分组增加

一

个 时 间 戳( tim est amp )， 让接 收端知道所 收到的每

”

一

区分

个分

组是在什么 时间产生的。

有了 序 号 和时间戳， 再 采 用适当的算法， 接 收端 就知道应在什么 时 间 开始 播放缓存中

收到的分组。 这样既可减 少分组的丢失率， 也可使播放的延 迟 在 人们可容忍的范 围之内。

根据以上的 讨论可以看出， 若 想在互联网上传送质量 很好的音频／视频数据， 就需要设

法改造现 有的互联网使它能够适应音频／视频数据的传送。

对这 个问题， 网络界

一

直 有较大的 争论， 众 说 纷 纭。 有人认 为， 只 要大量使用 光 缆，

网络的时延和时 延 抖 动就可以足够小 。 再加上使用具有大容量高速缓存的高速路 由 器， 在 互

联网上传送实时数据就 不会有问题。 也 有人认为， 必须将互联网改造为能够对端到端的 带 宽

实现 预 留 ( res ervation )， 从而 根本改变互联网的协议 栈

从 无 连 接的网络转 变 为 面 向 连 接

的网络。 还有人认为， 部分 改动杠联网的协议 栈所付出的代价较 小， 而 这也 能够使多媒体信

息在互联网上的传输质量得到改进。

尽 管上述的 争 论 仍在 继 续， 但互联网的

一

些新的协议 也在 不断出现。 下面我们 有 选 择

地讨 论与传送音频／视频信息有关的若 干问题。

目前互联 网 提供的音频／视频服务大体上可分为三种类型 ：

(1 ) 流式(s treami n g)存储音频／视频

这种类型是先把已压缩的录制 好的音频／视 频 文件

（ 如音乐、 电影等 ） 存储在服务器上。 用户通过互联网 下载 这样的 文件。 请注意， 用户并不

是把文件全部 下载完毕后再播放， 因为这往往需要很长时间， 而用户

一

般也 不 大 愿意 等待太

长的时间。 流 式存储音频／视 频文件的特点是能够边下 载边播放， 即在文件 下 载 后不 久 （例

一

如，

般在缓存中存放最多几 十 秒 ） 就 开始连续播放 。 请注意， 普通光盘中 的 DVD 电影文

件不是流 式视频文件。 如果我们打算下载

一

部光盘中的普通的 DVD 电影， 那么 你 只 能 花费

很长的时间把整个电影文件全部 下载完毕 后 才能 播放。 请注意， flow 的译名也是
“

流量

”
)， 但意思和st reami n g 完全不同。

”

“

流

（ 或

( 2 ) 流式实 况音 频／视频

这种类型和无线电 台 或电视 台 的实况 广 播相似， 不 同之处是
一

一

一

音频／视 频 节目 的 广 播是通过互联网来传送的。 流 式实况音频／视 频是

对多 （而不是

对

）

的通信。 它的特点是 ： 音频／视 频 节目不是事先录制好和存储在服 务 器中 的， 而是在发送方

边 录 制 边 发 送 （不是录制完 毕 后 再发送）。 在接 收时也要求 能够连续 播 放。 接 收 方 收到节 目

的时间和节目中事件的发生时间可以认为是同时的 （ 相 差仅仅是电磁波的传播时间和很短的

信 号处理时间）。 流 式 实 况音频／视频按理说 应 当 采用 多 播技术 才能 提 高 网 络 资源 的利用率，

• 373  •

但目前实 际上还是使用多个独立的单播 。

(3) 交互式音频／视频

这 种类型是用户使用兀联网和其他人进行实 时交互式通信 。 现

在的互联网电话或互联网电视会议 就 属 千 这 种类 型 。

“

“

请注意 ， 对 千流式音频／视频的

下 载

， 实 际 上并没有把

＂

“

下 载

的内容存储在硬盘上 。

“

因此当

边 下 载边播放

”

结束后 ， 在用户的硬盘上没有 留 下 有关播放内容 的 任何痕迹 。 播放

流式音频／视频的用户 ， 仅仅能够在屏 幕上观看播放的内容 。 用户既不能 修改节目内容 ， 也

不能把播放的内容存 储 下 来 ， 因此也 无法进行转发 。 这 对保护版权非常有利 。

不过技术 总是在不断进 步的 ， 现在已经有了能够存 储在网上播放的流式音频／视频文件

的软件 。

我们 现在常见的词汇流媒体( st r eami n gm ed i a)就是上 面 所说的流式音频／视频 。 流媒体最

主要的特点就是不是全部都 收录 下来 再 开始 播放 。 在 国外 的

一

些文献 中 ， 常见到 st r eami n g

一 词 ， 网上有人译为

“

串 流

“

”

或

流播

“

， 但目前还没有 找到对 st r eam i n g 更好 的译 名 。

限于篇 幅 ， 下 面简单介绍 上面的第

一

种和第三 种音频／视 频类型的服务 。

8 . 2   流式存储音频／视频

“

流式存储音频／视频

”

中的

“

存储

“

二字 ， 表明这 里所讨 论的流式音频／视频文件不是

实时产生的 ， 而是已经录制 好 的 ， 通常存储在光盘或硬盘中 。 不过有时为了简便 ， 往往 省 略

“

“ 存 储

二字 。 在讨 论从网上 下 载这 种文件之前 ， 我们 先 回忆

一

下使用传统的浏 览器是 怎样

从服务 器 下 载已经录制好的音频／视颜 文件的 。 图8-4 说 明 了 下 载 的 三 个步 骤 。

客 户 机
一1�
I

，

，

服 务 器

GET 音 频／视频 文 件

R ESPONSE

图 8-4 传 统 的 下 载 文 件 方 法

0 用户从客户机(c li ent mac hi ne)的浏 览器上用 HTTP 协议向服务器请求下载 某 个音频／

视频文件 ， GET 表示请求下 载的HTTP 报 文 。 请 注意 ， HTT P 使用 TCP连接 。

＠ 服务器如有此文件就发送给浏 览器 ， R ESPO NS E 表示服务器的HTTP 响应报 文 。 在

响应报 文中装有用户所要的音频／视频文件 。 整个下载过程可能会 花 费 很 长的时间 。

＠ 当浏 览器 完 全 收 下 这 个文件后（所需的时间取决 千音频／视频文件的大小 ） ， 就可以

传送给自己机器上的媒体播放器进行解压缩 ， 然后播放 。

为什么 不能直接在浏 览器中播放音频／视频文件呢？这是因为播放器并没有集成在 万维

网浏 览器中 。 因此 ， 必须 使用
个单独的应用 程 序来播放这 种音频／视频节目 。 这 个应用 程
序通常称为媒体播放器(m edi ap l ayer) 。 现在流行的媒体播 放 器有 R ealN etw o rk s 的 R ealP layer、
微软的 W i nd ow s M edi a P layer 和苹果 公司的 Qui c kTi me 。 媒体播放器具有的主要功能是： 管

一

• 374  •

