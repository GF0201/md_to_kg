6. 6  动态主机配置协议 DHCP

视 频 讲 解

为 了 把协议软件做成通用 的 和 便 于 移植 的 ， 协议软件 的 编 写 者 不会把所
一
有 的 细 节 都 固 定 在源代码 中 。 相 反 ， 他们把协议软件参数化 。 这就使得在很
一

一

一

一

多 台 计 算机上 有 可 能 使 用 同

个经过编 译 的 二进制代码 。

台 计算机和 另
一

台 计算 机 的 许 多

区 别 ， 都可 以通过

些不 同 的参数来体现 。 在 协议软件运行之前 ， 必 须给每

个参数赋值 。

在 协 议 软 件 中 给 这 些 参 数 赋 值 的 动 作 叫 作 协议配置 。

个 协 议 软 件 在 使 用 之 前 必 须 是

已 正 确 配置 的 。 具 体 的 配置信 息 有 哪 些 则 取决千协议栈 。 例 如 ， 连接到 互 联 网 的 计 算 机 的 协
议软件需要配置 的 项 目 包括 ：

( 1 )  IP 地址 ；
(2) 子 网 掩码 ；
(3) 默认路 由 器 的 IP 地址 ；
(4) 域 名 服务器 的 IP 地址 。
一
为 了 省 去给计算机配置 IP 地址 的 麻烦 ， 我们 能 否 在计算机 的 生产 过程 中 ， 事 先给 每

一

一

一

一

一

台 计 算机配置好
一

个 唯

的 IP 地址 呢 （ 如 同 每
一

个 以 太 网 适配器拥有

个 唯

的 MAC 地

址 ） ？ 这 显 然 是 不行 的 。 这 是 因 为 IP 地址不仅包括 了 主机 号 ， 而 且还包括 了 网 络 号 。 一 个
IP 地址 指 出 了
个 网 络 上 。 当 计 算机还 在 生 产 时 ， 无 法 知 道 它 在 出 厂
台 计 算机 连 接 在 哪
个 网 络 上 。 因 此 ， 需 要 连 接 到 互 联 网 的 计算机 ， 必 须对 IP 地址等项 目 进

一

后 将 被连接 到 哪
行协议配置 。

一

一
Protocol) ， 它 提供 了

用 人工进行协议配置很不方便 ， 而 且容 易 出 错 。 因 此 ， 应 当采用 自 动协议配置 的 方法 。
互 联 网 现 在 广 泛 使 用 的 是 动 态 主 机 配 置 协 议 DHCP (Dynamic  Host  Configuration
种 机 制 ， 称 为 即 插即 用 连 网(plug-and-play networking) 。 这种机制 允 许
—
台 计 算机加 入新 的 网 络 和 获取 IP 地址而不 用 手 工 参 与 。 DHCP 最新 的 RFC 文 档 还 是 互 联
一

网 草 案标 准 [RFC 2 1 3 1

2 1 32] 。

DHCP 对 运 行 客 户 软件和服务器软件 的 计 算机都适用 。 当 运行客户 软件 的 计 算机移至
个 新 的 网 络 时 ， 就可 使 用 DHCP 获 取其配置信 息 而 不 需 要 手 工 干 预 。 DHCP 给运行服务器
软 件 而 位置 固 定 的 计 算机指派

个永久地址 ， 而 当 这计算机重新启 动 时 其地址不 改变 。

一

DHCP 使 用 客 户 服务器方式 。 需 要 IP 地址 的 主 机 在 启 动 时 就 向 DHCP 服务器广播发送
发 现报文(DHCPDISCOVER) （ 将 目 的 IP 地址置为全 1 , 即 255 .255 .255.255 ) ， 这时 该 主机就
成为 DHCP 客 户 。 发 送广 播报 文 是 因 为现在还不 知 道 DHCP 服务器在什 么 地方 ， 因 此 要 发
现(DISCOVER)DHCP 服 务 器 的 IP 地址 。 这 台 主机 目 前还没有 自 己 的 IP 地址 ， 因 此它 将 I P
数据 报 的 源 IP 地 址 设 为 全 0 。 这样 ， 在 本地 网 络 上 的 所有 主 机 都 能 够 收 到 这 个广 播报 文 ，
但 只 有 DHCP 服务器才对此广播报文进行 回 答 。 DHCP 服 务 器 先 在 其 数 据 库 中 查找 该 计 算
机 的 配置 信 息 。 若 找 到 ， 则 返 回 找 到 的 信 息 。 若 找 不 到 ， 则 从服 务 器 的 IP 地 址 池(address
”
pool) 中 取
个 地 址 分 配 给 该 计 算机 。 DHCP 服 务 器 的 回 答报 文 叫 作提供报文(DHCPOFFER) ,
表 示

提供

一

一

一

“

了 IP 地址等配置信 息 。
一

一

但是我们 并 不 愿 意 在 每
务器 的 数量太 多 。 因 此现在是使每
是

（ 通常
台 路 由 器 ， 如 图 6- 1 8 所 示 ） ， 它配置 了 DHCP 服 务 器 的 IP 地址信 息 。 当 DHCP 中 继代

个 网 络至 少 有

个 DHCP 服务器 ， 因 为这样会使 DHCP 服
个 DHCP 中 继代理(relay agent)

个 网 络 上 都 设置

一

理 收 到 主机 A 以广播形式发送 的 发现报文 后 ， 就 以单播方式 向 DHCP 服 务 器转发此报 文 ，

•  304  •

并等待其回答。 收到 DHCP 服务器 回答的提供报文后， DHCP 中继代 理再把此提供报文发
回给主机A 。 需要注意的是， 图 6- 1 8 只是个示意 图。 实际上， DHCP 报 文只是 UDP 用 户数

据报的数据， 它还要加上 UDP 首部、 IP 数据报 首部， 以及以太网的MAC 帧的首部和尾部

后， 才能在链路上传送。

主机 A

广播
I DHCPDISCOVE R

尸

DHCP 服 务 器

% 1

单 播
I DHCPDISCOVER

尸

DHCP 中 继代理

图

中 继代理 以 单 播方式转发 发现报 文

6- 1 8 DHCP

DHCP 服务器分配给 DHCP 客户的 IP 地址是临时的， 因此 DHCP 客户只能在

一

段有 限

的时间内使用 这 个分配到的IP 地址。 DHCP 协议称这 段时间为租用期(

leas ep eriod )， 但并没

有具体 规定租用 期应取为多长或至少为多长， 这 个数值应 由 DHCP 服务器自己决定。 例如，

一个校 园网的 DHCP 服务器可将租用 期设定为 1 小时。 DHCP 服务器在给 DHCP 发送的提
供报文的选项中给出租用 期的数值。 按照 RFC 2132 的规 定， 租 用 期用 4 字节的二进制数字

表示， 单位是秒。 因此可供选 择的租用 期范 围从1 秒到136年。 DHCP 客户也可在 自 已发送

的报文中（例如， 发现报文） 提出对租用 期的要求。

DHCP 的详细工作过程如图6- 1 9 所示。 DHCP 客户使用的 UDP 端 口 是 6 8 , 而 DHCP

服务器使用的 UDP 端 口 是67。 这 两个 UDP 端 口 都是熟知端 口 。

＠

,

I

三 o

UDP

UDP

UDP

UDP

UDP

UDP

DHCPDISCOVER

DHCPOFFER

DHCPREQUEST

DHCPACK

DHCPREOUEST

DHCPACK

DHCPNACK

DHCPRELEASE

协 议 的 工 作 过程

下面按照 图 6- 1 9 中的注释编 号 ( 0 至 O) 进行简单的解释。

图 6- 1 9 DHCP

0  DHCP 服务器被动打 开 UDP 端 口 67 , 等待客户端发来的报文。
8  DHCP 客户从 UDP 端 口 6 8 发送 DHCP 发现报 文。

视 频 讲 解

＠ 凡 收到 DHCP 发现报文的 DHCP 服务器都发出 DHCP 提供报文， 因此 DHCP 客户

•  305 •

可能收到多个 DHCP 提供报文。

0  DHCP 客户从几 个 DHCP 服务 器 中选 择其中的

一

个， 并向所选 择的 DHCP 服务器

发送 DHCP 请求报文 。

© 被选 择 的 DHCP 服务器发送确认报文 DHCPACK。 从这时起， DHCP 客户就 可以使

用这个 IP 地址了。 这种状 态叫 作 已 绑定 状 态， 因为在 DHCP 客户端的IP 地址和

MAC 地址 已经完成绑定， 并且可以开始使用得到的 临时I P 地址了。
DHCP 客户现在要根据服务 器提供的租用 期 T 设置两个计时器T 1 和T 2 , 它们的超

时时间分别是 0.5T 和0.875T 。 当超时时间到了就要请求更新租用期。

0 租用 期过了

一

新租用期。

半 （T 1 时间到）， DHCP 客户发送请 求报 文 DHCPRE Q UE S T 要求更

8  DHCP 服务器若 同意， 则发回确认报文 DHCPACK。 DHCP 客户得到了新的租用期，

重新设置计时器。

0  DHCP 服务 器 若不同意， 则发回 否 认报文 DHCPNACK。 这 时 DHCP 客户必须立即

停 止使用原来的IP 地址， 而必须重新 申 请IP 地址（回到步骤＠）。
若 DHCP 服务 器 不 响应 步 骤 0 的 请 求 报 文 DHCPRE Q UE S T , 则 在 租 用 期过 了

87. 5 ％时（兀 时间到）， DHCP 客户必须重新发送请求报文 DHCPRE Q UE ST （重复

步 骤 0)， 然后又继 续后面的步骤。

0  DHCP 客户可以随时提前终止服务器所提供的租用期， 这时只需向 DHCP 服务器发

送释放报文 DHCPRE LE ASE 即可。

DHCP 很 适 合千经常移动位置的计算机。 当计算机使用 Wi n dows 操作系统时， 点击

“

控制面板

”

“

“

的
“

网络
”

协议 后点击其

属 性

按钮， 若选 择

图标就可以找到某个连接中的

“

自 动获 得IP 地址

”

“

”

网络
“

和

下 面的菜单， 找到 TCP/ IP
”

自动获 得 DNS 服务器地址

选 项， 就 表示是使用 DHCP 协议。

6 . 7   简 单 网 络管理协议 S N M P

6.7. 1  网 络 管 理 的 基本概念

虽然网络管理还没有精确定义， 但它的内容可 归 纳为 ：

网络管理包括对硬件 、 软件 和 人 力 的使用、 综 合 与协调 ， 以 便 对网络 资源 进行监视、

测试、 配置 ｀ 分析、 评价和 控制 ， 这样就能 以合理的价格满足网络的
性 能 、 服务质量等 。 网络管理常简 称为网管 。

—

些 需 求 ， 如 实 时运行

我们可以看到， 网络管理并不是指对网络进行 行政上的管理。
网 络是

个非常 复 杂的分布式系统。 这是因为网络上有 很多不 同 厂家生产的 、 运行着

一

多种协议的节点（主要是 路 由 器）， 而这 些节点还在相互通信和交换信息。 网络的状态 总 是
一

一

不断地变化着。 可见， 我们必须使用

种机制来读取这 些 节 点上的状态信息， 有时还要把

些新的状态信息写入到这些节点上。

下 面简 单介绍网络管理模型中的主要构件 （ 如 图 6 -20 所示）。
管理 站 又称为管理器， 是整个网络管理系统的核 心， 它通常是个有着良好 图形界面的

高 性能的工作站， 并 由网络管理 员 直接操 作 和 控制。 所有 向被管设备 发送的命 令都是从管 理

站发出的。 管理站的所在部门也 常称为网络运行 中 心NOC (N etw ork Op erati ons Ce nt er)。 管

• 306  •

